{"url": "https://github.com/mihonapp/mihon/issues/2345", "repo": {"url": "https://github.com/mihonapp/mihon", "name": "mihon", "owner": "mihonapp", "modules": ["eu.kanade.core", "eu.kanade.domain", "eu.kanade.presentation", "eu.kanade.tachiyomi", "eu.kanade.test", "mihon.buildlogic", "mihon.buildlogic.tasks", "mihon.core.archive", "mihon.core.common", "mihon.core.designsystem", "mihon.core.migration", "mihon.data.repository", "mihon.domain.chapter", "mihon.domain.extensionrepo", "mihon.domain.manga", "mihon.domain.migration", "mihon.domain.upcoming", "mihon.feature.common", "mihon.feature.migration", "mihon.feature.upcoming", "mihon.presentation.core", "mihon.telemetry", "tachiyomi.core.common", "tachiyomi.core.metadata", "tachiyomi.data", "tachiyomi.data.category", "tachiyomi.data.chapter", "tachiyomi.data.history", "tachiyomi.data.manga", "tachiyomi.data.release", "tachiyomi.data.source", "tachiyomi.data.track", "tachiyomi.data.updates", "tachiyomi.domain.backup", "tachiyomi.domain.category", "tachiyomi.domain.chapter", "tachiyomi.domain.download", "tachiyomi.domain.history", "tachiyomi.domain.library", "tachiyomi.domain.manga", "tachiyomi.domain.release", "tachiyomi.domain.source", "tachiyomi.domain.storage", "tachiyomi.domain.track", "tachiyomi.domain.updates", "tachiyomi.macrobenchmark", "tachiyomi.presentation.core", "tachiyomi.presentation.widget", "tachiyomi.source.local"]}, "issue": {"number": 2345, "url": "https://github.com/mihonapp/mihon/issues/2345", "state": "closed", "title": "App crashes when press filter while there is nothing in the library", "body": "![mihon_crash_logs.txt](https://github.com/user-attachments/files/21579448/mihon_crash_logs.txt)\n\n", "logs": [{"name": "mihon_crash_logs.txt", "url": "https://github.com/user-attachments/files/21579448/mihon_crash_logs.txt"}]}, "pull_request": [{"number": 2355, "url": "https://github.com/mihonapp/mihon/pull/2355", "diff_url": "https://github.com/mihonapp/mihon/pull/2355.diff", "patch_url": "https://github.com/mihonapp/mihon/pull/2355.patch", "title": "Update LibraryScreenModel", "content": "Closes #2345\r\nCloses #2351\r\n - Get `selectedManga` before switching scope\r\n - Provide default category for `activeCategory` on empty favorites (library)\r\n", "diff": "diff --git a/CHANGELOG.md b/CHANGELOG.md\nindex 8e143e947e..e8e54a4851 100644\n--- a/CHANGELOG.md\n+++ b/CHANGELOG.md\n@@ -22,6 +22,8 @@ The format is a modified version of [Keep a Changelog](https://keepachangelog.co\n - Fix local source EPUB files not loading ([@AntsyLich](https://github.com/AntsyLich)) ([#2369](https://github.com/mihonapp/mihon/pull/2369))\n - Fix title text color in light mode on mass migration list ([@AntsyLich](https://github.com/AntsyLich)) ([#2370](https://github.com/mihonapp/mihon/pull/2370))\n - Fix 'Default' category showing in library with no user-added categories ([@AntsyLich](https://github.com/AntsyLich)) ([#2371](https://github.com/mihonapp/mihon/pull/2371))\n+- Fix crash when opening filter sheet with an empty library ([@krysanify](https://github.com/krysanify/)) ([#2355](https://github.com/mihonapp/mihon/pull/2355))\n+- Fix mark as read/unread not working for selected library items ([@krysanify](https://github.com/krysanify/)) ([#2355](https://github.com/mihonapp/mihon/pull/2355))\n \n ## [v0.19.0] - 2025-08-04\n ### Added\ndiff --git a/app/src/main/java/eu/kanade/tachiyomi/ui/library/LibraryScreenModel.kt b/app/src/main/java/eu/kanade/tachiyomi/ui/library/LibraryScreenModel.kt\nindex d07609340d..c5ac3131ee 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/ui/library/LibraryScreenModel.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/ui/library/LibraryScreenModel.kt\n@@ -499,8 +499,9 @@ class LibraryScreenModel(\n      * Marks mangas' chapters read status.\n      */\n     fun markReadSelection(read: Boolean) {\n+        val selection = state.value.selectedManga\n         screenModelScope.launchNonCancellable {\n-            state.value.selectedManga.forEach { manga ->\n+            selection.forEach { manga ->\n                 setReadStatus.await(\n                     manga = manga,\n                     read = read,\n@@ -573,7 +574,7 @@ class LibraryScreenModel(\n \n     fun getRandomLibraryItemForCurrentCategory(): LibraryItem? {\n         val state = state.value\n-        return state.getItemsForCategoryId(state.activeCategory.id).randomOrNull()\n+        return state.getItemsForCategoryId(state.activeCategory?.id).randomOrNull()\n     }\n \n     fun showSettingsDialog() {\n@@ -631,7 +632,7 @@ class LibraryScreenModel(\n         lastSelectionCategory = null\n         mutableState.update { state ->\n             val newSelection = state.selection.mutate { list ->\n-                state.getItemsForCategoryId(state.activeCategory.id).map { it.id }.let(list::addAll)\n+                state.getItemsForCategoryId(state.activeCategory?.id).map { it.id }.let(list::addAll)\n             }\n             state.copy(selection = newSelection)\n         }\n@@ -641,7 +642,7 @@ class LibraryScreenModel(\n         lastSelectionCategory = null\n         mutableState.update { state ->\n             val newSelection = state.selection.mutate { list ->\n-                val itemIds = state.getItemsForCategoryId(state.activeCategory.id).fastMap { it.id }\n+                val itemIds = state.getItemsForCategoryId(state.activeCategory?.id).fastMap { it.id }\n                 val (toRemove, toAdd) = itemIds.partition { it in list }\n                 list.removeAll(toRemove)\n                 list.addAll(toAdd)\n@@ -756,7 +757,7 @@ class LibraryScreenModel(\n             maximumValue = displayedCategories.lastIndex.coerceAtLeast(0),\n         )\n \n-        val activeCategory: Category by lazy { displayedCategories[coercedActiveCategoryIndex] }\n+        val activeCategory: Category? = displayedCategories.getOrNull(coercedActiveCategoryIndex)\n \n         val isLibraryEmpty = libraryData.favorites.isEmpty()\n \n@@ -764,7 +765,8 @@ class LibraryScreenModel(\n \n         val selectedManga by lazy { selection.mapNotNull { libraryData.favoritesById[it]?.libraryManga?.manga } }\n \n-        fun getItemsForCategoryId(categoryId: Long): List<LibraryItem> {\n+        fun getItemsForCategoryId(categoryId: Long?): List<LibraryItem> {\n+            if (categoryId == null) return emptyList()\n             val category = displayedCategories.find { it.id == categoryId } ?: return emptyList()\n             return getItemsForCategory(category)\n         }\n", "changes": [{"file": "app/src/main/java/eu/kanade/tachiyomi/ui/library/LibraryScreenModel.kt", "module": "eu.kanade.tachiyomi.ui.library.LibraryScreenModel", "range": [{"start": 502, "end": 502}, {"start": 503, "end": 504}, {"start": 576, "end": 577}, {"start": 634, "end": 635}, {"start": 644, "end": 645}, {"start": 759, "end": 760}, {"start": 767, "end": 768}]}]}]}
{"url": "https://github.com/mihonapp/mihon/issues/2081", "repo": {"url": "https://github.com/mihonapp/mihon", "name": "mihon", "owner": "mihonapp", "modules": ["eu.kanade.core", "eu.kanade.domain", "eu.kanade.presentation", "eu.kanade.tachiyomi", "eu.kanade.test", "mihon.buildlogic", "mihon.buildlogic.tasks", "mihon.core.archive", "mihon.core.common", "mihon.core.designsystem", "mihon.core.migration", "mihon.data.repository", "mihon.domain.chapter", "mihon.domain.extensionrepo", "mihon.domain.manga", "mihon.domain.migration", "mihon.domain.upcoming", "mihon.feature.common", "mihon.feature.migration", "mihon.feature.upcoming", "mihon.presentation.core", "mihon.telemetry", "tachiyomi.core.common", "tachiyomi.core.metadata", "tachiyomi.data", "tachiyomi.data.category", "tachiyomi.data.chapter", "tachiyomi.data.history", "tachiyomi.data.manga", "tachiyomi.data.release", "tachiyomi.data.source", "tachiyomi.data.track", "tachiyomi.data.updates", "tachiyomi.domain.backup", "tachiyomi.domain.category", "tachiyomi.domain.chapter", "tachiyomi.domain.download", "tachiyomi.domain.history", "tachiyomi.domain.library", "tachiyomi.domain.manga", "tachiyomi.domain.release", "tachiyomi.domain.source", "tachiyomi.domain.storage", "tachiyomi.domain.track", "tachiyomi.domain.updates", "tachiyomi.macrobenchmark", "tachiyomi.presentation.core", "tachiyomi.presentation.widget", "tachiyomi.source.local"]}, "issue": {"number": 2081, "url": "https://github.com/mihonapp/mihon/issues/2081", "state": "closed", "title": "App crashes after some time", "body": "![mihon_crash_logs.txt](https://github.com/user-attachments/files/20108974/mihon_crash_logs.txt)\n\n\n\nApp ID: app.mihon.debug\nApp version: 0.18.0-7234 (86ebf5581, 11, 2025-05-08T17:40:04Z)\nAndroid version: 14 (SDK 34; build UKQ1.230917.001 release-keys)\nDevice brand: Redmi\nDevice manufacturer: Xiaomi\nDevice name: tapas (tapas_global)\nDevice model: 23021RAAEG\nWebView: Android System WebView 135.0.7049.111\nCurrent time: 2025-05-08T19:42:47.965656+01:00\n\njava.lang.Throwable: java.lang.IllegalStateException: State is 'DESTROYED' and cannot be moved to `STARTED` in component cafe.adriel.voyager.androidx.AndroidScreenLifecycleOwner@14c9511\n\tat androidx.lifecycle.LifecycleRegistry.moveToState(Unknown Source:115)\n\tat androidx.lifecycle.LifecycleRegistry.handleLifecycleEvent(Unknown Source:14)\n\tat androidx.compose.animation.AnimatedContentKt$AnimatedContent$6$1$5$1$1$invoke$$inlined$onDispose$1.dispose(Unknown Source:35)\n\tat androidx.compose.runtime.DisposableEffectImpl.onForgotten(Unknown Source:4)\n\tat androidx.compose.runtime.internal.RememberEventDispatcher.dispatchRememberObservers(Unknown Source:49)\n\tat androidx.compose.runtime.CompositionImpl.applyChangesInLocked(Unknown Source:60)\n\tat androidx.compose.runtime.CompositionImpl.applyChanges(Unknown Source:5)\n\tat androidx.compose.material3.DatePickerKt$HorizontalMonthsList$1$2$1.invoke(Unknown Source:237)\n\tat androidx.compose.ui.platform.AndroidUiFrameClock$withFrameNanos$2$callback$1.doFrame(Unknown Source:6)\n\tat androidx.compose.ui.platform.AndroidUiDispatcher$dispatchCallback$1.doFrame(Unknown Source:47)\n\tat android.view.Choreographer$CallbackRecord.run(Choreographer.java:1632)\n\tat android.view.Choreographer$CallbackRecord.run(Choreographer.java:1643)\n\tat android.view.Choreographer.doCallbacks(Choreographer.java:1172)\n\tat android.view.Choreographer.doFrame(Choreographer.java:1072)\n\tat android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:1607)\n\tat android.os.Handler.handleCallback(Handler.java:958)\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\n\tat android.os.Looper.loopOnce(Looper.java:224)\n\tat android.os.Looper.loop(Looper.java:318)\n\tat android.app.ActivityThread.main(ActivityThread.java:8727)\n\tat java.lang.reflect.Method.invoke(Native Method)\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:561)\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1013)\n\tSuppressed: kotlinx.coroutines.internal.DiagnosticCoroutineContextException: [androidx.compose.runtime.PausableMonotonicFrameClock@9e0e113, androidx.compose.ui.platform.MotionDurationScaleImpl@105cf50, StandaloneCoroutine{Cancelling}@c83d549, AndroidUiDispatcher@e943e4e]\n\n\n--------- beginning of system\n2025-05-08 15:44:17.627 +0100 27021 27021 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 16:02:59.917 +0100 31979 31979 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 16:03:33.169 +0100 32517 32517 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 16:16:18.337 +0100  1490  1490 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 16:35:17.365 +0100  5466  5466 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 18:07:45.384 +0100 23628 23628 E MQSEventManagerDelegate: failed to get MQSService.\n--------- beginning of main\n2025-05-08 19:22:33.174 +0100  2207  2207 E app.mihon.debug: Not starting debugger since process cannot load the jdwp agent.\n2025-05-08 19:22:33.220 +0100  2207  2207 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 19:22:33.436 +0100  2207  2293 E SQLiteLog: (283) recovered 358 frames from WAL file /data/data/app.mihon.debug/databases/tachiyomi.db-wal\n2025-05-08 19:22:33.468 +0100  2207  2340 E app.mihon.debug: No package ID 75 found for resource ID 0x750b000f.\n2025-05-08 19:22:34.280 +0100  2207  2332 E libEGL  : pre_cache appList: com.miui.weather2,,\n2025-05-08 19:22:34.302 +0100  2207  2332 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:22:35.281 +0100  2207  2963 E SQLiteLog: (284) automatic index on C(manga_id)\n2025-05-08 19:22:35.281 +0100  2207  2963 E SQLiteLog: (284) automatic index on mangas_categories(manga_id)\n2025-05-08 19:22:35.606 +0100  2207  2332 E LB      : fail to open file: No such file or directory\n2025-05-08 19:22:35.606 +0100  2207  2332 E LB      : fail to open node: No such file or directory\n2025-05-08 19:22:38.812 +0100  2207  2332 E libEGL  : pre_cache appList: com.miui.weather2,,\n2025-05-08 19:22:39.383 +0100  2207  2332 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:25:43.454 +0100  2207  2332 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:27:24.652 +0100  2207  2332 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:27:26.335 +0100  2207  2332 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:27:27.257 +0100  2207  2332 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:27:31.490 +0100  2207  2332 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:28:19.386 +0100  2207  2332 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:28:20.064 +0100  2207  2332 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:28:39.393 +0100  2207  2332 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:28:43.431 +0100  2207  2332 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:30:21.370 +0100  5963  5963 E app.mihon.debug: Not starting debugger since process cannot load the jdwp agent.\n2025-05-08 19:30:21.437 +0100  5963  5963 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 19:30:21.667 +0100  5963  6038 E app.mihon.debug: No package ID 75 found for resource ID 0x750b000f.\n2025-05-08 19:30:21.668 +0100  5963  6032 E SQLiteLog: (283) recovered 184 frames from WAL file /data/data/app.mihon.debug/databases/tachiyomi.db-wal\n2025-05-08 19:30:22.745 +0100  5963  6046 E libEGL  : pre_cache appList: com.miui.weather2,,\n2025-05-08 19:30:22.770 +0100  5963  6046 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:30:23.750 +0100  5963  6032 E SQLiteLog: (284) automatic index on C(manga_id)\n2025-05-08 19:30:23.750 +0100  5963  6032 E SQLiteLog: (284) automatic index on mangas_categories(manga_id)\n2025-05-08 19:30:24.124 +0100  5963  6046 E LB      : fail to open file: No such file or directory\n2025-05-08 19:30:24.124 +0100  5963  6046 E LB      : fail to open node: No such file or directory\n2025-05-08 19:30:39.109 +0100  5963  6046 E libEGL  : pre_cache appList: com.miui.weather2,,\n2025-05-08 19:33:37.829 +0100  5963  6046 E OpenGLRenderer: Unable to match the desired swap behavior.\n--------- beginning of crash\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: FATAL EXCEPTION: main\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: Process: app.mihon.debug, PID: 5963\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: java.lang.IllegalStateException: State is 'DESTROYED' and cannot be moved to `STARTED` in component cafe.adriel.voyager.androidx.AndroidScreenLifecycleOwner@aaefb67\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat androidx.lifecycle.LifecycleRegistry.moveToState(Unknown Source:115)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat androidx.lifecycle.LifecycleRegistry.handleLifecycleEvent(Unknown Source:14)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat androidx.compose.animation.AnimatedContentKt$AnimatedContent$6$1$5$1$1$invoke$$inlined$onDispose$1.dispose(Unknown Source:35)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat androidx.compose.runtime.DisposableEffectImpl.onForgotten(Unknown Source:4)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat androidx.compose.runtime.internal.RememberEventDispatcher.dispatchRememberObservers(Unknown Source:49)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat androidx.compose.runtime.CompositionImpl.applyChangesInLocked(Unknown Source:60)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat androidx.compose.runtime.CompositionImpl.applyChanges(Unknown Source:5)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat androidx.compose.material3.DatePickerKt$HorizontalMonthsList$1$2$1.invoke(Unknown Source:237)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat androidx.compose.ui.platform.AndroidUiFrameClock$withFrameNanos$2$callback$1.doFrame(Unknown Source:6)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat androidx.compose.ui.platform.AndroidUiDispatcher$dispatchCallback$1.doFrame(Unknown Source:47)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat android.view.Choreographer$CallbackRecord.run(Choreographer.java:1632)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat android.view.Choreographer$CallbackRecord.run(Choreographer.java:1643)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat android.view.Choreographer.doCallbacks(Choreographer.java:1172)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat android.view.Choreographer.doFrame(Choreographer.java:1072)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:1607)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat android.os.Handler.handleCallback(Handler.java:958)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat android.os.Handler.dispatchMessage(Handler.java:99)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat android.os.Looper.loopOnce(Looper.java:224)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat android.os.Looper.loop(Looper.java:318)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat android.app.ActivityThread.main(ActivityThread.java:8727)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat java.lang.reflect.Method.invoke(Native Method)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:561)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1013)\n2025-05-08 19:33:53.909 +0100  5963  5963 E AndroidRuntime: \tSuppressed: kotlinx.coroutines.internal.DiagnosticCoroutineContextException: [androidx.compose.runtime.PausableMonotonicFrameClock@f45a4b9, androidx.compose.ui.platform.MotionDurationScaleImpl@8edb0fe, StandaloneCoroutine{Cancelling}@b95f05f, AndroidUiDispatcher@68e7aac]\n2025-05-08 19:33:53.911 +0100  5963  5963 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 19:33:54.020 +0100  6724  6724 E g:error_handler: Not starting debugger since process cannot load the jdwp agent.\n2025-05-08 19:33:54.040 +0100  6724  6724 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 19:33:54.365 +0100  6724  6758 E SQLiteLog: (283) recovered 108 frames from WAL file /data/data/app.mihon.debug/databases/tachiyomi.db-wal\n2025-05-08 19:33:54.379 +0100  6724  6776 E g:error_handler: No package ID 75 found for resource ID 0x750b000f.\n2025-05-08 19:33:54.991 +0100  6818  6818 E app.mihon.debug: Not starting debugger since process cannot load the jdwp agent.\n2025-05-08 19:33:55.054 +0100  6818  6818 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 19:33:55.204 +0100  6818  6848 E SQLiteLog: (5) statement aborts at 2: [PRAGMA journal_mode=TRUNCATE] database is locked\n2025-05-08 19:33:55.234 +0100  6818  6868 E app.mihon.debug: No package ID 75 found for resource ID 0x750b000f.\n2025-05-08 19:33:55.774 +0100  6894  6894 E app.mihon.debug: Not starting debugger since process cannot load the jdwp agent.\n2025-05-08 19:33:55.794 +0100  6894  6894 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 19:33:55.963 +0100  6894  6941 E app.mihon.debug: No package ID 75 found for resource ID 0x750b000f.\n2025-05-08 19:40:57.738 +0100  6894  8044 E libEGL  : pre_cache appList: com.miui.weather2,,\n2025-05-08 19:40:57.748 +0100  6894  8044 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:40:57.821 +0100  6894  7116 E SQLiteLog: (284) automatic index on C(manga_id)\n2025-05-08 19:40:57.821 +0100  6894  7116 E SQLiteLog: (284) automatic index on mangas_categories(manga_id)\n2025-05-08 19:40:58.152 +0100  6894  8044 E LB      : fail to open file: No such file or directory\n2025-05-08 19:40:58.152 +0100  6894  8044 E LB      : fail to open node: No such file or directory\n2025-05-08 19:41:16.614 +0100  6894  8044 E libEGL  : pre_cache appList: com.miui.weather2,,\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: FATAL EXCEPTION: main\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: Process: app.mihon.debug, PID: 6894\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: java.lang.IllegalStateException: State is 'DESTROYED' and cannot be moved to `STARTED` in component cafe.adriel.voyager.androidx.AndroidScreenLifecycleOwner@8046610\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat androidx.lifecycle.LifecycleRegistry.moveToState(Unknown Source:115)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat androidx.lifecycle.LifecycleRegistry.handleLifecycleEvent(Unknown Source:14)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat androidx.compose.animation.AnimatedContentKt$AnimatedContent$6$1$5$1$1$invoke$$inlined$onDispose$1.dispose(Unknown Source:35)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat androidx.compose.runtime.DisposableEffectImpl.onForgotten(Unknown Source:4)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat androidx.compose.runtime.internal.RememberEventDispatcher.dispatchRememberObservers(Unknown Source:49)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat androidx.compose.runtime.CompositionImpl.applyChangesInLocked(Unknown Source:60)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat androidx.compose.runtime.CompositionImpl.applyChanges(Unknown Source:5)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat androidx.compose.material3.DatePickerKt$HorizontalMonthsList$1$2$1.invoke(Unknown Source:237)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat androidx.compose.ui.platform.AndroidUiFrameClock$withFrameNanos$2$callback$1.doFrame(Unknown Source:6)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat androidx.compose.ui.platform.AndroidUiDispatcher$dispatchCallback$1.doFrame(Unknown Source:47)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat android.view.Choreographer$CallbackRecord.run(Choreographer.java:1632)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat android.view.Choreographer$CallbackRecord.run(Choreographer.java:1643)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat android.view.Choreographer.doCallbacks(Choreographer.java:1172)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat android.view.Choreographer.doFrame(Choreographer.java:1072)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:1607)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat android.os.Handler.handleCallback(Handler.java:958)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat android.os.Handler.dispatchMessage(Handler.java:99)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat android.os.Looper.loopOnce(Looper.java:224)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat android.os.Looper.loop(Looper.java:318)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat android.app.ActivityThread.main(ActivityThread.java:8727)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat java.lang.reflect.Method.invoke(Native Method)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:561)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1013)\n2025-05-08 19:41:20.540 +0100  6894  6894 E AndroidRuntime: \tSuppressed: kotlinx.coroutines.internal.DiagnosticCoroutineContextException: [androidx.compose.runtime.PausableMonotonicFrameClock@2d5d21a, androidx.compose.ui.platform.MotionDurationScaleImpl@52a914b, StandaloneCoroutine{Cancelling}@666e728, AndroidUiDispatcher@52ecc41]\n2025-05-08 19:41:20.543 +0100  6894  6894 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 19:41:20.710 +0100  8272  8272 E g:error_handler: Not starting debugger since process cannot load the jdwp agent.\n2025-05-08 19:41:20.728 +0100  8272  8272 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 19:41:20.859 +0100  8306  8306 E app.mihon.debug: Not starting debugger since process cannot load the jdwp agent.\n2025-05-08 19:41:20.881 +0100  8272  8295 E SQLiteLog: (283) recovered 73 frames from WAL file /data/data/app.mihon.debug/databases/tachiyomi.db-wal\n2025-05-08 19:41:20.886 +0100  8306  8306 E MQSEventManagerDelegate: failed to get MQSService.\n2025-05-08 19:41:20.917 +0100  8272  8308 E g:error_handler: No package ID 75 found for resource ID 0x750b000f.\n2025-05-08 19:41:21.057 +0100  8272  8363 E chromium: [0508/194121.055166:ERROR:variations_seed_loader.cc(39)] Seed missing signature.\n2025-05-08 19:41:21.094 +0100  8306  8374 E SQLiteLog: (5) statement aborts at 2: [PRAGMA journal_mode=TRUNCATE] database is locked\n2025-05-08 19:41:21.160 +0100  8306  8383 E app.mihon.debug: No package ID 75 found for resource ID 0x750b000f.\n2025-05-08 19:41:22.085 +0100  8272  8326 E libEGL  : pre_cache appList: com.miui.weather2,,\n2025-05-08 19:41:22.097 +0100  8272  8326 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:41:22.118 +0100  8272  8326 E LB      : fail to open file: No such file or directory\n2025-05-08 19:41:22.121 +0100  8272  8326 E LB      : fail to open node: No such file or directory\n2025-05-08 19:41:25.001 +0100  8306  8812 E libEGL  : pre_cache appList: com.miui.weather2,,\n2025-05-08 19:41:25.025 +0100  8306  8812 E OpenGLRenderer: Unable to match the desired swap behavior.\n2025-05-08 19:41:25.299 +0100  8306  8704 E SQLiteLog: (284) automatic index on C(manga_id)\n2025-05-08 19:41:25.299 +0100  8306  8704 E SQLiteLog: (284) automatic index on mangas_categories(manga_id)\n2025-05-08 19:41:25.615 +0100  8306  8812 E LB      : fail to open file: No such file or directory\n2025-05-08 19:41:25.615 +0100  8306  8812 E LB      : fail to open node: No such file or directory\n2025-05-08 19:41:38.456 +0100  8306  8812 E libEGL  : pre_cache appList: com.miui.weather2,,\n2025-05-08 19:42:00.930 +0100  8306  8306 E AndroidRuntime: FATAL EXCEPTION: main\n2025-05-08 19:42:00.930 +0100  8306  8306 E AndroidRuntime: Process: app.mihon.debug, PID: 8306\n2025-05-08 19:42:00.930 +0100  8306  8306 E AndroidRuntime: java.lang.IllegalStateException: State is 'DESTROYED' and cannot be moved to `STARTED` in component cafe.adriel.voyager.androidx.AndroidScreenLifecycleOwner@14c9511\n2025-05-08 19:42:00.930 +0100  8306  8306 E AndroidRuntime: \tat androidx.lifecycle.LifecycleRegistry.moveToState(Unknown Source:115)\n2025-05-08 19:42:00.930 +0100  8306  8306 E AndroidRuntime: \tat androidx.lifecycle.LifecycleRegistry.handleLifecycleEvent(Unknown Source:14)\n2025-05-08 19:42:00.930 +0100  8306  8306 E AndroidRuntime: \tat androidx.compose.animation.AnimatedContentKt$AnimatedContent$6$1$5$1$1$invoke$$inlined$onDispose$1.dispose(Unknown Source:35)\n2025-05-08 19:42:00.930 +0100  8306  8306 E AndroidRuntime: \tat androidx.compose.runtime.DisposableEffectImpl.onForgotten(Unknown Source:4)\n2025-05-08 19:42:00.930 +0100  8306  8306 E AndroidRuntime: \tat androidx.compose.runtime.internal.RememberEventDispatcher.dispatchRememberObservers(Unknown Source:49)\n2025-05-08 19:42", "logs": [{"name": "mihon_crash_logs.txt", "url": "https://github.com/user-attachments/files/20108974/mihon_crash_logs.txt"}]}, "pull_request": [{"number": 2087, "url": "https://github.com/mihonapp/mihon/pull/2087", "diff_url": "https://github.com/mihonapp/mihon/pull/2087.diff", "patch_url": "https://github.com/mihonapp/mihon/pull/2087.patch", "title": "Update voyager to v1.1.0-beta03", "content": "Fixes #2081 ", "diff": "diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml\nindex 3bda1219ab..d269a31a6a 100644\n--- a/gradle/libs.versions.toml\n+++ b/gradle/libs.versions.toml\n@@ -6,7 +6,7 @@ okhttp_version = \"5.0.0-alpha.14\"\n shizuku_version = \"13.1.0\"\n sqldelight = \"2.0.2\"\n sqlite = \"2.5.1\"\n-voyager = \"1.0.1\"\n+voyager = \"1.1.0-beta03\"\n spotless = \"7.0.3\"\n ktlint-core = \"1.5.0\"\n firebase-bom = \"33.13.0\"\n", "changes": []}]}
{"url": "https://github.com/mihonapp/mihon/issues/2035", "repo": {"url": "https://github.com/mihonapp/mihon", "name": "mihon", "owner": "mihonapp", "modules": ["eu.kanade.core", "eu.kanade.domain", "eu.kanade.presentation", "eu.kanade.tachiyomi", "eu.kanade.test", "mihon.buildlogic", "mihon.buildlogic.tasks", "mihon.core.archive", "mihon.core.common", "mihon.core.designsystem", "mihon.core.migration", "mihon.data.repository", "mihon.domain.chapter", "mihon.domain.extensionrepo", "mihon.domain.manga", "mihon.domain.migration", "mihon.domain.upcoming", "mihon.feature.common", "mihon.feature.migration", "mihon.feature.upcoming", "mihon.presentation.core", "mihon.telemetry", "tachiyomi.core.common", "tachiyomi.core.metadata", "tachiyomi.data", "tachiyomi.data.category", "tachiyomi.data.chapter", "tachiyomi.data.history", "tachiyomi.data.manga", "tachiyomi.data.release", "tachiyomi.data.source", "tachiyomi.data.track", "tachiyomi.data.updates", "tachiyomi.domain.backup", "tachiyomi.domain.category", "tachiyomi.domain.chapter", "tachiyomi.domain.download", "tachiyomi.domain.history", "tachiyomi.domain.library", "tachiyomi.domain.manga", "tachiyomi.domain.release", "tachiyomi.domain.source", "tachiyomi.domain.storage", "tachiyomi.domain.track", "tachiyomi.domain.updates", "tachiyomi.macrobenchmark", "tachiyomi.presentation.core", "tachiyomi.presentation.widget", "tachiyomi.source.local"]}, "issue": {"number": 2035, "url": "https://github.com/mihonapp/mihon/issues/2035", "state": "closed", "title": "app crashes after clicking an UI element", "body": "### Steps to reproduce\n\n1. Try to browse Pixiv\n2. Open filters menu\n3. Try to change sort order\n\n### Expected behavior\n\nI should be able to change sort order.\n\n### Actual behavior\n\nApp crashes.\n\n### Crash logs\n\n[mihon_crash_logs.txt](https://github.com/user-attachments/files/19841340/mihon_crash_logs.txt)\n\n### Mihon version\n\n0.18.0\n\n### Android version\n\nAndroid 14\n\n### Device\n\nMotorola edge 30\n\n### Other details\n\nMoved from https://github.com/keiyoushi/extensions-source/issues/8583, see that one for more information. The crash seems to occurs on Mihon an TachiyomiSY only.\n\n### Acknowledgements\n\n- [x] I have searched the existing issues and this is a new ticket, **NOT** a duplicate or related to another open or closed issue.\n- [x] I have written a short but informative title.\n- [x] I have gone through the [FAQ](https://mihon.app/docs/faq/general) and [troubleshooting guide](https://mihon.app/docs/guides/troubleshooting/).\n- [x] I have updated the app to version **[0.18.0](https://github.com/mihonapp/mihon/releases/latest)**.\n- [x] I have filled out all of the requested information in this form, including specific version numbers.\n- [x] I understand that **Mihon does not have or fix any extensions**, and I **will not receive help** for any issues related to sources or extensions.", "logs": [{"name": "mihon_crash_logs.txt", "url": "https://github.com/user-attachments/files/19841340/mihon_crash_logs.txt"}]}, "pull_request": [{"number": 2036, "url": "https://github.com/mihonapp/mihon/pull/2036", "diff_url": "https://github.com/mihonapp/mihon/pull/2036.diff", "patch_url": "https://github.com/mihonapp/mihon/pull/2036.patch", "title": "Fix crash when trying use source sort filter without a pre-selection", "content": "Fixes #2035", "diff": "diff --git a/CHANGELOG.md b/CHANGELOG.md\nindex 377be30796..b81762ba08 100644\n--- a/CHANGELOG.md\n+++ b/CHANGELOG.md\n@@ -44,6 +44,7 @@ The format is a modified version of [Keep a Changelog](https://keepachangelog.co\n - Fix navigation issue after migrating a duplicated entry from History tab ([@cuong-tran](https://github.com/cuong-tran)) ([#1980](https://github.com/mihonapp/mihon/pull/1980))\n - Fix duplicate requests in WebView due to empty reasonPhrase ([@AwkwardPeak7](https://github.com/AwkwardPeak7)) ([#2003](https://github.com/mihonapp/mihon/pull/2003))\n - Fix content under source browse screen top appbar is interactable ([@AntsyLich](https://github.com/AntsyLich)) ([#2026](https://github.com/mihonapp/mihon/pull/2026))\n+- Fix crash when trying use source sort filter without a pre-selection ([@AntsyLich](https://github.com/AntsyLich)) ([#2036](https://github.com/mihonapp/mihon/pull/2036))\n \n ### Removed\n - Remove Okhttp networking from WebView Screen ([@AwkwardPeak7](https://github.com/AwkwardPeak7)) ([#2020](https://github.com/mihonapp/mihon/pull/2020))\ndiff --git a/app/src/main/java/eu/kanade/tachiyomi/ui/browse/source/browse/SourceFilterDialog.kt b/app/src/main/java/eu/kanade/tachiyomi/ui/browse/source/browse/SourceFilterDialog.kt\nindex 42355c5042..6ff7c60871 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/ui/browse/source/browse/SourceFilterDialog.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/ui/browse/source/browse/SourceFilterDialog.kt\n@@ -128,22 +128,24 @@ private fun FilterItem(filter: Filter<*>, onUpdate: () -> Unit) {\n             ) {\n                 Column {\n                     filter.values.mapIndexed { index, item ->\n+                        val sortAscending = filter.state?.ascending\n+                            ?.takeIf { index == filter.state?.index }\n                         SortItem(\n                             label = item,\n-                            sortDescending = filter.state?.ascending?.not()\n-                                ?.takeIf { index == filter.state?.index },\n-                        ) {\n-                            val ascending = if (index == filter.state?.index) {\n-                                !filter.state!!.ascending\n-                            } else {\n-                                filter.state!!.ascending\n-                            }\n-                            filter.state = Filter.Sort.Selection(\n-                                index = index,\n-                                ascending = ascending,\n-                            )\n-                            onUpdate()\n-                        }\n+                            sortDescending = if (sortAscending != null) !sortAscending else null,\n+                            onClick = {\n+                                val ascending = if (index == filter.state?.index) {\n+                                    !filter.state!!.ascending\n+                                } else {\n+                                    filter.state?.ascending ?: true\n+                                }\n+                                filter.state = Filter.Sort.Selection(\n+                                    index = index,\n+                                    ascending = ascending,\n+                                )\n+                                onUpdate()\n+                            },\n+                        )\n                     }\n                 }\n             }\n", "changes": [{"file": "app/src/main/java/eu/kanade/tachiyomi/ui/browse/source/browse/SourceFilterDialog.kt", "module": "eu.kanade.tachiyomi.ui.browse.source.browse.SourceFilterDialog", "range": [{"start": 131, "end": 131}, {"start": 133, "end": 147}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/9644", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 9644, "url": "https://github.com/thunderbird/thunderbird-android/issues/9644", "state": "closed", "title": "12.0b7 crash. Upon [gmail] folder selection", "body": "### Checklist\n\n- [x] I have used the search function to see if someone else has already submitted the same bug report.\n- [x] I will describe the problem with as much detail as possible.\n\n### App\n\nThunderbird for Android\n\n### App version\n\n12.0b7\n\n### Where did you get the app from?\n\nOther\n\n### Android version\n\nAndroid 15\n\n### Device model\n\nOneplus 10 Pro\n\n### Steps to reproduce\n\nApp downloaded from github.\n\n1. Close app and remove from androids running app list.\n2. Open app again.\n3. Switch from Unified to gmail account.\n4. Observe standard gmail folders are all correctly displayed at the same level beneath each other.\n5. Drop back to android launcher (TBA running in background)\n6. I wait about 30 minutes.\n7. Open the app and view the gmail folder list.\n7. Observe abnormal presence of [gmail] expandable folder.\n8. Select this [gmail] folder.\n9. App crashes\n\n### Expected behavior\n\nThe normal behaviour is where the standard gmail folders (Inbox, outbox, all mail, draft, etc) are all displayed beneath each other at the top level.\n\n![Image](https://github.com/user-attachments/assets/db64c041-97a8-4cfa-96ae-ad79c5226aba)\n\n### Actual behavior\n\nI open the app after approx 30 minutes running in the background. I observe the app has changed the normal folder view and now displays an expandable [gmail] folder. Selecting this folder crashes the app.\n\nI'm not sure sure what is triggering the view to change as it does so without user interaction. Perhaps background sync.\n\n![Image](https://github.com/user-attachments/assets/88d8d5d2-b314-4255-ad38-c64e9dc10c2c)\n\n### Logs\n\n[k9mail-logs.txt](https://github.com/user-attachments/files/21970985/k9mail-logs.txt)", "logs": [{"name": "k9mail-logs.txt", "url": "https://github.com/user-attachments/files/21970985/k9mail-logs.txt"}]}, "pull_request": [{"number": 9716, "url": "https://github.com/thunderbird/thunderbird-android/pull/9716", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/9716.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/9716.patch", "title": "fix(drawer): crash when opening placeholder folder", "content": "Fixes #9644.\r\n\r\n- Change the placeholder `MailDisplayFolder` to not have an account ID.\r\n- Ensure that we only trigger `onClick(displayFolder)` in case we have an account ID.\r\n- If tapping on a Placeholder folder, toggle the `isExpanded` state.\r\n\r\n> [!NOTE]\r\n> A follow-up ticket will be placed to investigate why the `[Gmail]` prefix is added back when refreshing the folder list. For now, this PR is only meant to fix the crash.\r\n\r\nScreen recording:\r\n\r\nhttps://github.com/user-attachments/assets/94a9f89f-91b1-4e12-8ee8-7d0902e7a0e6\r\n\r\n", "diff": "diff --git a/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/entity/MailDisplayFolder.kt b/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/entity/MailDisplayFolder.kt\nindex ee14c89efd4..07b8a6643d4 100644\n--- a/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/entity/MailDisplayFolder.kt\n+++ b/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/entity/MailDisplayFolder.kt\n@@ -3,13 +3,13 @@ package net.thunderbird.feature.navigation.drawer.dropdown.domain.entity\n import net.thunderbird.feature.mail.folder.api.Folder\n \n internal data class MailDisplayFolder(\n-    val accountId: String,\n+    val accountId: String?,\n     val folder: Folder,\n     val isInTopGroup: Boolean,\n     override val unreadMessageCount: Int,\n     override val starredMessageCount: Int,\n ) : DisplayFolder {\n-    override val id: String = createMailDisplayAccountFolderId(accountId, folder.id)\n+    override val id: String = createMailDisplayAccountFolderId(accountId.orEmpty(), folder.id)\n }\n \n fun createMailDisplayAccountFolderId(accountId: String, folderId: Long): String {\ndiff --git a/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/usecase/GetDisplayTreeFolder.kt b/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/usecase/GetDisplayTreeFolder.kt\nindex 05ade0c3e12..ae75fcae30a 100644\n--- a/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/usecase/GetDisplayTreeFolder.kt\n+++ b/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/usecase/GetDisplayTreeFolder.kt\n@@ -90,7 +90,7 @@ internal class GetDisplayTreeFolder : UseCase.GetDisplayTreeFolder {\n     private fun createPlaceholderFolder(name: String): MailDisplayFolder {\n         placeholderCounter += 1\n         return MailDisplayFolder(\n-            accountId = \"placeholder\",\n+            accountId = null,\n             folder = Folder(\n                 id = placeholderCounter,\n                 name = name,\ndiff --git a/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/DrawerViewModel.kt b/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/DrawerViewModel.kt\nindex 793e71437e5..c81ab049921 100644\n--- a/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/DrawerViewModel.kt\n+++ b/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/DrawerViewModel.kt\n@@ -240,12 +240,14 @@ internal class DrawerViewModel(\n         selectFolder(folder.id)\n \n         if (folder is MailDisplayFolder) {\n-            emitEffect(\n-                Effect.OpenFolder(\n-                    accountId = folder.accountId,\n-                    folderId = folder.folder.id,\n-                ),\n-            )\n+            if (folder.accountId != null) {\n+                emitEffect(\n+                    Effect.OpenFolder(\n+                        accountId = folder.accountId,\n+                        folderId = folder.folder.id,\n+                    ),\n+                )\n+            }\n         } else if (folder is UnifiedDisplayFolder) {\n             emitEffect(Effect.OpenUnifiedFolder)\n         }\ndiff --git a/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/folder/FolderListItem.kt b/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/folder/FolderListItem.kt\nindex 9261aad3726..3dd9ef6fb49 100644\n--- a/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/folder/FolderListItem.kt\n+++ b/feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/folder/FolderListItem.kt\n@@ -76,13 +76,14 @@ internal fun FolderListItem(\n                 )\n             },\n             selected = selectedFolderId == displayFolder.id,\n-            onClick = { onClick(displayFolder) },\n-            modifier = Modifier.fillMaxWidth(),\n-            icon = {\n-                Icon(\n-                    imageVector = mapFolderIcon(displayFolder),\n-                )\n+            onClick = {\n+                when (displayFolder) {\n+                    is MailDisplayFolder if displayFolder.accountId == null -> isExpanded.value = !isExpanded.value\n+                    else -> onClick(displayFolder)\n+                }\n             },\n+            modifier = Modifier.fillMaxWidth(),\n+            icon = { Icon(imageVector = mapFolderIcon(displayFolder)) },\n         )\n \n         // Managing children\ndiff --git a/feature/navigation/drawer/dropdown/src/test/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/usecase/GetDisplayTreeFolderTest.kt b/feature/navigation/drawer/dropdown/src/test/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/usecase/GetDisplayTreeFolderTest.kt\nindex 0598feaccbd..1229ea96891 100644\n--- a/feature/navigation/drawer/dropdown/src/test/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/usecase/GetDisplayTreeFolderTest.kt\n+++ b/feature/navigation/drawer/dropdown/src/test/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/usecase/GetDisplayTreeFolderTest.kt\n@@ -199,7 +199,7 @@ class GetDisplayTreeFolderTest {\n                     children = persistentListOf(\n                         DisplayTreeFolder(\n                             displayFolder = MailDisplayFolder(\n-                                accountId = \"placeholder\",\n+                                accountId = null,\n                                 folder = Folder(\n                                     id = 1L,\n                                     name = \"(Unnamed)/(Unnamed)\",\n@@ -238,7 +238,7 @@ class GetDisplayTreeFolderTest {\n                 ),\n                 DisplayTreeFolder(\n                     displayFolder = MailDisplayFolder(\n-                        accountId = \"placeholder\",\n+                        accountId = null,\n                         folder = Folder(id = 2, name = \"valid1\", type = FolderType.REGULAR, isLocalOnly = false),\n                         isInTopGroup = true,\n                         unreadMessageCount = 0,\n@@ -250,7 +250,7 @@ class GetDisplayTreeFolderTest {\n                     children = persistentListOf(\n                         DisplayTreeFolder(\n                             displayFolder = MailDisplayFolder(\n-                                accountId = \"placeholder\",\n+                                accountId = null,\n                                 folder = Folder(\n                                     id = 3L,\n                                     name = \"valid1/(Unnamed)\",\n@@ -321,7 +321,7 @@ class GetDisplayTreeFolderTest {\n             children = persistentListOf(\n                 createDisplayTreeFolder(\n                     displayFolder = createDisplayAccountFolder(\n-                        accountId = \"placeholder\",\n+                        accountId = null,\n                         folderId = 1L,\n                         folderName = \"folderLevel1\",\n                         unreadMessageCount = 0,\n@@ -380,7 +380,7 @@ class GetDisplayTreeFolderTest {\n             children = persistentListOf(\n                 createDisplayTreeFolder(\n                     displayFolder = createDisplayAccountFolder(\n-                        accountId = \"placeholder\",\n+                        accountId = null,\n                         folderId = 1,\n                         folderName = \"level1\",\n                         unreadMessageCount = 0,\n@@ -392,7 +392,7 @@ class GetDisplayTreeFolderTest {\n                     children = persistentListOf(\n                         createDisplayTreeFolder(\n                             displayFolder = createDisplayAccountFolder(\n-                                accountId = \"placeholder\",\n+                                accountId = null,\n                                 folderId = 2L,\n                                 folderName = \"level1/level2\",\n                                 unreadMessageCount = 0,\n@@ -430,7 +430,7 @@ class GetDisplayTreeFolderTest {\n             folderName: String,\n             unreadMessageCount: Int,\n             starredMessageCount: Int,\n-            accountId: String = \"accountId\",\n+            accountId: String? = \"accountId\",\n         ): MailDisplayFolder {\n             return MailDisplayFolder(\n                 accountId = accountId,\ndiff --git a/feature/navigation/drawer/dropdown/src/test/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/DrawerViewModelTest.kt b/feature/navigation/drawer/dropdown/src/test/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/DrawerViewModelTest.kt\nindex 9b845976de8..a0a1af139e7 100644\n--- a/feature/navigation/drawer/dropdown/src/test/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/DrawerViewModelTest.kt\n+++ b/feature/navigation/drawer/dropdown/src/test/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/DrawerViewModelTest.kt\n@@ -334,7 +334,7 @@ internal class DrawerViewModelTest {\n \n         assertThat(turbines.awaitEffectItem()).isEqualTo(\n             Effect.OpenFolder(\n-                accountId = displayFolders[1].accountId,\n+                accountId = requireNotNull(displayFolders[1].accountId),\n                 folderId = displayFolders[1].folder.id,\n             ),\n         )\n", "changes": [{"file": "feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/entity/MailDisplayFolder.kt", "module": "net.thunderbird.feature.navigation.drawer.dropdown.domain.entity.MailDisplayFolder", "range": [{"start": 6, "end": 7}, {"start": 12, "end": 13}]}, {"file": "feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/domain/usecase/GetDisplayTreeFolder.kt", "module": "net.thunderbird.feature.navigation.drawer.dropdown.domain.usecase.GetDisplayTreeFolder", "range": [{"start": 93, "end": 94}]}, {"file": "feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/DrawerViewModel.kt", "module": "net.thunderbird.feature.navigation.drawer.dropdown.ui.DrawerViewModel", "range": [{"start": 243, "end": 249}]}, {"file": "feature/navigation/drawer/dropdown/src/main/kotlin/net/thunderbird/feature/navigation/drawer/dropdown/ui/folder/FolderListItem.kt", "module": "net.thunderbird.feature.navigation.drawer.dropdown.ui.folder.FolderListItem", "range": [{"start": 79, "end": 85}, {"start": 86, "end": 86}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/9453", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 9453, "url": "https://github.com/thunderbird/thunderbird-android/issues/9453", "state": "closed", "title": "App cannot start after latest beta (java.lang.IllegalStateException: action == SwipeAction.None)", "body": "### Checklist\n\n- [x] I have used the search function to see if someone else has already submitted the same bug report.\n- [x] I will describe the problem with as much detail as possible.\n\n### App\n\nThunderbird for Android\n\n### App version\n\n12.0b1\n\n### Where did you get the app from?\n\nOther\n\n### Android version\n\n16\n\n### Device model\n\nPixel 8\n\n### Steps to reproduce\n\n1. Open the app\n\n### Expected behavior\n\nThe app starts\n\n### Actual behavior\n\nThe app crash on start\n\n### Logs\n\n[Thunderbird Beta log c6d3231e911a.txt](https://github.com/user-attachments/files/21285383/Thunderbird.Beta.log.c6d3231e911a.txt)", "logs": [{"name": "Thunderbird Beta log c6d3231e911a.txt", "url": "https://github.com/user-attachments/files/21285383/Thunderbird.Beta.log.c6d3231e911a.txt"}]}, "pull_request": [{"number": 9458, "url": "https://github.com/thunderbird/thunderbird-android/pull/9458", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/9458.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/9458.patch", "title": "fix(swipe-actions): app crash when swipe action is None and try to create the swipe action config", "content": "Fixes #9453.\r\n", "diff": "diff --git a/legacy/ui/legacy/src/main/java/com/fsck/k9/ui/messagelist/MessageListSwipeCallback.kt b/legacy/ui/legacy/src/main/java/com/fsck/k9/ui/messagelist/MessageListSwipeCallback.kt\nindex f32e06d6f3a..30b802f246d 100644\n--- a/legacy/ui/legacy/src/main/java/com/fsck/k9/ui/messagelist/MessageListSwipeCallback.kt\n+++ b/legacy/ui/legacy/src/main/java/com/fsck/k9/ui/messagelist/MessageListSwipeCallback.kt\n@@ -352,20 +352,24 @@ class MessageListSwipeCallback(\n         resourceProvider: SwipeResourceProvider,\n         isLeft: Boolean,\n     ): Map<String, SwipeActionConfig> {\n-        return accounts.associate { account ->\n-            val swipeAction = requireNotNull(swipeActions[account.uuid]) {\n-                \"No swipe actions found for account (${account.uuid})\"\n-            }.let { (swipeActionLeft, swipeActionRight) ->\n-                if (isLeft) swipeActionLeft else swipeActionRight\n+        return accounts\n+            .mapNotNull { account ->\n+                swipeActions[account.uuid]\n+                    ?.let { (swipeActionLeft, swipeActionRight) ->\n+                        if (isLeft) swipeActionLeft else swipeActionRight\n+                    }\n+                    ?.takeIf { swipeAction -> swipeAction != SwipeAction.None }\n+                    ?.let { swipeAction -> account.uuid to swipeAction }\n+            }\n+            .associate { (uuid, swipeAction) ->\n+                uuid to SwipeActionConfig(\n+                    colorRoles = resourceProvider.getActionColorRoles(swipeAction),\n+                    icon = resourceProvider.getActionIcon(swipeAction),\n+                    iconToggled = resourceProvider.getActionIconToggled(swipeAction),\n+                    actionName = resourceProvider.getActionName(swipeAction),\n+                    actionNameToggled = resourceProvider.getActionNameToggled(swipeAction),\n+                )\n             }\n-            account.uuid to SwipeActionConfig(\n-                colorRoles = resourceProvider.getActionColorRoles(swipeAction),\n-                icon = resourceProvider.getActionIcon(swipeAction),\n-                iconToggled = resourceProvider.getActionIconToggled(swipeAction),\n-                actionName = resourceProvider.getActionName(swipeAction),\n-                actionNameToggled = resourceProvider.getActionNameToggled(swipeAction),\n-            )\n-        }\n     }\n \n     private fun isToggled(swipeAction: SwipeAction, item: MessageListItem): Boolean {\n", "changes": [{"file": "legacy/ui/legacy/src/main/java/com/fsck/k9/ui/messagelist/MessageListSwipeCallback.kt", "module": "com.fsck.k9.ui.messagelist.MessageListSwipeCallback", "range": [{"start": 355, "end": 360}, {"start": 361, "end": 368}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/9318", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 9318, "url": "https://github.com/thunderbird/thunderbird-android/issues/9318", "state": "closed", "title": "Crash when changing orientation", "body": "### Checklist\n\n- [x] I have used the search function to see if someone else has already submitted the same bug report.\n- [x] I will describe the problem with as much detail as possible.\n\n### App\n\nThunderbird for Android\n\n### App version\n\n11.0b3\n\n### Where did you get the app from?\n\nNone\n\n### Android version\n\n15\n\n### Device model\n\nXiaomi 14\n\n### Steps to reproduce\n\n1. Start TB\n2. Turn mobile phone to change orientation from portrait to landscape or vice versa \n\n### Expected behavior\n\nShould change display to new orientation\n\n### Actual behavior\n\nTB crashes.\n\nAlso happens in 12.0a1 June 10\n\n[k9mail-logs.txt](https://github.com/user-attachments/files/20684114/k9mail-logs.txt)\n\n### Logs\n\n_No response_", "logs": [{"name": "k9mail-logs.txt", "url": "https://github.com/user-attachments/files/20684114/k9mail-logs.txt"}]}, "pull_request": [{"number": 9380, "url": "https://github.com/thunderbird/thunderbird-android/pull/9380", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/9380.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/9380.patch", "title": "Fix MessageList.configureDrawer throwing NullPointerException when the device orientation changes", "content": "Same changes from #9318, but without the new logger to release on beta", "diff": "diff --git a/feature/search/src/main/java/net/thunderbird/feature/search/ConditionsTreeNode.java b/feature/search/src/main/java/net/thunderbird/feature/search/ConditionsTreeNode.java\nindex 0714f6ae3e2..96eee6b3922 100644\n--- a/feature/search/src/main/java/net/thunderbird/feature/search/ConditionsTreeNode.java\n+++ b/feature/search/src/main/java/net/thunderbird/feature/search/ConditionsTreeNode.java\n@@ -6,6 +6,7 @@\n import android.os.Parcel;\n import android.os.Parcelable;\n \n+import androidx.annotation.NonNull;\n import net.thunderbird.feature.search.api.SearchCondition;\n \n \n@@ -256,4 +257,16 @@ private ConditionsTreeNode(Parcel in) {\n             mRight.mParent = this;\n         }\n     }\n+\n+    @NonNull\n+    @Override\n+    public String toString() {\n+        return \"ConditionsTreeNode(\" +\n+            \"mLeft=\" + mLeft +\n+            \", mRight=\" + mRight +\n+            \", mParent=\" + mParent +\n+            \", mValue=\" + mValue +\n+            \", mCondition=\" + mCondition +\n+            ')';\n+    }\n }\ndiff --git a/feature/search/src/main/java/net/thunderbird/feature/search/LocalSearch.java b/feature/search/src/main/java/net/thunderbird/feature/search/LocalSearch.java\nindex 68e2e53e269..8e7866907d3 100644\n--- a/feature/search/src/main/java/net/thunderbird/feature/search/LocalSearch.java\n+++ b/feature/search/src/main/java/net/thunderbird/feature/search/LocalSearch.java\n@@ -8,6 +8,7 @@\n import android.os.Parcel;\n import android.os.Parcelable;\n \n+import androidx.annotation.NonNull;\n import net.thunderbird.feature.search.api.SearchAttribute;\n import net.thunderbird.feature.search.api.SearchCondition;\n import net.thunderbird.feature.search.api.SearchField;\n@@ -294,4 +295,16 @@ public LocalSearch(Parcel in) {\n             mLeafSet = mConditions.getLeafSet();\n         }\n     }\n+\n+    @NonNull\n+    @Override\n+    public String toString() {\n+        return \"LocalSearch(\" +\n+            \"id='\" + id + '\\'' +\n+            \", mManualSearch=\" + mManualSearch +\n+            \", mAccountUuids=\" + mAccountUuids +\n+            \", mConditions=\" + mConditions +\n+            \", mLeafSet=\" + mLeafSet +\n+            ')';\n+    }\n }\ndiff --git a/legacy/ui/legacy/src/main/java/com/fsck/k9/activity/MessageList.kt b/legacy/ui/legacy/src/main/java/com/fsck/k9/activity/MessageList.kt\nindex e0b78bf04a3..9fd3d5528b5 100644\n--- a/legacy/ui/legacy/src/main/java/com/fsck/k9/activity/MessageList.kt\n+++ b/legacy/ui/legacy/src/main/java/com/fsck/k9/activity/MessageList.kt\n@@ -1465,14 +1465,23 @@ open class MessageList :\n \n     private fun configureDrawer() {\n         val drawer = navigationDrawer ?: return\n-        drawer.selectAccount(account!!.uuid)\n-        when {\n-            singleFolderMode -> drawer.selectFolder(search!!.accountUuids[0], search!!.folderIds[0])\n-            // Don't select any item in the drawer because the Unified Inbox is displayed, but not listed in the drawer\n-            search!!.id == SearchAccount.UNIFIED_INBOX && !K9.isShowUnifiedInbox -> drawer.deselect()\n-            search!!.id == SearchAccount.UNIFIED_INBOX -> drawer.selectUnifiedInbox()\n-            else -> drawer.deselect()\n+        val accountUuid = account?.uuid ?: return Unit.also {\n+            Timber.w(\"The account property is null. Skipping drawer configuration. \")\n+            Timber.v(\"drawer = $drawer, localSearch = $search\")\n         }\n+        drawer.selectAccount(accountUuid)\n+\n+        search?.let { search ->\n+            when {\n+                singleFolderMode -> drawer.selectFolder(search.accountUuids[0], search.folderIds[0])\n+\n+                // Don't select any item in the drawer because the Unified Inbox is displayed,\n+                // but not listed in the drawer\n+                search.id == SearchAccount.UNIFIED_INBOX && !K9.isShowUnifiedInbox -> drawer.deselect()\n+                search.id == SearchAccount.UNIFIED_INBOX -> drawer.selectUnifiedInbox()\n+                else -> drawer.deselect()\n+            }\n+        } ?: Timber.w(\"Couldn't select folder for $accountUuid as LocalSearch is null.\")\n     }\n \n     private fun createSearchAccount(): SearchAccount {\n", "changes": [{"file": "legacy/ui/legacy/src/main/java/com/fsck/k9/activity/MessageList.kt", "module": "com.fsck.k9.activity.MessageList", "range": [{"start": 1468, "end": 1475}, {"start": 1476, "end": 1476}]}]}, {"number": 9337, "url": "https://github.com/thunderbird/thunderbird-android/pull/9337", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/9337.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/9337.patch", "title": "Fix MessageList.configureDrawer throwing NullPointerException when the device orientation changes", "content": "Fixes #9318.\r\n\r\n- Add `toString` methods for both `LocalSearch` and `ConditionsTreeNode` for better debuggability\r\n- Enhance null checks on `MessageList.configureDrawer` \r\n\r\n| Prior this PR changes | After this PR changes |\r\n| -- | -- |\r\n| <video src=\"https://github.com/user-attachments/assets/d3c491e0-75e4-4593-a433-ebeeac08636e\"/> | <video src=\"https://github.com/user-attachments/assets/0673b130-110b-4422-9864-aaf28ad046e3\"/> |", "diff": "diff --git a/feature/search/src/main/java/net/thunderbird/feature/search/ConditionsTreeNode.java b/feature/search/src/main/java/net/thunderbird/feature/search/ConditionsTreeNode.java\nindex 0714f6ae3e2..96eee6b3922 100644\n--- a/feature/search/src/main/java/net/thunderbird/feature/search/ConditionsTreeNode.java\n+++ b/feature/search/src/main/java/net/thunderbird/feature/search/ConditionsTreeNode.java\n@@ -6,6 +6,7 @@\n import android.os.Parcel;\n import android.os.Parcelable;\n \n+import androidx.annotation.NonNull;\n import net.thunderbird.feature.search.api.SearchCondition;\n \n \n@@ -256,4 +257,16 @@ private ConditionsTreeNode(Parcel in) {\n             mRight.mParent = this;\n         }\n     }\n+\n+    @NonNull\n+    @Override\n+    public String toString() {\n+        return \"ConditionsTreeNode(\" +\n+            \"mLeft=\" + mLeft +\n+            \", mRight=\" + mRight +\n+            \", mParent=\" + mParent +\n+            \", mValue=\" + mValue +\n+            \", mCondition=\" + mCondition +\n+            ')';\n+    }\n }\ndiff --git a/feature/search/src/main/java/net/thunderbird/feature/search/LocalSearch.java b/feature/search/src/main/java/net/thunderbird/feature/search/LocalSearch.java\nindex 68e2e53e269..8e7866907d3 100644\n--- a/feature/search/src/main/java/net/thunderbird/feature/search/LocalSearch.java\n+++ b/feature/search/src/main/java/net/thunderbird/feature/search/LocalSearch.java\n@@ -8,6 +8,7 @@\n import android.os.Parcel;\n import android.os.Parcelable;\n \n+import androidx.annotation.NonNull;\n import net.thunderbird.feature.search.api.SearchAttribute;\n import net.thunderbird.feature.search.api.SearchCondition;\n import net.thunderbird.feature.search.api.SearchField;\n@@ -294,4 +295,16 @@ public LocalSearch(Parcel in) {\n             mLeafSet = mConditions.getLeafSet();\n         }\n     }\n+\n+    @NonNull\n+    @Override\n+    public String toString() {\n+        return \"LocalSearch(\" +\n+            \"id='\" + id + '\\'' +\n+            \", mManualSearch=\" + mManualSearch +\n+            \", mAccountUuids=\" + mAccountUuids +\n+            \", mConditions=\" + mConditions +\n+            \", mLeafSet=\" + mLeafSet +\n+            ')';\n+    }\n }\ndiff --git a/legacy/ui/legacy/src/main/java/com/fsck/k9/activity/MessageList.kt b/legacy/ui/legacy/src/main/java/com/fsck/k9/activity/MessageList.kt\nindex b8456a601db..90de470f12f 100644\n--- a/legacy/ui/legacy/src/main/java/com/fsck/k9/activity/MessageList.kt\n+++ b/legacy/ui/legacy/src/main/java/com/fsck/k9/activity/MessageList.kt\n@@ -65,6 +65,7 @@ import net.thunderbird.core.android.account.AccountManager\n import net.thunderbird.core.android.account.LegacyAccount\n import net.thunderbird.core.featureflag.FeatureFlagKey\n import net.thunderbird.core.featureflag.FeatureFlagProvider\n+import net.thunderbird.core.logging.Logger\n import net.thunderbird.core.logging.legacy.Log\n import net.thunderbird.core.preference.GeneralSettingsManager\n import net.thunderbird.feature.navigation.drawer.api.NavigationDrawer\n@@ -80,6 +81,8 @@ import org.koin.android.ext.android.inject\n import org.koin.core.component.KoinComponent\n import org.koin.core.component.inject\n \n+private const val TAG = \"MessageList\"\n+\n /**\n  * MessageList is the primary user interface for the program. This Activity shows a list of messages.\n  *\n@@ -103,6 +106,7 @@ open class MessageList :\n     private val coreResourceProvider: CoreResourceProvider by inject()\n     private val fundingManager: FundingManager by inject()\n     private val featureFlagProvider: FeatureFlagProvider by inject()\n+    private val logger: Logger by inject()\n \n     private lateinit var actionBar: ActionBar\n     private var searchView: SearchView? = null\n@@ -1473,16 +1477,25 @@ open class MessageList :\n \n     private fun configureDrawer() {\n         val drawer = navigationDrawer ?: return\n-        drawer.selectAccount(account!!.uuid)\n-        when {\n-            singleFolderMode -> drawer.selectFolder(search!!.accountUuids[0], search!!.folderIds[0])\n-            // Don't select any item in the drawer because the Unified Inbox is displayed, but not listed in the drawer\n-            search!!.id == SearchAccount.UNIFIED_INBOX &&\n-                !generalSettingsManager.getSettings().isShowUnifiedInbox -> drawer.deselect()\n-\n-            search!!.id == SearchAccount.UNIFIED_INBOX -> drawer.selectUnifiedInbox()\n-            else -> drawer.deselect()\n+        val accountUuid = account?.uuid ?: return Unit.also {\n+            logger.warn(TAG) { \"The account property is null. Skipping drawer configuration. \" }\n+            logger.verbose(TAG) { \"drawer = $drawer, localSearch = $search\" }\n         }\n+        drawer.selectAccount(accountUuid)\n+\n+        search?.let { search ->\n+            when {\n+                singleFolderMode -> drawer.selectFolder(search.accountUuids[0], search.folderIds[0])\n+\n+                // Don't select any item in the drawer because the Unified Inbox is displayed,\n+                // but not listed in the drawer\n+                search.id == SearchAccount.UNIFIED_INBOX &&\n+                    !generalSettingsManager.getSettings().isShowUnifiedInbox -> drawer.deselect()\n+\n+                search.id == SearchAccount.UNIFIED_INBOX -> drawer.selectUnifiedInbox()\n+                else -> drawer.deselect()\n+            }\n+        } ?: logger.warn(TAG) { \"Couldn't select folder for $accountUuid as LocalSearch is null.\" }\n     }\n \n     private fun createSearchAccount(): SearchAccount {\n", "changes": [{"file": "legacy/ui/legacy/src/main/java/com/fsck/k9/activity/MessageList.kt", "module": "com.fsck.k9.activity.MessageList", "range": [{"start": 68, "end": 68}, {"start": 83, "end": 83}, {"start": 106, "end": 106}, {"start": 1476, "end": 1485}, {"start": 1486, "end": 1486}]}, {"file": "feature/search/src/main/java/net/thunderbird/feature/search/ConditionsTreeNode.java", "module": "net.thunderbird.feature.search.ConditionsTreeNode", "range": [{"start": 9, "end": 9}, {"start": 259, "end": 259}]}, {"file": "feature/search/src/main/java/net/thunderbird/feature/search/LocalSearch.java", "module": "net.thunderbird.feature.search.LocalSearch", "range": [{"start": 11, "end": 11}, {"start": 297, "end": 297}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/9236", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 9236, "url": "https://github.com/thunderbird/thunderbird-android/issues/9236", "state": "closed", "title": "Outlook header style formatting issue when replying to a message", "body": "### Checklist\n\n- [x] I have used the search function to see if someone else has already submitted the same bug report.\n- [x] I will describe the problem with as much detail as possible.\n\n### App\n\nThunderbird for Android\n\n### App version\n\n10.0\n\n### Where did you get the app from?\n\nGoogle Play\n\n### Android version\n\n15\n\n### Device model\n\nXQ-DQ54\n\n### Steps to reproduce\n\n1. Go to **Settings**.\n2. Configure the email account.\n3. Click on **Sending mail**.\n4. Set **Reply quoting style** to **Header (like Outlook)**.\n5. Go back to your mailbox.\n6. Reply to an email to start composing and view the header formatting.\n\n### Expected behavior\n\nThe header should be properly formatted. The **From:**, **To:**, and **Subject:** should be a single line and the next line should come right after.\n\n---------------------------------------\n**From:** GitHub \\<noreply@github.com\\>\n**Sent:** 29 May 2025 12:10:54 CEST\n**To:** myemail@domain.com\n**Subject:** Your GitHub launch code\n\n![Image](https://github.com/user-attachments/assets/16db9183-7a45-42f0-8d6c-af599012583c)\n\n### Actual behavior\n\nOnly the **Sent:** line is properly formatted. The others have their values printed on a new line and also have a trailing blank line.\n\n---------------------------------------\n**From:** \nGitHub \\<noreply@github.com\\>\n\n**Sent:** 29 May 2025 12:10:54 CEST\n**To:** \nmyemail@domain.com\n\n**Subject:** \nYour GitHub launch code\n\n\n![Image](https://github.com/user-attachments/assets/aeb96980-a8c7-4f91-9663-766c9a807c5b)\n\n### Logs\n\n[k9mail-logs-cleaned.txt](https://github.com/user-attachments/files/20503323/k9mail-logs-cleaned.txt)", "logs": [{"name": "k9mail-logs-cleaned.txt", "url": "https://github.com/user-attachments/files/20503323/k9mail-logs-cleaned.txt"}]}, "pull_request": [{"number": 9589, "url": "https://github.com/thunderbird/thunderbird-android/pull/9589", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/9589.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/9589.patch", "title": "Prevent newline in header", "content": "Fix #9236 \r\n\r\nPrevent newline that comes from using a div by using an \"inline\" span-element\r\n", "diff": "diff --git a/legacy/core/src/main/java/com/fsck/k9/message/html/HTMLTag.kt b/legacy/core/src/main/java/com/fsck/k9/message/html/HTMLTag.kt\nnew file mode 100644\nindex 00000000000..c22fa082f62\n--- /dev/null\n+++ b/legacy/core/src/main/java/com/fsck/k9/message/html/HTMLTag.kt\n@@ -0,0 +1,9 @@\n+package com.fsck.k9.message.html\n+\n+/**\n+ * Available HTML-Tags for creating HTML in E-Mails\n+ */\n+enum class HTMLTag(val html: String) {\n+    DIV(\"div\"),\n+    SPAN(\"span\"),\n+}\ndiff --git a/legacy/core/src/main/java/com/fsck/k9/message/html/HtmlConverter.kt b/legacy/core/src/main/java/com/fsck/k9/message/html/HtmlConverter.kt\nindex 4bca8521233..ad13c5d44e3 100644\n--- a/legacy/core/src/main/java/com/fsck/k9/message/html/HtmlConverter.kt\n+++ b/legacy/core/src/main/java/com/fsck/k9/message/html/HtmlConverter.kt\n@@ -46,7 +46,8 @@ object HtmlConverter {\n      * Convert a plain text string into an HTML fragment.\n      */\n     @JvmStatic\n-    fun textToHtmlFragment(text: String): String {\n-        return TextToHtml.toHtmlFragment(text, retainOriginalWhitespace = false)\n+    @JvmOverloads\n+    fun textToHtmlFragment(text: String, htmlTag: HTMLTag = HTMLTag.DIV): String {\n+        return TextToHtml.toHtmlFragment(text, retainOriginalWhitespace = false, htmlTag)\n     }\n }\ndiff --git a/legacy/core/src/main/java/com/fsck/k9/message/html/TextToHtml.kt b/legacy/core/src/main/java/com/fsck/k9/message/html/TextToHtml.kt\nindex ab634fe6575..5556b79c28e 100644\n--- a/legacy/core/src/main/java/com/fsck/k9/message/html/TextToHtml.kt\n+++ b/legacy/core/src/main/java/com/fsck/k9/message/html/TextToHtml.kt\n@@ -6,6 +6,7 @@ class TextToHtml private constructor(\n     private val text: CharSequence,\n     private val html: StringBuilder,\n     private val retainOriginalWhitespace: Boolean,\n+    private val htmlTag: HTMLTag = HTMLTag.DIV,\n ) {\n     fun appendAsHtmlFragment() {\n         appendHtmlPrefix()\n@@ -59,11 +60,11 @@ class TextToHtml private constructor(\n     }\n \n     private fun appendHtmlPrefix() {\n-        html.append(\"\"\"<div dir=\"auto\">\"\"\")\n+        html.append(\"\"\"<${htmlTag.html} dir=\"auto\">\"\"\")\n     }\n \n     private fun appendHtmlSuffix() {\n-        html.append(\"</div>\")\n+        html.append(\"</${htmlTag.html}>\")\n     }\n \n     private fun appendHtmlEncoded(startIndex: Int, endIndex: Int) {\n@@ -151,9 +152,9 @@ class TextToHtml private constructor(\n         }\n \n         @JvmStatic\n-        fun toHtmlFragment(text: CharSequence, retainOriginalWhitespace: Boolean): String {\n+        fun toHtmlFragment(text: CharSequence, retainOriginalWhitespace: Boolean, htmlTag: HTMLTag): String {\n             val html = StringBuilder(text.length + TEXT_TO_HTML_EXTRA_BUFFER_LENGTH)\n-            TextToHtml(text, html, retainOriginalWhitespace).appendAsHtmlFragment()\n+            TextToHtml(text, html, retainOriginalWhitespace, htmlTag).appendAsHtmlFragment()\n             return html.toString()\n         }\n     }\ndiff --git a/legacy/core/src/main/java/com/fsck/k9/message/quote/HtmlQuoteCreator.java b/legacy/core/src/main/java/com/fsck/k9/message/quote/HtmlQuoteCreator.java\nindex a460dd07a9f..e9aef053f3f 100644\n--- a/legacy/core/src/main/java/com/fsck/k9/message/quote/HtmlQuoteCreator.java\n+++ b/legacy/core/src/main/java/com/fsck/k9/message/quote/HtmlQuoteCreator.java\n@@ -6,6 +6,7 @@\n \n import com.fsck.k9.CoreResourceProvider;\n import app.k9mail.legacy.di.DI;\n+import com.fsck.k9.message.html.HTMLTag;\n import net.thunderbird.core.android.account.QuoteStyle;\n import net.thunderbird.core.logging.legacy.Log;\n import com.fsck.k9.mail.Address;\n@@ -68,12 +69,14 @@ public static InsertableHtmlContent quoteOriginalHtmlMessage(Message originalMes\n             insertable.insertIntoQuotedFooter(footer);\n         } else if (quoteStyle == QuoteStyle.HEADER) {\n \n+            HTMLTag span = HTMLTag.SPAN; //Fixes #9236\n+\n             StringBuilder header = new StringBuilder();\n             header.append(\"<div style='font-size:10.0pt;font-family:\\\"Tahoma\\\",\\\"sans-serif\\\";padding:3.0pt 0in 0in 0in'>\\r\\n\");\n             header.append(\"<hr style='border:none;border-top:solid #E1E1E1 1.0pt'>\\r\\n\"); // This gets converted into a horizontal line during html to text conversion.\n             if (originalMessage.getFrom() != null && fromAddress.length() != 0) {\n                 header.append(\"<b>\").append(resourceProvider.messageHeaderFrom()).append(\"</b> \")\n-                        .append(HtmlConverter.textToHtmlFragment(fromAddress))\n+                        .append(HtmlConverter.textToHtmlFragment(fromAddress, span))\n                         .append(\"<br>\\r\\n\");\n             }\n             if (sentDate.length() != 0) {\n@@ -83,17 +86,18 @@ public static InsertableHtmlContent quoteOriginalHtmlMessage(Message originalMes\n             }\n             if (originalMessage.getRecipients(RecipientType.TO) != null && originalMessage.getRecipients(RecipientType.TO).length != 0) {\n                 header.append(\"<b>\").append(resourceProvider.messageHeaderTo()).append(\"</b> \")\n-                        .append(HtmlConverter.textToHtmlFragment(Address.toString(originalMessage.getRecipients(RecipientType.TO))))\n+                        .append(HtmlConverter.textToHtmlFragment(Address.toString(originalMessage.getRecipients(RecipientType.TO)),\n+                            span))\n                         .append(\"<br>\\r\\n\");\n             }\n             if (originalMessage.getRecipients(RecipientType.CC) != null && originalMessage.getRecipients(RecipientType.CC).length != 0) {\n                 header.append(\"<b>\").append(resourceProvider.messageHeaderCc()).append(\"</b> \")\n-                        .append(HtmlConverter.textToHtmlFragment(Address.toString(originalMessage.getRecipients(RecipientType.CC))))\n+                        .append(HtmlConverter.textToHtmlFragment(Address.toString(originalMessage.getRecipients(RecipientType.CC)), span))\n                         .append(\"<br>\\r\\n\");\n             }\n             if (originalMessage.getSubject() != null) {\n                 header.append(\"<b>\").append(resourceProvider.messageHeaderSubject()).append(\"</b> \")\n-                        .append(HtmlConverter.textToHtmlFragment(originalMessage.getSubject()))\n+                        .append(HtmlConverter.textToHtmlFragment(originalMessage.getSubject(), span))\n                         .append(\"<br>\\r\\n\");\n             }\n             header.append(\"</div>\\r\\n\");\n", "changes": [{"file": "legacy/core/src/main/java/com/fsck/k9/message/html/HTMLTag.kt", "module": "com.fsck.k9.message.html.HTMLTag", "range": [{"start": 0, "end": 0}]}, {"file": "legacy/core/src/main/java/com/fsck/k9/message/html/HtmlConverter.kt", "module": "com.fsck.k9.message.html.HtmlConverter", "range": [{"start": 49, "end": 51}]}, {"file": "legacy/core/src/main/java/com/fsck/k9/message/html/TextToHtml.kt", "module": "com.fsck.k9.message.html.TextToHtml", "range": [{"start": 9, "end": 9}, {"start": 62, "end": 63}, {"start": 66, "end": 67}, {"start": 154, "end": 155}, {"start": 156, "end": 157}]}, {"file": "legacy/core/src/main/java/com/fsck/k9/message/quote/HtmlQuoteCreator.java", "module": "com.fsck.k9.message.quote.HtmlQuoteCreator", "range": [{"start": 9, "end": 9}, {"start": 71, "end": 71}, {"start": 76, "end": 77}, {"start": 86, "end": 87}, {"start": 91, "end": 92}, {"start": 96, "end": 97}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/9212", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 9212, "url": "https://github.com/thunderbird/thunderbird-android/issues/9212", "state": "closed", "title": "Non-english folder names are displayed incorrectly", "body": "### Checklist\n\n- [x] I have used the search function to see if someone else has already submitted the same bug report.\n- [x] I will describe the problem with as much detail as possible.\n\n### App\n\nK-9 Mail\n\n### App version\n\nManually builded from branch main from 23.05.2025\n\n### Where did you get the app from?\n\nOther\n\n### Android version\n\nAndroid 14 HIOS (stock rom)\n\n### Device model\n\nTecno Spark 30 (KL6)\n\n### Steps to reproduce\n\n1. Open app\n2. Create account\n3. Open folder list (left menu)\n4. See \"?\" symbols instead of Cyrillic characters in folder names\n\n### Expected behavior\n\nCorrect folder names, like this:\n\n![Image](https://github.com/user-attachments/assets/9f32f4e9-8e02-4b5a-9d51-9571e54dedef)\n\n### Actual behavior\n\nSigns \"?\" instead of Cyrillic characters in folder names.\n\n![Image](https://github.com/user-attachments/assets/c82ec8a7-0c24-43b2-876c-60741d8f1826)\n\n### Logs\n\n[k9mail-logs.txt](https://github.com/user-attachments/files/20417577/k9mail-logs.txt)", "logs": [{"name": "k9mail-logs.txt", "url": "https://github.com/user-attachments/files/20417577/k9mail-logs.txt"}]}, "pull_request": [{"number": 9241, "url": "https://github.com/thunderbird/thunderbird-android/pull/9241", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/9241.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/9241.patch", "title": "Handle UTF8 strings sent using literal syntax", "content": "RFC 6855/9755 permits IMAP servers to send UTF8 in strings such as \"this\", but does not ban sending literals such as {4}\r\nthis\r\ninstead, and some servers do, and #8772 did not handle that.\r\n\r\nFixes #9212", "diff": "diff --git a/backend/imap/src/main/java/com/fsck/k9/backend/imap/CommandRefreshFolderList.kt b/backend/imap/src/main/java/com/fsck/k9/backend/imap/CommandRefreshFolderList.kt\nindex 3a79960785d..f6f70b3e7bd 100644\n--- a/backend/imap/src/main/java/com/fsck/k9/backend/imap/CommandRefreshFolderList.kt\n+++ b/backend/imap/src/main/java/com/fsck/k9/backend/imap/CommandRefreshFolderList.kt\n@@ -36,8 +36,8 @@ internal class CommandRefreshFolderList(\n }\n \n private fun List<FolderListItem>.toLegacyFolderList(): List<LegacyFolderListItem> {\n-    return this.filterNot { it.oldServerId == null }\n-        .map { LegacyFolderListItem(it.oldServerId!!, it.name, it.type) }\n+    return this\n+        .map { LegacyFolderListItem(it.serverId, it.name, it.type) }\n }\n \n private data class LegacyFolderListItem(\ndiff --git a/backend/imap/src/test/java/com/fsck/k9/backend/imap/TestImapStore.kt b/backend/imap/src/test/java/com/fsck/k9/backend/imap/TestImapStore.kt\nindex acd95b9c483..098cb8e909c 100644\n--- a/backend/imap/src/test/java/com/fsck/k9/backend/imap/TestImapStore.kt\n+++ b/backend/imap/src/test/java/com/fsck/k9/backend/imap/TestImapStore.kt\n@@ -33,7 +33,6 @@ class TestImapStore : ImapStore {\n                 serverId = folder.serverId,\n                 name = \"irrelevant\",\n                 type = FolderType.REGULAR,\n-                oldServerId = null,\n             )\n         }\n     }\ndiff --git a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/FolderListItem.kt b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/FolderListItem.kt\nindex b0bc0154edc..ce2f0cb5f48 100644\n--- a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/FolderListItem.kt\n+++ b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/FolderListItem.kt\n@@ -6,5 +6,4 @@ data class FolderListItem(\n     val serverId: String,\n     val name: String,\n     val type: FolderType,\n-    val oldServerId: String?,\n )\ndiff --git a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/FolderNameCodec.kt b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/FolderNameCodec.kt\nindex 9619f654ded..7862f112f59 100644\n--- a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/FolderNameCodec.kt\n+++ b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/FolderNameCodec.kt\n@@ -8,8 +8,13 @@ import java.nio.charset.StandardCharsets\n internal class FolderNameCodec {\n     private val modifiedUtf7Charset = CharsetProvider().charsetForName(\"X-RFC-3501\")\n     private val asciiCharset = StandardCharsets.US_ASCII\n+    var acceptUtf8Encoding = false\n \n     fun encode(folderName: String): String {\n+        if (acceptUtf8Encoding) {\n+            return folderName\n+        }\n+\n         val byteBuffer = modifiedUtf7Charset.encode(folderName)\n         val bytes = ByteArray(byteBuffer.limit())\n         byteBuffer.get(bytes)\n@@ -18,6 +23,10 @@ internal class FolderNameCodec {\n     }\n \n     fun decode(encodedFolderName: String): String {\n+        if (acceptUtf8Encoding) {\n+            return encodedFolderName\n+        }\n+\n         val decoder = modifiedUtf7Charset.newDecoder().onMalformedInput(CodingErrorAction.REPORT)\n         val byteBuffer = ByteBuffer.wrap(encodedFolderName.toByteArray(asciiCharset))\n         val charBuffer = decoder.decode(byteBuffer)\ndiff --git a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapConnection.kt b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapConnection.kt\nindex 7d67b0fcf1c..d4ad3fdc92c 100644\n--- a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapConnection.kt\n+++ b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapConnection.kt\n@@ -19,6 +19,8 @@ internal interface ImapConnection {\n \n     fun close()\n \n+    fun canSendUTF8QuotedStrings(): Boolean\n+\n     @Throws(IOException::class, MessagingException::class)\n     fun hasCapability(capability: String): Boolean\n \ndiff --git a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapFolderFetcher.kt b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapFolderFetcher.kt\nindex 3c74ab8e9d8..4e036ced350 100644\n--- a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapFolderFetcher.kt\n+++ b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapFolderFetcher.kt\n@@ -50,10 +50,9 @@ class ImapFolderFetcher internal constructor(\n         return try {\n             store.getFolders()\n                 .asSequence()\n-                .filterNot { it.oldServerId == null }\n                 .map { folder ->\n                     RemoteFolder(\n-                        serverId = FolderServerId(folder.oldServerId!!),\n+                        serverId = FolderServerId(folder.serverId),\n                         displayName = folder.name,\n                         type = folder.type,\n                     )\ndiff --git a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapResponseParser.java b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapResponseParser.java\nindex f1077c20ceb..d77d504fcc7 100644\n--- a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapResponseParser.java\n+++ b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapResponseParser.java\n@@ -22,14 +22,15 @@ class ImapResponseParser {\n     private boolean utf8Accept;\n     private FolderNameCodec folderNameCodec;\n \n-    public ImapResponseParser(PeekableInputStream in) {\n+    public ImapResponseParser(PeekableInputStream in, FolderNameCodec folderNameCodec) {\n         this.inputStream = in;\n         this.utf8Accept = false;\n-        this.folderNameCodec = new FolderNameCodec();\n+        this.folderNameCodec = folderNameCodec;\n     }\n \n     public void setUtf8Accepted(final boolean yes) {\n         utf8Accept = yes;\n+        folderNameCodec.setAcceptUtf8Encoding(yes);\n     }\n \n     public ImapResponse readResponse() throws IOException {\n@@ -417,7 +418,7 @@ private Object parseLiteral() throws IOException {\n             read += count;\n         }\n \n-        return new String(data, \"US-ASCII\");\n+        return new String(data, \"UTF8\");\n     }\n \n     private String parseQuoted() throws IOException {\ndiff --git a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.kt b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.kt\nindex 4923b0ed8f6..ccf7a3ae953 100644\n--- a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.kt\n+++ b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.kt\n@@ -45,6 +45,7 @@ internal class RealImapConnection(\n     private val settings: ImapSettings,\n     private val socketFactory: TrustedSocketFactory,\n     private val oauthTokenProvider: OAuth2TokenProvider?,\n+    private val folderNameCodec: FolderNameCodec,\n     override val connectionGeneration: Int,\n     private val socketConnectTimeout: Int = SOCKET_CONNECT_TIMEOUT,\n     private val socketReadTimeout: Int = SOCKET_READ_TIMEOUT,\n@@ -206,7 +207,7 @@ internal class RealImapConnection(\n \n     private fun setUpStreamsAndParser(input: InputStream, output: OutputStream) {\n         inputStream = PeekableInputStream(BufferedInputStream(input, BUFFER_SIZE))\n-        responseParser = ImapResponseParser(inputStream)\n+        responseParser = ImapResponseParser(inputStream, folderNameCodec)\n         imapOutputStream = BufferedOutputStream(output, BUFFER_SIZE)\n     }\n \n@@ -676,6 +677,10 @@ internal class RealImapConnection(\n         return isListResponse && hierarchyDelimiterValid\n     }\n \n+    override fun canSendUTF8QuotedStrings(): Boolean {\n+        return isUtf8AcceptCapable // later: or IMAP4Rev2 is enabled\n+    }\n+\n     override fun hasCapability(capability: String): Boolean {\n         if (!open) {\n             open()\ndiff --git a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapFolder.kt b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapFolder.kt\nindex 01dcaf26a65..f0e2cb8378a 100644\n--- a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapFolder.kt\n+++ b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapFolder.kt\n@@ -98,11 +98,7 @@ internal class RealImapFolder(\n     @get:Throws(MessagingException::class)\n     private val encodedName: String\n         get() {\n-            return if (connection?.isUtf8AcceptCapable == true) {\n-                prefixedName\n-            } else {\n-                folderNameCodec.encode(prefixedName)\n-            }\n+            return folderNameCodec.encode(prefixedName)\n         }\n \n     @Throws(MessagingException::class, IOException::class)\n@@ -311,11 +307,7 @@ internal class RealImapFolder(\n \n         val uids = messages.map { it.uid.toLong() }.toSet()\n         val encodedDestinationFolderName =\n-            if (connection!!.isUtf8AcceptCapable) {\n-                folder.prefixedName\n-            } else {\n-                folderNameCodec.encode(folder.prefixedName)\n-            }\n+            folderNameCodec.encode(folder.prefixedName)\n         val escapedDestinationFolderName = ImapUtility.encodeString(encodedDestinationFolderName)\n \n         return try {\n@@ -351,11 +343,7 @@ internal class RealImapFolder(\n \n         val uids = messages.map { it.uid.toLong() }.toSet()\n         val encodedDestinationFolderName =\n-            if (connection!!.isUtf8AcceptCapable) {\n-                folder.prefixedName\n-            } else {\n-                folderNameCodec.encode(folder.prefixedName)\n-            }\n+            folderNameCodec.encode(folder.prefixedName)\n         val escapedDestinationFolderName = ImapUtility.encodeString(encodedDestinationFolderName)\n \n         return try {\ndiff --git a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapStore.kt b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapStore.kt\nindex 8e2e7bb3950..ca36081bc97 100644\n--- a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapStore.kt\n+++ b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapStore.kt\n@@ -18,6 +18,8 @@ import java.util.Deque\n import java.util.LinkedList\n import net.thunderbird.core.logging.legacy.Log\n \n+private const val LAST_ASCII_CODE = 127\n+\n internal open class RealImapStore(\n     private val serverSettings: ServerSettings,\n     override val config: ImapStoreConfig,\n@@ -154,7 +156,6 @@ internal open class RealImapStore(\n             }\n \n             val name = getFolderDisplayName(serverId)\n-            val oldServerId = getOldServerId(serverId)\n \n             val type = when {\n                 listResponse.hasAttribute(\"\\\\Archive\") -> FolderType.ARCHIVE\n@@ -168,19 +169,23 @@ internal open class RealImapStore(\n \n             val existingItem = folderMap[serverId]\n             if (existingItem == null || existingItem.type == FolderType.REGULAR) {\n-                folderMap[serverId] = FolderListItem(serverId, name, type, oldServerId)\n+                folderMap[serverId] = FolderListItem(serverId, name, type)\n             }\n         }\n \n         return buildList {\n-            add(FolderListItem(RealImapFolder.INBOX, RealImapFolder.INBOX, FolderType.INBOX, RealImapFolder.INBOX))\n+            add(FolderListItem(RealImapFolder.INBOX, RealImapFolder.INBOX, FolderType.INBOX))\n             addAll(folderMap.values)\n         }\n     }\n \n     private fun getFolderDisplayName(serverId: String): String {\n         val decodedFolderName = try {\n-            folderNameCodec.decode(serverId)\n+            if (serverId.all { it.code <= LAST_ASCII_CODE }) {\n+                folderNameCodec.decode(serverId)\n+            } else {\n+                serverId\n+            }\n         } catch (e: CharacterCodingException) {\n             Log.w(e, \"Folder name not correctly encoded with the UTF-7 variant as defined by RFC 3501: %s\", serverId)\n             serverId\n@@ -190,17 +195,6 @@ internal open class RealImapStore(\n         return folderNameWithoutPrefix ?: decodedFolderName\n     }\n \n-    private fun getOldServerId(serverId: String): String? {\n-        val decodedFolderName = try {\n-            folderNameCodec.decode(serverId)\n-        } catch (e: CharacterCodingException) {\n-            // Previous versions of K-9 Mail ignored folders with invalid UTF-7 encoding\n-            return null\n-        }\n-\n-        return removePrefixFromFolderName(decodedFolderName)\n-    }\n-\n     private fun removePrefixFromFolderName(folderName: String): String? {\n         val prefix = getCombinedPrefix()\n         val prefixLength = prefix.length\n@@ -287,6 +281,7 @@ internal open class RealImapStore(\n             StoreImapSettings(),\n             trustedSocketFactory,\n             oauthTokenProvider,\n+            folderNameCodec,\n             connectionGeneration,\n         )\n     }\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapFolderFetcherTest.kt b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapFolderFetcherTest.kt\nindex 8830ebc0eb4..48fa58dc53e 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapFolderFetcherTest.kt\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapFolderFetcherTest.kt\n@@ -60,49 +60,41 @@ class ImapFolderFetcherTest {\n                     serverId = \"INBOX\",\n                     name = \"INBOX\",\n                     type = FolderType.INBOX,\n-                    oldServerId = \"INBOX\",\n                 ),\n                 FolderListItem(\n                     serverId = \"[Gmail]/All Mail\",\n                     name = \"[Gmail]/All Mail\",\n                     type = FolderType.ARCHIVE,\n-                    oldServerId = \"[Gmail]/All Mail\",\n                 ),\n                 FolderListItem(\n                     serverId = \"[Gmail]/Drafts\",\n                     name = \"[Gmail]/Drafts\",\n                     type = FolderType.DRAFTS,\n-                    oldServerId = \"[Gmail]/Drafts\",\n                 ),\n                 FolderListItem(\n                     serverId = \"[Gmail]/Important\",\n                     name = \"[Gmail]/Important\",\n                     type = FolderType.REGULAR,\n-                    oldServerId = \"[Gmail]/Important\",\n                 ),\n                 FolderListItem(\n                     serverId = \"[Gmail]/Sent Mail\",\n                     name = \"[Gmail]/Sent Mail\",\n                     type = FolderType.SENT,\n-                    oldServerId = \"[Gmail]/Sent Mail\",\n                 ),\n                 FolderListItem(\n                     serverId = \"[Gmail]/Spam\",\n                     name = \"[Gmail]/Spam\",\n                     type = FolderType.SPAM,\n-                    oldServerId = \"[Gmail]/Spam\",\n                 ),\n                 FolderListItem(\n                     serverId = \"[Gmail]/Starred\",\n                     name = \"[Gmail]/Starred\",\n                     type = FolderType.REGULAR,\n-                    oldServerId = \"[Gmail]/Starred\",\n                 ),\n                 FolderListItem(\n                     serverId = \"[Gmail]/Trash\",\n                     name = \"[Gmail]/Trash\",\n                     type = FolderType.TRASH,\n-                    oldServerId = \"[Gmail]/Trash\",\n                 ),\n             )\n         }\n@@ -154,38 +146,6 @@ class ImapFolderFetcherTest {\n         assertThat(fakeImapStore.hasOpenConnections).isFalse()\n     }\n \n-    @Test\n-    fun `folder without oldServerId should be ignored`() {\n-        fakeImapStore.getFoldersAction = {\n-            listOf(\n-                FolderListItem(\n-                    serverId = \"nicode\",\n-                    name = \"nicode\",\n-                    type = FolderType.REGULAR,\n-                    oldServerId = null,\n-                ),\n-                FolderListItem(\n-                    serverId = \"INBOX\",\n-                    name = \"INBOX\",\n-                    type = FolderType.INBOX,\n-                    oldServerId = \"INBOX\",\n-                ),\n-            )\n-        }\n-\n-        val folders = folderFetcher.getFolders(serverSettings, authStateStorage = null)\n-\n-        assertThat(folders).containsExactly(\n-            RemoteFolder(\n-                serverId = FolderServerId(\"INBOX\"),\n-                displayName = \"INBOX\",\n-                type = FolderType.INBOX,\n-            ),\n-        )\n-\n-        assertThat(fakeImapStore.hasOpenConnections).isFalse()\n-    }\n-\n     @Test\n     fun `authentication error should throw FolderFetcherException with server message`() {\n         fakeImapStore.getFoldersAction = {\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapResponseHelper.java b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapResponseHelper.java\nindex 5eb48ecc67d..cd639e6a9d3 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapResponseHelper.java\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapResponseHelper.java\n@@ -21,9 +21,14 @@ public static List<ImapResponse> createImapResponseList(String... responses) thr\n     }\n \n     public static ImapResponse createImapResponse(String response) throws IOException {\n+        return createImapResponse(response, false);\n+    }\n+\n+    public static ImapResponse createImapResponse(String response, boolean utf8) throws IOException {\n         String input = response + \"\\r\\n\";\n         PeekableInputStream inputStream = new PeekableInputStream(new ByteArrayInputStream(input.getBytes()));\n-        ImapResponseParser parser = new ImapResponseParser(inputStream);\n+        ImapResponseParser parser = new ImapResponseParser(inputStream, new FolderNameCodec());\n+        parser.setUtf8Accepted(utf8);\n \n         return parser.readResponse();\n     }\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapResponseParserTest.kt b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapResponseParserTest.kt\nindex b17042a3688..1963e86b836 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapResponseParserTest.kt\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapResponseParserTest.kt\n@@ -471,6 +471,18 @@ class ImapResponseParserTest {\n         assertThatAllInputWasConsumed()\n     }\n \n+    @Test\n+    fun `readResponse() with LIST response containing folder name with literal UTF8`() {\n+        val parser = createParserWithResponses(\"\"\"* LIST (\\hasnochildren) \"/\" {18}\"\"\" + \"\\r\\n\")\n+\n+        parser.setUtf8Accepted(true)\n+        val response = parser.readResponse()\n+\n+        assertThat(response).hasSize(4)\n+        assertThat(response).index(3).isEqualTo(\"\")\n+        assertThatAllInputWasConsumed()\n+    }\n+\n     @Test\n     fun `readResponse() with LIST response containing folder name with parentheses should throw`() {\n         val parser = createParserWithResponses(\"\"\"* LIST (\\NoInferiors) \"/\" Root/Folder/Subfolder()\"\"\")\n@@ -595,7 +607,7 @@ class ImapResponseParserTest {\n         val byteArrayInputStream = ByteArrayInputStream(response.toByteArray(Charsets.UTF_8))\n         peekableInputStream = PeekableInputStream(byteArrayInputStream)\n \n-        return ImapResponseParser(peekableInputStream)\n+        return ImapResponseParser(peekableInputStream, FolderNameCodec())\n     }\n \n     private fun assertThatAllInputWasConsumed() {\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapConnectionTest.kt b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapConnectionTest.kt\nindex 39daedb6064..c34fdd6c2f4 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapConnectionTest.kt\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapConnectionTest.kt\n@@ -1185,6 +1185,7 @@ class RealImapConnectionTest {\n             settings,\n             socketFactory,\n             oAuth2TokenProvider,\n+            FolderNameCodec(),\n             connectionGeneration,\n             SOCKET_CONNECT_TIMEOUT,\n             SOCKET_READ_TIMEOUT,\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapFolderTest.kt b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapFolderTest.kt\nindex 6588cc462dd..6731f1406e0 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapFolderTest.kt\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapFolderTest.kt\n@@ -379,6 +379,25 @@ class RealImapFolderTest {\n         assertThat(uidMapping).isNotNull().containsOnly(\"1\" to \"101\")\n     }\n \n+    @Test\n+    fun `moveMessages() with MOVE and UTF8=ACCEPT extensions`() {\n+        val folderNameCodec = FolderNameCodec()\n+        folderNameCodec.acceptUtf8Encoding = true\n+        val sourceFolder = RealImapFolder(internalImapStore, testConnectionManager, \"Folder\", folderNameCodec)\n+        prepareImapFolderForOpen(OpenMode.READ_WRITE)\n+        imapConnection.stub {\n+            on { hasCapability(Capabilities.MOVE) } doReturn true\n+        }\n+        val destinationFolder = createFolder(\"la vache dit m\")\n+        val messages = listOf(createImapMessage(\"1\"))\n+        setupMoveResponses(\"x OK [COPYUID 23 1 101] Success\")\n+        sourceFolder.open(OpenMode.READ_WRITE)\n+\n+        val uidMapping = sourceFolder.moveMessages(messages, destinationFolder)\n+\n+        assertCommandWithIdsIssued(\"UID MOVE 1 \\\"la vache dit m\\\"\")\n+    }\n+\n     @Test\n     fun moveMessages_shouldCopyMessages() {\n         val sourceFolder = createFolder(\"Folder\")\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapStoreTest.kt b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapStoreTest.kt\nindex c46c6dd95b6..a154763c2e1 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapStoreTest.kt\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapStoreTest.kt\n@@ -116,6 +116,23 @@ class RealImapStoreTest {\n         verify(imapConnection).executeSimpleCommand(\"\"\"LIST \"\" \"*\"\"\"\")\n     }\n \n+    @Test\n+    fun `getFolder() should not corrupt UTF8 folder names`() {\n+        val imapStore = createTestImapStore(isSubscribedFoldersOnly = false)\n+        val imapConnection = createMockConnection().stub {\n+            on { executeSimpleCommand(\"\"\"LIST \"\" \"*\"\"\"\") } doReturn listOf(\n+                createImapResponse(\"\"\"* LIST () \".\" \"Chvre\"\"\"\", true),\n+                createImapResponse(\"6 OK Success\"),\n+            )\n+        }\n+        imapStore.enqueueImapConnection(imapConnection)\n+\n+        val folders = imapStore.getFolders()\n+\n+        assertThat(folders).isNotNull()\n+        assertThat(folders.map { it.name }).containsExactly(\"INBOX\", \"Chvre\")\n+    }\n+\n     @Test\n     fun `getFolders() should ignore NoSelect entries`() {\n         val imapStore = createTestImapStore(isSubscribedFoldersOnly = false)\n@@ -218,7 +235,6 @@ class RealImapStoreTest {\n         assertThat(folders).isNotNull()\n         assertThat(folders.map { it.serverId }).containsExactly(\"INBOX\", \"INBOX.FolderOne\", \"INBOX.FolderTwo\")\n         assertThat(folders.map { it.name }).containsExactly(\"INBOX\", \"FolderOne\", \"FolderTwo\")\n-        assertThat(folders.map { it.oldServerId }).containsExactly(\"INBOX\", \"FolderOne\", \"FolderTwo\")\n     }\n \n     @Test\n@@ -239,7 +255,6 @@ class RealImapStoreTest {\n         assertThat(folders).isNotNull()\n         assertThat(folders.map { it.serverId }).containsExactly(\"INBOX\", \"INBOX.FolderOne\", \"FolderTwo\")\n         assertThat(folders.map { it.name }).containsExactly(\"INBOX\", \"FolderOne\", \"FolderTwo\")\n-        assertThat(folders.mapNotNull { it.oldServerId }).containsExactly(\"INBOX\", \"FolderOne\")\n     }\n \n     @Test\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/TestImapConnection.kt b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/TestImapConnection.kt\nindex d9996ddf039..a43ea6df71f 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/TestImapConnection.kt\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/TestImapConnection.kt\n@@ -38,6 +38,10 @@ internal open class TestImapConnection(val timeout: Long, override val connectio\n         isConnected = false\n     }\n \n+    override fun canSendUTF8QuotedStrings(): Boolean {\n+        return false // to be mocked where appropriate\n+    }\n+\n     override fun hasCapability(capability: String): Boolean {\n         throw UnsupportedOperationException(\"not implemented\")\n     }\n", "changes": [{"file": "backend/imap/src/main/java/com/fsck/k9/backend/imap/CommandRefreshFolderList.kt", "module": "com.fsck.k9.backend.imap.CommandRefreshFolderList", "range": [{"start": 39, "end": 41}]}, {"file": "mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/FolderListItem.kt", "module": "com.fsck.k9.mail.store.imap.FolderListItem", "range": [{"start": 9, "end": 9}]}, {"file": "mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/FolderNameCodec.kt", "module": "com.fsck.k9.mail.store.imap.FolderNameCodec", "range": [{"start": 11, "end": 11}, {"start": 13, "end": 13}, {"start": 21, "end": 21}]}, {"file": "mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapConnection.kt", "module": "com.fsck.k9.mail.store.imap.ImapConnection", "range": [{"start": 22, "end": 22}]}, {"file": "mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapFolderFetcher.kt", "module": "com.fsck.k9.mail.store.imap.ImapFolderFetcher", "range": [{"start": 53, "end": 53}, {"start": 56, "end": 57}]}, {"file": "mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapResponseParser.java", "module": "com.fsck.k9.mail.store.imap.ImapResponseParser", "range": [{"start": 25, "end": 26}, {"start": 28, "end": 29}, {"start": 33, "end": 33}, {"start": 420, "end": 421}]}, {"file": "mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.kt", "module": "com.fsck.k9.mail.store.imap.RealImapConnection", "range": [{"start": 48, "end": 48}, {"start": 209, "end": 210}, {"start": 679, "end": 679}]}, {"file": "mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapFolder.kt", "module": "com.fsck.k9.mail.store.imap.RealImapFolder", "range": [{"start": 101, "end": 106}, {"start": 314, "end": 319}, {"start": 354, "end": 359}]}, {"file": "mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapStore.kt", "module": "com.fsck.k9.mail.store.imap.RealImapStore", "range": [{"start": 21, "end": 21}, {"start": 157, "end": 157}, {"start": 171, "end": 172}, {"start": 176, "end": 177}, {"start": 183, "end": 184}, {"start": 193, "end": 203}, {"start": 290, "end": 290}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/9194", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 9194, "url": "https://github.com/thunderbird/thunderbird-android/issues/9194", "state": "closed", "title": "Authentication fails after some time with a Fastmail account", "body": "### Checklist\n\n- [x] I have used the search function to see if someone else has already submitted the same bug report.\n- [x] I will describe the problem with as much detail as possible.\n\n### App\n\nThunderbird for Android\n\n### App version\n\n11b02\n\n### Where did you get the app from?\n\nF-Droid\n\n### Android version\n\nCalyx OS 6.7.20\n\n### Device model\n\nGoogle Pixel 6 Pro\n\n### Steps to reproduce\n\n1. Add a [Fastmail](https://www.fastmail.com) account. The login process will use OAuth to sign me in.\n2. Enable notifications and push sync for the \"Inbox\" folder. Allow the app to set alarms and reminders as well.\n3. Allow unrestricted power usage for Thunderbird Beta.\n4. After a few hours, a notification with \"Authentication failed\" will appear, and the app won't be able to sync from the upstream IMAP server.\n\n### Expected behavior\n\nThe expected behaviour, and what still happens in Thunderbird 10.0, is that Thunderbird can fetch updates in the background and the OAuth authorization doesn't expire.\n\n### Actual behavior\n\nThe OAuth authorization expires a lot faster than before, and the app will continuously prompt me to log in, work for a few hours, and prompt me to log in again.\n\n### Logs\n\n[thunderbird.log](https://github.com/user-attachments/files/20353760/thunderbird.log)\n\nThe displayed notification is this:\n![Image](https://github.com/user-attachments/assets/11f94d8b-fd94-4600-96c4-0802e94c6cbb)", "logs": [{"name": "thunderbird.log", "url": "https://github.com/user-attachments/files/20353760/thunderbird.log"}]}, "pull_request": [{"number": 9414, "url": "https://github.com/thunderbird/thunderbird-android/pull/9414", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/9414.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/9414.patch", "title": "Fixes Outlook outgoing server autoconfig failure", "content": "Resolves #9194 and #8024.\r\n\r\nThis pull request reapplies changes from #9089 with minor adjustments, resolving the Outlook outgoing server issue while ensuring Fastmail authentication continues to function.", "diff": "diff --git a/app-k9mail/src/debug/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt b/app-k9mail/src/debug/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt\nindex 5080baf9ee0..97a72f2061b 100644\n--- a/app-k9mail/src/debug/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt\n+++ b/app-k9mail/src/debug/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt\n@@ -64,6 +64,8 @@ class K9OAuthConfigurationFactory : OAuthConfigurationFactory {\n         ) to OAuthConfiguration(\n             clientId = \"e647013a-ada4-4114-b419-e43d250f99c5\",\n             scopes = listOf(\n+                \"openid\",\n+                \"email\",\n                 \"https://outlook.office.com/IMAP.AccessAsUser.All\",\n                 \"https://outlook.office.com/SMTP.Send\",\n                 \"offline_access\",\ndiff --git a/app-k9mail/src/release/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt b/app-k9mail/src/release/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt\nindex 1e2af9111f2..a7100df7d22 100644\n--- a/app-k9mail/src/release/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt\n+++ b/app-k9mail/src/release/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt\n@@ -64,6 +64,8 @@ class K9OAuthConfigurationFactory : OAuthConfigurationFactory {\n         ) to OAuthConfiguration(\n             clientId = \"e647013a-ada4-4114-b419-e43d250f99c5\",\n             scopes = listOf(\n+                \"openid\",\n+                \"email\",\n                 \"https://outlook.office.com/IMAP.AccessAsUser.All\",\n                 \"https://outlook.office.com/SMTP.Send\",\n                 \"offline_access\",\ndiff --git a/app-thunderbird/src/beta/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt b/app-thunderbird/src/beta/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\nindex 4b695b7452e..8376dc84830 100644\n--- a/app-thunderbird/src/beta/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n+++ b/app-thunderbird/src/beta/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n@@ -65,6 +65,8 @@ class TbOAuthConfigurationFactory : OAuthConfigurationFactory {\n         ) to OAuthConfiguration(\n             clientId = \"e6f8716e-299d-4ed9-bbf3-453f192f44e5\",\n             scopes = listOf(\n+                \"openid\",\n+                \"email\",\n                 \"https://outlook.office.com/IMAP.AccessAsUser.All\",\n                 \"https://outlook.office.com/SMTP.Send\",\n                 \"offline_access\",\ndiff --git a/app-thunderbird/src/daily/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt b/app-thunderbird/src/daily/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\nindex b0c7f975871..580a82288a6 100644\n--- a/app-thunderbird/src/daily/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n+++ b/app-thunderbird/src/daily/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n@@ -64,6 +64,8 @@ class TbOAuthConfigurationFactory : OAuthConfigurationFactory {\n         ) to OAuthConfiguration(\n             clientId = \"e6f8716e-299d-4ed9-bbf3-453f192f44e5\",\n             scopes = listOf(\n+                \"openid\",\n+                \"email\",\n                 \"https://outlook.office.com/IMAP.AccessAsUser.All\",\n                 \"https://outlook.office.com/SMTP.Send\",\n                 \"offline_access\",\ndiff --git a/app-thunderbird/src/debug/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt b/app-thunderbird/src/debug/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\nindex 0ae92392f77..aeeb7c40cae 100644\n--- a/app-thunderbird/src/debug/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n+++ b/app-thunderbird/src/debug/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n@@ -64,6 +64,8 @@ class TbOAuthConfigurationFactory : OAuthConfigurationFactory {\n         ) to OAuthConfiguration(\n             clientId = \"e6f8716e-299d-4ed9-bbf3-453f192f44e5\",\n             scopes = listOf(\n+                \"openid\",\n+                \"email\",\n                 \"https://outlook.office.com/IMAP.AccessAsUser.All\",\n                 \"https://outlook.office.com/SMTP.Send\",\n                 \"offline_access\",\ndiff --git a/app-thunderbird/src/release/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt b/app-thunderbird/src/release/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\nindex ea20291121a..a8795dfb1df 100644\n--- a/app-thunderbird/src/release/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n+++ b/app-thunderbird/src/release/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n@@ -64,6 +64,8 @@ class TbOAuthConfigurationFactory : OAuthConfigurationFactory {\n         ) to OAuthConfiguration(\n             clientId = \"e6f8716e-299d-4ed9-bbf3-453f192f44e5\",\n             scopes = listOf(\n+                \"openid\",\n+                \"email\",\n                 \"https://outlook.office.com/IMAP.AccessAsUser.All\",\n                 \"https://outlook.office.com/SMTP.Send\",\n                 \"offline_access\",\ndiff --git a/legacy/common/src/main/java/com/fsck/k9/backends/RealOAuth2TokenProvider.kt b/legacy/common/src/main/java/com/fsck/k9/backends/RealOAuth2TokenProvider.kt\nindex 8e7e2d1a930..10f56497450 100644\n--- a/legacy/common/src/main/java/com/fsck/k9/backends/RealOAuth2TokenProvider.kt\n+++ b/legacy/common/src/main/java/com/fsck/k9/backends/RealOAuth2TokenProvider.kt\n@@ -17,20 +17,26 @@ import net.thunderbird.core.logging.legacy.Log\n class RealOAuth2TokenProvider(\n     context: Context,\n     private val authStateStorage: AuthStateStorage,\n-\n ) : OAuth2TokenProvider {\n     private val authService = AuthorizationService(context)\n     private var requestFreshToken = false\n \n+    override val primaryEmail: String?\n+        get() {\n+            return parseAuthState()\n+                .parsedIdToken\n+                ?.additionalClaims\n+                ?.get(\"email\")\n+                ?.toString()\n+        }\n+\n     @Suppress(\"TooGenericExceptionCaught\")\n     override fun getToken(timeoutMillis: Long): String {\n         val latch = CountDownLatch(1)\n         var token: String? = null\n         var exception: AuthorizationException? = null\n \n-        val authState = authStateStorage.getAuthorizationState()?.let { AuthState.jsonDeserialize(it) }\n-            ?: throw AuthenticationFailedException(\"Login required\")\n-\n+        val authState = parseAuthState()\n         if (requestFreshToken) {\n             authState.needsTokenRefresh = true\n         }\n@@ -85,4 +91,11 @@ class RealOAuth2TokenProvider(\n     override fun invalidateToken() {\n         requestFreshToken = true\n     }\n+\n+    private fun parseAuthState(): AuthState {\n+        return authStateStorage\n+            .getAuthorizationState()\n+            ?.let { AuthState.jsonDeserialize(it) }\n+            ?: throw AuthenticationFailedException(\"Login required\")\n+    }\n }\ndiff --git a/mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.java b/mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.java\ndeleted file mode 100644\nindex 77ec7ecab10..00000000000\n--- a/mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.java\n+++ /dev/null\n@@ -1,29 +0,0 @@\n-package com.fsck.k9.mail.oauth;\n-\n-\n-import com.fsck.k9.mail.AuthenticationFailedException;\n-\n-\n-public interface OAuth2TokenProvider {\n-    /**\n-     * A default timeout value to use when fetching tokens.\n-     */\n-    int OAUTH2_TIMEOUT = 30000;\n-\n-\n-    /**\n-     * Fetch a token. No guarantees are provided for validity.\n-     */\n-    String getToken(long timeoutMillis) throws AuthenticationFailedException;\n-\n-    /**\n-     * Invalidate the token for this username.\n-     *\n-     * <p>\n-     * Note that the token should always be invalidated on credential failure. However invalidating a token every\n-     * single time is not recommended.\n-     * <p>\n-     * Invalidating a token and then failure with a new token should be treated as a permanent failure.\n-     */\n-    void invalidateToken();\n-}\ndiff --git a/mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.kt b/mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.kt\nnew file mode 100644\nindex 00000000000..076f5912486\n--- /dev/null\n+++ b/mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.kt\n@@ -0,0 +1,41 @@\n+package com.fsck.k9.mail.oauth\n+\n+import com.fsck.k9.mail.AuthenticationFailedException\n+\n+interface OAuth2TokenProvider {\n+    companion object {\n+        /**\n+         * A default timeout value to use when fetching tokens.\n+         */\n+        const val OAUTH2_TIMEOUT: Int = 30000\n+    }\n+\n+    /**\n+     * Fetch the primary email found in the id_token additional claims,\n+     * if it is available.\n+     *\n+     * > Some providers, like Microsoft, require this as they need the primary account email to be the username,\n+     * not the email the user entered\n+     *\n+     * @return the primary email present in the id_token, otherwise null.\n+     */\n+    val primaryEmail: String?\n+        @Throws(AuthenticationFailedException::class)\n+        get\n+\n+    /**\n+     * Fetch a token. No guarantees are provided for validity.\n+     */\n+    @Throws(AuthenticationFailedException::class)\n+    fun getToken(timeoutMillis: Long): String\n+\n+    /**\n+     * Invalidate the token for this username.\n+     *\n+     * Note that the token should always be invalidated on credential failure. However invalidating a token every\n+     * single time is not recommended.\n+     *\n+     * Invalidating a token and then failure with a new token should be treated as a permanent failure.\n+     */\n+    fun invalidateToken()\n+}\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapServerSettingsValidatorTest.kt b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapServerSettingsValidatorTest.kt\nindex bed7b0a5743..dcd55a9826a 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapServerSettingsValidatorTest.kt\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapServerSettingsValidatorTest.kt\n@@ -351,7 +351,7 @@ class ImapServerSettingsValidatorTest {\n     }\n }\n \n-class FakeOAuth2TokenProvider : OAuth2TokenProvider {\n+class FakeOAuth2TokenProvider(override val primaryEmail: String? = null) : OAuth2TokenProvider {\n     override fun getToken(timeoutMillis: Long): String {\n         return AUTHORIZATION_TOKEN\n     }\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapConnectionTest.kt b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapConnectionTest.kt\nindex 1700cdb95c8..39daedb6064 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapConnectionTest.kt\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapConnectionTest.kt\n@@ -1272,7 +1272,7 @@ class RealImapConnectionTest {\n     }\n }\n \n-class TestTokenProvider : OAuth2TokenProvider {\n+class TestTokenProvider(override val primaryEmail: String? = null) : OAuth2TokenProvider {\n     private var invalidationCount = 0\n \n     override fun getToken(timeoutMillis: Long): String {\ndiff --git a/mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpTransport.kt b/mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpTransport.kt\nindex ce152f8528c..84d2b184f96 100644\n--- a/mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpTransport.kt\n+++ b/mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpTransport.kt\n@@ -549,10 +549,16 @@ class SmtpTransport(\n     }\n \n     private fun saslOAuth(method: OAuthMethod) {\n+        Log.d(\"saslOAuth() called with: method = $method\")\n         retryOAuthWithNewToken = true\n+\n+        val primaryEmail = oauthTokenProvider?.primaryEmail\n+        val primaryUsername = primaryEmail ?: username\n+\n         try {\n-            attempOAuth(method, username)\n+            attempOAuth(method, primaryUsername)\n         } catch (negativeResponse: NegativeSmtpReplyException) {\n+            Log.w(negativeResponse, \"saslOAuth: failed to authenticate.\")\n             if (negativeResponse.replyCode != SMTP_AUTHENTICATION_FAILURE_ERROR_CODE) {\n                 throw negativeResponse\n             }\n@@ -562,7 +568,7 @@ class SmtpTransport(\n             if (!retryOAuthWithNewToken) {\n                 handlePermanentOAuthFailure(method, negativeResponse)\n             } else {\n-                handleTemporaryOAuthFailure(method, username, negativeResponse)\n+                handleTemporaryOAuthFailure(method, primaryUsername, negativeResponse)\n             }\n         }\n     }\ndiff --git a/mail/protocols/smtp/src/test/java/com/fsck/k9/mail/transport/smtp/SmtpServerSettingsValidatorTest.kt b/mail/protocols/smtp/src/test/java/com/fsck/k9/mail/transport/smtp/SmtpServerSettingsValidatorTest.kt\nindex d6795c81327..ad880c998a1 100644\n--- a/mail/protocols/smtp/src/test/java/com/fsck/k9/mail/transport/smtp/SmtpServerSettingsValidatorTest.kt\n+++ b/mail/protocols/smtp/src/test/java/com/fsck/k9/mail/transport/smtp/SmtpServerSettingsValidatorTest.kt\n@@ -20,6 +20,7 @@ import java.net.UnknownHostException\n import kotlin.test.Test\n import net.thunderbird.core.logging.legacy.Log\n import net.thunderbird.core.logging.testing.TestLogger\n+import okio.ByteString.Companion.encodeUtf8\n import org.junit.Before\n \n private const val USERNAME = \"user\"\n@@ -115,6 +116,60 @@ class SmtpServerSettingsValidatorTest {\n         server.verifyInteractionCompleted()\n     }\n \n+    @Test\n+    fun `valid server settings with primary email different from username on OAuth should return Success`() {\n+        // Arrange\n+        val expectedUser = \"expected@email.com\"\n+        val serverSettingsValidator = SmtpServerSettingsValidator(\n+            trustedSocketFactory = trustedSocketFactory,\n+            oAuth2TokenProviderFactory = { authStateStorage ->\n+                assertThat(authStateStorage.getAuthorizationState()).isEqualTo(AUTHORIZATION_STATE)\n+                FakeOAuth2TokenProvider(primaryEmail = expectedUser)\n+            },\n+        )\n+\n+        val server = MockSmtpServer().apply {\n+            output(\"220 localhost Simple Mail Transfer Service Ready\")\n+            expect(\"EHLO $SMTP_HELLO_NAME\")\n+            output(\"250-localhost Hello $SMTP_HELLO_NAME\")\n+            output(\"250-ENHANCEDSTATUSCODES\")\n+            output(\"250-AUTH PLAIN LOGIN XOAUTH2\")\n+            output(\"250 HELP\")\n+\n+            val ouathBearer = \"user=${expectedUser}\\u0001auth=Bearer ${AUTHORIZATION_TOKEN}\\u0001\\u0001\"\n+                .encodeUtf8()\n+                .base64()\n+\n+            expect(\"AUTH XOAUTH2 $ouathBearer\")\n+            output(\"235 2.7.0 Authentication successful\")\n+            expect(\"QUIT\")\n+            closeConnection()\n+        }\n+\n+        server.start()\n+\n+        val serverSettings = ServerSettings(\n+            type = \"smtp\",\n+            host = server.host,\n+            port = server.port,\n+            connectionSecurity = ConnectionSecurity.NONE,\n+            authenticationType = AuthType.XOAUTH2,\n+            username = USERNAME,\n+            password = null,\n+            clientCertificateAlias = CLIENT_CERTIFICATE_ALIAS,\n+        )\n+\n+        val authStateStorage = FakeAuthStateStorage(authorizationState = AUTHORIZATION_STATE)\n+\n+        // Act\n+        val result = serverSettingsValidator.checkServerSettings(serverSettings, authStateStorage)\n+\n+        // Assert\n+        assertThat(result).isInstanceOf<ServerSettingsValidationResult.Success>()\n+        server.verifyConnectionClosed()\n+        server.verifyInteractionCompleted()\n+    }\n+\n     @Test\n     fun `authentication error should return AuthenticationError`() {\n         val server = MockSmtpServer().apply {\n@@ -342,7 +397,7 @@ class SmtpServerSettingsValidatorTest {\n     }\n }\n \n-class FakeOAuth2TokenProvider : OAuth2TokenProvider {\n+class FakeOAuth2TokenProvider(override val primaryEmail: String? = null) : OAuth2TokenProvider {\n     override fun getToken(timeoutMillis: Long): String {\n         return AUTHORIZATION_TOKEN\n     }\n", "changes": [{"file": "app-k9mail/src/debug/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt", "module": "app.k9mail.auth.K9OAuthConfigurationFactory", "range": [{"start": 67, "end": 67}]}, {"file": "app-k9mail/src/release/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt", "module": "app.k9mail.auth.K9OAuthConfigurationFactory", "range": [{"start": 67, "end": 67}]}, {"file": "app-thunderbird/src/beta/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt", "module": "net.thunderbird.android.auth.TbOAuthConfigurationFactory", "range": [{"start": 68, "end": 68}]}, {"file": "app-thunderbird/src/daily/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt", "module": "net.thunderbird.android.auth.TbOAuthConfigurationFactory", "range": [{"start": 67, "end": 67}]}, {"file": "app-thunderbird/src/debug/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt", "module": "net.thunderbird.android.auth.TbOAuthConfigurationFactory", "range": [{"start": 67, "end": 67}]}, {"file": "app-thunderbird/src/release/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt", "module": "net.thunderbird.android.auth.TbOAuthConfigurationFactory", "range": [{"start": 67, "end": 67}]}, {"file": "legacy/common/src/main/java/com/fsck/k9/backends/RealOAuth2TokenProvider.kt", "module": "com.fsck.k9.backends.RealOAuth2TokenProvider", "range": [{"start": 20, "end": 20}, {"start": 25, "end": 25}, {"start": 31, "end": 34}, {"start": 88, "end": 88}]}, {"file": "mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.kt", "module": "com.fsck.k9.mail.oauth.OAuth2TokenProvider", "range": [{"start": 0, "end": 0}]}, {"file": "mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpTransport.kt", "module": "com.fsck.k9.mail.transport.smtp.SmtpTransport", "range": [{"start": 552, "end": 552}, {"start": 553, "end": 553}, {"start": 554, "end": 555}, {"start": 556, "end": 556}, {"start": 565, "end": 566}]}]}, {"number": 9390, "url": "https://github.com/thunderbird/thunderbird-android/pull/9390", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/9390.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/9390.patch", "title": "Revert \"PR #9089 - Fixes Outlook outgoing server autoconfig failure\"", "content": "Reverts #9089 PR changes that caused the #9194 issue as a side effect.\r\n\r\nI will come up with a different solution for #8024 that won't cause a regression.", "diff": "diff --git a/app-k9mail/src/debug/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt b/app-k9mail/src/debug/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt\nindex 97a72f2061b..5080baf9ee0 100644\n--- a/app-k9mail/src/debug/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt\n+++ b/app-k9mail/src/debug/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt\n@@ -64,8 +64,6 @@ class K9OAuthConfigurationFactory : OAuthConfigurationFactory {\n         ) to OAuthConfiguration(\n             clientId = \"e647013a-ada4-4114-b419-e43d250f99c5\",\n             scopes = listOf(\n-                \"openid\",\n-                \"email\",\n                 \"https://outlook.office.com/IMAP.AccessAsUser.All\",\n                 \"https://outlook.office.com/SMTP.Send\",\n                 \"offline_access\",\ndiff --git a/app-k9mail/src/release/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt b/app-k9mail/src/release/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt\nindex a7100df7d22..1e2af9111f2 100644\n--- a/app-k9mail/src/release/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt\n+++ b/app-k9mail/src/release/kotlin/app/k9mail/auth/K9OAuthConfigurationFactory.kt\n@@ -64,8 +64,6 @@ class K9OAuthConfigurationFactory : OAuthConfigurationFactory {\n         ) to OAuthConfiguration(\n             clientId = \"e647013a-ada4-4114-b419-e43d250f99c5\",\n             scopes = listOf(\n-                \"openid\",\n-                \"email\",\n                 \"https://outlook.office.com/IMAP.AccessAsUser.All\",\n                 \"https://outlook.office.com/SMTP.Send\",\n                 \"offline_access\",\ndiff --git a/app-thunderbird/src/beta/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt b/app-thunderbird/src/beta/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\nindex 8376dc84830..4b695b7452e 100644\n--- a/app-thunderbird/src/beta/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n+++ b/app-thunderbird/src/beta/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n@@ -65,8 +65,6 @@ class TbOAuthConfigurationFactory : OAuthConfigurationFactory {\n         ) to OAuthConfiguration(\n             clientId = \"e6f8716e-299d-4ed9-bbf3-453f192f44e5\",\n             scopes = listOf(\n-                \"openid\",\n-                \"email\",\n                 \"https://outlook.office.com/IMAP.AccessAsUser.All\",\n                 \"https://outlook.office.com/SMTP.Send\",\n                 \"offline_access\",\ndiff --git a/app-thunderbird/src/daily/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt b/app-thunderbird/src/daily/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\nindex 580a82288a6..b0c7f975871 100644\n--- a/app-thunderbird/src/daily/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n+++ b/app-thunderbird/src/daily/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n@@ -64,8 +64,6 @@ class TbOAuthConfigurationFactory : OAuthConfigurationFactory {\n         ) to OAuthConfiguration(\n             clientId = \"e6f8716e-299d-4ed9-bbf3-453f192f44e5\",\n             scopes = listOf(\n-                \"openid\",\n-                \"email\",\n                 \"https://outlook.office.com/IMAP.AccessAsUser.All\",\n                 \"https://outlook.office.com/SMTP.Send\",\n                 \"offline_access\",\ndiff --git a/app-thunderbird/src/debug/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt b/app-thunderbird/src/debug/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\nindex aeeb7c40cae..0ae92392f77 100644\n--- a/app-thunderbird/src/debug/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n+++ b/app-thunderbird/src/debug/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n@@ -64,8 +64,6 @@ class TbOAuthConfigurationFactory : OAuthConfigurationFactory {\n         ) to OAuthConfiguration(\n             clientId = \"e6f8716e-299d-4ed9-bbf3-453f192f44e5\",\n             scopes = listOf(\n-                \"openid\",\n-                \"email\",\n                 \"https://outlook.office.com/IMAP.AccessAsUser.All\",\n                 \"https://outlook.office.com/SMTP.Send\",\n                 \"offline_access\",\ndiff --git a/app-thunderbird/src/release/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt b/app-thunderbird/src/release/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\nindex a8795dfb1df..ea20291121a 100644\n--- a/app-thunderbird/src/release/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n+++ b/app-thunderbird/src/release/kotlin/net/thunderbird/android/auth/TbOAuthConfigurationFactory.kt\n@@ -64,8 +64,6 @@ class TbOAuthConfigurationFactory : OAuthConfigurationFactory {\n         ) to OAuthConfiguration(\n             clientId = \"e6f8716e-299d-4ed9-bbf3-453f192f44e5\",\n             scopes = listOf(\n-                \"openid\",\n-                \"email\",\n                 \"https://outlook.office.com/IMAP.AccessAsUser.All\",\n                 \"https://outlook.office.com/SMTP.Send\",\n                 \"offline_access\",\ndiff --git a/legacy/common/src/main/java/com/fsck/k9/backends/RealOAuth2TokenProvider.kt b/legacy/common/src/main/java/com/fsck/k9/backends/RealOAuth2TokenProvider.kt\nindex 4699708e99d..8e7e2d1a930 100644\n--- a/legacy/common/src/main/java/com/fsck/k9/backends/RealOAuth2TokenProvider.kt\n+++ b/legacy/common/src/main/java/com/fsck/k9/backends/RealOAuth2TokenProvider.kt\n@@ -17,19 +17,10 @@ import net.thunderbird.core.logging.legacy.Log\n class RealOAuth2TokenProvider(\n     context: Context,\n     private val authStateStorage: AuthStateStorage,\n+\n ) : OAuth2TokenProvider {\n     private val authService = AuthorizationService(context)\n     private var requestFreshToken = false\n-    private val authState\n-        get() = authStateStorage.getAuthorizationState()\n-            ?.let { AuthState.jsonDeserialize(it) }\n-            ?: throw AuthenticationFailedException(\"Login required\")\n-\n-    override val primaryEmail: String?\n-        get() = authState.parsedIdToken\n-            ?.additionalClaims\n-            ?.get(\"email\")\n-            ?.toString()\n \n     @Suppress(\"TooGenericExceptionCaught\")\n     override fun getToken(timeoutMillis: Long): String {\n@@ -37,6 +28,9 @@ class RealOAuth2TokenProvider(\n         var token: String? = null\n         var exception: AuthorizationException? = null\n \n+        val authState = authStateStorage.getAuthorizationState()?.let { AuthState.jsonDeserialize(it) }\n+            ?: throw AuthenticationFailedException(\"Login required\")\n+\n         if (requestFreshToken) {\n             authState.needsTokenRefresh = true\n         }\ndiff --git a/mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.java b/mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.java\nnew file mode 100644\nindex 00000000000..77ec7ecab10\n--- /dev/null\n+++ b/mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.java\n@@ -0,0 +1,29 @@\n+package com.fsck.k9.mail.oauth;\n+\n+\n+import com.fsck.k9.mail.AuthenticationFailedException;\n+\n+\n+public interface OAuth2TokenProvider {\n+    /**\n+     * A default timeout value to use when fetching tokens.\n+     */\n+    int OAUTH2_TIMEOUT = 30000;\n+\n+\n+    /**\n+     * Fetch a token. No guarantees are provided for validity.\n+     */\n+    String getToken(long timeoutMillis) throws AuthenticationFailedException;\n+\n+    /**\n+     * Invalidate the token for this username.\n+     *\n+     * <p>\n+     * Note that the token should always be invalidated on credential failure. However invalidating a token every\n+     * single time is not recommended.\n+     * <p>\n+     * Invalidating a token and then failure with a new token should be treated as a permanent failure.\n+     */\n+    void invalidateToken();\n+}\ndiff --git a/mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.kt b/mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.kt\ndeleted file mode 100644\nindex 434a0cf9687..00000000000\n--- a/mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.kt\n+++ /dev/null\n@@ -1,41 +0,0 @@\n-package com.fsck.k9.mail.oauth\n-\n-import com.fsck.k9.mail.AuthenticationFailedException\n-\n-interface OAuth2TokenProvider {\n-    companion object {\n-        /**\n-         * A default timeout value to use when fetching tokens.\n-         */\n-        const val OAUTH2_TIMEOUT = 30000L\n-    }\n-\n-    /**\n-     * Fetch the primary email found in the id_token additional claims,\n-     * if it is available.\n-     *\n-     * > Some providers, like Microsoft, require this as they need the primary account email to be the username,\n-     * not the email the user entered\n-     *\n-     * @return the primary email present in the id_token, otherwise null.\n-     */\n-    val primaryEmail: String?\n-        @Throws(AuthenticationFailedException::class)\n-        get\n-\n-    /**\n-     * Fetch a token. No guarantees are provided for validity.\n-     */\n-    @Throws(AuthenticationFailedException::class)\n-    fun getToken(timeoutMillis: Long): String\n-\n-    /**\n-     * Invalidate the token for this username.\n-     *\n-     * Note that the token should always be invalidated on credential failure. However invalidating a token every\n-     * single time is not recommended.\n-     *\n-     * Invalidating a token and then failure with a new token should be treated as a permanent failure.\n-     */\n-    fun invalidateToken()\n-}\ndiff --git a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.kt b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.kt\nindex e3e57ce274f..597e65c559c 100644\n--- a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.kt\n+++ b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.kt\n@@ -403,7 +403,7 @@ internal class RealImapConnection(\n         val oauthTokenProvider = checkNotNull(oauthTokenProvider)\n         val responseParser = checkNotNull(responseParser)\n \n-        val token = oauthTokenProvider.getToken(OAuth2TokenProvider.OAUTH2_TIMEOUT)\n+        val token = oauthTokenProvider.getToken(OAuth2TokenProvider.OAUTH2_TIMEOUT.toLong())\n \n         val authString = method.buildInitialClientResponse(settings.username, token)\n         val tag = sendSaslIrCommand(method.command, authString, true)\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapServerSettingsValidatorTest.kt b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapServerSettingsValidatorTest.kt\nindex dcd55a9826a..bed7b0a5743 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapServerSettingsValidatorTest.kt\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/ImapServerSettingsValidatorTest.kt\n@@ -351,7 +351,7 @@ class ImapServerSettingsValidatorTest {\n     }\n }\n \n-class FakeOAuth2TokenProvider(override val primaryEmail: String? = null) : OAuth2TokenProvider {\n+class FakeOAuth2TokenProvider : OAuth2TokenProvider {\n     override fun getToken(timeoutMillis: Long): String {\n         return AUTHORIZATION_TOKEN\n     }\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapConnectionTest.kt b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapConnectionTest.kt\nindex 0448580c5d0..f3807e6b7cb 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapConnectionTest.kt\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapConnectionTest.kt\n@@ -1272,7 +1272,7 @@ class RealImapConnectionTest {\n     }\n }\n \n-class TestTokenProvider(override val primaryEmail: String? = null) : OAuth2TokenProvider {\n+class TestTokenProvider : OAuth2TokenProvider {\n     private var invalidationCount = 0\n \n     override fun getToken(timeoutMillis: Long): String {\ndiff --git a/mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpTransport.kt b/mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpTransport.kt\nindex f4401b98982..e2a4a243806 100644\n--- a/mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpTransport.kt\n+++ b/mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpTransport.kt\n@@ -551,27 +551,20 @@ class SmtpTransport(\n     }\n \n     private fun saslOAuth(method: OAuthMethod) {\n-        checkNotNull(oauthTokenProvider) {\n-            \"Can't perform saslOAuth with a null OAuthTokenProvider.\"\n-        }\n         retryOAuthWithNewToken = true\n-\n-        val primaryEmail = oauthTokenProvider.primaryEmail\n-        val primaryUsername = primaryEmail ?: username\n-\n         try {\n-            attempOAuth(method, primaryUsername)\n+            attempOAuth(method, username)\n         } catch (negativeResponse: NegativeSmtpReplyException) {\n             if (negativeResponse.replyCode != SMTP_AUTHENTICATION_FAILURE_ERROR_CODE) {\n                 throw negativeResponse\n             }\n \n-            oauthTokenProvider.invalidateToken()\n+            oauthTokenProvider!!.invalidateToken()\n \n             if (!retryOAuthWithNewToken) {\n                 handlePermanentOAuthFailure(method, negativeResponse)\n             } else {\n-                handleTemporaryOAuthFailure(method, primaryUsername, negativeResponse)\n+                handleTemporaryOAuthFailure(method, username, negativeResponse)\n             }\n         }\n     }\n@@ -612,7 +605,7 @@ class SmtpTransport(\n     }\n \n     private fun attempOAuth(method: OAuthMethod, username: String) {\n-        val token = oauthTokenProvider!!.getToken(OAuth2TokenProvider.OAUTH2_TIMEOUT)\n+        val token = oauthTokenProvider!!.getToken(OAuth2TokenProvider.OAUTH2_TIMEOUT.toLong())\n         val authString = method.buildInitialClientResponse(username, token)\n \n         val response = executeSensitiveCommand(\"%s %s\", method.command, authString)\ndiff --git a/mail/protocols/smtp/src/test/java/com/fsck/k9/mail/transport/smtp/SmtpServerSettingsValidatorTest.kt b/mail/protocols/smtp/src/test/java/com/fsck/k9/mail/transport/smtp/SmtpServerSettingsValidatorTest.kt\nindex 69bdc106085..337a291a263 100644\n--- a/mail/protocols/smtp/src/test/java/com/fsck/k9/mail/transport/smtp/SmtpServerSettingsValidatorTest.kt\n+++ b/mail/protocols/smtp/src/test/java/com/fsck/k9/mail/transport/smtp/SmtpServerSettingsValidatorTest.kt\n@@ -20,7 +20,6 @@ import java.net.UnknownHostException\n import kotlin.test.Test\n import net.thunderbird.core.logging.legacy.Log\n import net.thunderbird.core.logging.testing.TestLogger\n-import okio.ByteString.Companion.encodeUtf8\n import org.junit.Before\n \n private const val USERNAME = \"user\"\n@@ -116,53 +115,6 @@ class SmtpServerSettingsValidatorTest {\n         server.verifyInteractionCompleted()\n     }\n \n-    @Test\n-    fun `valid server settings with primary email different from username on OAuth should return Success`() {\n-        val expectedUser = \"expected@email.com\"\n-        val serverSettingsValidator = SmtpServerSettingsValidator(\n-            trustedSocketFactory = trustedSocketFactory,\n-            oAuth2TokenProviderFactory = { authStateStorage ->\n-                assertThat(authStateStorage.getAuthorizationState()).isEqualTo(AUTHORIZATION_STATE)\n-                FakeOAuth2TokenProvider(primaryEmail = expectedUser)\n-            },\n-        )\n-        val server = MockSmtpServer().apply {\n-            output(\"220 localhost Simple Mail Transfer Service Ready\")\n-            expect(\"EHLO [127.0.0.1]\")\n-            output(\"250-localhost Hello client.localhost\")\n-            output(\"250-ENHANCEDSTATUSCODES\")\n-            output(\"250-AUTH PLAIN LOGIN XOAUTH2\")\n-            output(\"250 HELP\")\n-            val ouathBearer = \"user=${expectedUser}\\u0001auth=Bearer ${AUTHORIZATION_TOKEN}\\u0001\\u0001\"\n-                .encodeUtf8()\n-                .base64()\n-            expect(\"AUTH XOAUTH2 $ouathBearer\")\n-            output(\"235 2.7.0 Authentication successful\")\n-            expect(\"QUIT\")\n-            closeConnection()\n-        }\n-        server.start()\n-        val serverSettings = ServerSettings(\n-            type = \"smtp\",\n-            host = server.host,\n-            port = server.port,\n-            connectionSecurity = ConnectionSecurity.NONE,\n-            authenticationType = AuthType.XOAUTH2,\n-            username = USERNAME,\n-            password = null,\n-            clientCertificateAlias = CLIENT_CERTIFICATE_ALIAS,\n-        )\n-        val authStateStorage = FakeAuthStateStorage(\n-            authorizationState = AUTHORIZATION_STATE,\n-        )\n-\n-        val result = serverSettingsValidator.checkServerSettings(serverSettings, authStateStorage)\n-\n-        assertThat(result).isInstanceOf<ServerSettingsValidationResult.Success>()\n-        server.verifyConnectionClosed()\n-        server.verifyInteractionCompleted()\n-    }\n-\n     @Test\n     fun `authentication error should return AuthenticationError`() {\n         val server = MockSmtpServer().apply {\n@@ -390,7 +342,7 @@ class SmtpServerSettingsValidatorTest {\n     }\n }\n \n-class FakeOAuth2TokenProvider(override val primaryEmail: String? = null) : OAuth2TokenProvider {\n+class FakeOAuth2TokenProvider : OAuth2TokenProvider {\n     override fun getToken(timeoutMillis: Long): String {\n         return AUTHORIZATION_TOKEN\n     }\n", "changes": [{"file": "legacy/common/src/main/java/com/fsck/k9/backends/RealOAuth2TokenProvider.kt", "module": "com.fsck.k9.backends.RealOAuth2TokenProvider", "range": [{"start": 20, "end": 20}, {"start": 23, "end": 32}, {"start": 40, "end": 40}]}, {"file": "mail/common/src/main/java/com/fsck/k9/mail/oauth/OAuth2TokenProvider.java", "module": "com.fsck.k9.mail.oauth.OAuth2TokenProvider", "range": [{"start": 0, "end": 0}]}, {"file": "mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.kt", "module": "com.fsck.k9.mail.store.imap.RealImapConnection", "range": [{"start": 406, "end": 407}]}, {"file": "mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpTransport.kt", "module": "com.fsck.k9.mail.transport.smtp.SmtpTransport", "range": [{"start": 554, "end": 556}, {"start": 558, "end": 561}, {"start": 563, "end": 564}, {"start": 569, "end": 570}, {"start": 574, "end": 575}, {"start": 615, "end": 616}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/8138", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 8138, "url": "https://github.com/thunderbird/thunderbird-android/issues/8138", "state": "closed", "title": "Import settings not working in Thunderbird Daily APK", "body": "### Checklist\n\n- [X] I have used the search function to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n\n### App version\n\n0.1a1\n\n### Where did you get the app from?\n\nOther\n\n### Android version\n\n14 - One UI 6.1\n\n### Device model\n\nSamsung S22\n\n### Steps to reproduce\n\n1. Have K-9 installed and configured on your device\r\n2. Install Thunderbird Daily APK\r\n3. Launch TB without any existing profile\r\n4. Select import settings (you can also do it from the Settings page if you can't start with a fresh profile)\r\n5. Select \"Import from app\"\r\n6. Select K-9 Mail from the list of available apps\n\n### Expected behavior\n\nSettings should be imported\n\n### Actual behavior\n\nAn error appears at the bottom left stating `Failed to read settings file`.\n\n### Logs\n\n[k9mail-logs.txt](https://github.com/user-attachments/files/16982758/k9mail-logs.txt)\r\n", "logs": [{"name": "k9mail-logs.txt", "url": "https://github.com/user-attachments/files/16982758/k9mail-logs.txt"}]}, "pull_request": [{"number": 8272, "url": "https://github.com/thunderbird/thunderbird-android/pull/8272", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/8272.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/8272.patch", "title": "Improve \"Import from app\" user experience", "content": "Disable list items for apps that are too old and don't support exporting settings to another app.\r\n\r\n![image](https://github.com/user-attachments/assets/1df8dd55-7447-4a05-9951-c58164e9cf5e)\r\n\r\nFixes #8138\r\n", "diff": "diff --git a/feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/ImportAppFetcher.kt b/feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/ImportAppFetcher.kt\nindex 7ccbb934900..5c992bfb1a9 100644\n--- a/feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/ImportAppFetcher.kt\n+++ b/feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/ImportAppFetcher.kt\n@@ -14,7 +14,7 @@ internal class ImportAppFetcher(\n      */\n     @WorkerThread\n     fun isAtLeastOneAppInstalled(): Boolean {\n-        return supportedApps.any { packageName -> packageManager.isAppInstalled(packageName) }\n+        return supportedApps.any { app -> packageManager.isAppInstalled(app.packageName) }\n     }\n \n     @Suppress(\"SwallowedException\")\n@@ -33,17 +33,20 @@ internal class ImportAppFetcher(\n     @WorkerThread\n     fun getAppInfoList(): List<AppInfo> {\n         return supportedApps\n-            .mapNotNull { packageName -> packageManager.loadAppInfo(packageName) }\n+            .mapNotNull { app -> packageManager.loadAppInfo(app) }\n             .toList()\n     }\n \n     @Suppress(\"SwallowedException\")\n-    private fun PackageManager.loadAppInfo(packageName: String): AppInfo? {\n+    private fun PackageManager.loadAppInfo(app: AppVersion): AppInfo? {\n         return try {\n-            val applicationInfo = getApplicationInfo(packageName, 0)\n+            val packageInfo = getPackageInfo(app.packageName, 0)\n+            val isImportSupported = packageInfo.versionCode >= app.minVersionCode\n+\n+            val applicationInfo = getApplicationInfo(app.packageName, 0)\n             val appName = packageManager.getApplicationLabel(applicationInfo).toString()\n \n-            AppInfo(packageName, appName)\n+            AppInfo(app.packageName, appName, isImportSupported)\n         } catch (e: PackageManager.NameNotFoundException) {\n             null\n         }\n@@ -52,29 +55,32 @@ internal class ImportAppFetcher(\n     /**\n      * Get the list of application IDs of supported apps excluding our own app.\n      */\n-    private val supportedApps: Sequence<String>\n+    private val supportedApps: Sequence<AppVersion>\n         get() {\n             val myPackageName = context.packageName\n             return SUPPORTED_APPS\n                 .asSequence()\n-                .filterNot { packageName -> packageName == myPackageName }\n+                .filterNot { app -> app.packageName == myPackageName }\n         }\n \n     companion object {\n         private val SUPPORTED_APPS = listOf(\n             // K-9 Mail\n-            \"com.fsck.k9\",\n+            AppVersion(\"com.fsck.k9\", 39005),\n             // Thunderbird for Android (release)\n-            \"net.thunderbird.android\",\n+            AppVersion(\"net.thunderbird.android\", 1),\n             // Thunderbird for Android (beta)\n-            \"net.thunderbird.android.beta\",\n+            AppVersion(\"net.thunderbird.android.beta\", 4),\n             // Thunderbird for Android (daily)\n-            \"net.thunderbird.android.daily\",\n+            AppVersion(\"net.thunderbird.android.daily\", 1),\n         )\n     }\n }\n \n-internal data class AppInfo(val packageName: String, private val appName: String) {\n-    // ArrayAdapter is using `toString()` when rendering list items. See PickAppDialogFragment.\n-    override fun toString() = appName\n-}\n+private data class AppVersion(val packageName: String, val minVersionCode: Int)\n+\n+internal data class AppInfo(\n+    val packageName: String,\n+    val appName: String,\n+    val isImportSupported: Boolean,\n+)\ndiff --git a/feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/PickAppAdapter.kt b/feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/PickAppAdapter.kt\nnew file mode 100644\nindex 00000000000..d763dd6283a\n--- /dev/null\n+++ b/feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/PickAppAdapter.kt\n@@ -0,0 +1,41 @@\n+package app.k9mail.feature.settings.import.ui\n+\n+import android.content.Context\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import android.widget.ArrayAdapter\n+import android.widget.TextView\n+import androidx.core.view.isVisible\n+import app.k9mail.feature.settings.importing.R\n+\n+internal class PickAppAdapter(context: Context) : ArrayAdapter<AppInfo>(context, 0) {\n+    private val inflater = LayoutInflater.from(context)\n+\n+    private fun getItemOrThrow(position: Int): AppInfo {\n+        return getItem(position) ?: error(\"Item at position $position not found\")\n+    }\n+\n+    override fun getView(position: Int, convertView: View?, parent: ViewGroup): View {\n+        val view = convertView ?: inflater.inflate(R.layout.settings_import_pick_app_list_item, parent, false)\n+\n+        val appNameTextView = view.findViewById<TextView>(R.id.settings_import_app_name)\n+        val appNoteTextView = view.findViewById<View>(R.id.settings_import_app_note)\n+\n+        val item = getItemOrThrow(position)\n+        appNameTextView.text = item.appName\n+        appNoteTextView.isVisible = !item.isImportSupported\n+\n+        view.isEnabled = item.isImportSupported\n+\n+        return view\n+    }\n+\n+    override fun areAllItemsEnabled(): Boolean {\n+        return false\n+    }\n+\n+    override fun isEnabled(position: Int): Boolean {\n+        return getItemOrThrow(position).isImportSupported\n+    }\n+}\ndiff --git a/feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/PickAppDialogFragment.kt b/feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/PickAppDialogFragment.kt\nindex 7fdfd0ad3bf..75eddf2c25d 100644\n--- a/feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/PickAppDialogFragment.kt\n+++ b/feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/PickAppDialogFragment.kt\n@@ -4,7 +4,6 @@ import android.app.Dialog\n import android.content.DialogInterface\n import android.content.DialogInterface.OnClickListener\n import android.os.Bundle\n-import android.widget.ArrayAdapter\n import androidx.core.os.bundleOf\n import androidx.fragment.app.DialogFragment\n import androidx.fragment.app.setFragmentResult\n@@ -29,11 +28,7 @@ internal class PickAppDialogFragment : DialogFragment() {\n     private var selectedPackageName: String? = null\n \n     override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {\n-        val adapter = ArrayAdapter<AppInfo>(\n-            requireContext(),\n-            R.layout.settings_import_pick_app_list_item,\n-            R.id.settings_import_app_name,\n-        )\n+        val adapter = PickAppAdapter(requireContext())\n \n         viewModel.appInfoFlow.observe(this) { appInfoList ->\n             adapter.clear()\ndiff --git a/feature/settings/import/src/main/res/layout/settings_import_pick_app_list_item.xml b/feature/settings/import/src/main/res/layout/settings_import_pick_app_list_item.xml\nindex 0f49365e656..f8f391e8f05 100644\n--- a/feature/settings/import/src/main/res/layout/settings_import_pick_app_list_item.xml\n+++ b/feature/settings/import/src/main/res/layout/settings_import_pick_app_list_item.xml\n@@ -6,6 +6,7 @@\n     android:layout_height=\"wrap_content\"\n     android:gravity=\"center_vertical\"\n     android:minHeight=\"56dp\"\n+    android:orientation=\"vertical\"\n     android:paddingHorizontal=\"24dp\"\n     android:paddingVertical=\"8dp\"\n     >\n@@ -14,8 +15,20 @@\n         android:id=\"@+id/settings_import_app_name\"\n         android:layout_width=\"wrap_content\"\n         android:layout_height=\"wrap_content\"\n+        android:duplicateParentState=\"true\"\n         android:textAppearance=\"?attr/textAppearanceBodyLarge\"\n         tools:text=\"K-9 Mail\"\n         />\n \n+    <com.google.android.material.textview.MaterialTextView\n+        android:id=\"@+id/settings_import_app_note\"\n+        android:layout_width=\"wrap_content\"\n+        android:layout_height=\"wrap_content\"\n+        android:duplicateParentState=\"true\"\n+        android:text=\"@string/settings_import_app_version_not_supported\"\n+        android:textAppearance=\"?attr/textAppearanceBodyMedium\"\n+        android:visibility=\"gone\"\n+        tools:visibility=\"visible\"\n+        />\n+\n </LinearLayout>\ndiff --git a/feature/settings/import/src/main/res/values/strings.xml b/feature/settings/import/src/main/res/values/strings.xml\nindex d347b96ad00..85c2c6372e4 100644\n--- a/feature/settings/import/src/main/res/values/strings.xml\n+++ b/feature/settings/import/src/main/res/values/strings.xml\n@@ -40,4 +40,6 @@\n     <string name=\"settings_import_oauth_error_oauth_not_supported\">OAuth 2.0 is currently not supported with this provider.</string>\n     <string name=\"settings_import_oauth_error_browser_not_found\">The app couldn\\'t find a browser to use for granting access to your account.</string>\n     <string name=\"settings_import_general_settings_item\">General settings</string>\n+    <!-- Displayed below the app name in the list of apps from which settings can be imported when the app is too old and doesn't support exporting settings to another app. -->\n+    <string name=\"settings_import_app_version_not_supported\">App version not supported.</string>\n </resources>\ndiff --git a/feature/settings/import/src/test/kotlin/app/k9mail/feature/settings/import/ui/ImportAppFetcherTest.kt b/feature/settings/import/src/test/kotlin/app/k9mail/feature/settings/import/ui/ImportAppFetcherTest.kt\nindex a0292252fc7..27264033f2a 100644\n--- a/feature/settings/import/src/test/kotlin/app/k9mail/feature/settings/import/ui/ImportAppFetcherTest.kt\n+++ b/feature/settings/import/src/test/kotlin/app/k9mail/feature/settings/import/ui/ImportAppFetcherTest.kt\n@@ -50,28 +50,39 @@ class ImportAppFetcherTest {\n     }\n \n     @Test\n-    fun `getAppInfoList() with another app installed`() {\n-        installPackage(\"com.fsck.k9\", \"K-9 Mail\")\n+    fun `getAppInfoList() with another supported app installed`() {\n+        installPackage(\"com.fsck.k9\", \"K-9 Mail\", versionCode = 40000)\n \n         val result = importAppFetcher.getAppInfoList()\n \n         assertThat(result).containsExactly(\n-            AppInfo(\"com.fsck.k9\", \"K-9 Mail\"),\n+            AppInfo(\"com.fsck.k9\", \"K-9 Mail\", isImportSupported = true),\n         )\n     }\n \n     @Test\n-    fun `getAppInfoList() with multiple other apps installed`() {\n-        installPackage(\"com.fsck.k9\", \"K-9 Mail\")\n-        installPackage(\"net.thunderbird.android.beta\", \"Thunderbird Beta\")\n-        installPackage(\"net.thunderbird.android.daily\", \"Thunderbird Daily\")\n+    fun `getAppInfoList() with another unsupported app installed`() {\n+        installPackage(\"com.fsck.k9\", \"K-9 Mail\", versionCode = 39004)\n+\n+        val result = importAppFetcher.getAppInfoList()\n+\n+        assertThat(result).containsExactly(\n+            AppInfo(\"com.fsck.k9\", \"K-9 Mail\", isImportSupported = false),\n+        )\n+    }\n+\n+    @Test\n+    fun `getAppInfoList() with multiple other supported apps installed`() {\n+        installPackage(\"com.fsck.k9\", \"K-9 Mail\", versionCode = 39005)\n+        installPackage(\"net.thunderbird.android.beta\", \"Thunderbird Beta\", versionCode = 4)\n+        installPackage(\"net.thunderbird.android.daily\", \"Thunderbird Daily\", versionCode = 1)\n \n         val result = importAppFetcher.getAppInfoList()\n \n         assertThat(result).containsExactlyInAnyOrder(\n-            AppInfo(\"com.fsck.k9\", \"K-9 Mail\"),\n-            AppInfo(\"net.thunderbird.android.beta\", \"Thunderbird Beta\"),\n-            AppInfo(\"net.thunderbird.android.daily\", \"Thunderbird Daily\"),\n+            AppInfo(\"com.fsck.k9\", \"K-9 Mail\", isImportSupported = true),\n+            AppInfo(\"net.thunderbird.android.beta\", \"Thunderbird Beta\", isImportSupported = true),\n+            AppInfo(\"net.thunderbird.android.daily\", \"Thunderbird Daily\", isImportSupported = true),\n         )\n     }\n \n@@ -82,7 +93,7 @@ class ImportAppFetcherTest {\n         return appContext.createPackageContext(MY_PACKAGE_NAME, 0)\n     }\n \n-    private fun installPackage(packageName: String, name: String = \"irrelevant\") {\n+    private fun installPackage(packageName: String, name: String = \"irrelevant\", versionCode: Int = 1) {\n         val packageManager = shadowOf(appContext.packageManager)\n \n         packageManager.installPackage(\n@@ -91,6 +102,7 @@ class ImportAppFetcherTest {\n                 this.applicationInfo = ApplicationInfo().apply {\n                     this.name = name\n                 }\n+                this.versionCode = versionCode\n             },\n         )\n     }\n", "changes": [{"file": "feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/ImportAppFetcher.kt", "module": "app.k9mail.feature.settings.import.ui.ImportAppFetcher", "range": [{"start": 17, "end": 18}, {"start": 36, "end": 37}, {"start": 41, "end": 42}, {"start": 43, "end": 44}, {"start": 46, "end": 47}, {"start": 55, "end": 56}, {"start": 60, "end": 61}, {"start": 66, "end": 67}, {"start": 68, "end": 69}, {"start": 70, "end": 71}, {"start": 72, "end": 73}, {"start": 77, "end": 81}]}, {"file": "feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/PickAppAdapter.kt", "module": "app.k9mail.feature.settings.import.ui.PickAppAdapter", "range": [{"start": 0, "end": 0}]}, {"file": "feature/settings/import/src/main/kotlin/app/k9mail/feature/settings/import/ui/PickAppDialogFragment.kt", "module": "app.k9mail.feature.settings.import.ui.PickAppDialogFragment", "range": [{"start": 7, "end": 7}, {"start": 32, "end": 37}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/7739", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 7739, "url": "https://github.com/thunderbird/thunderbird-android/issues/7739", "state": "closed", "title": "App crashes when adding new Email", "body": "### Checklist\n\n- [X] I have used the search function to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n\n### App version\n\n6.801\n\n### Where did you get the app from?\n\nGoogle Play\n\n### Android version\n\n14\n\n### Device model\n\nGoogle Pixel 6 Pro\n\n### Steps to reproduce\n\nTry to add `fakemail@technikum-wien.at`\n\n### Expected behavior\n\nThe account creation proceeds as normal.\n\n### Actual behavior\n\nThe app crashes.\n\n### Logs\n\n[k9mail-logs.txt](https://github.com/thunderbird/thunderbird-android/files/14791669/k9mail-logs.txt)\r\n", "logs": [{"name": "k9mail-logs.txt", "url": "https://github.com/thunderbird/thunderbird-android/files/14791669/k9mail-logs.txt"}]}, "pull_request": [{"number": 7741, "url": "https://github.com/thunderbird/thunderbird-android/pull/7741", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/7741.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/7741.patch", "title": "Bump MiniDNS 1.0.4 -> 1.0.5", "content": "Make this fix in MiniDNS available in K-9 Mail: https://github.com/MiniDNS/minidns/pull/137\r\n\r\nFixes #7739", "diff": "diff --git a/app-k9mail/dependencies/releaseRuntimeClasspath.txt b/app-k9mail/dependencies/releaseRuntimeClasspath.txt\nindex 102fb6b6c9c..2dd628d8150 100644\n--- a/app-k9mail/dependencies/releaseRuntimeClasspath.txt\n+++ b/app-k9mail/dependencies/releaseRuntimeClasspath.txt\n@@ -183,9 +183,9 @@ org.jetbrains.kotlinx:kotlinx-datetime-jvm:0.5.0\n org.jetbrains.kotlinx:kotlinx-datetime:0.5.0\n org.jetbrains:annotations:24.0.1\n org.jsoup:jsoup:1.15.4\n-org.minidns:minidns-client:1.0.4\n-org.minidns:minidns-core:1.0.4\n-org.minidns:minidns-dnssec:1.0.4\n-org.minidns:minidns-hla:1.0.4\n-org.minidns:minidns-iterative-resolver:1.0.4\n+org.minidns:minidns-client:1.0.5\n+org.minidns:minidns-core:1.0.5\n+org.minidns:minidns-dnssec:1.0.5\n+org.minidns:minidns-hla:1.0.5\n+org.minidns:minidns-iterative-resolver:1.0.5\n org.slf4j:slf4j-api:1.7.36\ndiff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml\nindex 2ecc23b55d7..9298bdaf8c6 100644\n--- a/gradle/libs.versions.toml\n+++ b/gradle/libs.versions.toml\n@@ -81,7 +81,7 @@ kxml2 = \"1.0\"\n leakcanary = \"2.13\"\n materialDrawer = \"8.4.5\"\n mime4j = \"0.8.9\"\n-minidns = \"1.0.4\"\n+minidns = \"1.0.5\"\n mockito = \"5.8.0\"\n mockitoKotlin = \"5.2.1\"\n moshi = \"1.15.1\"\n", "changes": [{"file": "app-k9mail/dependencies/releaseRuntimeClasspath.txt", "module": "app.k9mail.dependencies.releaseRuntimeClasspath", "range": [{"start": 186, "end": 191}]}, {"file": "gradle/libs.versions.toml", "module": "gradle.libs.versions", "range": [{"start": 84, "end": 85}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/7705", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 7705, "url": "https://github.com/thunderbird/thunderbird-android/issues/7705", "state": "closed", "title": "Crash when unmasking a password field (v. 6.800 from GitHub)", "body": "### Checklist\n\n- [X] I have used the search function to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n\n### App version\n\nGitHub\n\n### Where did you get the app from?\n\nOther\n\n### Android version\n\n7.0 MIUI 11\n\n### Device model\n\nXiaomi Redmi Note 4\n\n### Steps to reproduce\n\nSettings --> Account settings --> Fetching mail --> Incoming server --> Password unhide\n\n### Expected behavior\n\nNo crashes like before\n\n### Actual behavior\n\nCrash when unmasking a password field.\n\n### Logs\n\n[k9mail-logs.txt](https://github.com/thunderbird/thunderbird-android/files/14535855/k9mail-logs.txt)\r\n", "logs": [{"name": "k9mail-logs.txt", "url": "https://github.com/thunderbird/thunderbird-android/files/14535855/k9mail-logs.txt"}]}, "pull_request": [{"number": 8071, "url": "https://github.com/thunderbird/thunderbird-android/pull/8071", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/8071.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/8071.patch", "title": "Fix a crash that occurs when the password input field visibility state changes and an accessibility service is enabled running Android 7 (API level 25) and below", "content": "This pull request addresses a critical issue: our app crashes when the password visibility state changes while an accessibility service is enabled, particularly on devices running Android 7 (API level 25) and below. The crash stems from an interaction between accessibility services and Jetpack Compose and how these components handle accessibility events.\r\n\r\nThis issue is documented in ticket #7705, and it has also been recognized as a broader issue on Google's end, as detailed in this [Google Issue Tracker](https://issuetracker.google.com/issues/348232635).\r\n\r\nFixes  #7705", "diff": "diff --git a/core/ui/compose/designsystem/src/main/kotlin/app/k9mail/core/ui/compose/designsystem/atom/textfield/TextFieldOutlinedPassword.kt b/core/ui/compose/designsystem/src/main/kotlin/app/k9mail/core/ui/compose/designsystem/atom/textfield/TextFieldOutlinedPassword.kt\nindex ef91352dc2a..87def19745a 100644\n--- a/core/ui/compose/designsystem/src/main/kotlin/app/k9mail/core/ui/compose/designsystem/atom/textfield/TextFieldOutlinedPassword.kt\n+++ b/core/ui/compose/designsystem/src/main/kotlin/app/k9mail/core/ui/compose/designsystem/atom/textfield/TextFieldOutlinedPassword.kt\n@@ -1,5 +1,6 @@\n package app.k9mail.core.ui.compose.designsystem.atom.textfield\n \n+import android.os.Build\n import androidx.compose.foundation.text.KeyboardOptions\n import androidx.compose.runtime.Composable\n import androidx.compose.runtime.getValue\n@@ -8,6 +9,8 @@ import androidx.compose.runtime.saveable.rememberSaveable\n import androidx.compose.runtime.setValue\n import androidx.compose.ui.Modifier\n import androidx.compose.ui.res.stringResource\n+import androidx.compose.ui.semantics.password\n+import androidx.compose.ui.semantics.semantics\n import androidx.compose.ui.text.input.KeyboardType\n import androidx.compose.ui.text.input.PasswordVisualTransformation\n import androidx.compose.ui.text.input.VisualTransformation\n@@ -34,7 +37,7 @@ fun TextFieldOutlinedPassword(\n     Material3OutlinedTextField(\n         value = value,\n         onValueChange = stripLineBreaks(onValueChange),\n-        modifier = modifier,\n+        modifier = modifier.applyLegacyPasswordSemantics(),\n         enabled = isEnabled,\n         label = selectLabel(label, isRequired),\n         trailingIcon = selectTrailingIcon(\n@@ -69,7 +72,7 @@ fun TextFieldOutlinedPassword(\n     Material3OutlinedTextField(\n         value = value,\n         onValueChange = stripLineBreaks(onValueChange),\n-        modifier = modifier,\n+        modifier = modifier.applyLegacyPasswordSemantics(),\n         enabled = isEnabled,\n         label = selectLabel(label, isRequired),\n         trailingIcon = selectTrailingIcon(\n@@ -129,3 +132,16 @@ private fun selectVisualTransformation(\n }\n \n private fun isShowPasswordAllowed(isEnabled: Boolean, isPasswordVisible: Boolean) = isEnabled && isPasswordVisible\n+\n+private fun Modifier.applyLegacyPasswordSemantics(): Modifier {\n+    /*\n+     * Workaround for a crash that can occur when the password visibility state changes\n+     * while an accessibility service is enabled on devices running Android API level 25 or below.\n+     * This approach mitigates the issue by applying password semantics only on affected versions.\n+     */\n+    return this.semantics {\n+        if (Build.VERSION.SDK_INT <= Build.VERSION_CODES.N_MR1) {\n+            password()\n+        }\n+    }\n+}\n", "changes": [{"file": "core/ui/compose/designsystem/src/main/kotlin/app/k9mail/core/ui/compose/designsystem/atom/textfield/TextFieldOutlinedPassword.kt", "module": "app.k9mail.core.ui.compose.designsystem.atom.textfield.TextFieldOutlinedPassword", "range": [{"start": 3, "end": 3}, {"start": 11, "end": 11}, {"start": 37, "end": 38}, {"start": 72, "end": 73}, {"start": 132, "end": 132}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/6980", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 6980, "url": "https://github.com/thunderbird/thunderbird-android/issues/6980", "state": "closed", "title": "IMAP folders are empty", "body": "### Checklist\r\n\r\n- [X] I have used the search function to see if someone else has already submitted the same bug report.\r\n- [X] I will describe the problem with as much detail as possible.\r\n\r\n### App version\r\n\r\n6.705\r\n\r\n### Where did you get the app from?\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n13\r\n\r\n### Device model\r\n\r\nOnePlus 8 pro\r\n\r\n### Steps to reproduce\r\n\r\nGo to folder in IMAP account and open it. No mails are visible.\r\n\r\n### Expected behavior\r\n\r\nMails should be visible. The folder isn't empty. There are 230 unread Mails indicated.\r\n\r\n### Actual behavior\r\n\r\nSome folders are empty. But not all of them. Interesting thing: If you use the search function the mails found get visible. If you delete the searched word the folder is shown as empty again.\r\n\r\n### Logs\r\n\r\n[k9mail-logs.txt](https://github.com/thundernest/k-9/files/11738784/k9mail-logs.txt)\r\n", "logs": [{"name": "k9mail-logs.txt", "url": "https://github.com/thundernest/k-9/files/11738784/k9mail-logs.txt"}]}, "pull_request": [{"number": 6987, "url": "https://github.com/thunderbird/thunderbird-android/pull/6987", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/6987.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/6987.patch", "title": "Change `EmailAddressParser` to support addresses violating the specification", "content": "Steps to test:\r\n1. Run a debug build\r\n2. Add an account for `demo@k9mail.example` (contains a message with an email address where the local part exceeds the 64 character limit)\r\n3. Enable *Settings  General settings  Display  Show contact names*\r\n4. Loading the message list for the inbox fails without this change and should load fine with this change applied.\r\n\r\nFixes #6980", "diff": "diff --git a/app/core/src/main/java/com/fsck/k9/helper/ContactNameProvider.kt b/app/core/src/main/java/com/fsck/k9/helper/ContactNameProvider.kt\nindex 5ed06cdbfb2..1e354c987b6 100644\n--- a/app/core/src/main/java/com/fsck/k9/helper/ContactNameProvider.kt\n+++ b/app/core/src/main/java/com/fsck/k9/helper/ContactNameProvider.kt\n@@ -1,7 +1,7 @@\n package com.fsck.k9.helper\n \n import app.k9mail.core.android.common.contact.ContactRepository\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toEmailAddressOrNull\n \n interface ContactNameProvider {\n     fun getNameForAddress(address: String): String?\n@@ -11,6 +11,8 @@ class RealContactNameProvider(\n     private val contactRepository: ContactRepository,\n ) : ContactNameProvider {\n     override fun getNameForAddress(address: String): String? {\n-        return contactRepository.getContactFor(address.toEmailAddress())?.name\n+        return address.toEmailAddressOrNull()?.let { emailAddress ->\n+            contactRepository.getContactFor(emailAddress)?.name\n+        }\n     }\n }\ndiff --git a/app/core/src/main/java/com/fsck/k9/helper/MessageHelper.kt b/app/core/src/main/java/com/fsck/k9/helper/MessageHelper.kt\nindex 2fe1f554231..a36dc77909d 100644\n--- a/app/core/src/main/java/com/fsck/k9/helper/MessageHelper.kt\n+++ b/app/core/src/main/java/com/fsck/k9/helper/MessageHelper.kt\n@@ -6,7 +6,7 @@ import android.text.SpannableStringBuilder\n import android.text.TextUtils\n import android.text.style.ForegroundColorSpan\n import app.k9mail.core.android.common.contact.ContactRepository\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toEmailAddressOrNull\n import com.fsck.k9.CoreResourceProvider\n import com.fsck.k9.K9.contactNameColor\n import com.fsck.k9.K9.isChangeContactNameColor\n@@ -101,7 +101,7 @@ class MessageHelper(\n             if (!showCorrespondentNames) {\n                 return address.address\n             } else if (contactRepository != null) {\n-                val name = contactRepository.getContactFor(address.address.toEmailAddress())?.name\n+                val name = contactRepository.getContactName(address)\n                 if (name != null) {\n                     return if (changeContactNameColor) {\n                         val coloredName = SpannableString(name)\n@@ -124,6 +124,12 @@ class MessageHelper(\n             }\n         }\n \n+        private fun ContactRepository.getContactName(address: Address): String? {\n+            return address.address.toEmailAddressOrNull()?.let { emailAddress ->\n+                getContactFor(emailAddress)?.name\n+            }\n+        }\n+\n         private fun isSpoofAddress(displayName: String): Boolean {\n             return displayName.contains(\"@\") && SPOOF_ADDRESS_PATTERN.matcher(displayName).find()\n         }\ndiff --git a/app/core/src/test/java/com/fsck/k9/helper/MessageHelperTest.kt b/app/core/src/test/java/com/fsck/k9/helper/MessageHelperTest.kt\nindex 4aafc2e7249..b34ab5d7187 100644\n--- a/app/core/src/test/java/com/fsck/k9/helper/MessageHelperTest.kt\n+++ b/app/core/src/test/java/com/fsck/k9/helper/MessageHelperTest.kt\n@@ -5,7 +5,7 @@ import android.text.SpannableString\n import app.k9mail.core.android.common.contact.Contact\n import app.k9mail.core.android.common.contact.ContactRepository\n import app.k9mail.core.common.mail.EmailAddress\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toEmailAddressOrThrow\n import assertk.assertThat\n import assertk.assertions.isEqualTo\n import assertk.assertions.isInstanceOf\n@@ -143,6 +143,6 @@ class MessageHelperTest : RobolectricTest() {\n     }\n \n     private companion object {\n-        val EMAIL_ADDRESS = \"test@testor.com\".toEmailAddress()\n+        val EMAIL_ADDRESS = \"test@testor.com\".toEmailAddressOrThrow()\n     }\n }\ndiff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/K9NotificationStrategy.kt b/app/k9mail/src/main/java/com/fsck/k9/notification/K9NotificationStrategy.kt\nindex 77967e14efc..005a8e12508 100644\n--- a/app/k9mail/src/main/java/com/fsck/k9/notification/K9NotificationStrategy.kt\n+++ b/app/k9mail/src/main/java/com/fsck/k9/notification/K9NotificationStrategy.kt\n@@ -1,7 +1,7 @@\n package com.fsck.k9.notification\n \n import app.k9mail.core.android.common.contact.ContactRepository\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toEmailAddressOrNull\n import com.fsck.k9.Account\n import com.fsck.k9.K9\n import com.fsck.k9.mail.Flag\n@@ -88,7 +88,7 @@ class K9NotificationStrategy(\n         }\n \n         if (account.isNotifyContactsMailOnly &&\n-            !contactRepository.hasAnyContactFor(message.from.asList().mapNotNull { it.address.toEmailAddress() })\n+            !contactRepository.hasAnyContactFor(message.from.asList().mapNotNull { it.address.toEmailAddressOrNull() })\n         ) {\n             Timber.v(\"No notification: Message is not from a known contact\")\n             return false\ndiff --git a/app/ui/legacy/src/main/java/com/fsck/k9/contacts/ContactPhotoLoader.kt b/app/ui/legacy/src/main/java/com/fsck/k9/contacts/ContactPhotoLoader.kt\nindex ac7012219ef..363d4890c2f 100644\n--- a/app/ui/legacy/src/main/java/com/fsck/k9/contacts/ContactPhotoLoader.kt\n+++ b/app/ui/legacy/src/main/java/com/fsck/k9/contacts/ContactPhotoLoader.kt\n@@ -3,8 +3,9 @@ package com.fsck.k9.contacts\n import android.content.ContentResolver\n import android.graphics.Bitmap\n import android.graphics.BitmapFactory\n+import android.net.Uri\n import app.k9mail.core.android.common.contact.ContactRepository\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toEmailAddressOrNull\n import timber.log.Timber\n \n internal class ContactPhotoLoader(\n@@ -12,7 +13,7 @@ internal class ContactPhotoLoader(\n     private val contactRepository: ContactRepository,\n ) {\n     fun loadContactPhoto(emailAddress: String): Bitmap? {\n-        val photoUri = contactRepository.getContactFor(emailAddress.toEmailAddress())?.photoUri ?: return null\n+        val photoUri = getPhotoUri(emailAddress) ?: return null\n         return try {\n             contentResolver.openInputStream(photoUri).use { inputStream ->\n                 BitmapFactory.decodeStream(inputStream)\n@@ -22,4 +23,10 @@ internal class ContactPhotoLoader(\n             null\n         }\n     }\n+\n+    private fun getPhotoUri(email: String): Uri? {\n+        return email.toEmailAddressOrNull()?.let { emailAddress ->\n+            contactRepository.getContactFor(emailAddress)?.photoUri\n+        }\n+    }\n }\ndiff --git a/app/ui/legacy/src/main/java/com/fsck/k9/ui/messagedetails/MessageDetailsViewModel.kt b/app/ui/legacy/src/main/java/com/fsck/k9/ui/messagedetails/MessageDetailsViewModel.kt\nindex 060a2a5dd6c..63b46ed5328 100644\n--- a/app/ui/legacy/src/main/java/com/fsck/k9/ui/messagedetails/MessageDetailsViewModel.kt\n+++ b/app/ui/legacy/src/main/java/com/fsck/k9/ui/messagedetails/MessageDetailsViewModel.kt\n@@ -2,12 +2,13 @@ package com.fsck.k9.ui.messagedetails\n \n import android.app.PendingIntent\n import android.content.res.Resources\n+import android.net.Uri\n import androidx.lifecycle.ViewModel\n import androidx.lifecycle.viewModelScope\n import app.k9mail.core.android.common.contact.CachingRepository\n import app.k9mail.core.android.common.contact.ContactPermissionResolver\n import app.k9mail.core.android.common.contact.ContactRepository\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toEmailAddressOrNull\n import com.fsck.k9.Account\n import com.fsck.k9.controller.MessageReference\n import com.fsck.k9.helper.ClipboardManager\n@@ -30,6 +31,7 @@ import kotlinx.coroutines.flow.MutableStateFlow\n import kotlinx.coroutines.flow.receiveAsFlow\n import kotlinx.coroutines.launch\n \n+@Suppress(\"TooManyFunctions\")\n internal class MessageDetailsViewModel(\n     private val resources: Resources,\n     private val messageRepository: MessageRepository,\n@@ -130,11 +132,17 @@ internal class MessageDetailsViewModel(\n             Participant(\n                 displayName = displayName,\n                 emailAddress = emailAddress,\n-                contactLookupUri = contactRepository.getContactFor(emailAddress.toEmailAddress())?.uri,\n+                contactLookupUri = getContactLookupUri(emailAddress),\n             )\n         }\n     }\n \n+    private fun getContactLookupUri(email: String): Uri? {\n+        return email.toEmailAddressOrNull()?.let { emailAddress ->\n+            contactRepository.getContactFor(emailAddress)?.uri\n+        }\n+    }\n+\n     private fun Folder.toFolderInfo(): FolderInfoUi {\n         return FolderInfoUi(\n             displayName = folderNameFormatter.displayName(this),\ndiff --git a/app/ui/legacy/src/main/java/com/fsck/k9/ui/messageview/MessageTopView.kt b/app/ui/legacy/src/main/java/com/fsck/k9/ui/messageview/MessageTopView.kt\nindex 85d771323da..c55613365a2 100644\n--- a/app/ui/legacy/src/main/java/com/fsck/k9/ui/messageview/MessageTopView.kt\n+++ b/app/ui/legacy/src/main/java/com/fsck/k9/ui/messageview/MessageTopView.kt\n@@ -18,7 +18,8 @@ import android.widget.LinearLayout\n import android.widget.ProgressBar\n import android.widget.TextView\n import app.k9mail.core.android.common.contact.ContactRepository\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.EmailAddress\n+import app.k9mail.core.common.mail.toEmailAddressOrNull\n import com.fsck.k9.Account\n import com.fsck.k9.Account.ShowPictures\n import com.fsck.k9.mail.Message\n@@ -262,15 +263,15 @@ class MessageTopView(\n             return false\n         }\n         val senderEmailAddress = getSenderEmailAddress(message) ?: return false\n-        return contactRepository.hasContactFor(senderEmailAddress.toEmailAddress())\n+        return contactRepository.hasContactFor(senderEmailAddress)\n     }\n \n-    private fun getSenderEmailAddress(message: Message): String? {\n+    private fun getSenderEmailAddress(message: Message): EmailAddress? {\n         val from = message.from\n         return if (from == null || from.isEmpty()) {\n             null\n         } else {\n-            from[0].address\n+            from[0].address.toEmailAddressOrNull()\n         }\n     }\n \ndiff --git a/backend/demo/src/main/resources/contents.json b/backend/demo/src/main/resources/contents.json\nindex f0f75a8e00e..137551a3b90 100644\n--- a/backend/demo/src/main/resources/contents.json\n+++ b/backend/demo/src/main/resources/contents.json\n@@ -8,7 +8,8 @@\n       \"thread_1\",\n       \"thread_2\",\n       \"inline_image_data_uri\",\n-      \"inline_image_attachment\"\n+      \"inline_image_attachment\",\n+      \"localpart_exceeds_length_limit\"\n     ]\n   },\n   \"trash\": {\ndiff --git a/backend/demo/src/main/resources/inbox/localpart_exceeds_length_limit.eml b/backend/demo/src/main/resources/inbox/localpart_exceeds_length_limit.eml\nnew file mode 100644\nindex 00000000000..2aa0ecb1f06\n--- /dev/null\n+++ b/backend/demo/src/main/resources/inbox/localpart_exceeds_length_limit.eml\n@@ -0,0 +1,9 @@\n+MIME-Version: 1.0\n+From: Sender <aaaaaaaaaabbbbbbbbbbccccccccccddddddddddeeeeeeeeeeffffffffffggggg@k9mail.example> (local part exceeds maximum length)\n+Date: Thu, 15 Jun 2023 18:00:00 +0200\n+Message-ID: <localpart@k9mail.example>\n+Subject: Localpart of email address exceeds 64 characters\n+To: User <user@k9mail.example>\n+Content-Type: text/plain; charset=UTF-8\n+\n+You should still be able to read this message.\ndiff --git a/cli/autodiscovery-cli/src/main/kotlin/app/k9mail/cli/autodiscovery/AutoDiscoveryCli.kt b/cli/autodiscovery-cli/src/main/kotlin/app/k9mail/cli/autodiscovery/AutoDiscoveryCli.kt\nindex 5419037bc06..1cdf47d950d 100644\n--- a/cli/autodiscovery-cli/src/main/kotlin/app/k9mail/cli/autodiscovery/AutoDiscoveryCli.kt\n+++ b/cli/autodiscovery-cli/src/main/kotlin/app/k9mail/cli/autodiscovery/AutoDiscoveryCli.kt\n@@ -6,7 +6,7 @@ import app.k9mail.autodiscovery.autoconfig.AutoconfigUrlConfig\n import app.k9mail.autodiscovery.autoconfig.createIspDbAutoconfigDiscovery\n import app.k9mail.autodiscovery.autoconfig.createMxLookupAutoconfigDiscovery\n import app.k9mail.autodiscovery.autoconfig.createProviderAutoconfigDiscovery\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toUserEmailAddress\n import com.github.ajalt.clikt.core.CliktCommand\n import com.github.ajalt.clikt.parameters.arguments.argument\n import com.github.ajalt.clikt.parameters.options.flag\n@@ -57,7 +57,7 @@ class AutoDiscoveryCli : CliktCommand(\n             val mxDiscovery = createMxLookupAutoconfigDiscovery(okHttpClient)\n \n             val runnables = listOf(providerDiscovery, ispDbDiscovery, mxDiscovery)\n-                .flatMap { it.initDiscovery(emailAddress.toEmailAddress()) }\n+                .flatMap { it.initDiscovery(emailAddress.toUserEmailAddress()) }\n             val serialRunner = SerialRunner(runnables)\n \n             return runBlocking {\ndiff --git a/core/android/common/src/test/kotlin/app/k9mail/core/android/common/contact/ContactFixture.kt b/core/android/common/src/test/kotlin/app/k9mail/core/android/common/contact/ContactFixture.kt\nindex 89d71831db9..35567986af2 100644\n--- a/core/android/common/src/test/kotlin/app/k9mail/core/android/common/contact/ContactFixture.kt\n+++ b/core/android/common/src/test/kotlin/app/k9mail/core/android/common/contact/ContactFixture.kt\n@@ -1,12 +1,12 @@\n package app.k9mail.core.android.common.contact\n \n import android.net.Uri\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toEmailAddressOrThrow\n \n const val CONTACT_ID = 123L\n const val CONTACT_NAME = \"user name\"\n const val CONTACT_LOOKUP_KEY = \"0r1-4F314D4F2F294F29\"\n-val CONTACT_EMAIL_ADDRESS = \"user@example.com\".toEmailAddress()\n+val CONTACT_EMAIL_ADDRESS = \"user@example.com\".toEmailAddressOrThrow()\n val CONTACT_URI: Uri = Uri.parse(\"content://com.android.contacts/contacts/lookup/$CONTACT_LOOKUP_KEY/$CONTACT_ID\")\n val CONTACT_PHOTO_URI: Uri = Uri.parse(\"content://com.android.contacts/display_photo/$CONTACT_ID\")\n \ndiff --git a/core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddress.kt b/core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddress.kt\nindex c164c02bcc8..cdf0dfd603e 100644\n--- a/core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddress.kt\n+++ b/core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddress.kt\n@@ -1,5 +1,12 @@\n package app.k9mail.core.common.mail\n \n+// See RFC 5321, 4.5.3.1.3.\n+// The maximum length of 'Path' indirectly limits the length of 'Mailbox'.\n+internal const val MAXIMUM_EMAIL_ADDRESS_LENGTH = 254\n+\n+// See RFC 5321, 4.5.3.1.1.\n+internal const val MAXIMUM_LOCAL_PART_LENGTH = 64\n+\n /**\n  * Represents an email address.\n  *\n@@ -15,6 +22,14 @@ class EmailAddress internal constructor(\n \n     init {\n         warnings = buildSet {\n+            if (localPart.length > MAXIMUM_LOCAL_PART_LENGTH) {\n+                add(Warning.LocalPartExceedsLengthLimit)\n+            }\n+\n+            if (address.length > MAXIMUM_EMAIL_ADDRESS_LENGTH) {\n+                add(Warning.EmailAddressExceedsLengthLimit)\n+            }\n+\n             if (localPart.isEmpty()) {\n                 add(Warning.EmptyLocalPart)\n             }\n@@ -65,6 +80,17 @@ class EmailAddress internal constructor(\n     }\n \n     enum class Warning {\n+        /**\n+         * The local part exceeds the length limit (see RFC 5321, 4.5.3.1.1.).\n+         */\n+        LocalPartExceedsLengthLimit,\n+\n+        /**\n+         * The email address exceeds the length limit (see RFC 5321, 4.5.3.1.3.; The maximum length of 'Path'\n+         * indirectly limits the length of 'Mailbox').\n+         */\n+        EmailAddressExceedsLengthLimit,\n+\n         /**\n          * The local part requires using a quoted string.\n          *\n@@ -81,10 +107,32 @@ class EmailAddress internal constructor(\n     }\n \n     companion object {\n-        fun parse(address: String, config: EmailAddressParserConfig = EmailAddressParserConfig.DEFAULT): EmailAddress {\n+        fun parse(address: String, config: EmailAddressParserConfig = EmailAddressParserConfig.RELAXED): EmailAddress {\n             return EmailAddressParser(address, config).parse()\n         }\n     }\n }\n \n-fun String.toEmailAddress() = EmailAddress.parse(this)\n+/**\n+ * Converts this string to an [EmailAddress] instance using [EmailAddressParserConfig.RELAXED].\n+ */\n+fun String.toEmailAddressOrThrow() = EmailAddress.parse(this, EmailAddressParserConfig.RELAXED)\n+\n+/**\n+ * Converts this string to an [EmailAddress] instance using [EmailAddressParserConfig.RELAXED].\n+ */\n+@Suppress(\"SwallowedException\")\n+fun String.toEmailAddressOrNull(): EmailAddress? {\n+    return try {\n+        EmailAddress.parse(this, EmailAddressParserConfig.RELAXED)\n+    } catch (e: EmailAddressParserException) {\n+        null\n+    }\n+}\n+\n+/**\n+ * Convert this string into an [EmailAddress] instance using [EmailAddressParserConfig.LIMITED].\n+ *\n+ * Use this when validating the email address a user wants to add to an account/identity.\n+ */\n+fun String.toUserEmailAddress() = EmailAddress.parse(this, EmailAddressParserConfig.LIMITED)\ndiff --git a/core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddressParser.kt b/core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddressParser.kt\nindex 8c0ed4946c3..fd03a6e725a 100644\n--- a/core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddressParser.kt\n+++ b/core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddressParser.kt\n@@ -13,13 +13,6 @@ import app.k9mail.core.common.mail.EmailAddressParserError.LocalPartRequiresQuot\n import app.k9mail.core.common.mail.EmailAddressParserError.QuotedStringInLocalPart\n import app.k9mail.core.common.mail.EmailAddressParserError.TotalLengthExceeded\n \n-// See RFC 5321, 4.5.3.1.3.\n-// The maximum length of 'Path' indirectly limits the length of 'Mailbox'.\n-internal const val MAXIMUM_EMAIL_ADDRESS_LENGTH = 254\n-\n-// See RFC 5321, 4.5.3.1.1.\n-internal const val MAXIMUM_LOCAL_PART_LENGTH = 64\n-\n /**\n  * Parse an email address.\n  *\n@@ -52,15 +45,23 @@ internal class EmailAddressParser(\n             parserError(ExpectedEndOfInput)\n         }\n \n-        if (emailAddress.address.length > MAXIMUM_EMAIL_ADDRESS_LENGTH) {\n+        if (\n+            config.isEmailAddressLengthCheckEnabled && Warning.EmailAddressExceedsLengthLimit in emailAddress.warnings\n+        ) {\n             parserError(TotalLengthExceeded)\n         }\n \n-        if (!config.allowLocalPartRequiringQuotedString && Warning.QuotedStringInLocalPart in emailAddress.warnings) {\n+        if (config.isLocalPartLengthCheckEnabled && Warning.LocalPartExceedsLengthLimit in emailAddress.warnings) {\n+            parserError(LocalPartLengthExceeded, position = input.lastIndexOf('@'))\n+        }\n+\n+        if (\n+            !config.isLocalPartRequiringQuotedStringAllowed && Warning.QuotedStringInLocalPart in emailAddress.warnings\n+        ) {\n             parserError(LocalPartRequiresQuotedString, position = 0)\n         }\n \n-        if (!config.allowEmptyLocalPart && Warning.EmptyLocalPart in emailAddress.warnings) {\n+        if (!config.isEmptyLocalPartAllowed && Warning.EmptyLocalPart in emailAddress.warnings) {\n             parserError(EmptyLocalPart, position = 1)\n         }\n \n@@ -83,7 +84,7 @@ internal class EmailAddressParser(\n                 readDotString()\n             }\n             character == DQUOTE -> {\n-                if (config.allowQuotedLocalPart) {\n+                if (config.isQuotedLocalPartAllowed) {\n                     readQuotedString()\n                 } else {\n                     parserError(QuotedStringInLocalPart)\n@@ -94,10 +95,6 @@ internal class EmailAddressParser(\n             }\n         }\n \n-        if (localPart.length > MAXIMUM_LOCAL_PART_LENGTH) {\n-            parserError(LocalPartLengthExceeded)\n-        }\n-\n         return localPart\n     }\n \ndiff --git a/core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddressParserConfig.kt b/core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddressParserConfig.kt\nindex 2a19dfbbaf4..325b97975ce 100644\n--- a/core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddressParserConfig.kt\n+++ b/core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddressParserConfig.kt\n@@ -3,39 +3,63 @@ package app.k9mail.core.common.mail\n /**\n  * Configuration to control the behavior when parsing an email address into [EmailAddress].\n  *\n- * @param allowQuotedLocalPart When this is `true`, the parsing step allows email addresses with a local part encoded\n- * as quoted string, e.g. `\"foo bar\"@domain.example`. Otherwise, the parser will throw an [EmailAddressParserException]\n- * as soon as a quoted string is encountered.\n+ * @param isLocalPartLengthCheckEnabled When this is `true` the length of the local part is checked to make sure it\n+ * doesn't exceed the specified limit (see RFC 5321, 4.5.3.1.1.).\n+ *\n+ * @param isEmailAddressLengthCheckEnabled When this is `true` the length of the whole email address is checked to make\n+ * sure it doesn't exceed the specified limit (see RFC 5321, 4.5.3.1.3.; The maximum length of 'Path' indirectly limits\n+ * the length of 'Mailbox').\n+ *\n+ * @param isQuotedLocalPartAllowed When this is `true`, the parsing step allows email addresses with a local part\n+ * encoded as quoted string, e.g. `\"foo bar\"@domain.example`. Otherwise, the parser will throw an\n+ * [EmailAddressParserException] as soon as a quoted string is encountered.\n  * Quoted strings in local parts are not widely used. It's recommended to disallow them whenever possible.\n  *\n- * @param allowLocalPartRequiringQuotedString Email addresses whose local part requires the use of a quoted string are\n- * only allowed when this is `true`. This is separate from [allowQuotedLocalPart] because one might want to allow email\n- * addresses that unnecessarily use a quoted string, e.g. `\"test\"@domain.example` ([allowQuotedLocalPart] = `true`,\n- * [allowLocalPartRequiringQuotedString] = `false`; [EmailAddress] will not retain the original form and treat this\n- * address exactly like `test@domain.example`). When allowing this, remember to use the value of [EmailAddress.address]\n- * instead of retaining the original user input.\n+ * @param isLocalPartRequiringQuotedStringAllowed Email addresses whose local part requires the use of a quoted string\n+ * are only allowed when this is `true`. This is separate from [isQuotedLocalPartAllowed] because one might want to\n+ * allow email addresses that unnecessarily use a quoted string, e.g. `\"test\"@domain.example`\n+ * ([isQuotedLocalPartAllowed] = `true`, [isLocalPartRequiringQuotedStringAllowed] = `false`; [EmailAddress] will not\n+ * retain the original form and treat this address exactly like `test@domain.example`). When allowing this, remember to\n+ * use the value of [EmailAddress.address] instead of retaining the original user input.\n  *\n- * The value of this property is ignored if [allowQuotedLocalPart] is `false`.\n+ * The value of this property is ignored if [isQuotedLocalPartAllowed] is `false`.\n  *\n- * @param allowEmptyLocalPart Email addresses with an empty local part (e.g. `\"\"@domain.example`) are only allowed if\n- * this value is `true`.\n+ * @param isEmptyLocalPartAllowed Email addresses with an empty local part (e.g. `\"\"@domain.example`) are only allowed\n+ * if this value is `true`.\n  *\n- * The value of this property is ignored if at least one of [allowQuotedLocalPart] and\n- * [allowLocalPartRequiringQuotedString] is `false`.\n+ * The value of this property is ignored if at least one of [isQuotedLocalPartAllowed] and\n+ * [isLocalPartRequiringQuotedStringAllowed] is `false`.\n  */\n data class EmailAddressParserConfig(\n-    val allowQuotedLocalPart: Boolean,\n-    val allowLocalPartRequiringQuotedString: Boolean,\n-    val allowEmptyLocalPart: Boolean = false,\n+    val isLocalPartLengthCheckEnabled: Boolean,\n+    val isEmailAddressLengthCheckEnabled: Boolean,\n+    val isQuotedLocalPartAllowed: Boolean,\n+    val isLocalPartRequiringQuotedStringAllowed: Boolean,\n+    val isEmptyLocalPartAllowed: Boolean = false,\n ) {\n     companion object {\n         /**\n-         * This configuration should match what `EmailAddressValidator` currently allows.\n+         * This allows local parts requiring quoted strings and disables length checks for the local part and the\n+         * whole email address.\n+         */\n+        val RELAXED = EmailAddressParserConfig(\n+            isLocalPartLengthCheckEnabled = false,\n+            isEmailAddressLengthCheckEnabled = false,\n+            isQuotedLocalPartAllowed = true,\n+            isLocalPartRequiringQuotedStringAllowed = true,\n+            isEmptyLocalPartAllowed = false,\n+        )\n+\n+        /**\n+         * This only allows a subset of valid email addresses. Use this when validating the email address a user wants\n+         * to add to an account/identity.\n          */\n-        val DEFAULT = EmailAddressParserConfig(\n-            allowQuotedLocalPart = true,\n-            allowLocalPartRequiringQuotedString = true,\n-            allowEmptyLocalPart = false,\n+        val LIMITED = EmailAddressParserConfig(\n+            isLocalPartLengthCheckEnabled = true,\n+            isEmailAddressLengthCheckEnabled = true,\n+            isQuotedLocalPartAllowed = false,\n+            isLocalPartRequiringQuotedStringAllowed = false,\n+            isEmptyLocalPartAllowed = false,\n         )\n     }\n }\ndiff --git a/core/common/src/test/kotlin/app/k9mail/core/common/mail/EmailAddressParserTest.kt b/core/common/src/test/kotlin/app/k9mail/core/common/mail/EmailAddressParserTest.kt\nindex f506ad8238c..48431066a4d 100644\n--- a/core/common/src/test/kotlin/app/k9mail/core/common/mail/EmailAddressParserTest.kt\n+++ b/core/common/src/test/kotlin/app/k9mail/core/common/mail/EmailAddressParserTest.kt\n@@ -15,6 +15,7 @@ import app.k9mail.core.common.mail.EmailAddressParserError.UnexpectedCharacter\n import assertk.all\n import assertk.assertFailure\n import assertk.assertThat\n+import assertk.assertions.contains\n import assertk.assertions.hasMessage\n import assertk.assertions.isEqualTo\n import assertk.assertions.isInstanceOf\n@@ -40,7 +41,10 @@ class EmailAddressParserTest {\n \n     @Test\n     fun `quoted local part`() {\n-        val emailAddress = parseEmailAddress(\"\\\"one two\\\"@domain.example\", allowLocalPartRequiringQuotedString = true)\n+        val emailAddress = parseEmailAddress(\n+            address = \"\\\"one two\\\"@domain.example\",\n+            isLocalPartRequiringQuotedStringAllowed = true,\n+        )\n \n         assertThat(emailAddress.localPart).isEqualTo(\"one two\")\n         assertThat(emailAddress.domain).isEqualTo(EmailDomain(\"domain.example\"))\n@@ -51,8 +55,8 @@ class EmailAddressParserTest {\n         assertFailure {\n             parseEmailAddress(\n                 address = \"\\\"one two\\\"@domain.example\",\n-                allowQuotedLocalPart = true,\n-                allowLocalPartRequiringQuotedString = false,\n+                isQuotedLocalPartAllowed = true,\n+                isLocalPartRequiringQuotedStringAllowed = false,\n             )\n         }.isInstanceOf<EmailAddressParserException>().all {\n             prop(EmailAddressParserException::error).isEqualTo(LocalPartRequiresQuotedString)\n@@ -65,8 +69,8 @@ class EmailAddressParserTest {\n     fun `unnecessarily quoted local part`() {\n         val emailAddress = parseEmailAddress(\n             address = \"\\\"user\\\"@domain.example\",\n-            allowQuotedLocalPart = true,\n-            allowLocalPartRequiringQuotedString = false,\n+            isQuotedLocalPartAllowed = true,\n+            isLocalPartRequiringQuotedStringAllowed = false,\n         )\n \n         assertThat(emailAddress.localPart).isEqualTo(\"user\")\n@@ -77,7 +81,7 @@ class EmailAddressParserTest {\n     @Test\n     fun `unnecessarily quoted local part not allowed`() {\n         assertFailure {\n-            parseEmailAddress(\"\\\"user\\\"@domain.example\", allowQuotedLocalPart = false)\n+            parseEmailAddress(\"\\\"user\\\"@domain.example\", isQuotedLocalPartAllowed = false)\n         }.isInstanceOf<EmailAddressParserException>().all {\n             prop(EmailAddressParserException::error).isEqualTo(QuotedStringInLocalPart)\n             prop(EmailAddressParserException::position).isEqualTo(0)\n@@ -87,7 +91,10 @@ class EmailAddressParserTest {\n \n     @Test\n     fun `quoted local part containing double quote character`() {\n-        val emailAddress = parseEmailAddress(\"\"\"\"a\\\"b\"@domain.example\"\"\", allowLocalPartRequiringQuotedString = true)\n+        val emailAddress = parseEmailAddress(\n+            address = \"\"\"\"a\\\"b\"@domain.example\"\"\",\n+            isLocalPartRequiringQuotedStringAllowed = true,\n+        )\n \n         assertThat(emailAddress.localPart).isEqualTo(\"a\\\"b\")\n         assertThat(emailAddress.domain).isEqualTo(EmailDomain(\"domain.example\"))\n@@ -96,7 +103,7 @@ class EmailAddressParserTest {\n \n     @Test\n     fun `empty local part`() {\n-        val emailAddress = parseEmailAddress(\"\\\"\\\"@domain.example\", allowEmptyLocalPart = true)\n+        val emailAddress = parseEmailAddress(\"\\\"\\\"@domain.example\", isEmptyLocalPartAllowed = true)\n \n         assertThat(emailAddress.localPart).isEqualTo(\"\")\n         assertThat(emailAddress.domain).isEqualTo(EmailDomain(\"domain.example\"))\n@@ -108,8 +115,8 @@ class EmailAddressParserTest {\n         assertFailure {\n             parseEmailAddress(\n                 address = \"\\\"\\\"@domain.example\",\n-                allowLocalPartRequiringQuotedString = true,\n-                allowEmptyLocalPart = false,\n+                isLocalPartRequiringQuotedStringAllowed = true,\n+                isEmptyLocalPartAllowed = false,\n             )\n         }.isInstanceOf<EmailAddressParserException>().all {\n             prop(EmailAddressParserException::error).isEqualTo(EmptyLocalPart)\n@@ -154,7 +161,7 @@ class EmailAddressParserTest {\n     @Test\n     fun `obsolete syntax`() {\n         assertFailure {\n-            parseEmailAddress(\"\\\"quoted\\\".atom@domain.example\", allowLocalPartRequiringQuotedString = true)\n+            parseEmailAddress(\"\\\"quoted\\\".atom@domain.example\", isLocalPartRequiringQuotedStringAllowed = true)\n         }.isInstanceOf<EmailAddressParserException>().all {\n             prop(EmailAddressParserException::error).isEqualTo(UnexpectedCharacter)\n             prop(EmailAddressParserException::position).isEqualTo(8)\n@@ -187,7 +194,7 @@ class EmailAddressParserTest {\n     @Test\n     fun `quoted local part missing closing double quote`() {\n         assertFailure {\n-            parseEmailAddress(\"\\\"invalid@domain.example\", allowLocalPartRequiringQuotedString = true)\n+            parseEmailAddress(\"\\\"invalid@domain.example\", isLocalPartRequiringQuotedStringAllowed = true)\n         }.isInstanceOf<EmailAddressParserException>().all {\n             prop(EmailAddressParserException::error).isEqualTo(UnexpectedCharacter)\n             prop(EmailAddressParserException::position).isEqualTo(23)\n@@ -198,7 +205,7 @@ class EmailAddressParserTest {\n     @Test\n     fun `quoted text containing unsupported character`() {\n         assertFailure {\n-            parseEmailAddress(\"\\\"\\\"@domain.example\", allowLocalPartRequiringQuotedString = true)\n+            parseEmailAddress(\"\\\"\\\"@domain.example\", isLocalPartRequiringQuotedStringAllowed = true)\n         }.isInstanceOf<EmailAddressParserException>().all {\n             prop(EmailAddressParserException::error).isEqualTo(InvalidQuotedString)\n             prop(EmailAddressParserException::position).isEqualTo(1)\n@@ -209,7 +216,7 @@ class EmailAddressParserTest {\n     @Test\n     fun `quoted text containing unsupported escaped character`() {\n         assertFailure {\n-            parseEmailAddress(\"\"\"\"\\\"@domain.example\"\"\", allowLocalPartRequiringQuotedString = true)\n+            parseEmailAddress(\"\"\"\"\\\"@domain.example\"\"\", isLocalPartRequiringQuotedStringAllowed = true)\n         }.isInstanceOf<EmailAddressParserException>().all {\n             prop(EmailAddressParserException::error).isEqualTo(InvalidQuotedString)\n             prop(EmailAddressParserException::position).isEqualTo(3)\n@@ -218,9 +225,12 @@ class EmailAddressParserTest {\n     }\n \n     @Test\n-    fun `local part exceeds maximum size`() {\n+    fun `local part exceeds maximum size with length check enabled`() {\n         assertFailure {\n-            parseEmailAddress(\"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx12345@domain.example\")\n+            parseEmailAddress(\n+                address = \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx12345@domain.example\",\n+                isLocalPartLengthCheckEnabled = true,\n+            )\n         }.isInstanceOf<EmailAddressParserException>().all {\n             prop(EmailAddressParserException::error).isEqualTo(LocalPartLengthExceeded)\n             prop(EmailAddressParserException::position).isEqualTo(65)\n@@ -229,13 +239,27 @@ class EmailAddressParserTest {\n     }\n \n     @Test\n-    fun `email exceeds maximum size`() {\n+    fun `local part exceeds maximum size with length check disabled`() {\n+        val input = \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx12345@domain.example\"\n+\n+        val emailAddress = parseEmailAddress(address = input, isLocalPartLengthCheckEnabled = false)\n+\n+        assertThat(emailAddress.localPart)\n+            .isEqualTo(\"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx12345\")\n+        assertThat(emailAddress.domain).isEqualTo(EmailDomain(\"domain.example\"))\n+        assertThat(emailAddress.address).isEqualTo(input)\n+        assertThat(emailAddress.warnings).contains(EmailAddress.Warning.LocalPartExceedsLengthLimit)\n+    }\n+\n+    @Test\n+    fun `email exceeds maximum size with length check enabled`() {\n         assertFailure {\n             parseEmailAddress(\n-                \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx1234@\" +\n+                address = \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx1234@\" +\n                     \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx123.\" +\n                     \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx123.\" +\n                     \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx12\",\n+                isEmailAddressLengthCheckEnabled = true,\n             )\n         }.isInstanceOf<EmailAddressParserException>().all {\n             prop(EmailAddressParserException::error).isEqualTo(TotalLengthExceeded)\n@@ -244,6 +268,28 @@ class EmailAddressParserTest {\n         }\n     }\n \n+    @Test\n+    fun `email exceeds maximum size with length check disabled`() {\n+        val input = \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx1234@\" +\n+            \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx123.\" +\n+            \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx123.\" +\n+            \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx12\"\n+\n+        val emailAddress = parseEmailAddress(address = input, isEmailAddressLengthCheckEnabled = false)\n+\n+        assertThat(emailAddress.localPart)\n+            .isEqualTo(\"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx1234\")\n+        assertThat(emailAddress.domain).isEqualTo(\n+            EmailDomain(\n+                \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx123.\" +\n+                    \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx123.\" +\n+                    \"1xxxxxxxxx2xxxxxxxxx3xxxxxxxxx4xxxxxxxxx5xxxxxxxxx6xxxxxxxxx12\",\n+            ),\n+        )\n+        assertThat(emailAddress.address).isEqualTo(input)\n+        assertThat(emailAddress.warnings).contains(EmailAddress.Warning.EmailAddressExceedsLengthLimit)\n+    }\n+\n     @Test\n     fun `input contains additional character`() {\n         assertFailure {\n@@ -257,14 +303,18 @@ class EmailAddressParserTest {\n \n     private fun parseEmailAddress(\n         address: String,\n-        allowEmptyLocalPart: Boolean = false,\n-        allowLocalPartRequiringQuotedString: Boolean = allowEmptyLocalPart,\n-        allowQuotedLocalPart: Boolean = allowLocalPartRequiringQuotedString,\n+        isLocalPartLengthCheckEnabled: Boolean = false,\n+        isEmailAddressLengthCheckEnabled: Boolean = false,\n+        isEmptyLocalPartAllowed: Boolean = false,\n+        isLocalPartRequiringQuotedStringAllowed: Boolean = isEmptyLocalPartAllowed,\n+        isQuotedLocalPartAllowed: Boolean = isLocalPartRequiringQuotedStringAllowed,\n     ): EmailAddress {\n         val config = EmailAddressParserConfig(\n-            allowQuotedLocalPart,\n-            allowLocalPartRequiringQuotedString,\n-            allowEmptyLocalPart,\n+            isLocalPartLengthCheckEnabled,\n+            isEmailAddressLengthCheckEnabled,\n+            isQuotedLocalPartAllowed,\n+            isLocalPartRequiringQuotedStringAllowed,\n+            isEmptyLocalPartAllowed,\n         )\n         return EmailAddressParser(address, config).parse()\n     }\ndiff --git a/feature/account/setup/src/main/kotlin/app/k9mail/feature/account/setup/domain/usecase/GetAutoDiscovery.kt b/feature/account/setup/src/main/kotlin/app/k9mail/feature/account/setup/domain/usecase/GetAutoDiscovery.kt\nindex eda3da3c760..3566f9cd387 100644\n--- a/feature/account/setup/src/main/kotlin/app/k9mail/feature/account/setup/domain/usecase/GetAutoDiscovery.kt\n+++ b/feature/account/setup/src/main/kotlin/app/k9mail/feature/account/setup/domain/usecase/GetAutoDiscovery.kt\n@@ -6,7 +6,7 @@ import app.k9mail.autodiscovery.api.AutoDiscoveryService\n import app.k9mail.autodiscovery.api.ConnectionSecurity\n import app.k9mail.autodiscovery.api.ImapServerSettings\n import app.k9mail.autodiscovery.api.SmtpServerSettings\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toUserEmailAddress\n import app.k9mail.core.common.net.toHostname\n import app.k9mail.core.common.net.toPort\n import app.k9mail.feature.account.setup.domain.DomainContract\n@@ -34,7 +34,7 @@ internal class GetAutoDiscovery(\n             return provideWithDelay(fakeResult)\n         }\n \n-        return service.discover(emailAddress.toEmailAddress())!!\n+        return service.discover(emailAddress.toUserEmailAddress())!!\n     }\n \n     @Suppress(\"MagicNumber\")\ndiff --git a/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/AutoconfigDiscoveryTest.kt b/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/AutoconfigDiscoveryTest.kt\nindex c289283b8da..d077ce2e3bb 100644\n--- a/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/AutoconfigDiscoveryTest.kt\n+++ b/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/AutoconfigDiscoveryTest.kt\n@@ -2,7 +2,7 @@ package app.k9mail.autodiscovery.autoconfig\n \n import app.k9mail.autodiscovery.autoconfig.MockAutoconfigFetcher.Companion.RESULT_ONE\n import app.k9mail.autodiscovery.autoconfig.MockAutoconfigFetcher.Companion.RESULT_TWO\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toUserEmailAddress\n import app.k9mail.core.common.net.toDomain\n import assertk.assertThat\n import assertk.assertions.containsExactly\n@@ -13,7 +13,7 @@ import kotlin.test.Test\n import kotlinx.coroutines.test.runTest\n import okhttp3.HttpUrl.Companion.toHttpUrl\n \n-private val IRRELEVANT_EMAIL_ADDRESS = \"irrelevant@domain.example\".toEmailAddress()\n+private val IRRELEVANT_EMAIL_ADDRESS = \"irrelevant@domain.example\".toUserEmailAddress()\n \n class AutoconfigDiscoveryTest {\n     private val urlProvider = MockAutoconfigUrlProvider()\n@@ -22,7 +22,7 @@ class AutoconfigDiscoveryTest {\n \n     @Test\n     fun `AutoconfigFetcher and AutoconfigParser should only be called when AutoDiscoveryRunnable is run`() = runTest {\n-        val emailAddress = \"user@domain.example\".toEmailAddress()\n+        val emailAddress = \"user@domain.example\".toUserEmailAddress()\n         val autoconfigUrl = \"https://autoconfig.domain.invalid/mail/config-v1.1.xml\".toHttpUrl()\n         urlProvider.addResult(listOf(autoconfigUrl))\n         autoconfigFetcher.addResult(RESULT_ONE)\ndiff --git a/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/MxLookupAutoconfigDiscoveryTest.kt b/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/MxLookupAutoconfigDiscoveryTest.kt\nindex 2b58f204e77..0e12e3c0824 100644\n--- a/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/MxLookupAutoconfigDiscoveryTest.kt\n+++ b/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/MxLookupAutoconfigDiscoveryTest.kt\n@@ -2,7 +2,7 @@ package app.k9mail.autodiscovery.autoconfig\n \n import app.k9mail.autodiscovery.api.AutoDiscoveryResult.NoUsableSettingsFound\n import app.k9mail.autodiscovery.autoconfig.MockAutoconfigFetcher.Companion.RESULT_ONE\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toUserEmailAddress\n import app.k9mail.core.common.net.toDomain\n import assertk.assertThat\n import assertk.assertions.containsExactly\n@@ -28,7 +28,7 @@ class MxLookupAutoconfigDiscoveryTest {\n \n     @Test\n     fun `AutoconfigUrlProvider should be called with MX base domain`() = runTest {\n-        val emailAddress = \"user@company.example\".toEmailAddress()\n+        val emailAddress = \"user@company.example\".toUserEmailAddress()\n         mxResolver.addResult(\"mx.emailprovider.example\".toDomain())\n         urlProvider.addResult(listOf(\"https://ispdb.invalid/emailprovider.example\".toHttpUrl()))\n         autoconfigFetcher.addResult(RESULT_ONE)\n@@ -50,7 +50,7 @@ class MxLookupAutoconfigDiscoveryTest {\n \n     @Test\n     fun `AutoconfigUrlProvider should be called with MX base domain and subdomain`() = runTest {\n-        val emailAddress = \"user@company.example\".toEmailAddress()\n+        val emailAddress = \"user@company.example\".toUserEmailAddress()\n         mxResolver.addResult(\"mx.something.emailprovider.example\".toDomain())\n         urlProvider.apply {\n             addResult(listOf(\"https://ispdb.invalid/something.emailprovider.example\".toHttpUrl()))\n@@ -74,7 +74,7 @@ class MxLookupAutoconfigDiscoveryTest {\n \n     @Test\n     fun `skip Autoconfig lookup when MX lookup does not return a result`() = runTest {\n-        val emailAddress = \"user@company.example\".toEmailAddress()\n+        val emailAddress = \"user@company.example\".toUserEmailAddress()\n         mxResolver.addResult(emptyList())\n \n         val autoDiscoveryRunnables = discovery.initDiscovery(emailAddress)\n@@ -88,7 +88,7 @@ class MxLookupAutoconfigDiscoveryTest {\n \n     @Test\n     fun `skip Autoconfig lookup when base domain of MX record is email domain`() = runTest {\n-        val emailAddress = \"user@company.example\".toEmailAddress()\n+        val emailAddress = \"user@company.example\".toUserEmailAddress()\n         mxResolver.addResult(\"mx.company.example\".toDomain())\n \n         val autoDiscoveryRunnables = discovery.initDiscovery(emailAddress)\n@@ -102,7 +102,7 @@ class MxLookupAutoconfigDiscoveryTest {\n \n     @Test\n     fun `isTrusted should be false when MxLookupResult_isTrusted is false`() = runTest {\n-        val emailAddress = \"user@company.example\".toEmailAddress()\n+        val emailAddress = \"user@company.example\".toUserEmailAddress()\n         mxResolver.addResult(\"mx.emailprovider.example\".toDomain(), isTrusted = false)\n         urlProvider.addResult(listOf(\"https://ispdb.invalid/emailprovider.example\".toHttpUrl()))\n         autoconfigFetcher.addResult(RESULT_ONE.copy(isTrusted = true))\n@@ -115,7 +115,7 @@ class MxLookupAutoconfigDiscoveryTest {\n \n     @Test\n     fun `isTrusted should be false when AutoDiscoveryResult_isTrusted from AutoconfigFetcher is false`() = runTest {\n-        val emailAddress = \"user@company.example\".toEmailAddress()\n+        val emailAddress = \"user@company.example\".toUserEmailAddress()\n         mxResolver.addResult(\"mx.emailprovider.example\".toDomain(), isTrusted = true)\n         urlProvider.addResult(listOf(\"https://ispdb.invalid/emailprovider.example\".toHttpUrl()))\n         autoconfigFetcher.addResult(RESULT_ONE.copy(isTrusted = false))\ndiff --git a/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/ProviderAutoconfigUrlProviderTest.kt b/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/ProviderAutoconfigUrlProviderTest.kt\nindex 50c0abb85e1..2a2250dfd1f 100644\n--- a/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/ProviderAutoconfigUrlProviderTest.kt\n+++ b/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/ProviderAutoconfigUrlProviderTest.kt\n@@ -1,6 +1,6 @@\n package app.k9mail.autodiscovery.autoconfig\n \n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toUserEmailAddress\n import app.k9mail.core.common.net.toDomain\n import assertk.assertThat\n import assertk.assertions.containsExactly\n@@ -8,7 +8,7 @@ import org.junit.Test\n \n class ProviderAutoconfigUrlProviderTest {\n     private val domain = \"domain.example\".toDomain()\n-    private val email = \"test@domain.example\".toEmailAddress()\n+    private val email = \"test@domain.example\".toUserEmailAddress()\n \n     @Test\n     fun `getAutoconfigUrls with http allowed and email address included`() {\ndiff --git a/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/RealAutoconfigParserTest.kt b/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/RealAutoconfigParserTest.kt\nindex e90d2ce4005..31448eebac7 100644\n--- a/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/RealAutoconfigParserTest.kt\n+++ b/feature/autodiscovery/autoconfig/src/test/kotlin/app/k9mail/autodiscovery/autoconfig/RealAutoconfigParserTest.kt\n@@ -8,7 +8,7 @@ import app.k9mail.autodiscovery.api.ImapServerSettings\n import app.k9mail.autodiscovery.api.SmtpServerSettings\n import app.k9mail.autodiscovery.autoconfig.AutoconfigParserResult.ParserError\n import app.k9mail.autodiscovery.autoconfig.AutoconfigParserResult.Settings\n-import app.k9mail.core.common.mail.toEmailAddress\n+import app.k9mail.core.common.mail.toUserEmailAddress\n import app.k9mail.core.common.net.toHostname\n import app.k9mail.core.common.net.toPort\n import assertk.assertThat\n@@ -55,13 +55,13 @@ class RealAutoconfigParserTest {\n         </clientConfig>\n         \"\"\".trimIndent()\n \n-    private val irrelevantEmailAddress = \"irrelevant@domain.example\".toEmailAddress()\n+    private val irrelevantEmailAddress = \"irrelevant@domain.example\".toUserEmailAddress()\n \n     @Test\n     fun `minimal data`() {\n         val inputStream = minimalConfig.byteInputStream()\n \n-        val result = parser.parseSettings(inputStream, email = \"user@domain.example\".toEmailAddress())\n+        val result = parser.parseSettings(inputStream, email = \"user@domain.example\".toUserEmailAddress())\n \n         assertThat(result).isNotNull().isEqualTo(\n             Settings(\n@@ -87,7 +87,7 @@ class RealAutoconfigParserTest {\n     fun `real-world data`() {\n         val inputStream = javaClass.getResourceAsStream(\"/2022-11-19-googlemail.com.xml\")!!\n \n-        val result = parser.parseSettings(inputStream, email = \"test@gmail.com\".toEmailAddress())\n+        val result = parser.parseSettings(inputStream, email = \"test@gmail.com\".toUserEmailAddress())\n \n         assertThat(result).isNotNull().isEqualTo(\n             Settings(\n@@ -117,7 +117,7 @@ class RealAutoconfigParserTest {\n             element(\"outgoingServer > username\").text(\"%EMAILDOMAIN%\")\n         }\n \n-        val result = parser.parseSettings(inputStream, email = \"user@domain.example\".toEmailAddress())\n+        val result = parser.parseSettings(inputStream, email = \"user@domain.example\".toUserEmailAddress())\n \n         assertThat(result).isNotNull().isEqualTo(\n             Settings(\n@@ -149,7 +149,7 @@ class RealAutoconfigParserTest {\n             element(\"incomingServer > username\").prepend(\"<!-- comment -->\")\n         }\n \n-        val result = parser.parseSettings(inputStream, email = \"user@domain.example\".toEmailAddress())\n+        val result = parser.parseSettings(inputStream, email = \"user@domain.example\".toUserEmailAddress())\n \n         assertThat(result).isInstanceOf<Settings>()\n             .prop(Settings::incomingServerSettings).isEqualTo(\n@@ -169,7 +169,7 @@ class RealAutoconfigParserTest {\n             element(\"incomingServer\").insertBefore(\"\"\"<incomingServer type=\"smtp\"/>\"\"\")\n         }\n \n-        val result = parser.parseSettings(inputStream, email = \"user@domain.example\".toEmailAddress())\n+        val result = parser.parseSettings(inputStream, email = \"user@domain.example\".toUserEmailAddress())\n \n         assertThat(result).isInstanceOf<Settings>()\n             .prop(Settings::incomingServerSettings).isEqualTo(\n@@ -189,7 +189,7 @@ class RealAutoconfigParserTest {\n             element(\"outgoingServer\").insertBefore(\"\"\"<outgoingServer type=\"imap\"/>\"\"\")\n         }\n \n-        val result = parser.parseSettings(inputStream, email = \"user@domain.example\".toEmailAddress())\n+        val result = parser.parseSettings(inputStream, email = \"user@domain.example\".toUserEmailAddress())\n \n         assertThat(result).isInstanceOf<Settings>()\n             .prop(Settings::outgoingServerSettings).isEqualTo(\n@@ -209,7 +209,7 @@ class RealAutoconfigParserTest {\n             element(\"incomingServer > authentication\").insertBefore(\"<authentication></authentication>\")\n         }\n \n-        val result = parser.parseSettings(inputStream, email = \"user@domain.example\".toEmailAddress())\n+        val result = parser.parseSettings(inputStream, email = \"user@domain.example\".toUserEmailAddress())\n \n         assertThat(result).isInstanceOf<Settings>()\n             .prop(Settings::incomingServerSettings).isEqualTo(\n", "changes": [{"file": "app/core/src/main/java/com/fsck/k9/helper/ContactNameProvider.kt", "module": "com.fsck.k9.helper.RealContactNameProvider", "range": [{"start": 4, "end": 5}, {"start": 14, "end": 15}]}, {"file": "app/core/src/main/java/com/fsck/k9/helper/MessageHelper.kt", "module": "com.fsck.k9.helper.MessageHelper", "range": [{"start": 9, "end": 10}, {"start": 104, "end": 105}, {"start": 127, "end": 127}]}, {"file": "app/k9mail/src/main/java/com/fsck/k9/notification/K9NotificationStrategy.kt", "module": "com.fsck.k9.notification.K9NotificationStrategy", "range": [{"start": 4, "end": 5}, {"start": 91, "end": 92}]}, {"file": "app/ui/legacy/src/main/java/com/fsck/k9/contacts/ContactPhotoLoader.kt", "module": "com.fsck.k9.contacts.ContactPhotoLoader", "range": [{"start": 6, "end": 6}, {"start": 7, "end": 8}, {"start": 15, "end": 16}, {"start": 25, "end": 25}]}, {"file": "app/ui/legacy/src/main/java/com/fsck/k9/ui/messagedetails/MessageDetailsViewModel.kt", "module": "com.fsck.k9.ui.messagedetails.MessageDetailsViewModel", "range": [{"start": 5, "end": 5}, {"start": 10, "end": 11}, {"start": 33, "end": 33}, {"start": 133, "end": 134}, {"start": 138, "end": 138}]}, {"file": "app/ui/legacy/src/main/java/com/fsck/k9/ui/messageview/MessageTopView.kt", "module": "com.fsck.k9.ui.messageview.MessageTopView", "range": [{"start": 21, "end": 22}, {"start": 265, "end": 266}, {"start": 268, "end": 269}, {"start": 273, "end": 274}]}, {"file": "core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddress.kt", "module": "app.k9mail.core.common.mail.EmailAddress", "range": [{"start": 3, "end": 3}, {"start": 18, "end": 18}, {"start": 68, "end": 68}, {"start": 84, "end": 85}, {"start": 90, "end": 91}]}, {"file": "core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddressParser.kt", "module": "app.k9mail.core.common.mail.EmailAddressParser", "range": [{"start": 16, "end": 22}, {"start": 55, "end": 56}, {"start": 59, "end": 60}, {"start": 63, "end": 64}, {"start": 86, "end": 87}, {"start": 97, "end": 100}]}, {"file": "core/common/src/main/kotlin/app/k9mail/core/common/mail/EmailAddressParserConfig.kt", "module": "app.k9mail.core.common.mail.EmailAddressParserConfig", "range": [{"start": 6, "end": 9}, {"start": 11, "end": 17}, {"start": 18, "end": 19}, {"start": 20, "end": 22}, {"start": 23, "end": 25}, {"start": 27, "end": 30}, {"start": 33, "end": 34}, {"start": 35, "end": 39}]}, {"file": "cli/autodiscovery-cli/src/main/kotlin/app/k9mail/cli/autodiscovery/AutoDiscoveryCli.kt", "module": "app.k9mail.cli.autodiscovery.AutoDiscoveryCli", "range": [{"start": 9, "end": 10}, {"start": 60, "end": 61}]}, {"file": "feature/account/setup/src/main/kotlin/app/k9mail/feature/account/setup/domain/usecase/GetAutoDiscovery.kt", "module": "app.k9mail.feature.account.setup.domain.usecase.GetAutoDiscovery", "range": [{"start": 9, "end": 10}, {"start": 37, "end": 38}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/6843", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 6843, "url": "https://github.com/thunderbird/thunderbird-android/issues/6843", "state": "closed", "title": "Valid e-mail recipient specification rejected (special characters)", "body": "### Checklist\r\n\r\n- [X] I have used the search function to see if someone else has already submitted the same bug report.\r\n- [X] I will describe the problem with as much detail as possible.\r\n\r\n### App version\r\n\r\n6.600\r\n\r\n### Where did you get the app from?\r\n\r\nF-Droid\r\n\r\n### Android version\r\n\r\n11\r\n\r\n### Device model\r\n\r\nQX1050 (FX Technology Pro1x)\r\n\r\n### Steps to reproduce\r\n\r\n1) Either copy e-mail address together with the sender name containing accented characters from a received e-mail (using the new functionality for displaying sender details) and paste it into the recipient address of a newly composed message, or type such an address anew - as an example, use something like: `\"Tom Marn\" <tomas@example.com>` (starting with the quote mark and finishing with the greater than sign).\r\n\r\n2) Press \"Tab\" key, or change to a different field.\r\n\r\n3) An exclamation mark appears next to the provided address. Clicking on the exclamation mark results in displaying \"Special characters are not supported at the moment\" (actually, I see a localized version of this message, thus the real English version of this message may be slightly different).\r\n\r\nThe point is - the recipient specification written this way is perfectly valid (even copied by K9 from a received message), but K9 refuses it.\r\n\r\n### Expected behavior\r\n\r\nNo exclamation mark is displayed, provided address is used for the \"To\" header of the composed message and sent to the address between the \"less than\" and \"greater than\" signs after user sends the message.\r\n\r\n### Actual behavior\r\n\r\nThe recipient specification is refused as described above.\r\n\r\n### Logs\r\n\r\n[k9mail-logs_230421.txt](https://github.com/thundernest/k-9/files/11299477/k9mail-logs_230421.txt)\r\n", "logs": [{"name": "k9mail-logs_230421.txt", "url": "https://github.com/thundernest/k-9/files/11299477/k9mail-logs_230421.txt"}]}, "pull_request": [{"number": 6962, "url": "https://github.com/thunderbird/thunderbird-android/pull/6962", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/6962.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/6962.patch", "title": "Add `UserInputEmailAddressParser`", "content": "Used to parse name and email address pairs entered by the user when composing a message. This can handle names containing non-ASCII characters while still not allowing email addresses containing non-ASCII characters.\r\n\r\nIt's not what we actually want. But it's better than what we have now.\r\n\r\nFixes #6843", "diff": "diff --git a/app/ui/legacy/src/main/java/com/fsck/k9/view/KoinModule.kt b/app/ui/legacy/src/main/java/com/fsck/k9/view/KoinModule.kt\nindex 39f7fd1a65b..89a209b7c2e 100644\n--- a/app/ui/legacy/src/main/java/com/fsck/k9/view/KoinModule.kt\n+++ b/app/ui/legacy/src/main/java/com/fsck/k9/view/KoinModule.kt\n@@ -16,4 +16,5 @@ val viewModule = module {\n         K9WebViewClient(clipboardManager = get(), attachmentResolver, onPageFinishedListener)\n     }\n     factory { WebViewClientFactory() }\n+    factory { UserInputEmailAddressParser() }\n }\ndiff --git a/app/ui/legacy/src/main/java/com/fsck/k9/view/RecipientSelectView.java b/app/ui/legacy/src/main/java/com/fsck/k9/view/RecipientSelectView.java\nindex 1cfd2418614..6505c34f53b 100644\n--- a/app/ui/legacy/src/main/java/com/fsck/k9/view/RecipientSelectView.java\n+++ b/app/ui/legacy/src/main/java/com/fsck/k9/view/RecipientSelectView.java\n@@ -33,6 +33,7 @@\n import android.widget.ListView;\n import android.widget.TextView;\n \n+import com.fsck.k9.DI;\n import com.fsck.k9.K9;\n import com.fsck.k9.ui.R;\n import com.fsck.k9.activity.AlternateRecipientAdapter;\n@@ -43,7 +44,6 @@\n import com.fsck.k9.ui.compose.RecipientCircleImageView;\n import com.fsck.k9.view.RecipientSelectView.Recipient;\n import com.tokenautocomplete.TokenCompleteTextView;\n-import org.apache.james.mime4j.util.CharsetUtil;\n import timber.log.Timber;\n import de.hdodenhof.circleimageview.CircleImageView;\n \n@@ -61,6 +61,8 @@ public class RecipientSelectView extends TokenCompleteTextView<Recipient> implem\n     private static final int LOADER_ID_ALTERNATES = 1;\n \n \n+    private final UserInputEmailAddressParser emailAddressParser = DI.get(UserInputEmailAddressParser.class);\n+\n     private RecipientAdapter adapter;\n     @Nullable\n     private String cryptoProvider;\n@@ -171,17 +173,19 @@ private void bindObjectView(Recipient recipient, View view) {\n \n     @Override\n     protected Recipient defaultObject(String completionText) {\n-        Address[] parsedAddresses = Address.parse(completionText);\n-        if (!CharsetUtil.isASCII(completionText)) {\n+        try {\n+            List<Address> parsedAddresses = emailAddressParser.parse(completionText);\n+\n+            if (parsedAddresses.isEmpty()) {\n+                setError(getContext().getString(R.string.recipient_error_parse_failed));\n+                return null;\n+            }\n+\n+            return new Recipient(parsedAddresses.get(0));\n+        } catch (NonAsciiEmailAddressException e) {\n             setError(getContext().getString(R.string.recipient_error_non_ascii));\n             return null;\n         }\n-        if (parsedAddresses.length == 0 || parsedAddresses[0].getAddress() == null) {\n-            setError(getContext().getString(R.string.recipient_error_parse_failed));\n-            return null;\n-        }\n-\n-        return new Recipient(parsedAddresses[0]);\n     }\n \n     public void setLoaderManager(@Nullable LoaderManager loaderManager) {\ndiff --git a/app/ui/legacy/src/main/java/com/fsck/k9/view/UserInputEmailAddressParser.kt b/app/ui/legacy/src/main/java/com/fsck/k9/view/UserInputEmailAddressParser.kt\nnew file mode 100644\nindex 00000000000..a14cb14bdb2\n--- /dev/null\n+++ b/app/ui/legacy/src/main/java/com/fsck/k9/view/UserInputEmailAddressParser.kt\n@@ -0,0 +1,31 @@\n+package com.fsck.k9.view\n+\n+import com.fsck.k9.mail.Address\n+import org.apache.james.mime4j.util.CharsetUtil\n+\n+/**\n+ * Used to parse name & email address pairs entered by the user.\n+ *\n+ * TODO: Build a custom implementation that can deal with typical inputs from users who are not familiar with the\n+ *  RFC 5322 address-list syntax. See (ignored) tests in `UserInputEmailAddressParserTest`.\n+ */\n+internal class UserInputEmailAddressParser {\n+\n+    @Throws(NonAsciiEmailAddressException::class)\n+    fun parse(input: String): List<Address> {\n+        return Address.parseUnencoded(input)\n+            .mapNotNull { address ->\n+                when {\n+                    address.isIncomplete() -> null\n+                    address.isNonAsciiAddress() -> throw NonAsciiEmailAddressException(address.address)\n+                    else -> Address.parse(address.toEncodedString()).firstOrNull()\n+                }\n+            }\n+    }\n+\n+    private fun Address.isIncomplete() = hostname.isNullOrBlank()\n+\n+    private fun Address.isNonAsciiAddress() = !CharsetUtil.isASCII(address)\n+}\n+\n+internal class NonAsciiEmailAddressException(message: String) : Exception(message)\ndiff --git a/app/ui/legacy/src/test/java/com/fsck/k9/view/UserInputEmailAddressParserTest.kt b/app/ui/legacy/src/test/java/com/fsck/k9/view/UserInputEmailAddressParserTest.kt\nnew file mode 100644\nindex 00000000000..f1ecb2d6053\n--- /dev/null\n+++ b/app/ui/legacy/src/test/java/com/fsck/k9/view/UserInputEmailAddressParserTest.kt\n@@ -0,0 +1,153 @@\n+package com.fsck.k9.view\n+\n+import assertk.assertFailure\n+import assertk.assertThat\n+import assertk.assertions.containsExactly\n+import assertk.assertions.isEmpty\n+import assertk.assertions.isInstanceOf\n+import com.fsck.k9.mail.Address\n+import kotlin.test.Ignore\n+import kotlin.test.Test\n+\n+class UserInputEmailAddressParserTest {\n+    private val parser = UserInputEmailAddressParser()\n+\n+    @Test\n+    fun `plain email address`() {\n+        val addresses = parser.parse(\"user@domain.example\")\n+\n+        assertThat(addresses).containsExactly(Address(\"user@domain.example\"))\n+    }\n+\n+    @Test\n+    fun `email address followed by space`() {\n+        val addresses = parser.parse(\"user@domain.example \")\n+\n+        assertThat(addresses).containsExactly(Address(\"user@domain.example\"))\n+    }\n+\n+    @Test\n+    fun `email address in angle brackets`() {\n+        val addresses = parser.parse(\"<user@domain.example>\")\n+\n+        assertThat(addresses).containsExactly(Address(\"user@domain.example\"))\n+    }\n+\n+    @Test\n+    fun `simple name and address`() {\n+        val addresses = parser.parse(\"Name <user@domain.example>\")\n+\n+        assertThat(addresses).containsExactly(Address(\"user@domain.example\", \"Name\"))\n+    }\n+\n+    @Test\n+    fun `name with quoted string and address`() {\n+        val addresses = parser.parse(\"\\\"Name\\\" <user@domain.example>\")\n+\n+        assertThat(addresses).containsExactly(Address(\"user@domain.example\", \"Name\"))\n+    }\n+\n+    @Test\n+    fun `name with multiple words and address`() {\n+        val addresses = parser.parse(\"Firstname Lastname <user@domain.example>\")\n+\n+        assertThat(addresses).containsExactly(Address(\"user@domain.example\", \"Firstname Lastname\"))\n+    }\n+\n+    @Test\n+    fun `name with non-ASCII characters and address`() {\n+        val addresses = parser.parse(\"Kthe Gehusegre <user@domain.example>\")\n+\n+        assertThat(addresses).containsExactly(Address(\"user@domain.example\", \"Kthe Gehusegre\"))\n+    }\n+\n+    @Test\n+    fun `address with non-ASCII character in local part`() {\n+        assertFailure {\n+            parser.parse(\"mller@domain.example\")\n+        }.isInstanceOf<NonAsciiEmailAddressException>()\n+    }\n+\n+    @Test\n+    fun `address with non-ASCII character in domain part`() {\n+        assertFailure {\n+            parser.parse(\"user@dmain.example\")\n+        }.isInstanceOf<NonAsciiEmailAddressException>()\n+    }\n+\n+    @Test\n+    fun `multiple addresses separated by comma`() {\n+        val addresses = parser.parse(\"one@domain.example,<two@domain.example>\")\n+\n+        assertThat(addresses).containsExactly(\n+            Address(\"one@domain.example\"),\n+            Address(\"two@domain.example\"),\n+        )\n+    }\n+\n+    @Test\n+    @Ignore(\"Currently not supported\")\n+    fun `multiple addresses separated by space`() {\n+        val addresses = parser.parse(\"one@domain.example two@domain.example\")\n+\n+        assertThat(addresses).containsExactly(\n+            Address(\"one@domain.example\"),\n+            Address(\"two@domain.example\"),\n+        )\n+    }\n+\n+    @Test\n+    fun `multiple addresses in angle brackets separated by space`() {\n+        val addresses = parser.parse(\"<one@domain.example>, <two@domain.example>\")\n+\n+        assertThat(addresses).containsExactly(\n+            Address(\"one@domain.example\"),\n+            Address(\"two@domain.example\"),\n+        )\n+    }\n+\n+    @Test\n+    fun `incomplete address should not return a result`() {\n+        val addresses = parser.parse(\"user\")\n+\n+        assertThat(addresses).isEmpty()\n+    }\n+\n+    @Test\n+    fun `incomplete address ending in @ should not return a result`() {\n+        val addresses = parser.parse(\"user@\")\n+\n+        assertThat(addresses).isEmpty()\n+    }\n+\n+    @Test\n+    fun `name and incomplete address should not return a result`() {\n+        val addresses = parser.parse(\"Name <user\")\n+\n+        assertThat(addresses).isEmpty()\n+    }\n+\n+    @Test\n+    @Ignore(\"Currently not supported\")\n+    fun `name followed by address not in angle brackets`() {\n+        val addresses = parser.parse(\"Firstname Lastname user@domain.example\")\n+\n+        assertThat(addresses).containsExactly(Address(\"user@domain.example\", \"Firstname LastName\"))\n+    }\n+\n+    @Test\n+    @Ignore(\"Currently not supported\")\n+    fun `name containing parenthesis`() {\n+        val addresses = parser.parse(\"Firstname (Nickname) Lastname <user@domain.example>\")\n+\n+        assertThat(addresses).containsExactly(Address(\"user@domain.example\", \"Firstname (Nickname) LastName\"))\n+    }\n+\n+    @Test\n+    @Ignore(\"Currently not supported\")\n+    fun `name containing double quotes in the middle`() {\n+        val addresses = parser.parse(\"Firstname \\\"Nickname\\\" Lastname <user@domain.example>\")\n+\n+        assertThat(addresses).containsExactly(Address(\"user@domain.example\", \"Firstname \\\"Nickname\\\" LastName\"))\n+    }\n+}\ndiff --git a/mail/common/src/main/java/com/fsck/k9/mail/Address.java b/mail/common/src/main/java/com/fsck/k9/mail/Address.java\nindex fd272638fa2..8bc3eaa1d22 100644\n--- a/mail/common/src/main/java/com/fsck/k9/mail/Address.java\n+++ b/mail/common/src/main/java/com/fsck/k9/mail/Address.java\n@@ -115,7 +115,8 @@ public static Address[] parseUnencoded(String addressList) {\n             for (Rfc822Token token : tokens) {\n                 String address = token.getAddress();\n                 if (!TextUtils.isEmpty(address)) {\n-                    addresses.add(new Address(token.getAddress(), token.getName(), false));\n+                    String name = TextUtils.isEmpty(token.getName()) ? null : token.getName();\n+                    addresses.add(new Address(token.getAddress(), name, false));\n                 }\n             }\n         }\n", "changes": [{"file": "app/ui/legacy/src/main/java/com/fsck/k9/view/RecipientSelectView.java", "module": "com.fsck.k9.view.RecipientSelectView", "range": [{"start": 36, "end": 36}, {"start": 46, "end": 46}, {"start": 64, "end": 64}, {"start": 174, "end": 176}, {"start": 179, "end": 184}]}, {"file": "app/ui/legacy/src/main/java/com/fsck/k9/view/UserInputEmailAddressParser.kt", "module": "com.fsck.k9.view.UserInputEmailAddressParser", "range": [{"start": 0, "end": 0}]}, {"file": "mail/common/src/main/java/com/fsck/k9/mail/Address.java", "module": "com.fsck.k9.mail.Address", "range": [{"start": 118, "end": 119}]}, {"file": "app/ui/legacy/src/main/java/com/fsck/k9/view/KoinModule.kt", "module": "com.fsck.k9.view.KoinModule", "range": [{"start": 19, "end": 19}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/6062", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 6062, "url": "https://github.com/thunderbird/thunderbird-android/issues/6062", "state": "closed", "title": "EHLO keyword contains invalid character", "body": "### Checklist\r\n\r\n- [X] I have used the search function to see if someone else has already submitted the same bug report.\r\n- [X] I will describe the problem with as much detail as possible.\r\n\r\n### App version\r\n\r\nd13352a4cd7f5ea540eba738155ff377ee48da62 - 2205202769770bc37feb98414bb8a1ae084b9c98\r\n\r\n### Where did you get the app from?\r\n\r\nOther\r\n\r\n### Android version\r\n\r\n11 (LineageOS for microG)\r\n\r\n### Device model\r\n\r\nFairphone 3\r\n\r\n### Steps to reproduce\r\n\r\n1. Set up an email account\r\n2. Go to outgoing server settings\r\n3. Fill in everything and click next\r\n\r\nSMTP server: `<REDACTED>`\r\nSecurity: SSL/TLS\r\nPort: 465\r\nRequire sign-in: Yes\r\nUsername: `<REDACTED>`\r\nAuthentication: Normal password\r\nPassword: `<REDACTED>`\r\nClient certificate: No client certificate\r\n\r\nNote: This happens on my own self-hosted mailserver, not on a public provider. I obviously don't want to make authentication info for it public, but if it helps to debug please send me an email and I'll get you some login credentials.\r\n\r\n### Expected behavior\r\n\r\nSuccesfully set up SMTP, like it did on K-9 Mail v6.000\r\n\r\n### Actual behavior\r\n\r\nAn error message shows:\r\n\r\n# Setup could not finish\r\nCannot connect to server.\r\n(EHLO keyword contains invalid character)\r\n[ Continue ] [ Edit Details ]\r\n\r\n![image](https://user-images.githubusercontent.com/1885159/167604225-40801927-8e97-44b4-b177-0732d62d22df.png)\r\n\r\n\r\n### Logs\r\n\r\nUsing git bisect, I was able to pinpoint it to the following commit:\r\n\r\n```\r\nd13352a4cd7f5ea540eba738155ff377ee48da62 is the first bad commit\r\ncommit d13352a4cd7f5ea540eba738155ff377ee48da62\r\nAuthor: cketti <cketti@gmail.com>\r\nDate:   Wed Mar 23 04:07:37 2022 +0100\r\n\r\n    Use new `SmtpResponseParser` in `SmtpTransport`\r\n\r\n .../smtp/EnhancedNegativeSmtpReplyException.java   |  12 +-\r\n .../fsck/k9/mail/transport/smtp/SmtpResponse.kt    |   3 +\r\n .../fsck/k9/mail/transport/smtp/SmtpTransport.java | 268 +++++++--------------\r\n .../k9/mail/transport/smtp/StatusCodeClass.java    |  12 -\r\n .../k9/mail/transport/smtp/StatusCodeDetail.java   |  80 ------\r\n .../k9/mail/transport/smtp/StatusCodeSubject.java  |  31 ---\r\n .../k9/mail/transport/smtp/SmtpTransportTest.java  |   8 +-\r\n 7 files changed, 100 insertions(+), 314 deletions(-)\r\n delete mode 100644 mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/StatusCodeDetail.java\r\n delete mode 100644 mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/StatusCodeSubject.java\r\n```\r\n\r\nPlease note: In the attached log file, I replaced the mailserver identification with `mail.example.com` and the Hello's hostname and IP with `<REDACTED>`.\r\n\r\n[k9-log-redacted.txt](https://github.com/k9mail/k-9/files/8660865/k9-log-redacted.txt)", "logs": [{"name": "k9-log-redacted.txt", "url": "https://github.com/k9mail/k-9/files/8660865/k9-log-redacted.txt"}]}, "pull_request": [{"number": 6080, "url": "https://github.com/thunderbird/thunderbird-android/pull/6080", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/6080.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/6080.patch", "title": "Ignore invalid SMTP EHLO response lines", "content": "Fixes #6062", "diff": "diff --git a/mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpResponseParser.kt b/mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpResponseParser.kt\nindex e67febebd16..a7ceefaa101 100644\n--- a/mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpResponseParser.kt\n+++ b/mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpResponseParser.kt\n@@ -115,20 +115,25 @@ internal class SmtpResponseParser(\n \n     private fun parseEhloLine(ehloLine: String, keywords: MutableMap<String, List<String>>) {\n         val parts = ehloLine.split(\" \")\n-        val keyword = checkAndNormalizeEhloKeyword(parts[0])\n-        val parameters = checkEhloParameters(parts)\n \n-        if (keywords.containsKey(keyword)) {\n-            parserError(\"Same EHLO keyword present in more than one response line\")\n-        }\n+        try {\n+            val keyword = checkAndNormalizeEhloKeyword(parts[0])\n+            val parameters = checkEhloParameters(parts)\n+\n+            if (keywords.containsKey(keyword)) {\n+                parserError(\"Same EHLO keyword present in more than one response line\", logging = false)\n+            }\n \n-        keywords[keyword] = parameters\n+            keywords[keyword] = parameters\n+        } catch (e: SmtpResponseParserException) {\n+            logger.log(e, \"Ignoring EHLO keyword line: $ehloLine\")\n+        }\n     }\n \n     private fun checkAndNormalizeEhloKeyword(text: String): String {\n         val keyword = text.uppercase()\n         if (!keyword[0].isCapitalAlphaDigit() || keyword.any { !it.isCapitalAlphaDigit() && it != DASH }) {\n-            parserError(\"EHLO keyword contains invalid character\")\n+            parserError(\"EHLO keyword contains invalid character\", logging = false)\n         }\n \n         return keyword\n@@ -138,9 +143,9 @@ internal class SmtpResponseParser(\n         for (i in 1..parts.lastIndex) {\n             val parameter = parts[i]\n             if (parameter.isEmpty()) {\n-                parserError(\"EHLO parameter must not be empty\")\n+                parserError(\"EHLO parameter must not be empty\", logging = false)\n             } else if (parameter.any { it.code !in 33..126 }) {\n-                parserError(\"EHLO parameter contains invalid character\")\n+                parserError(\"EHLO parameter contains invalid character\", logging = false)\n             }\n         }\n \ndiff --git a/mail/protocols/smtp/src/test/java/com/fsck/k9/mail/transport/smtp/SmtpResponseParserTest.kt b/mail/protocols/smtp/src/test/java/com/fsck/k9/mail/transport/smtp/SmtpResponseParserTest.kt\nindex e3f349201c6..9b813c0ae5c 100644\n--- a/mail/protocols/smtp/src/test/java/com/fsck/k9/mail/transport/smtp/SmtpResponseParserTest.kt\n+++ b/mail/protocols/smtp/src/test/java/com/fsck/k9/mail/transport/smtp/SmtpResponseParserTest.kt\n@@ -145,26 +145,36 @@ class SmtpResponseParserTest {\n     }\n \n     @Test\n-    fun `read EHLO response with invalid keyword`() {\n+    fun `read EHLO response with invalid keywords`() {\n         val input = \"\"\"\n             250-smtp.domain.example\n-            250 KEY:WORD\n+            250-SIZE 52428800\n+            250-8BITMIME\n+            250-PIPELINING\n+            250-PIPE_CONNECT\n+            250-AUTH=PLAIN\n+            250 HELP\n             \"\"\".toPeekableInputStream()\n         val parser = SmtpResponseParser(logger, input)\n \n-        assertFailsWithMessage(\"EHLO keyword contains invalid character\") {\n-            parser.readHelloResponse()\n-        }\n+        val response = parser.readHelloResponse()\n \n-        assertThat(logger.logEntries).containsExactly(\n-            LogEntry(\n-                throwable = null,\n-                message = \"\"\"\n-                    SMTP response data on parser error:\n-                    250-smtp.domain.example\n-                    250 KEY:WORD\n-                \"\"\".trimIndent()\n+        assertType<SmtpHelloResponse.Hello>(response) { hello ->\n+            assertThat(hello.keywords.keys).containsExactly(\n+                \"SIZE\",\n+                \"8BITMIME\",\n+                \"PIPELINING\",\n+                \"HELP\"\n             )\n+        }\n+\n+        assertThat(logger.logEntries.map { it.message }).containsExactly(\n+            \"Ignoring EHLO keyword line: PIPE_CONNECT\",\n+            \"Ignoring EHLO keyword line: AUTH=PLAIN\"\n+        )\n+        assertThat(logger.logEntries.map { it.throwable?.message }).containsExactly(\n+            \"EHLO keyword contains invalid character\",\n+            \"EHLO keyword contains invalid character\"\n         )\n     }\n \n@@ -176,44 +186,37 @@ class SmtpResponseParserTest {\n             \"\"\".toPeekableInputStream()\n         val parser = SmtpResponseParser(logger, input)\n \n-        assertFailsWithMessage(\"EHLO parameter must not be empty\") {\n-            parser.readHelloResponse()\n+        val response = parser.readHelloResponse()\n+\n+        assertType<SmtpHelloResponse.Hello>(response) { hello ->\n+            assertThat(hello.keywords.keys).isEmpty()\n         }\n \n-        assertThat(logger.logEntries).containsExactly(\n-            LogEntry(\n-                throwable = null,\n-                message = \"\"\"\n-                    SMTP response data on parser error:\n-                    250-smtp.domain.example\n-                    250 KEYWORD${\" \"}\n-                \"\"\".trimIndent()\n-            )\n-        )\n+        assertThat(logger.logEntries).hasSize(1)\n+        assertThat(logger.logEntries.first().throwable).hasMessageThat().isEqualTo(\"EHLO parameter must not be empty\")\n+        assertThat(logger.logEntries.first().message).isEqualTo(\"Ignoring EHLO keyword line: KEYWORD \")\n     }\n \n     @Test\n     fun `read EHLO response with invalid parameter`() {\n         val input = \"\"\"\n             250-smtp.domain.example\n+            250-8BITMIME\n             250 KEYWORD para${\"\\t\"}meter\n             \"\"\".toPeekableInputStream()\n         val parser = SmtpResponseParser(logger, input)\n \n-        assertFailsWithMessage(\"EHLO parameter contains invalid character\") {\n-            parser.readHelloResponse()\n+        val response = parser.readHelloResponse()\n+\n+        assertType<SmtpHelloResponse.Hello>(response) { hello ->\n+            assertThat(hello.keywords.keys).containsExactly(\"8BITMIME\")\n         }\n \n-        assertThat(logger.logEntries).containsExactly(\n-            LogEntry(\n-                throwable = null,\n-                message = \"\"\"\n-                    SMTP response data on parser error:\n-                    250-smtp.domain.example\n-                    250 KEYWORD para${\"\\t\"}meter\n-                \"\"\".trimIndent()\n-            )\n-        )\n+        assertThat(logger.logEntries).hasSize(1)\n+        assertThat(logger.logEntries.first().throwable)\n+            .hasMessageThat().isEqualTo(\"EHLO parameter contains invalid character\")\n+        assertThat(logger.logEntries.first().message)\n+            .isEqualTo(\"Ignoring EHLO keyword line: KEYWORD para${\"\\t\"}meter\")\n     }\n \n     @Test\n", "changes": [{"file": "mail/protocols/smtp/src/main/java/com/fsck/k9/mail/transport/smtp/SmtpResponseParser.kt", "module": "com.fsck.k9.mail.transport.smtp.SmtpResponseParser", "range": [{"start": 118, "end": 119}, {"start": 121, "end": 124}, {"start": 125, "end": 126}, {"start": 131, "end": 132}, {"start": 141, "end": 142}, {"start": 143, "end": 144}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/5922", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 5922, "url": "https://github.com/thunderbird/thunderbird-android/issues/5922", "state": "closed", "title": "Beta 5.911: vibration / led on notification broken", "body": "### Checklist\n\n- [X] I have used the search function to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n\n### App version\n\n5911\n\n### Where did you get the app from?\n\n_No response_\n\n### Android version\n\n8\n\n### Device model\n\nSamsung S7 edge\n\n### Steps to reproduce\n\n1. enable notification\r\n2. Set vibration to default\r\n3. Enable notification light\n\n### Expected behavior\n\nWhen mail arrives notification should vibrate and show notification light\n\n### Actual behavior\n\nNo vibration / notification light. Vibration was working on 5.910\n\n### Logs\n\n[k9mail-logs2.txt](https://github.com/k9mail/k-9/files/8075136/k9mail-logs2.txt)\r\n", "logs": [{"name": "k9mail-logs2.txt", "url": "https://github.com/k9mail/k-9/files/8075136/k9mail-logs2.txt"}]}, "pull_request": [{"number": 5928, "url": "https://github.com/thunderbird/thunderbird-android/pull/5928", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/5928.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/5928.patch", "title": "Add more logging around notifications", "content": "Related: #5922", "diff": "diff --git a/app/core/src/main/java/com/fsck/k9/notification/NotificationChannelManager.kt b/app/core/src/main/java/com/fsck/k9/notification/NotificationChannelManager.kt\nindex 1445bf8ea90..55b12338013 100644\n--- a/app/core/src/main/java/com/fsck/k9/notification/NotificationChannelManager.kt\n+++ b/app/core/src/main/java/com/fsck/k9/notification/NotificationChannelManager.kt\n@@ -193,6 +193,8 @@ class NotificationChannelManager(\n         }\n \n         Timber.v(\"Recreating NotificationChannel(%s => %s)\", oldChannelId, newChannelId)\n+        Timber.v(\"Old NotificationChannel: %s\", oldNotificationChannel)\n+        Timber.v(\"New NotificationChannel: %s\", newNotificationChannel)\n         notificationManager.createNotificationChannel(newNotificationChannel)\n     }\n \ndiff --git a/app/core/src/main/java/com/fsck/k9/notification/SingleMessageNotificationCreator.kt b/app/core/src/main/java/com/fsck/k9/notification/SingleMessageNotificationCreator.kt\nindex 46635307a41..45027ec8206 100644\n--- a/app/core/src/main/java/com/fsck/k9/notification/SingleMessageNotificationCreator.kt\n+++ b/app/core/src/main/java/com/fsck/k9/notification/SingleMessageNotificationCreator.kt\n@@ -5,6 +5,7 @@ import androidx.core.app.NotificationCompat\n import androidx.core.app.NotificationCompat.WearableExtender\n import androidx.core.app.NotificationManagerCompat\n import com.fsck.k9.notification.NotificationChannelManager.ChannelType\n+import timber.log.Timber\n import androidx.core.app.NotificationCompat.Builder as NotificationBuilder\n \n internal class SingleMessageNotificationCreator(\n@@ -44,6 +45,13 @@ internal class SingleMessageNotificationCreator(\n             .setLockScreenNotification(baseNotificationData, singleNotificationData.addLockScreenNotification)\n             .build()\n \n+        if (isGroupSummary) {\n+            Timber.v(\n+                \"Creating single summary notification (silent=%b): %s\",\n+                singleNotificationData.isSilent,\n+                notification\n+            )\n+        }\n         notificationManager.notify(notificationId, notification)\n     }\n \ndiff --git a/app/core/src/main/java/com/fsck/k9/notification/SummaryNotificationCreator.kt b/app/core/src/main/java/com/fsck/k9/notification/SummaryNotificationCreator.kt\nindex d6b85a3aef2..bcd4f72b3f9 100644\n--- a/app/core/src/main/java/com/fsck/k9/notification/SummaryNotificationCreator.kt\n+++ b/app/core/src/main/java/com/fsck/k9/notification/SummaryNotificationCreator.kt\n@@ -7,6 +7,7 @@ import androidx.core.app.NotificationManagerCompat\n import com.fsck.k9.Account\n import com.fsck.k9.notification.NotificationChannelManager.ChannelType\n import com.fsck.k9.notification.NotificationIds.getNewMailSummaryNotificationId\n+import timber.log.Timber\n import androidx.core.app.NotificationCompat.Builder as NotificationBuilder\n \n internal class SummaryNotificationCreator(\n@@ -73,6 +74,7 @@ internal class SummaryNotificationCreator(\n             .setLockScreenNotification(baseNotificationData)\n             .build()\n \n+        Timber.v(\"Creating inbox-style summary notification (silent=%b): %s\", notificationData.isSilent, notification)\n         notificationManager.notify(notificationData.notificationId, notification)\n     }\n \n", "changes": [{"file": "app/core/src/main/java/com/fsck/k9/notification/NotificationChannelManager.kt", "module": "com.fsck.k9.notification.NotificationChannelManager", "range": [{"start": 196, "end": 196}]}, {"file": "app/core/src/main/java/com/fsck/k9/notification/SingleMessageNotificationCreator.kt", "module": "com.fsck.k9.notification.SingleMessageNotificationCreator", "range": [{"start": 8, "end": 8}, {"start": 47, "end": 47}]}, {"file": "app/core/src/main/java/com/fsck/k9/notification/SummaryNotificationCreator.kt", "module": "com.fsck.k9.notification.SummaryNotificationCreator", "range": [{"start": 10, "end": 10}, {"start": 76, "end": 76}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/5397", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 5397, "url": "https://github.com/thunderbird/thunderbird-android/issues/5397", "state": "closed", "title": "Device not sleeping with Push enabled", "body": "Whenever I enable Push the device doesn't sleep at all. My awake time was 5 hrs 10 min at 15:40 today when I enabled Push again - now its 17:00 (an hour 20 min later) and the Awake time is 6 hrs 20 minutes.\r\nThose previous 5 hrs+ were from over 5 days uptime without Push enabled, so its clearly not sleeping much at all now.\r\n![k9smaller](https://user-images.githubusercontent.com/33838834/125101550-9e676280-e0da-11eb-9ab6-1c542d4aee86.png)\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Enable Push\r\n2. Write down Awake Time from FKM\r\n3. Wait an hour or 2\r\n4. Check Awake time again\r\n\r\n**Expected behavior**\r\nDevice should sleep in between getting emails\r\n\r\n**Environment (please complete the following information):**\r\n - K-9 Mail version: Beta 5.738 and previous version\r\n - Android version: OOS 10\r\n - Device: OP 7\r\n - Account type: IMAP\r\n\r\n**Logs**\r\n[k9-log.txt](https://github.com/k9mail/k-9/files/6792367/k9-log.txt)", "logs": [{"name": "k9-log.txt", "url": "https://github.com/k9mail/k-9/files/6792367/k9-log.txt"}]}, "pull_request": [{"number": 5398, "url": "https://github.com/thunderbird/thunderbird-android/pull/5398", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/5398.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/5398.patch", "title": "Fix Push keeping the device awake", "content": "`ImapConnection.isDataAvailable()` didn't reliably work on all devices (returned `true` when no complete IMAP response was available). This lead to situations where a wakelock was being held the whole time the IDLE command was active. At the same time no alarm was set to refresh the IDLE connection. So most of the time the blocking read would time out.\r\n\r\nFixes #5397", "diff": "diff --git a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapConnection.kt b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapConnection.kt\nindex a967e42dd88..39e8ba09046 100644\n--- a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapConnection.kt\n+++ b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapConnection.kt\n@@ -44,7 +44,4 @@ internal interface ImapConnection {\n \n     @Throws(SocketException::class)\n     fun setSocketReadTimeout(timeout: Int)\n-\n-    @Throws(IOException::class)\n-    fun isDataAvailable(): Boolean\n }\ndiff --git a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.java b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.java\nindex 3e7d4561b39..1cea9830b16 100644\n--- a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.java\n+++ b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.java\n@@ -910,11 +910,6 @@ int getLineLengthLimit() throws IOException, MessagingException {\n         return isCondstoreCapable() ? LENGTH_LIMIT_WITH_CONDSTORE : LENGTH_LIMIT_WITHOUT_CONDSTORE;\n     }\n \n-    @Override\n-    public boolean isDataAvailable() throws IOException {\n-        return inputStream.available() > 0;\n-    }\n-\n     @Override\n     public int getConnectionGeneration() {\n         return connectionGeneration;\ndiff --git a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapFolderIdler.kt b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapFolderIdler.kt\nindex 998233e4600..b0a7aba33eb 100644\n--- a/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapFolderIdler.kt\n+++ b/mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapFolderIdler.kt\n@@ -95,25 +95,18 @@ internal class RealImapFolderIdler(\n \n             var response: ImapResponse\n             do {\n-                val expectSleeping = !connection.isDataAvailable() && !stopIdle\n+                idleRefreshTimer = idleRefreshManager.startTimer(\n+                    timeout = idleRefreshTimeoutProvider.idleRefreshTimeoutMs,\n+                    callback = ::idleRefresh\n+                )\n \n-                idleRefreshTimer = if (expectSleeping) {\n-                    idleRefreshManager.startTimer(idleRefreshTimeoutProvider.idleRefreshTimeoutMs) { idleRefresh() }\n-                } else {\n-                    null\n-                }\n-\n-                if (expectSleeping) {\n-                    wakeLock.release()\n-                }\n+                wakeLock.release()\n \n                 try {\n                     response = connection.readResponse()\n                 } finally {\n-                    if (expectSleeping) {\n-                        wakeLock.acquire()\n-                        idleRefreshTimer?.cancel()\n-                    }\n+                    wakeLock.acquire()\n+                    idleRefreshTimer?.cancel()\n                 }\n \n                 if (response.isRelevant && !stopIdle) {\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapFolderIdlerTest.kt b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapFolderIdlerTest.kt\nindex 68aa1fc3251..871c5849190 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapFolderIdlerTest.kt\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/RealImapFolderIdlerTest.kt\n@@ -121,7 +121,6 @@ class RealImapFolderIdlerTest {\n         wakeLock.waitForRelease()\n         imapConnection.enqueueUntaggedServerResponse(\"1 EXISTS\")\n         imapConnection.waitForCommand(\"DONE\")\n-        assertThat(wakeLock.isHeld).isTrue()\n         imapConnection.enqueueTaggedServerResponse(\"OK\")\n \n         latch.awaitWithTimeout()\ndiff --git a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/TestImapConnection.kt b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/TestImapConnection.kt\nindex 4149623344e..5bfd672fa93 100644\n--- a/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/TestImapConnection.kt\n+++ b/mail/protocols/imap/src/test/java/com/fsck/k9/mail/store/imap/TestImapConnection.kt\n@@ -94,8 +94,6 @@ internal open class TestImapConnection(val timeout: Long, override val connectio\n         currentSocketReadTimeout = timeout\n     }\n \n-    override fun isDataAvailable(): Boolean = false\n-\n     fun waitForCommand(command: String) {\n         do {\n             val receivedCommand = receivedCommands.poll(timeout, TimeUnit.SECONDS) ?: throw AssertionError(\"Timeout\")\n", "changes": [{"file": "mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/ImapConnection.kt", "module": "com.fsck.k9.mail.store.imap.ImapConnection", "range": [{"start": 47, "end": 49}]}, {"file": "mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapConnection.java", "module": "com.fsck.k9.mail.store.imap.RealImapConnection", "range": [{"start": 913, "end": 917}]}, {"file": "mail/protocols/imap/src/main/java/com/fsck/k9/mail/store/imap/RealImapFolderIdler.kt", "module": "com.fsck.k9.mail.store.imap.RealImapFolderIdler", "range": [{"start": 98, "end": 99}, {"start": 100, "end": 109}, {"start": 113, "end": 117}]}]}]}
{"url": "https://github.com/thunderbird/thunderbird-android/issues/5026", "repo": {"url": "https://github.com/thunderbird/thunderbird-android", "name": "thunderbird-android", "owner": "thunderbird", "modules": ["app.k9mail", "app.k9mail.auth", "app.k9mail.autodiscovery", "app.k9mail.backend", "app.k9mail.cli", "app.k9mail.core", "app.k9mail.dev", "app.k9mail.feature", "app.k9mail.featureflag", "app.k9mail.html", "app.k9mail.legacy", "app.k9mail.provider", "app.k9mail.ui", "app.k9mail.widget", "assertk.assertions", "com.fsck.k9", "com.tokenautocomplete", "net.thunderbird.account", "net.thunderbird.android", "net.thunderbird.app", "net.thunderbird.backend", "net.thunderbird.cli", "net.thunderbird.core", "net.thunderbird.feature", "net.thunderbird.legacy", "net.thunderbird.protocols", "net.thunderbird.quality", "net.thunderbird.ui", "org.openintents.openpgp"]}, "issue": {"number": 5026, "url": "https://github.com/thunderbird/thunderbird-android/issues/5026", "state": "closed", "title": "Unable to delete messages from inbox", "body": "**Describe the bug**\r\nWhen trying to delete messages, messages disappear, but are not moved into Trash directory.\r\nWhen re-opening k-9, deleted messages still appear in inbox.\r\n\r\nPlease note that it could also happen with messages from other directory ( I didn't test it)\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Open k-9 (unified inbox in my case)\r\n2. Select one or many messages\r\n3. Delete them\r\n4. Quit k-9\r\n5. Re-open k-9\r\n6. Messages are still in inbox\r\n\r\n**Expected behavior**\r\nDeleted messages should be visible in Trash directory and not in inbox anymore\r\n\r\n**Environment (please complete the following information):**\r\n - K-9 Mail version: 5.722 (beta)\r\n - Android version: 11\r\n - Device: Google Pixel 4a\r\n - Account type: IMAP\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n\r\n**Logs**\r\n[k9-mail.log.txt](https://github.com/k9mail/k-9/files/5434913/k9-mail.log.txt)", "logs": [{"name": "k9-mail.log.txt", "url": "https://github.com/k9mail/k-9/files/5434913/k9-mail.log.txt"}]}, "pull_request": [{"number": 5027, "url": "https://github.com/thunderbird/thunderbird-android/pull/5027", "diff_url": "https://github.com/thunderbird/thunderbird-android/pull/5027.diff", "patch_url": "https://github.com/thunderbird/thunderbird-android/pull/5027.patch", "title": "Fix moving messages not containing a Message-ID header", "content": "Fix `ThreadInfo` to allow `messageIdHeader` being `null`.\r\n\r\nFixes #5026 ", "diff": "diff --git a/app/storage/src/main/java/com/fsck/k9/storage/messages/ThreadMessageOperations.kt b/app/storage/src/main/java/com/fsck/k9/storage/messages/ThreadMessageOperations.kt\nindex 6afa1c10f27..26f59a5716d 100644\n--- a/app/storage/src/main/java/com/fsck/k9/storage/messages/ThreadMessageOperations.kt\n+++ b/app/storage/src/main/java/com/fsck/k9/storage/messages/ThreadMessageOperations.kt\n@@ -85,7 +85,7 @@ internal class ThreadMessageOperations(private val localStore: LocalStore) {\n internal data class ThreadInfo(\n     val threadId: Long?,\n     val messageId: Long?,\n-    val messageIdHeader: String,\n+    val messageIdHeader: String?,\n     val rootId: Long?,\n     val parentId: Long?\n )\ndiff --git a/app/storage/src/test/java/com/fsck/k9/storage/messages/MessageDatabaseHelpers.kt b/app/storage/src/test/java/com/fsck/k9/storage/messages/MessageDatabaseHelpers.kt\nindex 4c2773f9621..62877bd8161 100644\n--- a/app/storage/src/test/java/com/fsck/k9/storage/messages/MessageDatabaseHelpers.kt\n+++ b/app/storage/src/test/java/com/fsck/k9/storage/messages/MessageDatabaseHelpers.kt\n@@ -50,7 +50,7 @@ fun SQLiteDatabase.createMessage(\n     replyToList: String = \"\",\n     attachmentCount: Int = 0,\n     internalDate: Long = 0L,\n-    messageId: String = \"\",\n+    messageIdHeader: String? = null,\n     previewType: DatabasePreviewType = DatabasePreviewType.NONE,\n     preview: String = \"\",\n     mimeType: String = \"text/plain\",\n@@ -77,7 +77,7 @@ fun SQLiteDatabase.createMessage(\n         put(\"reply_to_list\", replyToList)\n         put(\"attachment_count\", attachmentCount)\n         put(\"internal_date\", internalDate)\n-        put(\"message_id\", messageId)\n+        put(\"message_id\", messageIdHeader)\n         put(\"preview_type\", previewType.databaseValue)\n         put(\"preview\", preview)\n         put(\"mime_type\", mimeType)\ndiff --git a/app/storage/src/test/java/com/fsck/k9/storage/messages/MoveMessageOperationsTest.kt b/app/storage/src/test/java/com/fsck/k9/storage/messages/MoveMessageOperationsTest.kt\nindex 1af8cf68e8f..57f9015ce76 100644\n--- a/app/storage/src/test/java/com/fsck/k9/storage/messages/MoveMessageOperationsTest.kt\n+++ b/app/storage/src/test/java/com/fsck/k9/storage/messages/MoveMessageOperationsTest.kt\n@@ -24,7 +24,7 @@ class MoveMessageOperationsTest : RobolectricTest() {\n             folderId = SOURCE_FOLDER_ID,\n             uid = \"uid1\",\n             subject = \"Move me\",\n-            messageId = MESSAGE_ID_HEADER\n+            messageIdHeader = MESSAGE_ID_HEADER\n         )\n         val originalMessage = sqliteDatabase.readMessages().first()\n         val messageThreader = createMessageThreader(\n@@ -73,14 +73,14 @@ class MoveMessageOperationsTest : RobolectricTest() {\n             folderId = SOURCE_FOLDER_ID,\n             uid = \"uid1\",\n             subject = \"Move me\",\n-            messageId = MESSAGE_ID_HEADER,\n+            messageIdHeader = MESSAGE_ID_HEADER,\n             read = false\n         )\n         val originalMessage = sqliteDatabase.readMessages().first()\n         val placeholderMessageId = sqliteDatabase.createMessage(\n             empty = true,\n             folderId = DESTINATION_FOLDER_ID,\n-            messageId = MESSAGE_ID_HEADER,\n+            messageIdHeader = MESSAGE_ID_HEADER,\n             uid = \"\"\n         )\n         val messageThreader = createMessageThreader(\n@@ -123,6 +123,54 @@ class MoveMessageOperationsTest : RobolectricTest() {\n         )\n     }\n \n+    @Test\n+    fun `move message not containing a message-id header`() {\n+        val originalMessageId = sqliteDatabase.createMessage(\n+            folderId = SOURCE_FOLDER_ID,\n+            uid = \"uid1\",\n+            subject = \"Move me\",\n+            messageIdHeader = null\n+        )\n+        val originalMessage = sqliteDatabase.readMessages().first()\n+        val messageThreader = createMessageThreader(\n+            ThreadInfo(\n+                threadId = null,\n+                messageId = null,\n+                messageIdHeader = null,\n+                rootId = null,\n+                parentId = null\n+            )\n+        )\n+        val moveMessageOperations = MoveMessageOperations(lockableDatabase, messageThreader)\n+\n+        val destinationMessageId = moveMessageOperations.moveMessage(\n+            messageId = originalMessageId,\n+            destinationFolderId = DESTINATION_FOLDER_ID\n+        )\n+\n+        val messages = sqliteDatabase.readMessages()\n+        assertThat(messages).hasSize(2)\n+\n+        val sourceMessage = messages.find { it.id == originalMessageId }\n+            ?: fail(\"Original message not found\")\n+        assertThat(sourceMessage.folderId).isEqualTo(SOURCE_FOLDER_ID)\n+        assertThat(sourceMessage.uid).isEqualTo(\"uid1\")\n+        assertPlaceholderEntry(sourceMessage)\n+\n+        val destinationMessage = messages.find { it.id == destinationMessageId }\n+            ?: fail(\"Destination message not found\")\n+        assertThat(destinationMessage.uid).startsWith(K9.LOCAL_UID_PREFIX)\n+        assertThat(destinationMessage).isEqualTo(\n+            originalMessage.copy(\n+                id = destinationMessageId,\n+                folderId = DESTINATION_FOLDER_ID,\n+                uid = destinationMessage.uid,\n+                deleted = 0,\n+                empty = 0\n+            )\n+        )\n+    }\n+\n     private fun createMessageThreader(threadInfo: ThreadInfo): ThreadMessageOperations {\n         return mock {\n             on { createOrUpdateParentThreadEntries(any(), anyLong(), anyLong()) } doReturn threadInfo\n", "changes": [{"file": "app/storage/src/main/java/com/fsck/k9/storage/messages/ThreadMessageOperations.kt", "module": "com.fsck.k9.storage.messages.ThreadMessageOperations", "range": [{"start": 88, "end": 89}]}, {"file": "app/storage/src/test/java/com/fsck/k9/storage/messages/MessageDatabaseHelpers.kt", "module": "com.fsck.k9.storage.messages.MessageDatabaseHelpers", "range": [{"start": 53, "end": 54}, {"start": 80, "end": 81}]}]}]}
{"url": "https://github.com/iSoron/uhabits/issues/296", "repo": {"url": "https://github.com/iSoron/uhabits", "name": "uhabits", "owner": "iSoron", "modules": ["com.android.colorpicker", "com.android.datetimepicker", "com.android.datetimepicker.date", "com.android.datetimepicker.time", "org.isoron.platform.gui", "org.isoron.platform.io", "org.isoron.platform.time", "org.isoron.platform.utils", "org.isoron.uhabits", "org.isoron.uhabits.acceptance", "org.isoron.uhabits.acceptance.steps", "org.isoron.uhabits.activities", "org.isoron.uhabits.activities.about", "org.isoron.uhabits.activities.common", "org.isoron.uhabits.activities.habits", "org.isoron.uhabits.activities.intro", "org.isoron.uhabits.activities.settings", "org.isoron.uhabits.automation", "org.isoron.uhabits.core", "org.isoron.uhabits.core.commands", "org.isoron.uhabits.core.database", "org.isoron.uhabits.core.io", "org.isoron.uhabits.core.models", "org.isoron.uhabits.core.preferences", "org.isoron.uhabits.core.reminders", "org.isoron.uhabits.core.tasks", "org.isoron.uhabits.core.test", "org.isoron.uhabits.core.ui", "org.isoron.uhabits.core.utils", "org.isoron.uhabits.database", "org.isoron.uhabits.inject", "org.isoron.uhabits.intents", "org.isoron.uhabits.io", "org.isoron.uhabits.notifications", "org.isoron.uhabits.performance", "org.isoron.uhabits.preferences", "org.isoron.uhabits.receivers", "org.isoron.uhabits.regression", "org.isoron.uhabits.tasks", "org.isoron.uhabits.utils", "org.isoron.uhabits.widgets", "org.isoron.uhabits.widgets.activities", "org.isoron.uhabits.widgets.views"]}, "issue": {"number": 296, "url": "https://github.com/iSoron/uhabits/issues/296", "state": "closed", "title": "Applications still crashes from time to time", "body": "Hello,\r\n\r\nThe version 1.7.1 of the application still crashes from time to time despite having been supposedly fixed.\r\n\r\nFor further information see https://github.com/iSoron/uhabits/issues/287 and the new bug report attached.\r\n\r\n[Bug Report - Loop Habit Tracker.txt](https://github.com/iSoron/uhabits/files/1026464/Bug.Report.-.Loop.Habit.Tracker.txt)\r\n", "logs": [{"name": "Bug Report - Loop Habit Tracker.txt", "url": "https://github.com/iSoron/uhabits/files/1026464/Bug.Report.-.Loop.Habit.Tracker.txt"}]}, "pull_request": [{"number": 893, "url": "https://github.com/iSoron/uhabits/pull/893", "diff_url": "https://github.com/iSoron/uhabits/pull/893.diff", "patch_url": "https://github.com/iSoron/uhabits/pull/893.patch", "title": "Bump appintro from 3.4.0 to 4.1.0", "content": "Bumps [appintro](https://github.com/PaoloRotolo/AppIntro) from 3.4.0 to 4.1.0.\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/PaoloRotolo/AppIntro/releases\">appintro's releases</a>.</em></p>\n<blockquote>\n<h2>AppIntro v4.1.0</h2>\n<h2>How to update</h2>\n<p>Add this to your <strong>build.gradle</strong>:</p>\n<pre lang=\"java\"><code>repositories {\n    mavenCentral()\n}\n<p>dependencies {\ncompile 'com.github.paolorotolo:appintro:4.1.0'\n}\n</code></pre></p>\n<h2>Changelog:</h2>\n<ul>\n<li>Long Description Support <a href=\"https://github.com/SandroMachado\"><code>@SandroMachado</code></a> <a href=\"https://github-redirect.dependabot.com/PaoloRotolo/AppIntro/issues/234\">#234</a></li>\n<li>Changes to Skip Button Visibility <a href=\"https://github.com/RafaG\"><code>@RafaG</code></a> <a href=\"https://github-redirect.dependabot.com/PaoloRotolo/AppIntro/issues/241\">#241</a></li>\n<li>Added Wizard Mode &amp; Custom Typeface Support <a href=\"https://github.com/ameykshirsagar\"><code>@ameykshirsagar</code></a> <a href=\"https://github-redirect.dependabot.com/PaoloRotolo/AppIntro/issues/267\">#267</a></li>\n<li>Improve compatibility with Vector Drawables <a href=\"https://github.com/xsorifc28\"><code>@xsorifc28</code></a> <a href=\"https://github-redirect.dependabot.com/PaoloRotolo/AppIntro/issues/271\">#271</a> &amp; <a href=\"https://github.com/K0bin\"><code>@K0bin</code></a> <a href=\"https://github-redirect.dependabot.com/PaoloRotolo/AppIntro/issues/296\">#296</a></li>\n<li>Add German Translations <a href=\"https://github.com/K0bin\"><code>@K0bin</code></a> <a href=\"https://github-redirect.dependabot.com/PaoloRotolo/AppIntro/issues/291\">#291</a></li>\n<li>Add Spanish Translations <a href=\"https://github.com/voghDev\"><code>@voghDev</code></a> <a href=\"https://github-redirect.dependabot.com/PaoloRotolo/AppIntro/issues/292\">#292</a></li>\n<li>Documentation updates <a href=\"https://github.com/maxee\"><code>@maxee</code></a> <a href=\"https://github-redirect.dependabot.com/PaoloRotolo/AppIntro/issues/302\">#302</a></li>\n</ul>\n<h2>AppIntro 4.0.0</h2>\n<h2>How to update</h2>\n<p>Add this to your <strong>build.gradle</strong>:</p>\n<pre lang=\"java\"><code>repositories {\n    mavenCentral()\n}\n<p>dependencies {\ncompile 'com.github.paolorotolo:appintro:4.0.0'\n}\n</code></pre></p>\n<h2>Changelog:</h2>\n<ul>\n<li><strong>Users can now override onCreate();</strong></li>\n<li>New method: setNextArrowColor() [<a href=\"https://github.com/championswimmer\"><code>@championswimmer</code></a>];</li>\n<li>Implemented basic support to restore fragments (e.g. on orientation change) [<a href=\"https://github.com/maxee\"><code>@maxee</code></a>];</li>\n<li>Implemented support for immersive mode [<a href=\"https://github.com/maxee\"><code>@maxee</code></a>];</li>\n<li>Implemented extended slide policy [<a href=\"https://github.com/maxee\"><code>@maxee</code></a>];</li>\n<li>New skip button for DefaultIntro2 [<a href=\"https://github.com/timobaehr\"><code>@timobaehr</code></a>];</li>\n<li>Bug fixes and improvements;</li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li>See full diff in <a href=\"https://github.com/PaoloRotolo/AppIntro/commits/v4.1.0\">compare view</a></li>\n</ul>\n</details>\n<br />\n\n\n[![Dependabot compatibility score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=com.github.paolorotolo:appintro&package-manager=gradle&previous-version=3.4.0&new-version=4.1.0)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[//]: # (dependabot-automerge-start)\n[//]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options</summary>\n<br />\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\n\n\n</details>", "diff": "diff --git a/uhabits-android/build.gradle.kts b/uhabits-android/build.gradle.kts\nindex 72388c2fd..6c92015ac 100644\n--- a/uhabits-android/build.gradle.kts\n+++ b/uhabits-android/build.gradle.kts\n@@ -75,7 +75,7 @@ android {\n \n dependencies {\n     val daggerVersion = \"2.34.1\"\n-    val kotlinVersion = \"1.4.32\"\n+    val kotlinVersion = \"1.5.0\"\n     val kxCoroutinesVersion = \"1.4.2\"\n     val ktorVersion = \"1.5.3\"\n     val espressoVersion = \"3.3.0\"\n@@ -93,7 +93,7 @@ dependencies {\n     androidTestImplementation(\"com.nhaarman.mockitokotlin2:mockito-kotlin:2.2.0\")\n     compileOnly(\"javax.annotation:jsr250-api:1.0\")\n     coreLibraryDesugaring(\"com.android.tools:desugar_jdk_libs:1.1.5\")\n-    implementation(\"com.github.paolorotolo:appintro:3.4.0\")\n+    implementation(\"com.github.paolorotolo:appintro:4.1.0\")\n     implementation(\"com.google.code.findbugs:jsr305:3.0.2\")\n     implementation(\"com.google.dagger:dagger:$daggerVersion\")\n     implementation(\"com.google.guava:guava:30.1.1-android\")\n", "changes": [{"file": "uhabits-android/build.gradle.kts", "module": "uhabits-android.build.gradle.kts", "range": [{"start": 78, "end": 79}, {"start": 96, "end": 97}]}]}]}
{"url": "https://github.com/aniyomiorg/aniyomi/issues/1930", "repo": {"url": "https://github.com/aniyomiorg/aniyomi", "name": "aniyomi", "owner": "aniyomiorg", "modules": ["aniyomi.domain.anime", "aniyomi.util", "eu.kanade.core", "eu.kanade.domain", "eu.kanade.presentation", "eu.kanade.tachiyomi", "eu.kanade.test", "mihon.buildlogic", "mihon.buildlogic.tasks", "mihon.core.archive", "mihon.core.designsystem", "mihon.core.migration", "mihon.data.repository", "mihon.domain.extensionrepo", "mihon.domain.items", "mihon.domain.upcoming", "mihon.feature.upcoming", "mihon.presentation.core", "tachiyomi.core.common", "tachiyomi.core.metadata", "tachiyomi.data", "tachiyomi.data.category", "tachiyomi.data.custombutton", "tachiyomi.data.entries", "tachiyomi.data.handlers", "tachiyomi.data.history", "tachiyomi.data.items", "tachiyomi.data.release", "tachiyomi.data.source", "tachiyomi.data.track", "tachiyomi.data.updates", "tachiyomi.domain.backup", "tachiyomi.domain.category", "tachiyomi.domain.custombuttons", "tachiyomi.domain.download", "tachiyomi.domain.entries", "tachiyomi.domain.history", "tachiyomi.domain.items", "tachiyomi.domain.library", "tachiyomi.domain.release", "tachiyomi.domain.source", "tachiyomi.domain.storage", "tachiyomi.domain.track", "tachiyomi.domain.updates", "tachiyomi.macrobenchmark", "tachiyomi.presentation.core", "tachiyomi.presentation.widget", "tachiyomi.source.local"]}, "issue": {"number": 1930, "url": "https://github.com/aniyomiorg/aniyomi/issues/1930", "state": "closed", "title": "Trying to download but it keeps saying it could not find the item in the sd card or internal storage and restarts over and over in the anime, the manga download is fine though", "body": "### Steps to reproduce\n\nI try to download an anime, but it just says it cant find it after in 18% or so, and no its not internet issues, it says it cant find it in the storage(probably. Im not the smartest tool in the shed), ive put the crahslog.txt in here and i do not know if aniyomi adds sensitive data there or not\n\n### Expected behavior\n\nI expect it to download and not restart randomly\n\n### Actual behavior\n\nIt downloads to a few % like 18% and it says it cant find it for some reason saying \"Downloaded file not found, retrying..\"\n\n### Crash logs\n\n[aniyomi_crash_logs.txt](https://github.com/user-attachments/files/18723254/aniyomi_crash_logs.txt)\n\n### Aniyomi version\n\nApp version: 0.16.4.3 (standard, 959f84a, 124, 2024-07-01T22:25Z) Android version: 9 (SDK 28; build PPR1.180610.011.T395JXSDCUJ1) Android build ID: PPR1.180610.011.T395JXSDCUJ1 Device brand: samsung Device manufacturer: samsung Device name: gtactive2lte (gtactive2ltexx) Device model: SM-T395 WebView: Chrome 132.0.6834.163 MPV version: 4d32db2 Libplacebo version: v7.349.0 FFmpeg version: n7.0\n\n### Android version\n\nAndroid 9 (Pie)\n\n### Device\n\nSamsung Galaxy Tab active 2\n\n### Other details\n\n_No response_\n\n### Acknowledgements\n\n- [x] I have searched the existing issues and this is a new ticket, **NOT** a duplicate or related to another open or closed issue.\n- [x] I have written a short but informative title.\n- [x] If this is an issue with an extension, I should be opening an issue in the extension's repository.\n- [x] I have gone through the [FAQ](https://aniyomi.org/docs/faq/general) and [troubleshooting guide](https://aniyomi.org/docs/guides/troubleshooting/).\n- [x] I have updated the app to version **[0.16.4.3](https://github.com/aniyomiorg/aniyomi/releases/latest)**.\n- [x] I have updated all installed extensions.\n- [x] I will fill out all of the requested information in this form.", "logs": [{"name": "aniyomi_crash_logs.txt", "url": "https://github.com/user-attachments/files/18723254/aniyomi_crash_logs.txt"}]}, "pull_request": [{"number": 1964, "url": "https://github.com/aniyomiorg/aniyomi/pull/1964", "diff_url": "https://github.com/aniyomiorg/aniyomi/pull/1964.diff", "patch_url": "https://github.com/aniyomiorg/aniyomi/pull/1964.patch", "title": "Fix some downloader issues", "content": "Fix some downloader issues:\r\n  * Fix videos being deleted upon completion\r\n  * Fix Audio tracks not being added\r\n  * Fix subtitle & audio tracks not being added for some videos\r\n  * Fix headers not being applied to audio & subtitle tracks\r\n  * Fix not being able to find downloaded due to file extension mismatch\r\n  * Fix ffmpeg failing for some videos due to faulty options\r\n  * Adds proper logging to diagnose any downloader issues\r\n \r\nPotential TODOs:\r\n  * Use async execution of ffmpeg\r\n  * Don't pause/resume all downloads on reorder/cancellation, since ffmpeg doesn't support pausing/resuming\r\n\r\nCloses #1068\r\nCloses #1544\r\nCloses #1547\r\nCloses #1781\r\nCloses #1872\r\nCloses #1930\r\n(May or may not fix all the issues above, but if not they can create a new issue which will now have better logs)", "diff": "diff --git a/app/src/main/java/eu/kanade/presentation/more/settings/screen/SettingsDownloadScreen.kt b/app/src/main/java/eu/kanade/presentation/more/settings/screen/SettingsDownloadScreen.kt\nindex 9f18e214e2..6d8d236d07 100644\n--- a/app/src/main/java/eu/kanade/presentation/more/settings/screen/SettingsDownloadScreen.kt\n+++ b/app/src/main/java/eu/kanade/presentation/more/settings/screen/SettingsDownloadScreen.kt\n@@ -74,24 +74,11 @@ object SettingsDownloadScreen : SearchableSettings {\n                 },\n             )\n         }\n-        val safeDownload by downloadPreferences.safeDownload().collectAsState()\n         return listOf(\n             Preference.PreferenceItem.SwitchPreference(\n                 pref = downloadPreferences.downloadOnlyOverWifi(),\n                 title = stringResource(MR.strings.connected_to_wifi),\n             ),\n-            Preference.PreferenceItem.SwitchPreference(\n-                pref = downloadPreferences.safeDownload(),\n-                title = stringResource(MR.strings.safe_download),\n-                subtitle = stringResource(MR.strings.safe_download_summary),\n-            ),\n-            Preference.PreferenceItem.ListPreference(\n-                pref = downloadPreferences.numberOfThreads(),\n-                title = stringResource(MR.strings.download_threads_number),\n-                subtitle = stringResource(MR.strings.download_threads_number_summary),\n-                entries = (1..64).associateWith { it.toString() }.toImmutableMap(),\n-                enabled = !safeDownload,\n-            ),\n             Preference.PreferenceItem.TextPreference(\n                 title = stringResource(MR.strings.download_speed_limit),\n                 subtitle = if (speedLimit == 0) {\ndiff --git a/app/src/main/java/eu/kanade/tachiyomi/data/download/anime/AnimeDownloader.kt b/app/src/main/java/eu/kanade/tachiyomi/data/download/anime/AnimeDownloader.kt\nindex bbb3891830..c35b7f16db 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/data/download/anime/AnimeDownloader.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/data/download/anime/AnimeDownloader.kt\n@@ -10,18 +10,17 @@ import com.arthenica.ffmpegkit.FFmpegSession\n import com.arthenica.ffmpegkit.FFprobeSession\n import com.arthenica.ffmpegkit.Level\n import com.arthenica.ffmpegkit.LogCallback\n+import com.arthenica.ffmpegkit.ReturnCode\n import com.arthenica.ffmpegkit.SessionState\n import com.hippo.unifile.UniFile\n import eu.kanade.domain.items.episode.model.toSEpisode\n import eu.kanade.tachiyomi.animesource.UnmeteredSource\n+import eu.kanade.tachiyomi.animesource.model.Track\n import eu.kanade.tachiyomi.animesource.model.Video\n import eu.kanade.tachiyomi.animesource.online.AnimeHttpSource\n import eu.kanade.tachiyomi.data.download.anime.model.AnimeDownload\n-import eu.kanade.tachiyomi.data.download.anime.model.AnimeDownloadPart\n import eu.kanade.tachiyomi.data.library.anime.AnimeLibraryUpdateNotifier\n import eu.kanade.tachiyomi.data.notification.NotificationHandler\n-import eu.kanade.tachiyomi.network.ProgressListener\n-import eu.kanade.tachiyomi.util.size\n import eu.kanade.tachiyomi.util.storage.DiskUtil\n import eu.kanade.tachiyomi.util.storage.toFFmpegString\n import eu.kanade.tachiyomi.util.system.copyToClipboard\n@@ -44,11 +43,6 @@ import kotlinx.coroutines.isActive\n import kotlinx.coroutines.launch\n import kotlinx.coroutines.supervisorScope\n import logcat.LogPriority\n-import okhttp3.HttpUrl.Companion.toHttpUrl\n-import okhttp3.Response\n-import okio.Throttler\n-import okio.buffer\n-import okio.sink\n import tachiyomi.core.common.i18n.stringResource\n import tachiyomi.core.common.storage.extension\n import tachiyomi.core.common.util.lang.launchIO\n@@ -61,7 +55,6 @@ import tachiyomi.i18n.MR\n import uy.kohesive.injekt.Injekt\n import uy.kohesive.injekt.api.get\n import uy.kohesive.injekt.injectLazy\n-import java.util.Locale\n import kotlin.coroutines.cancellation.CancellationException\n import kotlin.coroutines.coroutineContext\n \n@@ -96,11 +89,6 @@ class AnimeDownloader(\n      */\n     private val notifier by lazy { AnimeDownloadNotifier(context) }\n \n-    /**\n-     * The throttler used to control the download speed.\n-     */\n-    private val throttler = Throttler()\n-\n     /**\n      * Coroutine scope used for download job scheduling\n      */\n@@ -370,6 +358,7 @@ class AnimeDownloader(\n                     val fetchedVideo = download.source.getVideoList(download.episode.toSEpisode()).first()\n                     download.video = fetchedVideo\n                 } catch (e: Exception) {\n+                    logcat(LogPriority.ERROR, e)\n                     throw Exception(context.stringResource(MR.strings.video_list_empty_error))\n                 }\n             }\n@@ -404,8 +393,11 @@ class AnimeDownloader(\n         // Get filename from download info\n         val filename = DiskUtil.buildValidFilename(download.episode.name)\n \n-        // Get VideoFile if existing\n-        val videoFile = tmpDir.listFiles()?.firstOrNull { it.name!!.startsWith(\"$filename.mp4\") }\n+        // Delete temp file if it exists\n+        tmpDir.findFile(\"$filename.tmp\")?.delete()\n+\n+        // Try to find the video file\n+        val videoFile = tmpDir.listFiles()?.firstOrNull { it.name!!.startsWith(\"$filename.mkv\") }\n \n         try {\n             // If the video is already downloaded, do nothing. Otherwise download from network\n@@ -426,7 +418,7 @@ class AnimeDownloader(\n                             }\n                         }\n \n-                        attemptDownload(download, tmpDir, filename, preferences.safeDownload().get())\n+                        downloadVideo(download, tmpDir, filename)\n                     } else {\n                         val betterFileName = DiskUtil.buildValidFilename(\n                             \"${download.anime.title} - ${download.episode.name}\",\n@@ -442,8 +434,11 @@ class AnimeDownloader(\n             progressJob?.cancel()\n         } catch (e: Exception) {\n             video.status = Video.State.ERROR\n+            notifier.onError(e.message, download.episode.name, download.anime.title, download.anime.id)\n             progressJob?.cancel()\n \n+            logcat(LogPriority.ERROR, e)\n+\n             throw e\n         }\n \n@@ -456,39 +451,19 @@ class AnimeDownloader(\n      * @param download the download reference\n      * @param tmpDir the directory where placing the file\n      * @param filename the name to give to download file\n-     * @param safe whether to use safe mode for each try\n      */\n-    private suspend fun attemptDownload(\n+    private suspend fun downloadVideo(\n         download: AnimeDownload,\n         tmpDir: UniFile,\n         filename: String,\n-        safe: Boolean,\n     ): UniFile {\n-        // If we attempt always in safe mode then initial threads count is 1\n-        val threads = if (safe) {\n-            1\n-        } else {\n-            preferences.numberOfThreads().get()\n-        }\n-\n         var file: UniFile? = null\n \n         val downloadScope = CoroutineScope(coroutineContext)\n-\n         for (tries in 1..3) {\n-            // At each try we reduce the number of thread used (this is due to the fact that sometimes\n-            // download fails because there are too many threads for limited max download speed\n-            // we then ensures that we have at least one thread\n-            var newThreads = threads.floorDiv(tries)\n-            if (newThreads < 1) newThreads = 1\n-\n             if (downloadScope.isActive) {\n                 file = try {\n-                    if (isHls(download.video!!) || isMpd(download.video!!)) {\n-                        ffmpegDownload(download, tmpDir, filename)\n-                    } else {\n-                        httpDownload(download, tmpDir, filename, newThreads, safe)\n-                    }\n+                    ffmpegDownload(download, tmpDir, filename)\n                 } catch (e: Exception) {\n                     notifier.onError(\n                         e.message + \", retrying..\",\n@@ -500,37 +475,17 @@ class AnimeDownloader(\n                     null\n                 }\n             }\n-\n             // If download has been completed successfully we break from retry loop\n             if (file != null) break\n         }\n \n-        // If download has completed successfully we return the file,\n-        // otherwise we attempt a final try forcing safe mode\n         return if (downloadScope.isActive) {\n-            file ?: try {\n-                if (isHls(download.video!!) || isMpd(download.video!!)) {\n-                    ffmpegDownload(download, tmpDir, filename)\n-                } else {\n-                    httpDownload(download, tmpDir, filename, 1, true)\n-                }\n-            } catch (e: Exception) {\n-                notifier.onError(e.message, download.episode.name, download.anime.title, download.anime.id)\n-                throw e\n-            }\n+            file ?: throw Exception(\"Downloaded file not found\")\n         } else {\n             throw Exception(\"Download has been stopped\")\n         }\n     }\n \n-    private fun isMpd(video: Video): Boolean {\n-        return video.videoUrl?.toHttpUrl()?.encodedPath?.endsWith(\".mpd\") ?: false\n-    }\n-\n-    private fun isHls(video: Video): Boolean {\n-        return video.videoUrl?.toHttpUrl()?.encodedPath?.endsWith(\".m3u8\") ?: false\n-    }\n-\n     // ffmpeg is always on safe mode\n     private fun ffmpegDownload(\n         download: AnimeDownload,\n@@ -555,7 +510,7 @@ class AnimeDownloader(\n         val ffmpegOptions = getFFmpegOptions(video, headerOptions, ffmpegFilename())\n         val ffprobeCommand = { file: String, ffprobeHeaders: String? ->\n             FFmpegKitConfig.parseArguments(\n-                \"${ffprobeHeaders?.plus(\" \") ?: \"\"}-v error -show_entries \" +\n+                \"${ffprobeHeaders?.plus(\" \") ?: \"\"}-v quiet -show_entries \" +\n                     \"format=duration -of default=noprint_wrappers=1:nokey=1 \\\"$file\\\"\",\n             )\n         }\n@@ -568,7 +523,11 @@ class AnimeDownloader(\n                 parseDuration(log.message)?.let { duration = it }\n                 nextLineIsDuration = false\n             }\n-            if (log.level <= Level.AV_LOG_WARNING) log.message?.let { logcat { it } }\n+            if (log.level <= Level.AV_LOG_WARNING) {\n+                log.message?.let {\n+                    logcat(LogPriority.ERROR) { it }\n+                }\n+            }\n             if (duration != 0L && log.message.startsWith(\"frame=\")) {\n                 val outTime = log.message\n                     .substringAfter(\"time=\", \"\")\n@@ -582,25 +541,24 @@ class AnimeDownloader(\n         val inputDuration = getDuration(ffprobeCommand(video.videoUrl!!, headerOptions)) ?: 0F\n \n         duration = inputDuration.toLong()\n-        FFmpegKitConfig.ffmpegExecute(session)\n \n-        val outputDuration = getDuration(ffprobeCommand(ffmpegFilename(), null)) ?: 0F\n-        // allow for slight errors\n-        if (inputDuration > outputDuration * 1.01F) {\n-            tmpDir.findFile(\"$filename.tmp\")?.delete()\n+        if (!isFFmpegRunning) {\n+            throw Exception(\"ffmpeg was cancelled\")\n         }\n+        FFmpegKitConfig.ffmpegExecute(session)\n \n-        session.failStackTrace?.let { trace ->\n-            logcat(LogPriority.ERROR) { trace }\n-            throw Exception(\"Error in ffmpeg!\")\n-        }\n+        return if (ReturnCode.isSuccess(session.returnCode)) {\n+            val file = tmpDir.findFile(\"$filename.tmp\")?.apply {\n+                renameTo(\"$filename.mkv\")\n+            }\n \n-        val file = tmpDir.findFile(\"$filename.tmp\")?.apply {\n-            renameTo(\"$filename.mkv\")\n+            file ?: throw Exception(\"Downloaded file not found\")\n+        } else {\n+            session.failStackTrace?.let { trace ->\n+                logcat(LogPriority.ERROR) { trace }\n+            }\n+            throw Exception(\"Error in ffmpeg!\")\n         }\n-\n-        file ?: throw Exception(\"Downloaded file not found\")\n-        return file\n     }\n \n     private fun parseTimeStringToSeconds(timeString: String): Long? {\n@@ -618,33 +576,44 @@ class AnimeDownloader(\n             val milliseconds = secondsAndMilliseconds[1].toInt()\n \n             (hours * 3600 + minutes * 60 + seconds + milliseconds / 100.0).toLong()\n-        } catch (e: NumberFormatException) {\n+        } catch (_: NumberFormatException) {\n             // Invalid number format\n             null\n         }\n     }\n \n     private fun getFFmpegOptions(video: Video, headerOptions: String, ffmpegFilename: String): Array<String> {\n-        val subtitleInputs = video.subtitleTracks.joinToString(\" \", postfix = \" \") {\n-            \"-i \\\"${it.url}\\\"\"\n+        fun formatInputs(tracks: List<Track>) = tracks.joinToString(\" \", postfix = \" \") {\n+            \"$headerOptions -i \\\"${it.url}\\\"\"\n         }\n-        val subtitleMaps = video.subtitleTracks.indices.joinToString(\" \") {\n-            val index = it + 1\n-            \"-map $index:s\"\n+\n+        fun formatMaps(tracks: List<Track>, type: String, offset: Int = 0) = tracks.indices.joinToString(\" \") {\n+            \"-map ${it + 1 + offset}:$type\"\n         }\n-        val subtitleMetadata = video.subtitleTracks.mapIndexed { i, sub ->\n-            \"-metadata:s:s:$i \\\"title=${sub.lang}\\\"\"\n+\n+        fun formatMetadata(tracks: List<Track>, type: String) = tracks.mapIndexed { i, track ->\n+            \"-metadata:s:$type:$i \\\"title=${track.lang}\\\"\"\n         }.joinToString(\" \")\n \n-        Locale(\"\")\n-        return FFmpegKitConfig.parseArguments(\n-            headerOptions +\n-                \" -i \\\"${video.videoUrl}\\\" \" + subtitleInputs +\n-                \"-map 0:v -map 0:a \" + subtitleMaps + \" -map 0:s?\" +\n-                \" -f matroska -c:a copy -c:v copy -c:s ass \" +\n-                subtitleMetadata +\n-                \" \\\"$ffmpegFilename\\\" -y\",\n+        val subtitleInputs = formatInputs(video.subtitleTracks)\n+        val subtitleMaps = formatMaps(video.subtitleTracks, \"s\")\n+        val subtitleMetadata = formatMetadata(video.subtitleTracks, \"s\")\n+\n+        val audioInputs = formatInputs(video.audioTracks)\n+        val audioMaps = formatMaps(video.audioTracks, \"a\", video.subtitleTracks.size)\n+        val audioMetadata = formatMetadata(video.audioTracks, \"a\")\n+\n+        val command = listOf(\n+            headerOptions, \"-i \\\"${video.videoUrl}\\\"\", subtitleInputs, audioInputs,\n+            \"-map 0:v\", audioMaps, \"-map 0:a?\", subtitleMaps, \"-map 0:s? -map 0:t?\",\n+            \"-f matroska -c:a copy -c:v copy -c:s copy\",\n+            subtitleMetadata, audioMetadata,\n+            \"\\\"$ffmpegFilename\\\" -y\",\n         )\n+            .filter(String::isNotBlank)\n+            .joinToString(\" \")\n+\n+        return FFmpegKitConfig.parseArguments(command)\n     }\n \n     private fun getDuration(ffprobeCommand: Array<String>): Float? {\n@@ -670,485 +639,6 @@ class AnimeDownloader(\n         return hours * 3600000L + minutes * 60000L + fullSeconds * 1000L + hundredths * 10L\n     }\n \n-    /**\n-     * Routine for download a file using http requests.\n-     *\n-     * @param download the download reference\n-     * @param tmpDir the directory where to place the downloaded file\n-     * @param filename the name to give to video file\n-     * @param threadNumber max number of parallel request\n-     * @param safeDownload whether to use safe download mode\n-     */\n-    private suspend fun httpDownload(\n-        download: AnimeDownload,\n-        tmpDir: UniFile,\n-        filename: String,\n-        threadNumber: Int,\n-        safeDownload: Boolean,\n-    ): UniFile {\n-        val downloadScope = CoroutineScope(coroutineContext)\n-        val video = download.video!!\n-\n-        // reset bytesDownloaded and totalBytesDownloaded\n-        download.resetProgress()\n-\n-        if (safeDownload) {\n-            tmpDir.listFiles().orEmpty()\n-                .filter {\n-                    if (it.name == null) {\n-                        false\n-                    } else {\n-                        it.name!!.endsWith(\"part.tmp\")\n-                    }\n-                }\n-                .forEach { it.delete() }\n-        }\n-\n-        val downloadParts = mutableListOf<AnimeDownloadPart>()\n-\n-        // on safe mode only one range is requested\n-        if (safeDownload) {\n-            val range = Pair(0L, 0L)\n-            val part = AnimeDownloadPart(tmpDir, range)\n-            part.listener =\n-                object : ProgressListener {\n-                    override fun update(bytesRead: Long, contentLength: Long, done: Boolean) {\n-                        download.update(bytesRead, contentLength, false)\n-                    }\n-                }\n-            part.request = download.source.safeVideoRequest(video)\n-            part.file = tmpDir.createFile(\"0.part.tmp\")!!\n-            part.completed = false\n-            downloadParts.add(part)\n-\n-            // on safe mode the tmp file has been deleted, so when content length will be updated\n-            // it will be the set to the effective video size\n-            download.bytesDownloaded = 0L\n-            download.totalContentLength = 0\n-        } else {\n-            // otherwise we get all needed ranges\n-\n-            // first we fetch the size of the video\n-            val videoSize: Long = download.source.getVideoSize(video, 3)\n-            if (videoSize == -1L) {\n-                throw Exception(\"Could not get video size\")\n-            }\n-\n-            // on normal mode, since the download can resume from tmp file, the download length can be different\n-            // from the effective video size. To prevent strange behaviours on progress update we manually set the\n-            // download total length as the known video file size, in this way any other update will always skip\n-            // the total length update since it will always be <= than the video file size\n-            download.totalContentLength = videoSize\n-\n-            // Get all download parts (completed and not-completed) sorted on increasing start byte value\n-            downloadParts.addAll(\n-                getDownloadParts(\n-                    download,\n-                    video,\n-                    tmpDir,\n-                    threadNumber,\n-                    videoSize,\n-                ).sortedBy { it.range.first },\n-            )\n-        }\n-\n-        // set throttler max bound\n-        throttler.apply {\n-            bytesPerSecond(preferences.downloadSpeedLimit().get().toLong() * 1024)\n-        }\n-\n-        // set download as not failed and not stopped\n-        var failedDownload = false\n-\n-        // support object for job management and progress funneling\n-        val partProgressLock = Object()\n-        var partProgress = -1\n-\n-        // do an initial update\n-        download.update(download.bytesDownloaded, download.totalContentLength, false)\n-\n-        val mergeWaiter = Object()\n-\n-        for (i in 1..threadNumber) {\n-            downloadScope.launchIO {\n-                var index: Int\n-                while (true) {\n-                    synchronized(partProgressLock) {\n-                        partProgress += 1\n-                        index = partProgress\n-                    }\n-                    if (index < downloadParts.size) {\n-                        // If failed before even starting, then just return\n-                        if (failedDownload || !isActive) return@launchIO\n-\n-                        val part = downloadParts[index]\n-                        var response: Response? = null\n-                        // try to open the file and append the bytes\n-                        try {\n-                            if (!part.completed) {\n-                                response = download.source.getVideo(part.request!!, part.listener!!)\n-\n-                                response.body.source()\n-                                    .use { source ->\n-                                        part.file\n-                                            .openOutputStream(true)\n-                                            .use { output ->\n-                                                val sink = output.sink().buffer()\n-                                                val buffer = ByteArray(4 * 1024)\n-                                                var bytesRead: Int\n-                                                val throttledSource = throttler.source(source).buffer()\n-\n-                                                // part file downloading loop\n-                                                while (throttledSource.read(buffer).also { bytesRead = it }\n-                                                        .toLong() != -1L\n-                                                ) {\n-                                                    // If job has been asked to close then set the download as failed and collaborate\n-                                                    // on closing (as job closure ask to do)\n-                                                    if (!isActive) {\n-                                                        break\n-                                                    }\n-\n-                                                    // Write the bytes to the file\n-                                                    sink.write(buffer, 0, bytesRead)\n-                                                    sink.emitCompleteSegments()\n-                                                    download.bytesDownloaded = bytesRead.toLong()\n-                                                }\n-                                                sink.flush()\n-                                                sink.close()\n-                                                throttledSource.close()\n-                                            }\n-                                    }\n-                                part.completed = true\n-                            }\n-                        } catch (e: Exception) {\n-                            response?.close()\n-                            failedDownload = true\n-                        } finally {\n-                            synchronized(mergeWaiter) {\n-                                mergeWaiter.notifyAll()\n-                            }\n-                        }\n-                    } else {\n-                        break\n-                    }\n-                }\n-            }\n-        }\n-\n-        var baseFile: UniFile? = null\n-\n-        // scan for jobs following starting bytes order\n-        for (part in downloadParts) {\n-            // await for job to be completed (download of part has finished\n-            // should we really stop if download scope is not active? I think we should merge at least the next part\n-            synchronized(mergeWaiter) {\n-                while (!part.completed && downloadScope.isActive && !failedDownload) {\n-                    mergeWaiter.wait()\n-                }\n-            }\n-\n-            // If some of part download has failed, then throw exception\n-            if (failedDownload || !downloadScope.isActive) {\n-                throw Exception(\"Download failed\")\n-            } else {\n-                // otherwise transfer part into general tmp file\n-\n-                baseFile = if (baseFile == null) {\n-                    part.file\n-                } else {\n-                    try {\n-                        mergeFile(baseFile, part.file)\n-                    } catch (e: Exception) {\n-                        throw Exception(\"Cannot merge tmp part file\")\n-                    }\n-                }\n-            }\n-        }\n-\n-        // do a final update, to ensure that the progress is 100%\n-        download.update(download.totalContentLength, download.totalContentLength, true)\n-\n-        return if (downloadScope.isActive) {\n-            if (baseFile != null) {\n-                baseFile.renameTo(\"$filename.mp4\")\n-                baseFile\n-            } else {\n-                throw Exception(\"Base file not found\")\n-            }\n-        } else {\n-            throw Exception(\"Download stopped\")\n-        }\n-    }\n-\n-    /**\n-     * Retrieve part files placed into given directory, deletes all other files\n-     * A file is considered part file if his name is formatted as x.part.file where x is a Long\n-     *\n-     * @param tmpDir the root dir\n-     * @return a list of well formatted part file placed into given dir\n-     */\n-    private fun cleanAndGetPartFile(tmpDir: UniFile): List<UniFile> {\n-        // Filter file on extension and name formatting as Long\n-        val files = tmpDir.listFiles().orEmpty().filter {\n-            // If name is null also delete them\n-            if (it.name == null) {\n-                it.delete()\n-                false\n-            } else {\n-                // If extension is not .part.tmp also delete it\n-                if (!it.name!!.endsWith(\".part.tmp\")) {\n-                    it.delete()\n-                    false\n-                } else {\n-                    try {\n-                        it.name!!.substringBefore(\".\").toLong()\n-                        // If size of the file is 0 also delete it\n-                        if (it.size() == 0L) {\n-                            it.delete()\n-                            false\n-                        } else {\n-                            true\n-                        }\n-                    } catch (e: Exception) {\n-                        // If name is not formatted as Long throws an error, delete it in the case\n-                        it.delete()\n-                        false\n-                    }\n-                }\n-            }\n-        }\n-\n-        return files\n-    }\n-\n-    /**\n-     * Given a list of part files (their name must be composed by x.extension, where x is a Long),\n-     * return a list of pair that associates each file to the download range that it covers\n-     *\n-     * @param files list of part file, correctly formatted (x.extension, x = Long)\n-     * @return a list of pair associating file to a download range\n-     */\n-    private fun getRangesAndFiles(files: List<UniFile>): List<Pair<Pair<Long, Long>, UniFile>> {\n-        val result = mutableListOf<Pair<Pair<Long, Long>, UniFile>>()\n-\n-        files.forEach {\n-            val startByte = it.name!!.substringBefore(\".\").toLong()\n-            val endByte = startByte + it.size() - 1\n-            result.add(Pair(Pair(startByte, endByte), it))\n-        }\n-\n-        return result.toList()\n-    }\n-\n-    /**\n-     * Merge download parts in order to reduce the total number of file used then in the downloader\n-     * Two successive parts are merged if the previous is completed and the following not\n-     */\n-    private fun mergeSuccessiveParts(parts: List<AnimeDownloadPart>): List<AnimeDownloadPart> {\n-        val result = mutableListOf<AnimeDownloadPart>()\n-\n-        var i = 0\n-        val sortedParts = parts.sortedBy { it.range.first }\n-\n-        // -1 since the last one has no successive to merge\n-        while (i < sortedParts.size - 1) {\n-            val part = sortedParts[i]\n-            result.add(part)\n-            if (part.completed && !sortedParts[i + 1].completed) {\n-                part.completed = false // not completed anymore\n-                part.range = sortedParts[i].range.copy(second = sortedParts[i + 1].range.second) // extends range\n-                part.request = sortedParts[i + 1].request // Assumes that not completed parts have at least a Request\n-                part.listener = sortedParts[i + 1].listener // same for listener\n-                i += 1 // skip the merged part\n-            }\n-            i += 1\n-        }\n-        // if the last one has not been merged then add it\n-        if (i < sortedParts.size) {\n-            result.add(sortedParts[i])\n-        }\n-\n-        return result.toList()\n-    }\n-\n-    /**\n-     * Check if two subsequent download ranges are touching each other,\n-     * in that case merge the two ranges and the corresponding files\n-     *\n-     * @param parts not merged nor sorted list of download ranges\n-     * @return a merged, not sorted, list of download ranges\n-     */\n-    private fun mergeSuccessiveFiles(\n-        parts: List<Pair<Pair<Long, Long>, UniFile>>,\n-    ): List<Pair<Pair<Long, Long>, UniFile>> {\n-        val newRanges = mutableListOf<Pair<Pair<Long, Long>, UniFile>>()\n-\n-        // support variable that is used to merge multiple ranges\n-        var tempRange: Pair<Pair<Long, Long>, UniFile>? = null\n-\n-        // sort range on ascending order, then for each one...\n-        parts.sortedBy { it.first.first }.forEach {\n-            tempRange = if (tempRange == null) {\n-                // If a temp range has not already been assigned then assign it\n-                it\n-            } else if (tempRange!!.first.second != it.first.first - 1) {\n-                // If the current range isn't touched by the temp one then add the previous to the final\n-                // list and set the current as the temp range\n-                newRanges.add(tempRange!!)\n-                it\n-            } else {\n-                // If the current range touches the temp one then merge them and assign the result to the temp\n-                Pair(\n-                    Pair(tempRange!!.first.first, it.first.second),\n-                    mergeFile(tempRange!!.second, it.second),\n-                )\n-            }\n-        }\n-        // This ensures that the last temp range is added to the list if present\n-        if (tempRange != null) {\n-            newRanges.add(tempRange!!)\n-        }\n-\n-        return newRanges\n-    }\n-\n-    /**\n-     * Takes two file and merge them appending the source to the sink\n-     *\n-     * @param sinkFile the sink\n-     * @param sourceFile the source\n-     * @return a file composed by appending the source to the sink\n-     */\n-    private fun mergeFile(sinkFile: UniFile?, sourceFile: UniFile): UniFile {\n-        if (sinkFile == null) {\n-            return sourceFile\n-        }\n-\n-        val buffer = ByteArray(4 * 1024)\n-        val output = sinkFile.openOutputStream(true)\n-        val input = sourceFile.openInputStream()\n-\n-        var bytesRead = input.read(buffer)\n-        while (bytesRead > 0) {\n-            output.write(buffer, 0, bytesRead)\n-            bytesRead = input.read(buffer)\n-        }\n-\n-        output.flush()\n-        output.close()\n-        input.close()\n-\n-        sourceFile.delete()\n-\n-        return sinkFile\n-    }\n-\n-    private fun getComplementaryRanges(\n-        range: Pair<Long, Long>,\n-        toRemove: List<Pair<Long, Long>>,\n-    ): List<Pair<Long, Long>> {\n-        val result = mutableListOf<Pair<Long, Long>>()\n-\n-        var tempRange = range.copy()\n-        toRemove.sortedBy { it.first }.forEach {\n-            if (it.first > tempRange.first) {\n-                result.add(Pair(tempRange.first, it.first - 1))\n-            }\n-            tempRange = tempRange.copy(first = it.second + 1)\n-        }\n-        if (tempRange.first <= tempRange.second) {\n-            result.add(tempRange)\n-        }\n-\n-        return result.toList()\n-    }\n-\n-    private fun getDownloadParts(\n-        download: AnimeDownload,\n-        video: Video,\n-        tmpDir: UniFile,\n-        threadNumber: Int,\n-        videoSize: Long,\n-    ): List<AnimeDownloadPart> {\n-        // Get non empty part files\n-        val partFiles = cleanAndGetPartFile(tmpDir)\n-\n-        // Retrieve from part files the downloaded ranges\n-        var downloadedRanges = getRangesAndFiles(partFiles).sortedByDescending { it.first.first }\n-\n-        // Merge ranges and files that can form a unique range and file\n-        downloadedRanges = mergeSuccessiveFiles(downloadedRanges)\n-\n-        // Get total downloaded size\n-        var downloadedSize = 0L\n-        downloadedRanges.forEach {\n-            downloadedSize += (it.first.second - it.first.first)\n-        }\n-\n-        // Get all ranges that aren't downloaded\n-        val tempRanges = mutableListOf<Pair<Long, Long>>()\n-        downloadedRanges.forEach { tempRanges.add(it.first) }\n-        val complementaryRanges = getComplementaryRanges(Pair(0, videoSize - 1), tempRanges)\n-\n-        // Calculate the parts size on new threadNumber value\n-        val partSize = maxOf(\n-            1024 * 1024,\n-            minOf(\n-                1024 * 1024 * 10,\n-                (videoSize - downloadedSize).floorDiv(threadNumber),\n-            ),\n-        )\n-\n-        // Get part subdivision of non-downloaded ranges\n-        val rangesToDownload = mutableListOf<Pair<Long, Long>>()\n-\n-        complementaryRanges.forEach { entry ->\n-            var partialToDownloadSize = entry.second - entry.first\n-            var tempStart = entry.first\n-            var tempEnd = tempStart + partSize\n-            // we subdivide in parts of at least partSize bytes\n-            while (partialToDownloadSize > 2 * partSize) {\n-                rangesToDownload.add(Pair(tempStart, tempEnd))\n-                partialToDownloadSize -= partSize\n-                tempStart = tempEnd + 1\n-                tempEnd = tempStart + partSize\n-            }\n-            rangesToDownload.add(Pair(tempStart, entry.second))\n-        }\n-\n-        val downloadParts = mutableListOf<AnimeDownloadPart>()\n-\n-        // Add downloaded ranges to parts as completed parts\n-        downloadedRanges.forEach { rF ->\n-            val part = AnimeDownloadPart(tmpDir, rF.first)\n-            part.file = rF.second\n-            part.completed = true\n-            downloadParts.add(part)\n-        }\n-\n-        // Add ranges to download to parts as non-completed parts\n-        rangesToDownload.forEach { r ->\n-            val request = download.source.videoRequest(video, r.first, r.second)\n-            val listener = object : ProgressListener {\n-                override fun update(bytesRead: Long, contentLength: Long, done: Boolean) {\n-                    download.update(download.bytesDownloaded, download.totalContentLength, false)\n-                }\n-            }\n-            val part = AnimeDownloadPart(tmpDir, r)\n-            part.completed = false\n-            part.request = request\n-            part.listener = listener\n-            downloadParts.add(part)\n-        }\n-\n-        val mergedDownloadParts = mergeSuccessiveParts(downloadParts)\n-\n-        // update downloaded size at sum of downloaded parts size\n-        download.bytesDownloaded = downloadedSize\n-\n-        return mergedDownloadParts.toList()\n-    }\n-\n     /**\n      * Returns the observable which downloads the video with an external downloader.\n      *\n@@ -1164,7 +654,7 @@ class AnimeDownloader(\n         filename: String,\n     ): UniFile {\n         try {\n-            val file = tmpDir.createFile(\"${filename}_tmp.mp4\")!!\n+            val file = tmpDir.createFile(\"${filename}_tmp.mkv\")!!\n             context.copyToClipboard(\"Episode download location\", tmpDir.filePath!!.substringBeforeLast(\"_tmp\"))\n \n             // TODO: support other file formats!!\n@@ -1186,7 +676,8 @@ class AnimeDownloader(\n                             )\n                             action = Intent.ACTION_VIEW\n                             data = Uri.parse(video.videoUrl)\n-                            putExtra(\"extra_filename\", filename)\n+\n+                            putExtra(\"extra_filename\", \"$filename.mkv\")\n                         }\n                     }\n                     // ADM\n@@ -1205,7 +696,7 @@ class AnimeDownloader(\n                             action = Intent.ACTION_VIEW\n                             putExtra(\n                                 \"com.dv.get.ACTION_LIST_ADD\",\n-                                \"${Uri.parse(video.videoUrl)}<info>$filename.mp4\",\n+                                \"${Uri.parse(video.videoUrl)}<info>$filename.mkv\",\n                             )\n                             putExtra(\n                                 \"com.dv.get.ACTION_LIST_PATH\",\n@@ -1238,7 +729,7 @@ class AnimeDownloader(\n             context.startActivity(intent)\n             return file\n         } catch (e: Exception) {\n-            tmpDir.findFile(\"${filename}_tmp.mp4\")?.delete()\n+            tmpDir.findFile(\"${filename}_tmp.mkv\")?.delete()\n             throw e\n         }\n     }\n@@ -1263,7 +754,7 @@ class AnimeDownloader(\n         download.status = if (downloadedVideo.size == 1) {\n             // Only rename the directory if it's downloaded\n             val filename = DiskUtil.buildValidFilename(\"${download.anime.title} - ${download.episode.name}\")\n-            tmpDir.findFile(\"${filename}_tmp.mp4\")?.delete()\n+            tmpDir.findFile(\"${filename}_tmp.mkv\")?.delete()\n             tmpDir.renameTo(dirname)\n \n             cache.addEpisode(dirname, animeDir, download.anime)\ndiff --git a/app/src/main/java/eu/kanade/tachiyomi/ui/download/DownloadsTab.kt b/app/src/main/java/eu/kanade/tachiyomi/ui/download/DownloadsTab.kt\nindex 36709480e7..f057ee162c 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/ui/download/DownloadsTab.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/ui/download/DownloadsTab.kt\n@@ -166,7 +166,7 @@ data object DownloadsTab : Tab {\n             floatingActionButton = {\n                 AnimatedVisibility(\n                     visible = when (state.currentPage) {\n-                        0 -> animeDownloadList.isNotEmpty()\n+                        0 -> false\n                         1 -> mangaDownloadList.isNotEmpty()\n                         else -> false\n                     },\ndiff --git a/domain/src/main/java/tachiyomi/domain/download/service/DownloadPreferences.kt b/domain/src/main/java/tachiyomi/domain/download/service/DownloadPreferences.kt\nindex 46026033a2..9c52c1c2c3 100644\n--- a/domain/src/main/java/tachiyomi/domain/download/service/DownloadPreferences.kt\n+++ b/domain/src/main/java/tachiyomi/domain/download/service/DownloadPreferences.kt\n@@ -65,8 +65,6 @@ class DownloadPreferences(\n     )\n \n     fun numberOfDownloads() = preferenceStore.getInt(\"download_slots\", 1)\n-    fun safeDownload() = preferenceStore.getBoolean(\"safe_download\", true)\n-    fun numberOfThreads() = preferenceStore.getInt(\"download_threads\", 1)\n     fun downloadSpeedLimit() = preferenceStore.getInt(\"download_speed_limit\", 0)\n \n     fun downloadNewUnreadChaptersOnly() = preferenceStore.getBoolean(\"download_new_unread_chapters_only\", false)\ndiff --git a/i18n/src/commonMain/moko-resources/base/strings.xml b/i18n/src/commonMain/moko-resources/base/strings.xml\nindex 99a4701f94..83abaa1736 100644\n--- a/i18n/src/commonMain/moko-resources/base/strings.xml\n+++ b/i18n/src/commonMain/moko-resources/base/strings.xml\n@@ -1331,10 +1331,6 @@\n     <string name=\"label_manga_extension_repos\">Manga extension repos</string>\n     <string name=\"label_anime_extension_repos\">Anime extension repos</string>\n     <string name=\"onboarding_storage_action_create_folder\">Create default Aniyomi folder</string>\n-    <string name=\"safe_download\">Safe downloading mode for anime</string>\n-    <string name=\"safe_download_summary\">Enable single thread and no range downloading mode</string>\n-    <string name=\"download_threads_number\">Thread count</string>\n-    <string name=\"download_threads_number_summary\">Number of threads to use for downloading, might get your IP blocked if too high, usually 4 is a good number to avoid heavy load on source servers.</string>\n-    <string name=\"download_speed_limit\">Download speed limit</string>\n+    <string name=\"download_speed_limit\">Chapter download speed limit</string>\n     <string name=\"download_speed_limit_hint\">Set to 0 to disable the speed limit.</string>\n </resources>\n", "changes": [{"file": "app/src/main/java/eu/kanade/presentation/more/settings/screen/SettingsDownloadScreen.kt", "module": "eu.kanade.presentation.more.settings.screen.SettingsDownloadScreen", "range": [{"start": 77, "end": 77}, {"start": 83, "end": 94}]}, {"file": "app/src/main/java/eu/kanade/tachiyomi/data/download/anime/AnimeDownloader.kt", "module": "eu.kanade.tachiyomi.data.download.anime.AnimeDownloader", "range": [{"start": 13, "end": 13}, {"start": 17, "end": 17}, {"start": 20, "end": 20}, {"start": 23, "end": 24}, {"start": 47, "end": 51}, {"start": 64, "end": 64}, {"start": 99, "end": 103}, {"start": 373, "end": 373}, {"start": 407, "end": 409}, {"start": 429, "end": 430}, {"start": 445, "end": 445}, {"start": 447, "end": 447}, {"start": 459, "end": 459}, {"start": 461, "end": 462}, {"start": 465, "end": 465}, {"start": 467, "end": 473}, {"start": 477, "end": 477}, {"start": 479, "end": 484}, {"start": 487, "end": 492}, {"start": 503, "end": 503}, {"start": 508, "end": 509}, {"start": 511, "end": 521}, {"start": 526, "end": 533}, {"start": 558, "end": 559}, {"start": 571, "end": 572}, {"start": 585, "end": 585}, {"start": 587, "end": 591}, {"start": 592, "end": 592}, {"start": 593, "end": 597}, {"start": 598, "end": 600}, {"start": 601, "end": 603}, {"start": 621, "end": 622}, {"start": 628, "end": 630}, {"start": 631, "end": 634}, {"start": 635, "end": 637}, {"start": 639, "end": 647}, {"start": 648, "end": 648}, {"start": 673, "end": 1151}, {"start": 1167, "end": 1168}, {"start": 1189, "end": 1190}, {"start": 1208, "end": 1209}, {"start": 1241, "end": 1242}, {"start": 1266, "end": 1267}]}, {"file": "app/src/main/java/eu/kanade/tachiyomi/ui/download/DownloadsTab.kt", "module": "eu.kanade.tachiyomi.ui.download.DownloadsTab", "range": [{"start": 169, "end": 170}]}, {"file": "domain/src/main/java/tachiyomi/domain/download/service/DownloadPreferences.kt", "module": "tachiyomi.domain.download.service.DownloadPreferences", "range": [{"start": 68, "end": 69}]}]}]}
{"url": "https://github.com/aniyomiorg/aniyomi/issues/1882", "repo": {"url": "https://github.com/aniyomiorg/aniyomi", "name": "aniyomi", "owner": "aniyomiorg", "modules": ["aniyomi.domain.anime", "aniyomi.util", "eu.kanade.core", "eu.kanade.domain", "eu.kanade.presentation", "eu.kanade.tachiyomi", "eu.kanade.test", "mihon.buildlogic", "mihon.buildlogic.tasks", "mihon.core.archive", "mihon.core.designsystem", "mihon.core.migration", "mihon.data.repository", "mihon.domain.extensionrepo", "mihon.domain.items", "mihon.domain.upcoming", "mihon.feature.upcoming", "mihon.presentation.core", "tachiyomi.core.common", "tachiyomi.core.metadata", "tachiyomi.data", "tachiyomi.data.category", "tachiyomi.data.custombutton", "tachiyomi.data.entries", "tachiyomi.data.handlers", "tachiyomi.data.history", "tachiyomi.data.items", "tachiyomi.data.release", "tachiyomi.data.source", "tachiyomi.data.track", "tachiyomi.data.updates", "tachiyomi.domain.backup", "tachiyomi.domain.category", "tachiyomi.domain.custombuttons", "tachiyomi.domain.download", "tachiyomi.domain.entries", "tachiyomi.domain.history", "tachiyomi.domain.items", "tachiyomi.domain.library", "tachiyomi.domain.release", "tachiyomi.domain.source", "tachiyomi.domain.storage", "tachiyomi.domain.track", "tachiyomi.domain.updates", "tachiyomi.macrobenchmark", "tachiyomi.presentation.core", "tachiyomi.presentation.widget", "tachiyomi.source.local"]}, "issue": {"number": 1882, "url": "https://github.com/aniyomiorg/aniyomi/issues/1882", "state": "closed", "title": "New player Freezes the app", "body": "### Steps to reproduce\n\n1. When an episode is played the app freezes\n2. after it goes into horizontal state for the player\n\n\n### Expected behavior\n\nThe player should play the episode as normally expected \n\n### Actual behavior\n\n1. after it goes into horizontal state for the player\n2. App doesnt respond goes into hang state\n3. then have to force close the app\n\n![Image](https://github.com/user-attachments/assets/b7a4fcd8-6e12-4b3c-a4be-5662cd0ee8de)\n\n### Crash logs\n\n[aniyomi_crash_logs.txt](https://github.com/user-attachments/files/18468700/aniyomi_crash_logs.txt)\n\n### Aniyomi version\n\nv0.16.4.3-r8037\n\n### Android version\n\n12\n\n### Device\n\nSamsung Galaxy M31\n\n### Other details\n\n_No response_\n\n### Acknowledgements\n\n- [x] I have searched the existing issues and this is a new ticket, **NOT** a duplicate or related to another open or closed issue.\n- [x] I have written a short but informative title.\n- [x] If this is an issue with an extension, I should be opening an issue in the extension's repository.\n- [x] I have gone through the [FAQ](https://aniyomi.org/docs/faq/general) and [troubleshooting guide](https://aniyomi.org/docs/guides/troubleshooting/).\n- [x] I have updated the app to version **[0.16.4.3](https://github.com/aniyomiorg/aniyomi/releases/latest)**.\n- [x] I have updated all installed extensions.\n- [x] I will fill out all of the requested information in this form.", "logs": [{"name": "aniyomi_crash_logs.txt", "url": "https://github.com/user-attachments/files/18468700/aniyomi_crash_logs.txt"}]}, "pull_request": [{"number": 1986, "url": "https://github.com/aniyomiorg/aniyomi/pull/1986", "diff_url": "https://github.com/aniyomiorg/aniyomi/pull/1986.diff", "patch_url": "https://github.com/aniyomiorg/aniyomi/pull/1986.patch", "title": "fix(player): Fix npe issue caused in player controls", "content": "Closes #1882\r\n^ confirmed via discord that the issue is actually fixed this time", "diff": "diff --git a/app/src/main/java/eu/kanade/tachiyomi/ui/player/PlayerViewModel.kt b/app/src/main/java/eu/kanade/tachiyomi/ui/player/PlayerViewModel.kt\nindex ba35a745ab..891ec625f0 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/ui/player/PlayerViewModel.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/ui/player/PlayerViewModel.kt\n@@ -1108,6 +1108,12 @@ class PlayerViewModel @JvmOverloads constructor(\n         _hasPreviousEpisode.update { _ -> value }\n     }\n \n+    fun showEpisodeListDialog() {\n+        if (currentAnime.value != null) {\n+            showDialog(Dialogs.EpisodeList)\n+        }\n+    }\n+\n     /**\n      * Called when the activity is saved and not changing configurations. It updates the database\n      * to persist the current progress of the active episode.\ndiff --git a/app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/PlayerControls.kt b/app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/PlayerControls.kt\nindex 35bafdc19f..b8d288b820 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/PlayerControls.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/PlayerControls.kt\n@@ -413,7 +413,7 @@ fun PlayerControls(\n                     TopLeftPlayerControls(\n                         animeTitle = animeTitle,\n                         mediaTitle = mediaTitle,\n-                        onTitleClick = { viewModel.showDialog(Dialogs.EpisodeList) },\n+                        onTitleClick = { viewModel.showEpisodeListDialog() },\n                         onBackClick = onBackPress,\n                     )\n                 }\n@@ -613,8 +613,7 @@ fun PlayerControls(\n \n         PlayerDialogs(\n             dialogShown = dialog,\n-\n-            episodeDisplayMode = anime!!.displayMode,\n+            episodeDisplayMode = anime?.displayMode,\n             episodeList = playlist,\n             currentEpisodeIndex = viewModel.getCurrentEpisodeIndex(),\n             dateRelativeTime = viewModel.relativeTime,\ndiff --git a/app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/PlayerDialogs.kt b/app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/PlayerDialogs.kt\nindex 0c7b874b54..f983c6658f 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/PlayerDialogs.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/PlayerDialogs.kt\n@@ -12,7 +12,7 @@ fun PlayerDialogs(\n     dialogShown: Dialogs,\n \n     // Episode list\n-    episodeDisplayMode: Long,\n+    episodeDisplayMode: Long?,\n     currentEpisodeIndex: Int,\n     episodeList: List<Episode>,\n     dateRelativeTime: Boolean,\ndiff --git a/app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/components/dialogs/EpisodeListDialog.kt b/app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/components/dialogs/EpisodeListDialog.kt\nindex d291c67b33..f840e80a26 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/components/dialogs/EpisodeListDialog.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/components/dialogs/EpisodeListDialog.kt\n@@ -50,7 +50,7 @@ import java.time.format.DateTimeFormatter\n \n @Composable\n fun EpisodeListDialog(\n-    displayMode: Long,\n+    displayMode: Long?,\n     currentEpisodeIndex: Int,\n     episodeList: List<Episode>,\n     dateRelativeTime: Boolean,\n", "changes": [{"file": "app/src/main/java/eu/kanade/tachiyomi/ui/player/PlayerViewModel.kt", "module": "eu.kanade.tachiyomi.ui.player.PlayerViewModel", "range": [{"start": 1111, "end": 1111}]}, {"file": "app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/PlayerControls.kt", "module": "eu.kanade.tachiyomi.ui.player.controls.PlayerControls", "range": [{"start": 416, "end": 417}, {"start": 616, "end": 618}]}, {"file": "app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/PlayerDialogs.kt", "module": "eu.kanade.tachiyomi.ui.player.controls.PlayerDialogs", "range": [{"start": 15, "end": 16}]}, {"file": "app/src/main/java/eu/kanade/tachiyomi/ui/player/controls/components/dialogs/EpisodeListDialog.kt", "module": "eu.kanade.tachiyomi.ui.player.controls.components.dialogs.EpisodeListDialog", "range": [{"start": 53, "end": 54}]}]}, {"number": 1961, "url": "https://github.com/aniyomiorg/aniyomi/pull/1961", "diff_url": "https://github.com/aniyomiorg/aniyomi/pull/1961.diff", "patch_url": "https://github.com/aniyomiorg/aniyomi/pull/1961.patch", "title": "fix(player): Don't run unnecessary stuff when exiting the player", "content": "Closes #1882\r\n\r\nSometimes it will still hang when exiting the player, causing the app to be unresponsive for a short while (which I have no why it's happening) but now it won't at least cause an ANR.", "diff": "diff --git a/app/src/main/java/eu/kanade/tachiyomi/ui/player/PlayerActivity.kt b/app/src/main/java/eu/kanade/tachiyomi/ui/player/PlayerActivity.kt\nindex 62ebff69bb..a970cd50bc 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/ui/player/PlayerActivity.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/ui/player/PlayerActivity.kt\n@@ -269,17 +269,23 @@ class PlayerActivity : BaseActivity() {\n     }\n \n     override fun onDestroy() {\n+        player.isExiting = true\n+\n         audioFocusRequest?.let {\n             AudioManagerCompat.abandonAudioFocusRequest(audioManager, it)\n         }\n         audioFocusRequest = null\n-        mediaSession?.release()\n+\n+        mediaSession?.let {\n+            it.isActive = false\n+            it.release()\n+        }\n+\n         if (noisyReceiver.initialized) {\n             unregisterReceiver(noisyReceiver)\n             noisyReceiver.initialized = false\n         }\n \n-        player.isExiting = true\n         MPVLib.removeLogObserver(playerObserver)\n         MPVLib.removeObserver(playerObserver)\n         player.destroy()\n@@ -288,16 +294,22 @@ class PlayerActivity : BaseActivity() {\n     }\n \n     override fun onPause() {\n-        if (!isInPictureInPictureMode) {\n-            viewModel.pause()\n-        }\n         viewModel.saveCurrentEpisodeWatchingProgress()\n+\n+        if (isInPictureInPictureMode) {\n+            super.onPause()\n+            return\n+        }\n+\n+        player.isExiting = true\n+        if (isFinishing) {\n+            MPVLib.command(arrayOf(\"stop\"))\n+        }\n+\n         super.onPause()\n     }\n \n     override fun onStop() {\n-        viewModel.pause()\n-        viewModel.saveCurrentEpisodeWatchingProgress()\n         window.attributes.screenBrightness.let {\n             if (playerPreferences.rememberPlayerBrightness().get() && it != -1f) {\n                 playerPreferences.playerBrightnessValue().set(it)\n", "changes": [{"file": "app/src/main/java/eu/kanade/tachiyomi/ui/player/PlayerActivity.kt", "module": "eu.kanade.tachiyomi.ui.player.PlayerActivity", "range": [{"start": 272, "end": 272}, {"start": 276, "end": 277}, {"start": 282, "end": 282}, {"start": 291, "end": 293}, {"start": 295, "end": 295}, {"start": 299, "end": 300}]}]}, {"number": 1921, "url": "https://github.com/aniyomiorg/aniyomi/pull/1921", "diff_url": "https://github.com/aniyomiorg/aniyomi/pull/1921.diff", "patch_url": "https://github.com/aniyomiorg/aniyomi/pull/1921.patch", "title": "fix(mpvlib): Fix npe issues", "content": "Closes #1882\r\n\r\nseems to probably be another issue, but might not", "diff": "diff --git a/app/src/main/java/eu/kanade/tachiyomi/ui/player/AniyomiMPVView.kt b/app/src/main/java/eu/kanade/tachiyomi/ui/player/AniyomiMPVView.kt\nindex d70279218e..9ecaed40f3 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/ui/player/AniyomiMPVView.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/ui/player/AniyomiMPVView.kt\n@@ -49,36 +49,52 @@ class AniyomiMPVView(context: Context, attributes: AttributeSet) : BaseMPVView(c\n \n     var isExiting = false\n \n+    private fun getPropertyInt(property: String): Int? {\n+        return MPVLib.getPropertyInt(property) as Int?\n+    }\n+\n+    private fun getPropertyBoolean(property: String): Boolean? {\n+        return MPVLib.getPropertyBoolean(property) as Boolean?\n+    }\n+\n+    private fun getPropertyDouble(property: String): Double? {\n+        return MPVLib.getPropertyDouble(property) as Double?\n+    }\n+\n+    private fun getPropertyString(property: String): String? {\n+        return MPVLib.getPropertyString(property) as String?\n+    }\n+\n     val duration: Int?\n-        get() = MPVLib.getPropertyInt(\"duration\")\n+        get() = getPropertyInt(\"duration\")\n \n     var timePos: Int?\n-        get() = MPVLib.getPropertyInt(\"time-pos\")\n+        get() = getPropertyInt(\"time-pos\")\n         set(position) = MPVLib.setPropertyInt(\"time-pos\", position!!)\n \n     var paused: Boolean?\n-        get() = MPVLib.getPropertyBoolean(\"pause\")\n+        get() = getPropertyBoolean(\"pause\")\n         set(paused) = MPVLib.setPropertyBoolean(\"pause\", paused!!)\n \n     val hwdecActive: String\n-        get() = MPVLib.getPropertyString(\"hwdec-current\") ?: \"no\"\n+        get() = getPropertyString(\"hwdec-current\") ?: \"no\"\n \n     val videoH: Int?\n-        get() = MPVLib.getPropertyInt(\"video-params/h\")\n+        get() = getPropertyInt(\"video-params/h\")\n \n     /**\n      * Returns the video aspect ratio. Rotation is taken into account.\n      */\n     fun getVideoOutAspect(): Double? {\n-        return MPVLib.getPropertyDouble(\"video-params/aspect\")?.let {\n+        return getPropertyDouble(\"video-params/aspect\")?.let {\n             if (it < 0.001) return 0.0\n-            if ((MPVLib.getPropertyInt(\"video-params/rotate\") ?: 0) % 180 == 90) 1.0 / it else it\n+            if ((getPropertyInt(\"video-params/rotate\") ?: 0) % 180 == 90) 1.0 / it else it\n         }\n     }\n \n-    class TrackDelegate(private val name: String) {\n+    inner class TrackDelegate(private val name: String) {\n         operator fun getValue(thisRef: Any?, property: KProperty<*>): Int {\n-            val v = MPVLib.getPropertyString(name)\n+            val v = getPropertyString(name)\n             // we can get null here for \"no\" or other invalid value\n             return v?.toIntOrNull() ?: -1\n         }\n", "changes": [{"file": "app/src/main/java/eu/kanade/tachiyomi/ui/player/AniyomiMPVView.kt", "module": "eu.kanade.tachiyomi.ui.player.AniyomiMPVView", "range": [{"start": 52, "end": 52}, {"start": 53, "end": 54}, {"start": 56, "end": 57}, {"start": 60, "end": 61}, {"start": 64, "end": 65}, {"start": 67, "end": 68}, {"start": 73, "end": 74}, {"start": 75, "end": 76}, {"start": 79, "end": 80}, {"start": 81, "end": 82}]}]}]}
{"url": "https://github.com/aniyomiorg/aniyomi/issues/1626", "repo": {"url": "https://github.com/aniyomiorg/aniyomi", "name": "aniyomi", "owner": "aniyomiorg", "modules": ["aniyomi.domain.anime", "aniyomi.util", "eu.kanade.core", "eu.kanade.domain", "eu.kanade.presentation", "eu.kanade.tachiyomi", "eu.kanade.test", "mihon.buildlogic", "mihon.buildlogic.tasks", "mihon.core.archive", "mihon.core.designsystem", "mihon.core.migration", "mihon.data.repository", "mihon.domain.extensionrepo", "mihon.domain.items", "mihon.domain.upcoming", "mihon.feature.upcoming", "mihon.presentation.core", "tachiyomi.core.common", "tachiyomi.core.metadata", "tachiyomi.data", "tachiyomi.data.category", "tachiyomi.data.custombutton", "tachiyomi.data.entries", "tachiyomi.data.handlers", "tachiyomi.data.history", "tachiyomi.data.items", "tachiyomi.data.release", "tachiyomi.data.source", "tachiyomi.data.track", "tachiyomi.data.updates", "tachiyomi.domain.backup", "tachiyomi.domain.category", "tachiyomi.domain.custombuttons", "tachiyomi.domain.download", "tachiyomi.domain.entries", "tachiyomi.domain.history", "tachiyomi.domain.items", "tachiyomi.domain.library", "tachiyomi.domain.release", "tachiyomi.domain.source", "tachiyomi.domain.storage", "tachiyomi.domain.track", "tachiyomi.domain.updates", "tachiyomi.macrobenchmark", "tachiyomi.presentation.core", "tachiyomi.presentation.widget", "tachiyomi.source.local"]}, "issue": {"number": 1626, "url": "https://github.com/aniyomiorg/aniyomi/issues/1626", "state": "closed", "title": "Advanced player settings not working in Android 10 and below", "body": "### Steps to reproduce\n\n1. Go to advanced player settings\r\n2. Modify mpv config, mpv input or enable mpv scripts\r\n3. App crashes\n\n### Expected behavior\n\nShould be able to modify those 3 preferences\n\n### Actual behavior\n\nCan't modify them and the app crashes\n\n### Crash logs\n\n[aniyomi_crash_logs.txt](https://github.com/user-attachments/files/15967276/aniyomi_crash_logs.txt)\r\n\n\n### Aniyomi version\n\n0.15.3.0-7567\n\n### Android version\n\nAndroid 10\n\n### Device\n\nSamsung Galaxy Note 9\n\n### Other details\n\nI believe the problem is in three lines of the same file that have `isExternalStorageManager`. This method is for Android 11 and above.\r\n\r\nhttps://github.com/aniyomiorg/aniyomi/blob/9baf6adce541ea5126f841b9043cb767585d0cd1/app/src/main/java/eu/kanade/presentation/more/settings/screen/AdvancedPlayerSettingsScreen.kt#L50-L54\r\n\r\nThere is another file that has this method but only for Android 11 and above:\r\nhttps://github.com/aniyomiorg/aniyomi/blob/224430ec0d9689f16eb1a63541c7f175761b0a65/app/src/main/java/eu/kanade/tachiyomi/ui/player/PlayerActivity.kt#L597-L604\r\n\n\n### Acknowledgements\n\n- [X] I have searched the existing issues and this is a new ticket, **NOT** a duplicate or related to another open or closed issue.\n- [X] I have written a short but informative title.\n- [X] If this is an issue with an official anime extension, I should be opening an issue in the [extensions repository](https://github.com/aniyomiorg/aniyomi-extensions/issues/new/choose).\n- [X] If this is an issue with a manga extension, report it to the manga source extension project you added it from.\n- [X] I have gone through the [FAQ](https://aniyomi.org/docs/faq/general) and [troubleshooting guide](https://aniyomi.org/docs/guides/troubleshooting/).\n- [X] I have updated the app to version **[0.15.3.0](https://github.com/aniyomiorg/aniyomi/releases/latest)**.\n- [X] I have updated all installed extensions.\n- [X] I will fill out all of the requested information in this form.", "logs": [{"name": "aniyomi_crash_logs.txt", "url": "https://github.com/user-attachments/files/15967276/aniyomi_crash_logs.txt"}]}, "pull_request": [{"number": 1627, "url": "https://github.com/aniyomiorg/aniyomi/pull/1627", "diff_url": "https://github.com/aniyomiorg/aniyomi/pull/1627.diff", "patch_url": "https://github.com/aniyomiorg/aniyomi/pull/1627.patch", "title": "fix: advanced player settings crash in android  10", "content": "Fixes #1626", "diff": "diff --git a/app/src/main/java/eu/kanade/presentation/more/settings/screen/AdvancedPlayerSettingsScreen.kt b/app/src/main/java/eu/kanade/presentation/more/settings/screen/AdvancedPlayerSettingsScreen.kt\nindex 3d0d72d678..001d75fd65 100644\n--- a/app/src/main/java/eu/kanade/presentation/more/settings/screen/AdvancedPlayerSettingsScreen.kt\n+++ b/app/src/main/java/eu/kanade/presentation/more/settings/screen/AdvancedPlayerSettingsScreen.kt\n@@ -3,6 +3,7 @@ package eu.kanade.presentation.more.settings.screen\n import android.annotation.SuppressLint\n import android.content.Intent\n import android.net.Uri\n+import android.os.Build\n import android.os.Environment\n import android.provider.Settings\n import androidx.compose.runtime.Composable\n@@ -45,9 +46,9 @@ object AdvancedPlayerSettingsScreen : SearchableSettings {\n                         postfix = if (mpvConf.asState(scope).value.lines().size > 2) \"\\n...\" else \"\",\n                     ),\n                 onValueChanged = {\n-                    val inputFile = storageManager.getMPVConfigDirectory()\n-                        ?.createFile(\"mpv.conf\")\n-                    if (Environment.isExternalStorageManager()) {\n+                    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.R && Environment.isExternalStorageManager()) {\n+                        val inputFile = storageManager.getMPVConfigDirectory()\n+                            ?.createFile(\"mpv.conf\")\n                         inputFile?.openOutputStream()?.bufferedWriter().use { writer ->\n                             writer?.write(it)\n                         }\n@@ -67,9 +68,9 @@ object AdvancedPlayerSettingsScreen : SearchableSettings {\n                         postfix = if (mpvInput.asState(scope).value.lines().size > 2) \"\\n...\" else \"\",\n                     ),\n                 onValueChanged = {\n-                    val inputFile = storageManager.getMPVConfigDirectory()\n-                        ?.createFile(\"input.conf\")\n-                    if (Environment.isExternalStorageManager()) {\n+                    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.R && Environment.isExternalStorageManager()) {\n+                        val inputFile = storageManager.getMPVConfigDirectory()\n+                            ?.createFile(\"input.conf\")\n                         inputFile?.openOutputStream()?.bufferedWriter().use { writer ->\n                             writer?.write(it)\n                         }\n@@ -100,7 +101,7 @@ object AdvancedPlayerSettingsScreen : SearchableSettings {\n                 onValueChanged = {\n                     // Ask for external storage permission\n                     if (it) {\n-                        if (!Environment.isExternalStorageManager()) {\n+                        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.R && !Environment.isExternalStorageManager()) {\n                             val intent = Intent(Settings.ACTION_MANAGE_APP_ALL_FILES_ACCESS_PERMISSION)\n                             intent.data = Uri.fromParts(\"package\", context.packageName, null)\n                             context.startActivity(intent)\n", "changes": [{"file": "app/src/main/java/eu/kanade/presentation/more/settings/screen/AdvancedPlayerSettingsScreen.kt", "module": "eu.kanade.presentation.more.settings.screen.AdvancedPlayerSettingsScreen", "range": [{"start": 6, "end": 6}, {"start": 48, "end": 51}, {"start": 70, "end": 73}, {"start": 103, "end": 104}]}]}]}
{"url": "https://github.com/bmax121/APatch/issues/297", "repo": {"url": "https://github.com/bmax121/APatch", "name": "APatch", "owner": "bmax121", "modules": ["me.bmax.apatch", "me.bmax.apatch.services", "me.bmax.apatch.ui", "me.bmax.apatch.ui.component", "me.bmax.apatch.ui.screen", "me.bmax.apatch.ui.theme", "me.bmax.apatch.ui.viewmodel", "me.bmax.apatch.ui.webui", "me.bmax.apatch.util", "me.bmax.apatch.util.ui"]}, "issue": {"number": 297, "url": "https://github.com/bmax121/APatch/issues/297", "state": "closed", "title": "Apatch broken on Android 14.", "body": "### Please check before submitting an issue/ issue \n\n- [X] I have searched the issues and haven't found anything relevant/ issues \n- [X] If patch failed, root failed, or device unable to boot after flashing the new boot.img. Please goto KernelPatch/ KernelPatch \n- [X] I will upload bugreport file in APatch Manager - Settings - Report log/ bureport  APatch  -  - \n- [ ] I know how to reproduce the issue which may not be specific to my device/\n\n### Version requirement/\n\n- [x] I am using latest CI version of APatch/ CI \n\n### Describe the bug/ bug\n\nApatch is completly broken on by device running Android 14 on crdroid.\r\n\r\nThe issue range from libsu not properly working to modules not being installed. Exporting the apatch logs does not work either.\r\n\n\n### Reproduce method/\n\n1. Install and patch the kernel\r\n2. Open Apatch, and try to install modules or grant su permissions (needs the active PR)\r\n3. Try to use su in termux\r\n\n\n### Expected behavior/\n\nAll of the above should work\n\n### Actual behaviour /\n\nEverything is broken\n\n### Screenshots/\n\n_No response_\n\n### Logs/\n\nLogcat: \r\n[log.txt](https://github.com/bmax121/APatch/files/14623376/log.txt)\r\n\r\nKernelConfig: \r\n[config.txt](https://github.com/bmax121/APatch/files/14623383/config.txt)\r\n\n\n### Device Name/\n\nOneplus 6t\n\n### OS Version/\n\n14 (crDroid)\n\n### APatch Version/APatch \n\n10568 - PR #289\n\n### Kernel Version/\n\n4.9.337\n\n### KernelPatch Version/KernelPatch \n\n0.10.3\n\n### Additional context/\n\n\r\n1. I've opened an issue on the [libsu's issue page](https://github.com/topjohnwu/libsu/issues/179) regarding the problem with their library.\r\n2. Modules can't be installed, instead I'm granted with a blank page, and while exporting the installation log I get only a line saying `Error: No such file or directory (os error 2)`.\r\n3. I can't export the APatch logs. I tried sending it to me via email, telegram, but to no avail. Also using Total Comander to try and save it to my storage, it complains that it can't open it for reading.\r\n4. Su in termux is also broken, while I can enter the su shell I get permission errors when trying to access any directories\r\n\r\n", "logs": [{"name": "log.txt", "url": "https://github.com/bmax121/APatch/files/14623376/log.txt"}]}, "pull_request": [{"number": 710, "url": "https://github.com/bmax121/APatch/pull/710", "diff_url": "https://github.com/bmax121/APatch/pull/710.diff", "patch_url": "https://github.com/bmax121/APatch/pull/710.patch", "title": "build(deps): bump the rust-dependencies group across 1 directory with 13 updates", "content": "Bumps the rust-dependencies group with 6 updates in the /apd directory:\n\n| Package | From | To |\n| --- | --- | --- |\n| [clap](https://github.com/clap-rs/clap) | `4.5.19` | `4.5.20` |\n| [procfs](https://github.com/eminence/procfs) | `0.16.0` | `0.17.0` |\n| [cc](https://github.com/rust-lang/cc-rs) | `1.1.25` | `1.1.28` |\n| [js-sys](https://github.com/rustwasm/wasm-bindgen) | `0.3.70` | `0.3.71` |\n| [once_cell](https://github.com/matklad/once_cell) | `1.20.1` | `1.20.2` |\n| [proc-macro2](https://github.com/dtolnay/proc-macro2) | `1.0.86` | `1.0.87` |\n\n\nUpdates `clap` from 4.5.19 to 4.5.20\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/clap-rs/clap/blob/master/CHANGELOG.md\">clap's changelog</a>.</em></p>\n<blockquote>\n<h2>[4.5.20] - 2024-10-08</h2>\n<h3>Features</h3>\n<ul>\n<li><em>(unstable)</em> Add <code>CommandExt</code></li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/clap-rs/clap/commit/5034cabe54870a0b95145167543d8ef5e80ad8a0\"><code>5034cab</code></a> chore: Release</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/b5b690c4590e8c60e9bc6706cbe7cd4614b9a5e4\"><code>b5b690c</code></a> docs: Update changelog</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/abba1965be32910c5628e15239314450cf4f8947\"><code>abba196</code></a> Merge pull request <a href=\"https://redirect.github.com/clap-rs/clap/issues/5688\">#5688</a> from epage/rename</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/6ddd5d4e11f4ecca080a9b0758d3342d440f6429\"><code>6ddd5d4</code></a> fix(complete)!: Rename ArgValueCompleter to ArgValueCandidates</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/71c5e27f8bf484bc745ac4bed55d917ec8947b5b\"><code>71c5e27</code></a> fix(complete)!: Rename CustomCompleter to ValueCandidates</li>\n<li>See full diff in <a href=\"https://github.com/clap-rs/clap/compare/clap_complete-v4.5.19...clap_complete-v4.5.20\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `procfs` from 0.16.0 to 0.17.0\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/eminence/procfs/releases\">procfs's releases</a>.</em></p>\n<blockquote>\n<h2>v0.17.0</h2>\n<h2>What's Changed</h2>\n<ul>\n<li>cgroups: skip empty controllers by <a href=\"https://github.com/eliad-wiz\"><code>@eliad-wiz</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/292\">eminence/procfs#292</a></li>\n<li>Clarify CpuInfo.get_field docs by <a href=\"https://github.com/eminence\"><code>@eminence</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/291\">eminence/procfs#291</a></li>\n<li>Correct copy-pasted Process::task_from_tid() doc by <a href=\"https://github.com/ryoqun\"><code>@ryoqun</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/294\">eminence/procfs#294</a></li>\n<li>Ship copyright and license files with split crates by <a href=\"https://github.com/michel-slm\"><code>@michel-slm</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/297\">eminence/procfs#297</a></li>\n<li>Derive serde for Pfn by <a href=\"https://github.com/tatref\"><code>@tatref</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/301\">eminence/procfs#301</a></li>\n<li>Add MountInfos::iter by <a href=\"https://github.com/rusty-snake\"><code>@rusty-snake</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/300\">eminence/procfs#300</a></li>\n<li>Add oom_score_adj Process methods by <a href=\"https://github.com/futpib\"><code>@futpib</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/298\">eminence/procfs#298</a></li>\n<li>feat: move PhysicalPageFlags to procfs-core by <a href=\"https://github.com/tatref\"><code>@tatref</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/303\">eminence/procfs#303</a></li>\n<li>Fix documentation for <code>Meminfo.s_reclaimable</code>. by <a href=\"https://github.com/carletes\"><code>@carletes</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/306\">eminence/procfs#306</a></li>\n<li>Doc: Fix incorrect link to examples by <a href=\"https://github.com/VxDxK\"><code>@VxDxK</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/307\">eminence/procfs#307</a></li>\n<li>Implemented proc/crypto parsing  by <a href=\"https://github.com/Hwatwasthat\"><code>@Hwatwasthat</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/296\">eminence/procfs#296</a></li>\n<li>Remove lazy-static dependency by <a href=\"https://github.com/notgull\"><code>@notgull</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/308\">eminence/procfs#308</a></li>\n<li>Fix build error with backtrace feature enabled by <a href=\"https://github.com/mbrubeck\"><code>@mbrubeck</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/309\">eminence/procfs#309</a></li>\n<li>net: Improve parsing of /proc/net/snmp by <a href=\"https://github.com/haaspors\"><code>@haaspors</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/313\">eminence/procfs#313</a></li>\n<li>Updated some examples to a bit more than printing debug. by <a href=\"https://github.com/Hwatwasthat\"><code>@Hwatwasthat</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/314\">eminence/procfs#314</a></li>\n<li>Implemented crypto example by <a href=\"https://github.com/Hwatwasthat\"><code>@Hwatwasthat</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/315\">eminence/procfs#315</a></li>\n<li>Add support for /dev/devices by <a href=\"https://github.com/yamaura\"><code>@yamaura</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/311\">eminence/procfs#311</a></li>\n</ul>\n<h2>New Contributors</h2>\n<ul>\n<li><a href=\"https://github.com/ryoqun\"><code>@ryoqun</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/294\">eminence/procfs#294</a></li>\n<li><a href=\"https://github.com/michel-slm\"><code>@michel-slm</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/297\">eminence/procfs#297</a></li>\n<li><a href=\"https://github.com/rusty-snake\"><code>@rusty-snake</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/300\">eminence/procfs#300</a></li>\n<li><a href=\"https://github.com/futpib\"><code>@futpib</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/298\">eminence/procfs#298</a></li>\n<li><a href=\"https://github.com/carletes\"><code>@carletes</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/306\">eminence/procfs#306</a></li>\n<li><a href=\"https://github.com/VxDxK\"><code>@VxDxK</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/307\">eminence/procfs#307</a></li>\n<li><a href=\"https://github.com/Hwatwasthat\"><code>@Hwatwasthat</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/296\">eminence/procfs#296</a></li>\n<li><a href=\"https://github.com/notgull\"><code>@notgull</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/308\">eminence/procfs#308</a></li>\n<li><a href=\"https://github.com/mbrubeck\"><code>@mbrubeck</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/309\">eminence/procfs#309</a></li>\n<li><a href=\"https://github.com/haaspors\"><code>@haaspors</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/313\">eminence/procfs#313</a></li>\n<li><a href=\"https://github.com/yamaura\"><code>@yamaura</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/311\">eminence/procfs#311</a></li>\n</ul>\n<p><strong>Full Changelog</strong>: <a href=\"https://github.com/eminence/procfs/compare/v0.16.0...v0.17.0\">https://github.com/eminence/procfs/compare/v0.16.0...v0.17.0</a></p>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/eminence/procfs/commit/e303757cd3e21c763e339f6f7e4c9cb4e435ff83\"><code>e303757</code></a> Version 0.17.0</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/6c959b69fadeac6aec2ec3c447bf3021aca4018e\"><code>6c959b6</code></a> Merge pull request <a href=\"https://redirect.github.com/eminence/procfs/issues/311\">#311</a> from yamaura/proc_devices</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/f2a51ef1105f1a7bfe14a0001be81ad1e435ba15\"><code>f2a51ef</code></a> Merge pull request <a href=\"https://redirect.github.com/eminence/procfs/issues/315\">#315</a> from Hwatwasthat/master</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/dc70412e36060ecc4d5d600348e337ff971bd010\"><code>dc70412</code></a> Update Devices struct doc comment to clarify block_devices can be empty</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/d66c910f3499860345f9903c0e8fa1683d849fb3\"><code>d66c910</code></a> Remove unnecessary #[allow(non_snake_case)]</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/eb26215f2008be4b3968e19f86613aaedd8335e2\"><code>eb26215</code></a> Add support for /dev/devices</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/53dc3a7521bf6c07ca7c342530d419e10ba53705\"><code>53dc3a7</code></a> Updated readme to show what the crypto example produces.</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/e0dec8b484ea7ec67abd5aa6f803d59fe1525976\"><code>e0dec8b</code></a> Implemented example for /dev/crypto parser</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/784dd2c30df4c6d581b24d6ff74c81bb4a50a069\"><code>784dd2c</code></a> Merge pull request <a href=\"https://redirect.github.com/eminence/procfs/issues/314\">#314</a> from Hwatwasthat/master</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/296791acbf8bde990b42d1a376d3daabe30d401e\"><code>296791a</code></a> Reworked pressure example to be more readable.</li>\n<li>Additional commits viewable in <a href=\"https://github.com/eminence/procfs/compare/v0.16.0...v0.17.0\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `cc` from 1.1.25 to 1.1.28\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/rust-lang/cc-rs/releases\">cc's releases</a>.</em></p>\n<blockquote>\n<h2>cc-v1.1.28</h2>\n<h3>Other</h3>\n<ul>\n<li>Environment variables: For one accepting boolean, treat &quot;0&quot;, &quot;false&quot; and empty env as false (<a href=\"https://redirect.github.com/rust-lang/cc-rs/pull/1238\">#1238</a>)</li>\n</ul>\n<h2>cc-v1.1.27</h2>\n<h3>Other</h3>\n<ul>\n<li>Revert &quot;Use debug version of MSVC runtime library on debug (<a href=\"https://redirect.github.com/rust-lang/cc-rs/pull/1231\">#1231</a>)&quot; (<a href=\"https://redirect.github.com/rust-lang/cc-rs/pull/1237\">#1237</a>)</li>\n<li>Disable <code>CC_ENABLE_DEBUG_OUTPUT</code> if it is set to &quot;0&quot; (<a href=\"https://redirect.github.com/rust-lang/cc-rs/pull/1234\">#1234</a>)</li>\n</ul>\n<h2>cc-v1.1.26</h2>\n<h3>Other</h3>\n<ul>\n<li>Use debug version of MSVC runtime library on debug (<a href=\"https://redirect.github.com/rust-lang/cc-rs/pull/1231\">#1231</a>)</li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/rust-lang/cc-rs/blob/main/CHANGELOG.md\">cc's changelog</a>.</em></p>\n<blockquote>\n<h2><a href=\"https://github.com/rust-lang/cc-rs/compare/cc-v1.1.27...cc-v1.1.28\">1.1.28</a> - 2024-10-06</h2>\n<h3>Other</h3>\n<ul>\n<li>Environment variables: For one accepting boolean, treat &quot;0&quot;, &quot;false&quot; and empty env as false (<a href=\"https://redirect.github.com/rust-lang/cc-rs/pull/1238\">#1238</a>)</li>\n</ul>\n<h2><a href=\"https://github.com/rust-lang/cc-rs/compare/cc-v1.1.26...cc-v1.1.27\">1.1.27</a> - 2024-10-06</h2>\n<h3>Other</h3>\n<ul>\n<li>Revert &quot;Use debug version of MSVC runtime library on debug (<a href=\"https://redirect.github.com/rust-lang/cc-rs/pull/1231\">#1231</a>)&quot; (<a href=\"https://redirect.github.com/rust-lang/cc-rs/pull/1237\">#1237</a>)</li>\n<li>Disable <code>CC_ENABLE_DEBUG_OUTPUT</code> if it is set to &quot;0&quot; (<a href=\"https://redirect.github.com/rust-lang/cc-rs/pull/1234\">#1234</a>)</li>\n</ul>\n<h2><a href=\"https://github.com/rust-lang/cc-rs/compare/cc-v1.1.25...cc-v1.1.26\">1.1.26</a> - 2024-10-06</h2>\n<h3>Other</h3>\n<ul>\n<li>Use debug version of MSVC runtime library on debug (<a href=\"https://redirect.github.com/rust-lang/cc-rs/pull/1231\">#1231</a>)</li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/rust-lang/cc-rs/commit/218365e5837815124b4b30c0ebb8149e1cec092a\"><code>218365e</code></a> chore: release (<a href=\"https://redirect.github.com/rust-lang/cc-rs/issues/1239\">#1239</a>)</li>\n<li><a href=\"https://github.com/rust-lang/cc-rs/commit/1a6a7103d912af080aa4c5b37e9d51a7967d3385\"><code>1a6a710</code></a> Environment variables: For one accepting boolean, treat &quot;0&quot;, &quot;false&quot; and empt...</li>\n<li><a href=\"https://github.com/rust-lang/cc-rs/commit/3bbb3849aeaf7230ca0e5d28ffe6d64742f022a1\"><code>3bbb384</code></a> chore: release (<a href=\"https://redirect.github.com/rust-lang/cc-rs/issues/1235\">#1235</a>)</li>\n<li><a href=\"https://github.com/rust-lang/cc-rs/commit/2b94f52d47bdc64684e3a7355bbedd07807cb438\"><code>2b94f52</code></a> Revert &quot;Use debug version of MSVC runtime library on debug (<a href=\"https://redirect.github.com/rust-lang/cc-rs/issues/1231\">#1231</a>)&quot; (<a href=\"https://redirect.github.com/rust-lang/cc-rs/issues/1237\">#1237</a>)</li>\n<li><a href=\"https://github.com/rust-lang/cc-rs/commit/39c0aaf933de38d6a644d7b19214ce8b4d4c375d\"><code>39c0aaf</code></a> Disable <code>CC_ENABLE_DEBUG_OUTPUT</code> if it is set to &quot;0&quot; (<a href=\"https://redirect.github.com/rust-lang/cc-rs/issues/1234\">#1234</a>)</li>\n<li><a href=\"https://github.com/rust-lang/cc-rs/commit/7e9730bab9ffa3a6cc7aba81eb83d2e258b6a368\"><code>7e9730b</code></a> chore: release (<a href=\"https://redirect.github.com/rust-lang/cc-rs/issues/1232\">#1232</a>)</li>\n<li><a href=\"https://github.com/rust-lang/cc-rs/commit/c80a7069404599db54f32ac7a0a1945bf67e5ea2\"><code>c80a706</code></a> Use debug version of MSVC runtime library on debug (<a href=\"https://redirect.github.com/rust-lang/cc-rs/issues/1231\">#1231</a>)</li>\n<li>See full diff in <a href=\"https://github.com/rust-lang/cc-rs/compare/cc-v1.1.25...cc-v1.1.28\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `clap_builder` from 4.5.19 to 4.5.20\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/clap-rs/clap/blob/master/CHANGELOG.md\">clap_builder's changelog</a>.</em></p>\n<blockquote>\n<h2>[4.5.20] - 2024-10-08</h2>\n<h3>Features</h3>\n<ul>\n<li><em>(unstable)</em> Add <code>CommandExt</code></li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/clap-rs/clap/commit/61f5ee514f8f60ed8f04c6494bdf36c19e7a8126\"><code>61f5ee5</code></a> chore: Release</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/3e6538427f0cce3321ad5b9df99a72614b970415\"><code>3e65384</code></a> docs: Update changelog</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/fca8f73c2c01bd88e171f2f5d9adb7a08039c124\"><code>fca8f73</code></a> Merge pull request <a href=\"https://redirect.github.com/clap-rs/clap/issues/5706\">#5706</a> from shannmu/external_subcommand</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/fc82a3e52887b426302013a8bcd94fa76b9fcbf4\"><code>fc82a3e</code></a> feat(complete): Support to complete custom external subcommand</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/6a091224215c886ef55a46f93c707438a487116d\"><code>6a09122</code></a> test(complete): Add test for external subcommand</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/d2874a50cf594ace49a9dfa644e734f83491a403\"><code>d2874a5</code></a> Merge pull request <a href=\"https://redirect.github.com/clap-rs/clap/issues/5766\">#5766</a> from epage/completer</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/a767a97c791a46ee2371b01b99adfadb82a08012\"><code>a767a97</code></a> feat: Add CommandExt support</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/32853d7b19ddd5944b91a7ff20bcec4bce570a7f\"><code>32853d7</code></a> refactor(builder): Make Ext code similar for Arg, Command</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/e9ce1be7078322afbcb8e4195012c2b30d33b6ff\"><code>e9ce1be</code></a> refactor(builder): Rename AppTag to AppExt</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/f89afeb8618e9863f40d363fd458f01ed099b091\"><code>f89afeb</code></a> refactor(complete): Put most general completer first</li>\n<li>Additional commits viewable in <a href=\"https://github.com/clap-rs/clap/compare/v4.5.19...v4.5.20\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `js-sys` from 0.3.70 to 0.3.71\n<details>\n<summary>Commits</summary>\n<ul>\n<li>See full diff in <a href=\"https://github.com/rustwasm/wasm-bindgen/commits\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `once_cell` from 1.20.1 to 1.20.2\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/matklad/once_cell/blob/master/CHANGELOG.md\">once_cell's changelog</a>.</em></p>\n<blockquote>\n<h2>1.20.2</h2>\n<ul>\n<li>Remove <code>portable_atomic</code> from Cargo.lock if it is not, in fact, used: <a href=\"https://redirect.github.com/matklad/once_cell/pull/267\">#267</a>\nThis is a work-around for this cargo bug: <a href=\"https://redirect.github.com/rust-lang/cargo/issues/10801\">rust-lang/cargo#10801</a>.</li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/matklad/once_cell/commit/4fbd4a53509ca59c8e09efc2ab0a22f21de70f7e\"><code>4fbd4a5</code></a> release 1.20.3</li>\n<li><a href=\"https://github.com/matklad/once_cell/commit/0aef2f86e3b5a7cd7a7b872fb05e381780704538\"><code>0aef2f8</code></a> Merge pull request <a href=\"https://redirect.github.com/matklad/once_cell/issues/267\">#267</a> from taiki-e/portable-atomic</li>\n<li><a href=\"https://github.com/matklad/once_cell/commit/cf87ac61f67c63b6c05311a98fd7f6c6650ddb5f\"><code>cf87ac6</code></a> Remove &quot;portable-atomic?/require-cas&quot; from race feature</li>\n<li>See full diff in <a href=\"https://github.com/matklad/once_cell/compare/v1.20.1...v1.20.2\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `proc-macro2` from 1.0.86 to 1.0.87\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/dtolnay/proc-macro2/releases\">proc-macro2's releases</a>.</em></p>\n<blockquote>\n<h2>1.0.87</h2>\n<ul>\n<li>Check valid punctuation character in <code>Punct::new</code> (<a href=\"https://redirect.github.com/dtolnay/proc-macro2/issues/470\">#470</a>)</li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/dtolnay/proc-macro2/commit/50b477d6dc0d1a781f91bf1f979ae138dadf795f\"><code>50b477d</code></a> Release 1.0.87</li>\n<li><a href=\"https://github.com/dtolnay/proc-macro2/commit/f0b680251272a96a889735b664d09138fb3cdf2c\"><code>f0b6802</code></a> Merge pull request <a href=\"https://redirect.github.com/dtolnay/proc-macro2/issues/471\">#471</a> from dtolnay/punctnew</li>\n<li><a href=\"https://github.com/dtolnay/proc-macro2/commit/98ea26129e9efb4198760e4504261e5dbbad658e\"><code>98ea261</code></a> Check valid punctuation character in Punct::new</li>\n<li><a href=\"https://github.com/dtolnay/proc-macro2/commit/d60aaad1a524f1f46adf6e154a10a7d4009be295\"><code>d60aaad</code></a> Ignore missing_panics_doc pedantic clippy lint</li>\n<li><a href=\"https://github.com/dtolnay/proc-macro2/commit/27061af259970a1e3a773f8fc5129d24bcbe8918\"><code>27061af</code></a> Ignore needless_lifetimes clippy lint</li>\n<li><a href=\"https://github.com/dtolnay/proc-macro2/commit/9c1d3eb1b6bddc5b86522bf3af98c2fb3de8e30a\"><code>9c1d3eb</code></a> Upload CI Cargo.lock for reproducing failures</li>\n<li>See full diff in <a href=\"https://github.com/dtolnay/proc-macro2/compare/1.0.86...1.0.87\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `procfs-core` from 0.16.0 to 0.17.0\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/eminence/procfs/releases\">procfs-core's releases</a>.</em></p>\n<blockquote>\n<h2>v0.17.0</h2>\n<h2>What's Changed</h2>\n<ul>\n<li>cgroups: skip empty controllers by <a href=\"https://github.com/eliad-wiz\"><code>@eliad-wiz</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/292\">eminence/procfs#292</a></li>\n<li>Clarify CpuInfo.get_field docs by <a href=\"https://github.com/eminence\"><code>@eminence</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/291\">eminence/procfs#291</a></li>\n<li>Correct copy-pasted Process::task_from_tid() doc by <a href=\"https://github.com/ryoqun\"><code>@ryoqun</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/294\">eminence/procfs#294</a></li>\n<li>Ship copyright and license files with split crates by <a href=\"https://github.com/michel-slm\"><code>@michel-slm</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/297\">eminence/procfs#297</a></li>\n<li>Derive serde for Pfn by <a href=\"https://github.com/tatref\"><code>@tatref</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/301\">eminence/procfs#301</a></li>\n<li>Add MountInfos::iter by <a href=\"https://github.com/rusty-snake\"><code>@rusty-snake</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/300\">eminence/procfs#300</a></li>\n<li>Add oom_score_adj Process methods by <a href=\"https://github.com/futpib\"><code>@futpib</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/298\">eminence/procfs#298</a></li>\n<li>feat: move PhysicalPageFlags to procfs-core by <a href=\"https://github.com/tatref\"><code>@tatref</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/303\">eminence/procfs#303</a></li>\n<li>Fix documentation for <code>Meminfo.s_reclaimable</code>. by <a href=\"https://github.com/carletes\"><code>@carletes</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/306\">eminence/procfs#306</a></li>\n<li>Doc: Fix incorrect link to examples by <a href=\"https://github.com/VxDxK\"><code>@VxDxK</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/307\">eminence/procfs#307</a></li>\n<li>Implemented proc/crypto parsing  by <a href=\"https://github.com/Hwatwasthat\"><code>@Hwatwasthat</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/296\">eminence/procfs#296</a></li>\n<li>Remove lazy-static dependency by <a href=\"https://github.com/notgull\"><code>@notgull</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/308\">eminence/procfs#308</a></li>\n<li>Fix build error with backtrace feature enabled by <a href=\"https://github.com/mbrubeck\"><code>@mbrubeck</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/309\">eminence/procfs#309</a></li>\n<li>net: Improve parsing of /proc/net/snmp by <a href=\"https://github.com/haaspors\"><code>@haaspors</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/313\">eminence/procfs#313</a></li>\n<li>Updated some examples to a bit more than printing debug. by <a href=\"https://github.com/Hwatwasthat\"><code>@Hwatwasthat</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/314\">eminence/procfs#314</a></li>\n<li>Implemented crypto example by <a href=\"https://github.com/Hwatwasthat\"><code>@Hwatwasthat</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/315\">eminence/procfs#315</a></li>\n<li>Add support for /dev/devices by <a href=\"https://github.com/yamaura\"><code>@yamaura</code></a> in <a href=\"https://redirect.github.com/eminence/procfs/pull/311\">eminence/procfs#311</a></li>\n</ul>\n<h2>New Contributors</h2>\n<ul>\n<li><a href=\"https://github.com/ryoqun\"><code>@ryoqun</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/294\">eminence/procfs#294</a></li>\n<li><a href=\"https://github.com/michel-slm\"><code>@michel-slm</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/297\">eminence/procfs#297</a></li>\n<li><a href=\"https://github.com/rusty-snake\"><code>@rusty-snake</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/300\">eminence/procfs#300</a></li>\n<li><a href=\"https://github.com/futpib\"><code>@futpib</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/298\">eminence/procfs#298</a></li>\n<li><a href=\"https://github.com/carletes\"><code>@carletes</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/306\">eminence/procfs#306</a></li>\n<li><a href=\"https://github.com/VxDxK\"><code>@VxDxK</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/307\">eminence/procfs#307</a></li>\n<li><a href=\"https://github.com/Hwatwasthat\"><code>@Hwatwasthat</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/296\">eminence/procfs#296</a></li>\n<li><a href=\"https://github.com/notgull\"><code>@notgull</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/308\">eminence/procfs#308</a></li>\n<li><a href=\"https://github.com/mbrubeck\"><code>@mbrubeck</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/309\">eminence/procfs#309</a></li>\n<li><a href=\"https://github.com/haaspors\"><code>@haaspors</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/313\">eminence/procfs#313</a></li>\n<li><a href=\"https://github.com/yamaura\"><code>@yamaura</code></a> made their first contribution in <a href=\"https://redirect.github.com/eminence/procfs/pull/311\">eminence/procfs#311</a></li>\n</ul>\n<p><strong>Full Changelog</strong>: <a href=\"https://github.com/eminence/procfs/compare/v0.16.0...v0.17.0\">https://github.com/eminence/procfs/compare/v0.16.0...v0.17.0</a></p>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/eminence/procfs/commit/e303757cd3e21c763e339f6f7e4c9cb4e435ff83\"><code>e303757</code></a> Version 0.17.0</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/6c959b69fadeac6aec2ec3c447bf3021aca4018e\"><code>6c959b6</code></a> Merge pull request <a href=\"https://redirect.github.com/eminence/procfs/issues/311\">#311</a> from yamaura/proc_devices</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/f2a51ef1105f1a7bfe14a0001be81ad1e435ba15\"><code>f2a51ef</code></a> Merge pull request <a href=\"https://redirect.github.com/eminence/procfs/issues/315\">#315</a> from Hwatwasthat/master</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/dc70412e36060ecc4d5d600348e337ff971bd010\"><code>dc70412</code></a> Update Devices struct doc comment to clarify block_devices can be empty</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/d66c910f3499860345f9903c0e8fa1683d849fb3\"><code>d66c910</code></a> Remove unnecessary #[allow(non_snake_case)]</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/eb26215f2008be4b3968e19f86613aaedd8335e2\"><code>eb26215</code></a> Add support for /dev/devices</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/53dc3a7521bf6c07ca7c342530d419e10ba53705\"><code>53dc3a7</code></a> Updated readme to show what the crypto example produces.</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/e0dec8b484ea7ec67abd5aa6f803d59fe1525976\"><code>e0dec8b</code></a> Implemented example for /dev/crypto parser</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/784dd2c30df4c6d581b24d6ff74c81bb4a50a069\"><code>784dd2c</code></a> Merge pull request <a href=\"https://redirect.github.com/eminence/procfs/issues/314\">#314</a> from Hwatwasthat/master</li>\n<li><a href=\"https://github.com/eminence/procfs/commit/296791acbf8bde990b42d1a376d3daabe30d401e\"><code>296791a</code></a> Reworked pressure example to be more readable.</li>\n<li>Additional commits viewable in <a href=\"https://github.com/eminence/procfs/compare/v0.16.0...v0.17.0\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `wasm-bindgen` from 0.2.93 to 0.2.94\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/rustwasm/wasm-bindgen/blob/main/CHANGELOG.md\">wasm-bindgen's changelog</a>.</em></p>\n<blockquote>\n<h2><a href=\"https://github.com/rustwasm/wasm-bindgen/compare/0.2.93...0.2.94\">0.2.94</a></h2>\n<p>Released 2024-10-09</p>\n<h3>Added</h3>\n<ul>\n<li>\n<p>Added support for the WebAssembly <code>Tail Call</code> proposal.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4111\">#4111</a></p>\n</li>\n<li>\n<p>Add bindings for <code>RTCPeerConnection.setConfiguration(RTCConfiguration)</code> method.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4105\">#4105</a></p>\n</li>\n<li>\n<p>Add bindings to <code>RTCRtpTransceiverDirection.stopped</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4102\">#4102</a></p>\n</li>\n<li>\n<p>Added experimental support for <code>Symbol.dispose</code> via <code>WASM_BINDGEN_EXPERIMENTAL_SYMBOL_DISPOSE</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4118\">#4118</a></p>\n</li>\n<li>\n<p>Added bindings for the draft <a href=\"https://www.w3.org/TR/webrtc-encoded-transform\">WebRTC Encoded Transform</a> spec.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4125\">#4125</a></p>\n</li>\n<li>\n<p>Added <code>Debug</code> implementation to <code>JsError</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4136\">#4136</a></p>\n</li>\n<li>\n<p>Added support for <code>js_name</code> and <code>skip_typescript</code> attributes for string enums.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4147\">#4147</a></p>\n</li>\n<li>\n<p>Added <code>unsupported</code> crate to <code>wasm_bindgen_test(unsupported = test)</code> as a way of running tests on non-Wasm targets as well.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4150\">#4150</a></p>\n</li>\n<li>\n<p>Added additional bindings for methods taking buffer view types (e.g. <code>&amp;[u8]</code>) with corresponding JS types (e.g. <code>Uint8Array</code>).\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4156\">#4156</a></p>\n</li>\n<li>\n<p>Added additional bindings for setters from WebIDL interface attributes with applicaple parameter types of just <code>JsValue</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4156\">#4156</a></p>\n</li>\n</ul>\n<h3>Changed</h3>\n<ul>\n<li>\n<p>Implicitly enable reference type and multivalue transformations if the module already makes use of the corresponding target features.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4133\">#4133</a></p>\n</li>\n<li>\n<p>Updated Gamepad API.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n<li>\n<p>Deprecated <code>Gamepad::display_id</code> and <code>GamepadHapticActuator::type_</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n<li>\n<p>Removed <code>GamepadAxisMoveEvent</code>, <code>GamepadAxisMoveEventInit</code>, <code>GamepadButtonEvent</code>, <code>GamepadButtonEventInit</code> and <code>GamepadServiceTest</code>, which were seemingly never implemented by any JS environment.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e6c82f5f58fb47c4320e7b926f70480c7c887a93\"><code>e6c82f5</code></a> Prepare v0.2.94 release (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4158\">#4158</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/b1500201df2f51dc7f0f652d777e42c6958ec1df\"><code>b150020</code></a> Properly indent the doc comments of enum variants (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4153\">#4153</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/95bf437f35eaef8ee0756dba8685b2ff2278536c\"><code>95bf437</code></a> Account for <code>[AllowShared]</code> and improve setters generated from interface attr...</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e575aba1ef8b7595feb88fdefc9567a2c48a3a54\"><code>e575aba</code></a> Fix <code>wasm_bindgen_test(unsupported = test)</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4151\">#4151</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/3f4545e58e924c3d6a5085ca8e3a4cdf0004dcc8\"><code>3f4545e</code></a> Add <code>wasm_bindgen_test(unsupported = test)</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4150\">#4150</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/0be2fe5f54739db09981055359726a085b0d5ebe\"><code>0be2fe5</code></a> Improved support for string enums (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4147\">#4147</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/2a0022a1031adfd3dea694df6667d9eb754022b7\"><code>2a0022a</code></a> Specify <code>&quot;type&quot;: &quot;module&quot;</code> when deploying to nodejs-module (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4092\">#4092</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/9725988db74823007a6667e0c17dbeb686b7e6fd\"><code>9725988</code></a> Fix error when importing very large JS files (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4146\">#4146</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/8a8f65c456cbc76dc6f311d93e579a8169438548\"><code>8a8f65c</code></a> Fix <code>experimental-nodejs-module</code> target with <code>#[wasm_bindgen(start)]</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4093\">#4093</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e6e098d78701b51b9f43900fd656d5b6290d3a07\"><code>e6e098d</code></a> Update WebGPU API to draft 2024-10-07 (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4145\">#4145</a>)</li>\n<li>Additional commits viewable in <a href=\"https://github.com/rustwasm/wasm-bindgen/compare/0.2.93...0.2.94\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `wasm-bindgen-backend` from 0.2.93 to 0.2.94\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/rustwasm/wasm-bindgen/blob/main/CHANGELOG.md\">wasm-bindgen-backend's changelog</a>.</em></p>\n<blockquote>\n<h2><a href=\"https://github.com/rustwasm/wasm-bindgen/compare/0.2.93...0.2.94\">0.2.94</a></h2>\n<p>Released 2024-10-09</p>\n<h3>Added</h3>\n<ul>\n<li>\n<p>Added support for the WebAssembly <code>Tail Call</code> proposal.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4111\">#4111</a></p>\n</li>\n<li>\n<p>Add bindings for <code>RTCPeerConnection.setConfiguration(RTCConfiguration)</code> method.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4105\">#4105</a></p>\n</li>\n<li>\n<p>Add bindings to <code>RTCRtpTransceiverDirection.stopped</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4102\">#4102</a></p>\n</li>\n<li>\n<p>Added experimental support for <code>Symbol.dispose</code> via <code>WASM_BINDGEN_EXPERIMENTAL_SYMBOL_DISPOSE</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4118\">#4118</a></p>\n</li>\n<li>\n<p>Added bindings for the draft <a href=\"https://www.w3.org/TR/webrtc-encoded-transform\">WebRTC Encoded Transform</a> spec.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4125\">#4125</a></p>\n</li>\n<li>\n<p>Added <code>Debug</code> implementation to <code>JsError</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4136\">#4136</a></p>\n</li>\n<li>\n<p>Added support for <code>js_name</code> and <code>skip_typescript</code> attributes for string enums.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4147\">#4147</a></p>\n</li>\n<li>\n<p>Added <code>unsupported</code> crate to <code>wasm_bindgen_test(unsupported = test)</code> as a way of running tests on non-Wasm targets as well.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4150\">#4150</a></p>\n</li>\n<li>\n<p>Added additional bindings for methods taking buffer view types (e.g. <code>&amp;[u8]</code>) with corresponding JS types (e.g. <code>Uint8Array</code>).\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4156\">#4156</a></p>\n</li>\n<li>\n<p>Added additional bindings for setters from WebIDL interface attributes with applicaple parameter types of just <code>JsValue</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4156\">#4156</a></p>\n</li>\n</ul>\n<h3>Changed</h3>\n<ul>\n<li>\n<p>Implicitly enable reference type and multivalue transformations if the module already makes use of the corresponding target features.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4133\">#4133</a></p>\n</li>\n<li>\n<p>Updated Gamepad API.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n<li>\n<p>Deprecated <code>Gamepad::display_id</code> and <code>GamepadHapticActuator::type_</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n<li>\n<p>Removed <code>GamepadAxisMoveEvent</code>, <code>GamepadAxisMoveEventInit</code>, <code>GamepadButtonEvent</code>, <code>GamepadButtonEventInit</code> and <code>GamepadServiceTest</code>, which were seemingly never implemented by any JS environment.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e6c82f5f58fb47c4320e7b926f70480c7c887a93\"><code>e6c82f5</code></a> Prepare v0.2.94 release (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4158\">#4158</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/b1500201df2f51dc7f0f652d777e42c6958ec1df\"><code>b150020</code></a> Properly indent the doc comments of enum variants (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4153\">#4153</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/95bf437f35eaef8ee0756dba8685b2ff2278536c\"><code>95bf437</code></a> Account for <code>[AllowShared]</code> and improve setters generated from interface attr...</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e575aba1ef8b7595feb88fdefc9567a2c48a3a54\"><code>e575aba</code></a> Fix <code>wasm_bindgen_test(unsupported = test)</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4151\">#4151</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/3f4545e58e924c3d6a5085ca8e3a4cdf0004dcc8\"><code>3f4545e</code></a> Add <code>wasm_bindgen_test(unsupported = test)</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4150\">#4150</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/0be2fe5f54739db09981055359726a085b0d5ebe\"><code>0be2fe5</code></a> Improved support for string enums (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4147\">#4147</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/2a0022a1031adfd3dea694df6667d9eb754022b7\"><code>2a0022a</code></a> Specify <code>&quot;type&quot;: &quot;module&quot;</code> when deploying to nodejs-module (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4092\">#4092</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/9725988db74823007a6667e0c17dbeb686b7e6fd\"><code>9725988</code></a> Fix error when importing very large JS files (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4146\">#4146</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/8a8f65c456cbc76dc6f311d93e579a8169438548\"><code>8a8f65c</code></a> Fix <code>experimental-nodejs-module</code> target with <code>#[wasm_bindgen(start)]</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4093\">#4093</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e6e098d78701b51b9f43900fd656d5b6290d3a07\"><code>e6e098d</code></a> Update WebGPU API to draft 2024-10-07 (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4145\">#4145</a>)</li>\n<li>Additional commits viewable in <a href=\"https://github.com/rustwasm/wasm-bindgen/compare/0.2.93...0.2.94\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `wasm-bindgen-macro` from 0.2.93 to 0.2.94\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/rustwasm/wasm-bindgen/blob/main/CHANGELOG.md\">wasm-bindgen-macro's changelog</a>.</em></p>\n<blockquote>\n<h2><a href=\"https://github.com/rustwasm/wasm-bindgen/compare/0.2.93...0.2.94\">0.2.94</a></h2>\n<p>Released 2024-10-09</p>\n<h3>Added</h3>\n<ul>\n<li>\n<p>Added support for the WebAssembly <code>Tail Call</code> proposal.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4111\">#4111</a></p>\n</li>\n<li>\n<p>Add bindings for <code>RTCPeerConnection.setConfiguration(RTCConfiguration)</code> method.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4105\">#4105</a></p>\n</li>\n<li>\n<p>Add bindings to <code>RTCRtpTransceiverDirection.stopped</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4102\">#4102</a></p>\n</li>\n<li>\n<p>Added experimental support for <code>Symbol.dispose</code> via <code>WASM_BINDGEN_EXPERIMENTAL_SYMBOL_DISPOSE</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4118\">#4118</a></p>\n</li>\n<li>\n<p>Added bindings for the draft <a href=\"https://www.w3.org/TR/webrtc-encoded-transform\">WebRTC Encoded Transform</a> spec.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4125\">#4125</a></p>\n</li>\n<li>\n<p>Added <code>Debug</code> implementation to <code>JsError</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4136\">#4136</a></p>\n</li>\n<li>\n<p>Added support for <code>js_name</code> and <code>skip_typescript</code> attributes for string enums.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4147\">#4147</a></p>\n</li>\n<li>\n<p>Added <code>unsupported</code> crate to <code>wasm_bindgen_test(unsupported = test)</code> as a way of running tests on non-Wasm targets as well.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4150\">#4150</a></p>\n</li>\n<li>\n<p>Added additional bindings for methods taking buffer view types (e.g. <code>&amp;[u8]</code>) with corresponding JS types (e.g. <code>Uint8Array</code>).\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4156\">#4156</a></p>\n</li>\n<li>\n<p>Added additional bindings for setters from WebIDL interface attributes with applicaple parameter types of just <code>JsValue</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4156\">#4156</a></p>\n</li>\n</ul>\n<h3>Changed</h3>\n<ul>\n<li>\n<p>Implicitly enable reference type and multivalue transformations if the module already makes use of the corresponding target features.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4133\">#4133</a></p>\n</li>\n<li>\n<p>Updated Gamepad API.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n<li>\n<p>Deprecated <code>Gamepad::display_id</code> and <code>GamepadHapticActuator::type_</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n<li>\n<p>Removed <code>GamepadAxisMoveEvent</code>, <code>GamepadAxisMoveEventInit</code>, <code>GamepadButtonEvent</code>, <code>GamepadButtonEventInit</code> and <code>GamepadServiceTest</code>, which were seemingly never implemented by any JS environment.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e6c82f5f58fb47c4320e7b926f70480c7c887a93\"><code>e6c82f5</code></a> Prepare v0.2.94 release (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4158\">#4158</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/b1500201df2f51dc7f0f652d777e42c6958ec1df\"><code>b150020</code></a> Properly indent the doc comments of enum variants (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4153\">#4153</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/95bf437f35eaef8ee0756dba8685b2ff2278536c\"><code>95bf437</code></a> Account for <code>[AllowShared]</code> and improve setters generated from interface attr...</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e575aba1ef8b7595feb88fdefc9567a2c48a3a54\"><code>e575aba</code></a> Fix <code>wasm_bindgen_test(unsupported = test)</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4151\">#4151</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/3f4545e58e924c3d6a5085ca8e3a4cdf0004dcc8\"><code>3f4545e</code></a> Add <code>wasm_bindgen_test(unsupported = test)</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4150\">#4150</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/0be2fe5f54739db09981055359726a085b0d5ebe\"><code>0be2fe5</code></a> Improved support for string enums (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4147\">#4147</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/2a0022a1031adfd3dea694df6667d9eb754022b7\"><code>2a0022a</code></a> Specify <code>&quot;type&quot;: &quot;module&quot;</code> when deploying to nodejs-module (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4092\">#4092</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/9725988db74823007a6667e0c17dbeb686b7e6fd\"><code>9725988</code></a> Fix error when importing very large JS files (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4146\">#4146</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/8a8f65c456cbc76dc6f311d93e579a8169438548\"><code>8a8f65c</code></a> Fix <code>experimental-nodejs-module</code> target with <code>#[wasm_bindgen(start)]</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4093\">#4093</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e6e098d78701b51b9f43900fd656d5b6290d3a07\"><code>e6e098d</code></a> Update WebGPU API to draft 2024-10-07 (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4145\">#4145</a>)</li>\n<li>Additional commits viewable in <a href=\"https://github.com/rustwasm/wasm-bindgen/compare/0.2.93...0.2.94\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `wasm-bindgen-macro-support` from 0.2.93 to 0.2.94\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/rustwasm/wasm-bindgen/blob/main/CHANGELOG.md\">wasm-bindgen-macro-support's changelog</a>.</em></p>\n<blockquote>\n<h2><a href=\"https://github.com/rustwasm/wasm-bindgen/compare/0.2.93...0.2.94\">0.2.94</a></h2>\n<p>Released 2024-10-09</p>\n<h3>Added</h3>\n<ul>\n<li>\n<p>Added support for the WebAssembly <code>Tail Call</code> proposal.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4111\">#4111</a></p>\n</li>\n<li>\n<p>Add bindings for <code>RTCPeerConnection.setConfiguration(RTCConfiguration)</code> method.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4105\">#4105</a></p>\n</li>\n<li>\n<p>Add bindings to <code>RTCRtpTransceiverDirection.stopped</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4102\">#4102</a></p>\n</li>\n<li>\n<p>Added experimental support for <code>Symbol.dispose</code> via <code>WASM_BINDGEN_EXPERIMENTAL_SYMBOL_DISPOSE</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4118\">#4118</a></p>\n</li>\n<li>\n<p>Added bindings for the draft <a href=\"https://www.w3.org/TR/webrtc-encoded-transform\">WebRTC Encoded Transform</a> spec.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4125\">#4125</a></p>\n</li>\n<li>\n<p>Added <code>Debug</code> implementation to <code>JsError</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4136\">#4136</a></p>\n</li>\n<li>\n<p>Added support for <code>js_name</code> and <code>skip_typescript</code> attributes for string enums.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4147\">#4147</a></p>\n</li>\n<li>\n<p>Added <code>unsupported</code> crate to <code>wasm_bindgen_test(unsupported = test)</code> as a way of running tests on non-Wasm targets as well.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4150\">#4150</a></p>\n</li>\n<li>\n<p>Added additional bindings for methods taking buffer view types (e.g. <code>&amp;[u8]</code>) with corresponding JS types (e.g. <code>Uint8Array</code>).\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4156\">#4156</a></p>\n</li>\n<li>\n<p>Added additional bindings for setters from WebIDL interface attributes with applicaple parameter types of just <code>JsValue</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4156\">#4156</a></p>\n</li>\n</ul>\n<h3>Changed</h3>\n<ul>\n<li>\n<p>Implicitly enable reference type and multivalue transformations if the module already makes use of the corresponding target features.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4133\">#4133</a></p>\n</li>\n<li>\n<p>Updated Gamepad API.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n<li>\n<p>Deprecated <code>Gamepad::display_id</code> and <code>GamepadHapticActuator::type_</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n<li>\n<p>Removed <code>GamepadAxisMoveEvent</code>, <code>GamepadAxisMoveEventInit</code>, <code>GamepadButtonEvent</code>, <code>GamepadButtonEventInit</code> and <code>GamepadServiceTest</code>, which were seemingly never implemented by any JS environment.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e6c82f5f58fb47c4320e7b926f70480c7c887a93\"><code>e6c82f5</code></a> Prepare v0.2.94 release (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4158\">#4158</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/b1500201df2f51dc7f0f652d777e42c6958ec1df\"><code>b150020</code></a> Properly indent the doc comments of enum variants (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4153\">#4153</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/95bf437f35eaef8ee0756dba8685b2ff2278536c\"><code>95bf437</code></a> Account for <code>[AllowShared]</code> and improve setters generated from interface attr...</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e575aba1ef8b7595feb88fdefc9567a2c48a3a54\"><code>e575aba</code></a> Fix <code>wasm_bindgen_test(unsupported = test)</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4151\">#4151</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/3f4545e58e924c3d6a5085ca8e3a4cdf0004dcc8\"><code>3f4545e</code></a> Add <code>wasm_bindgen_test(unsupported = test)</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4150\">#4150</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/0be2fe5f54739db09981055359726a085b0d5ebe\"><code>0be2fe5</code></a> Improved support for string enums (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4147\">#4147</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/2a0022a1031adfd3dea694df6667d9eb754022b7\"><code>2a0022a</code></a> Specify <code>&quot;type&quot;: &quot;module&quot;</code> when deploying to nodejs-module (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4092\">#4092</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/9725988db74823007a6667e0c17dbeb686b7e6fd\"><code>9725988</code></a> Fix error when importing very large JS files (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4146\">#4146</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/8a8f65c456cbc76dc6f311d93e579a8169438548\"><code>8a8f65c</code></a> Fix <code>experimental-nodejs-module</code> target with <code>#[wasm_bindgen(start)]</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4093\">#4093</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e6e098d78701b51b9f43900fd656d5b6290d3a07\"><code>e6e098d</code></a> Update WebGPU API to draft 2024-10-07 (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4145\">#4145</a>)</li>\n<li>Additional commits viewable in <a href=\"https://github.com/rustwasm/wasm-bindgen/compare/0.2.93...0.2.94\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `wasm-bindgen-shared` from 0.2.93 to 0.2.94\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/rustwasm/wasm-bindgen/blob/main/CHANGELOG.md\">wasm-bindgen-shared's changelog</a>.</em></p>\n<blockquote>\n<h2><a href=\"https://github.com/rustwasm/wasm-bindgen/compare/0.2.93...0.2.94\">0.2.94</a></h2>\n<p>Released 2024-10-09</p>\n<h3>Added</h3>\n<ul>\n<li>\n<p>Added support for the WebAssembly <code>Tail Call</code> proposal.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4111\">#4111</a></p>\n</li>\n<li>\n<p>Add bindings for <code>RTCPeerConnection.setConfiguration(RTCConfiguration)</code> method.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4105\">#4105</a></p>\n</li>\n<li>\n<p>Add bindings to <code>RTCRtpTransceiverDirection.stopped</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4102\">#4102</a></p>\n</li>\n<li>\n<p>Added experimental support for <code>Symbol.dispose</code> via <code>WASM_BINDGEN_EXPERIMENTAL_SYMBOL_DISPOSE</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4118\">#4118</a></p>\n</li>\n<li>\n<p>Added bindings for the draft <a href=\"https://www.w3.org/TR/webrtc-encoded-transform\">WebRTC Encoded Transform</a> spec.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4125\">#4125</a></p>\n</li>\n<li>\n<p>Added <code>Debug</code> implementation to <code>JsError</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4136\">#4136</a></p>\n</li>\n<li>\n<p>Added support for <code>js_name</code> and <code>skip_typescript</code> attributes for string enums.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4147\">#4147</a></p>\n</li>\n<li>\n<p>Added <code>unsupported</code> crate to <code>wasm_bindgen_test(unsupported = test)</code> as a way of running tests on non-Wasm targets as well.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4150\">#4150</a></p>\n</li>\n<li>\n<p>Added additional bindings for methods taking buffer view types (e.g. <code>&amp;[u8]</code>) with corresponding JS types (e.g. <code>Uint8Array</code>).\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4156\">#4156</a></p>\n</li>\n<li>\n<p>Added additional bindings for setters from WebIDL interface attributes with applicaple parameter types of just <code>JsValue</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4156\">#4156</a></p>\n</li>\n</ul>\n<h3>Changed</h3>\n<ul>\n<li>\n<p>Implicitly enable reference type and multivalue transformations if the module already makes use of the corresponding target features.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4133\">#4133</a></p>\n</li>\n<li>\n<p>Updated Gamepad API.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n<li>\n<p>Deprecated <code>Gamepad::display_id</code> and <code>GamepadHapticActuator::type_</code>.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n<li>\n<p>Removed <code>GamepadAxisMoveEvent</code>, <code>GamepadAxisMoveEventInit</code>, <code>GamepadButtonEvent</code>, <code>GamepadButtonEventInit</code> and <code>GamepadServiceTest</code>, which were seemingly never implemented by any JS environment.\n<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/pull/4134\">#4134</a></p>\n</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e6c82f5f58fb47c4320e7b926f70480c7c887a93\"><code>e6c82f5</code></a> Prepare v0.2.94 release (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4158\">#4158</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/b1500201df2f51dc7f0f652d777e42c6958ec1df\"><code>b150020</code></a> Properly indent the doc comments of enum variants (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4153\">#4153</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/95bf437f35eaef8ee0756dba8685b2ff2278536c\"><code>95bf437</code></a> Account for <code>[AllowShared]</code> and improve setters generated from interface attr...</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e575aba1ef8b7595feb88fdefc9567a2c48a3a54\"><code>e575aba</code></a> Fix <code>wasm_bindgen_test(unsupported = test)</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4151\">#4151</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/3f4545e58e924c3d6a5085ca8e3a4cdf0004dcc8\"><code>3f4545e</code></a> Add <code>wasm_bindgen_test(unsupported = test)</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4150\">#4150</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/0be2fe5f54739db09981055359726a085b0d5ebe\"><code>0be2fe5</code></a> Improved support for string enums (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4147\">#4147</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/2a0022a1031adfd3dea694df6667d9eb754022b7\"><code>2a0022a</code></a> Specify <code>&quot;type&quot;: &quot;module&quot;</code> when deploying to nodejs-module (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4092\">#4092</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/9725988db74823007a6667e0c17dbeb686b7e6fd\"><code>9725988</code></a> Fix error when importing very large JS files (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4146\">#4146</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/8a8f65c456cbc76dc6f311d93e579a8169438548\"><code>8a8f65c</code></a> Fix <code>experimental-nodejs-module</code> target with <code>#[wasm_bindgen(start)]</code> (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4093\">#4093</a>)</li>\n<li><a href=\"https://github.com/rustwasm/wasm-bindgen/commit/e6e098d78701b51b9f43900fd656d5b6290d3a07\"><code>e6e098d</code></a> Update WebGPU API to draft 2024-10-07 (<a href=\"https://redirect.github.com/rustwasm/wasm-bindgen/issues/4145\">#4145</a>)</li>\n<li>Additional commits viewable in <a href=\"https://github.com/rustwasm/wasm-bindgen/compare/0.2.93...0.2.94\">compare view</a></li>\n</ul>\n</details>\n<br />\n\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[//]: # (dependabot-automerge-start)\n[//]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options</summary>\n<br />\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot show <dependency name> ignore conditions` will show all of the ignore conditions of the specified dependency\n- `@dependabot ignore <dependency name> major version` will close this group update PR and stop Dependabot creating any more for the specific dependency's major version (unless you unignore this specific dependency's major version or upgrade to it yourself)\n- `@dependabot ignore <dependency name> minor version` will close this group update PR and stop Dependabot creating any more for the specific dependency's minor version (unless you unignore this specific dependency's minor version or upgrade to it yourself)\n- `@dependabot ignore <dependency name>` will close this group update PR and stop Dependabot creating any more for the specific dependency (unless you unignore this specific dependency or upgrade to it yourself)\n- `@dependabot unignore <dependency name>` will remove all of the ignore conditions of the specified dependency\n- `@dependabot unignore <dependency name> <ignore condition>` will remove the ignore condition of the specified dependency and ignore conditions\n\n\n</details>", "diff": "diff --git a/apd/Cargo.lock b/apd/Cargo.lock\nindex e6d9931bd..b22653058 100644\n--- a/apd/Cargo.lock\n+++ b/apd/Cargo.lock\n@@ -240,9 +240,9 @@ checksum = \"428d9aa8fbc0670b7b8d6030a7fadd0f86151cae55e4dbbece15f3780a3dfaf3\"\n \n [[package]]\n name = \"cc\"\n-version = \"1.1.25\"\n+version = \"1.1.28\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"e8d9e0b4957f635b8d3da819d0db5603620467ecf1f692d22a8c2717ce27e6d8\"\n+checksum = \"2e80e3b6a3ab07840e1cae9b0666a63970dc28e8ed5ffbcdacbfc760c281bfc1\"\n dependencies = [\n  \"shlex\",\n ]\n@@ -269,9 +269,9 @@ dependencies = [\n \n [[package]]\n name = \"clap\"\n-version = \"4.5.19\"\n+version = \"4.5.20\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7be5744db7978a28d9df86a214130d106a89ce49644cbc4e3f0c22c3fba30615\"\n+checksum = \"b97f376d85a664d5837dbae44bf546e6477a679ff6610010f17276f686d867e8\"\n dependencies = [\n  \"clap_builder\",\n  \"clap_derive\",\n@@ -279,9 +279,9 @@ dependencies = [\n \n [[package]]\n name = \"clap_builder\"\n-version = \"4.5.19\"\n+version = \"4.5.20\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a5fbc17d3ef8278f55b282b2a2e75ae6f6c7d4bb70ed3d0382375104bfafdb4b\"\n+checksum = \"19bc80abd44e4bed93ca373a0704ccbd1b710dc5749406201bb018272808dc54\"\n dependencies = [\n  \"anstream\",\n  \"anstyle\",\n@@ -804,9 +804,9 @@ dependencies = [\n \n [[package]]\n name = \"js-sys\"\n-version = \"0.3.70\"\n+version = \"0.3.71\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"1868808506b929d7b0cfa8f75951347aa71bb21144b7791bae35d9bccfcfe37a\"\n+checksum = \"0cb94a0ffd3f3ee755c20f7d8752f45cac88605a4dcf808abcff72873296ec7b\"\n dependencies = [\n  \"wasm-bindgen\",\n ]\n@@ -995,12 +995,9 @@ dependencies = [\n \n [[package]]\n name = \"once_cell\"\n-version = \"1.20.1\"\n+version = \"1.20.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"82881c4be219ab5faaf2ad5e5e5ecdff8c66bd7402ca3160975c93b24961afd1\"\n-dependencies = [\n- \"portable-atomic\",\n-]\n+checksum = \"1261fe7e33c73b354eab43b1273a57c8f967d0391e80353e51f764ac02cf6775\"\n \n [[package]]\n name = \"pin-project-lite\"\n@@ -1008,12 +1005,6 @@ version = \"0.2.14\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"bda66fc9667c18cb2758a2ac84d1167245054bcf85d5d1aaa6923f45801bdd02\"\n \n-[[package]]\n-name = \"portable-atomic\"\n-version = \"1.9.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"cc9c68a3f6da06753e9335d63e27f6b9754dd1920d941135b7ea8224f141adb2\"\n-\n [[package]]\n name = \"powerfmt\"\n version = \"0.2.0\"\n@@ -1031,33 +1022,32 @@ dependencies = [\n \n [[package]]\n name = \"proc-macro2\"\n-version = \"1.0.86\"\n+version = \"1.0.87\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"5e719e8df665df0d1c8fbfd238015744736151d4445ec0836b8e628aae103b77\"\n+checksum = \"b3e4daa0dcf6feba26f985457cdf104d4b4256fc5a09547140f3631bb076b19a\"\n dependencies = [\n  \"unicode-ident\",\n ]\n \n [[package]]\n name = \"procfs\"\n-version = \"0.16.0\"\n+version = \"0.17.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"731e0d9356b0c25f16f33b5be79b1c57b562f141ebfcdb0ad8ac2c13a24293b4\"\n+checksum = \"cc5b72d8145275d844d4b5f6d4e1eef00c8cd889edb6035c21675d1bb1f45c9f\"\n dependencies = [\n  \"bitflags 2.6.0\",\n  \"chrono\",\n  \"flate2\",\n  \"hex\",\n- \"lazy_static\",\n  \"procfs-core\",\n  \"rustix 0.38.37\",\n ]\n \n [[package]]\n name = \"procfs-core\"\n-version = \"0.16.0\"\n+version = \"0.17.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"2d3554923a69f4ce04c4a754260c338f505ce22642d3830e049a399fc2059a29\"\n+checksum = \"239df02d8349b06fc07398a3a1697b06418223b1c7725085e801e7c0fc6a12ec\"\n dependencies = [\n  \"bitflags 2.6.0\",\n  \"chrono\",\n@@ -1469,9 +1459,9 @@ checksum = \"9c8d87e72b64a3b4db28d11ce29237c246188f4f51057d65a7eab63b7987e423\"\n \n [[package]]\n name = \"wasm-bindgen\"\n-version = \"0.2.93\"\n+version = \"0.2.94\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a82edfc16a6c469f5f44dc7b571814045d60404b55a0ee849f9bcfa2e63dd9b5\"\n+checksum = \"ef073ced962d62984fb38a36e5fdc1a2b23c9e0e1fa0689bb97afa4202ef6887\"\n dependencies = [\n  \"cfg-if\",\n  \"once_cell\",\n@@ -1480,9 +1470,9 @@ dependencies = [\n \n [[package]]\n name = \"wasm-bindgen-backend\"\n-version = \"0.2.93\"\n+version = \"0.2.94\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9de396da306523044d3302746f1208fa71d7532227f15e347e2d93e4145dd77b\"\n+checksum = \"c4bfab14ef75323f4eb75fa52ee0a3fb59611977fd3240da19b2cf36ff85030e\"\n dependencies = [\n  \"bumpalo\",\n  \"log\",\n@@ -1495,9 +1485,9 @@ dependencies = [\n \n [[package]]\n name = \"wasm-bindgen-macro\"\n-version = \"0.2.93\"\n+version = \"0.2.94\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"585c4c91a46b072c92e908d99cb1dcdf95c5218eeb6f3bf1efa991ee7a68cccf\"\n+checksum = \"a7bec9830f60924d9ceb3ef99d55c155be8afa76954edffbb5936ff4509474e7\"\n dependencies = [\n  \"quote\",\n  \"wasm-bindgen-macro-support\",\n@@ -1505,9 +1495,9 @@ dependencies = [\n \n [[package]]\n name = \"wasm-bindgen-macro-support\"\n-version = \"0.2.93\"\n+version = \"0.2.94\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"afc340c74d9005395cf9dd098506f7f44e38f2b4a21c6aaacf9a105ea5e1e836\"\n+checksum = \"4c74f6e152a76a2ad448e223b0fc0b6b5747649c3d769cc6bf45737bf97d0ed6\"\n dependencies = [\n  \"proc-macro2\",\n  \"quote\",\n@@ -1518,9 +1508,9 @@ dependencies = [\n \n [[package]]\n name = \"wasm-bindgen-shared\"\n-version = \"0.2.93\"\n+version = \"0.2.94\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"c62a0a307cb4a311d3a07867860911ca130c3494e8c2719593806c08bc5d0484\"\n+checksum = \"a42f6c679374623f295a8623adfe63d9284091245c3504bde47c17a3ce2777d9\"\n \n [[package]]\n name = \"which\"\ndiff --git a/apd/Cargo.toml b/apd/Cargo.toml\nindex 871a92ea1..b62c66872 100644\n--- a/apd/Cargo.toml\n+++ b/apd/Cargo.toml\n@@ -45,7 +45,7 @@ notify = \"6.1\"\n rustix = { git = \"https://github.com/AndroidPatch/rustix\", branch = \"main\", features = [\"all-apis\"] }\n # some android specific dependencies which compiles under unix are also listed here for convenience of coding\n android-properties = { version = \"0.2.2\", features = [\"bionic-deprecated\"] }\n-procfs = \"0.16\"\n+procfs = \"0.17\"\n loopdev = { git = \"https://github.com/AndroidPatch/loopdev\" }\n \n [target.'cfg(target_os = \"android\")'.dependencies]\n", "changes": [{"file": "apd/Cargo.toml", "module": "apd.procfs", "range": [{"start": 48, "end": 49}]}, {"file": "apd/Cargo.lock", "module": "apd.procfs", "range": [{"start": 243, "end": 244}, {"start": 245, "end": 246}, {"start": 272, "end": 273}, {"start": 274, "end": 275}, {"start": 282, "end": 283}, {"start": 284, "end": 285}, {"start": 807, "end": 808}, {"start": 809, "end": 810}, {"start": 998, "end": 999}, {"start": 1000, "end": 1004}, {"start": 1011, "end": 1016}, {"start": 1034, "end": 1035}, {"start": 1036, "end": 1037}, {"start": 1043, "end": 1044}, {"start": 1045, "end": 1046}, {"start": 1051, "end": 1051}, {"start": 1058, "end": 1059}, {"start": 1060, "end": 1061}, {"start": 1472, "end": 1473}, {"start": 1474, "end": 1475}, {"start": 1483, "end": 1484}, {"start": 1485, "end": 1486}, {"start": 1498, "end": 1499}, {"start": 1500, "end": 1501}, {"start": 1508, "end": 1509}, {"start": 1510, "end": 1511}, {"start": 1521, "end": 1522}, {"start": 1523, "end": 1524}]}]}, {"number": 347, "url": "https://github.com/bmax121/APatch/pull/347", "diff_url": "https://github.com/bmax121/APatch/pull/347.diff", "patch_url": "https://github.com/bmax121/APatch/pull/347.patch", "title": "build(deps): bump the rust-dependencies group in /apd with 15 updates", "content": "Bumps the rust-dependencies group in /apd with 15 updates:\n\n| Package | From | To |\n| --- | --- | --- |\n| [anyhow](https://github.com/dtolnay/anyhow) | `1.0.68` | `1.0.81` |\n| [clap](https://github.com/clap-rs/clap) | `4.1.4` | `4.5.4` |\n| [const_format](https://github.com/rodrimati1992/const_format_crates) | `0.2.30` | `0.2.32` |\n| [zip](https://github.com/zip-rs/zip) | `0.6.4` | `0.6.6` |\n| [zip-extensions](https://github.com/matzefriedrich/zip-extensions-rs) | `0.6.1` | `0.6.2` |\n| [log](https://github.com/rust-lang/log) | `0.4.17` | `0.4.21` |\n| [env_logger](https://github.com/rust-cli/env_logger) | `0.10.0` | `0.11.3` |\n| [serde](https://github.com/serde-rs/serde) | `1.0.152` | `1.0.193` |\n| [serde_json](https://github.com/serde-rs/json) | `1.0.91` | `1.0.109` |\n| [regex](https://github.com/rust-lang/regex) | `1.7.1` | `1.9.4` |\n| [rust-embed](https://github.com/pyros2097/rust-embed) | `8.0.0` | `8.3.0` |\n| [which](https://github.com/harryfei/which-rs) | `5.0.0` | `6.0.1` |\n| [sha256](https://github.com/baoyachi/sha256-rs) | `1.4.0` | `1.5.0` |\n| [chrono](https://github.com/chronotope/chrono) | `0.4.23` | `0.4.37` |\n| [android_logger](https://github.com/rust-mobile/android_logger-rs) | `0.13.0` | `0.13.3` |\n\nUpdates `anyhow` from 1.0.68 to 1.0.81\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/dtolnay/anyhow/releases\">anyhow's releases</a>.</em></p>\n<blockquote>\n<h2>1.0.81</h2>\n<ul>\n<li>Make backtrace support available when using -Dwarnings (<a href=\"https://redirect.github.com/dtolnay/anyhow/issues/354\">#354</a>)</li>\n</ul>\n<h2>1.0.80</h2>\n<ul>\n<li>Fix unused_imports warnings when compiled by rustc 1.78</li>\n</ul>\n<h2>1.0.79</h2>\n<ul>\n<li>Work around improperly cached build script result by sccache (<a href=\"https://redirect.github.com/dtolnay/anyhow/issues/340\">#340</a>)</li>\n</ul>\n<h2>1.0.78</h2>\n<ul>\n<li>Reduce spurious rebuilds under RustRover IDE when using a nightly toolchain (<a href=\"https://redirect.github.com/dtolnay/anyhow/issues/337\">#337</a>)</li>\n</ul>\n<h2>1.0.77</h2>\n<ul>\n<li>Make <code>anyhow::Error::backtrace</code> available on stable Rust compilers 1.65+ (<a href=\"https://redirect.github.com/dtolnay/anyhow/issues/293\">#293</a>, thanks <a href=\"https://github.com/LukasKalbertodt\"><code>@LukasKalbertodt</code></a>)</li>\n</ul>\n<h2>1.0.76</h2>\n<ul>\n<li>Opt in to <code>unsafe_op_in_unsafe_fn</code> lint (<a href=\"https://redirect.github.com/dtolnay/anyhow/issues/329\">#329</a>)</li>\n</ul>\n<h2>1.0.75</h2>\n<ul>\n<li>Partially work around rust-analyzer bug (<a href=\"https://redirect.github.com/rust-lang/rust-analyzer/issues/9911\">rust-lang/rust-analyzer#9911</a>)</li>\n</ul>\n<h2>1.0.74</h2>\n<ul>\n<li>Add bootstrap workaround to allow rustc to depend on anyhow (<a href=\"https://redirect.github.com/dtolnay/anyhow/issues/320\">#320</a>, thanks <a href=\"https://github.com/RalfJung\"><code>@RalfJung</code></a>)</li>\n</ul>\n<h2>1.0.73</h2>\n<ul>\n<li>Update backtrace support to nightly's new Error::provide API (<a href=\"https://redirect.github.com/rust-lang/rust/pull/113464\">rust-lang/rust#113464</a>, <a href=\"https://redirect.github.com/dtolnay/anyhow/issues/319\">#319</a>)</li>\n</ul>\n<h2>1.0.72</h2>\n<ul>\n<li>Documentation improvements</li>\n</ul>\n<h2>1.0.71</h2>\n<ul>\n<li>Documentation improvements</li>\n</ul>\n<h2>1.0.70</h2>\n<ul>\n<li>Update syn dependency to 2.x</li>\n</ul>\n<h2>1.0.69</h2>\n<ul>\n<li>Documentation improvements</li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/dtolnay/anyhow/commit/4aad4edebd9f09247d6c6b6784419a74bb116829\"><code>4aad4ed</code></a> Release 1.0.81</li>\n<li><a href=\"https://github.com/dtolnay/anyhow/commit/8be90917c603199c5d1fdd73984237f023768e22\"><code>8be9091</code></a> Merge pull request <a href=\"https://redirect.github.com/dtolnay/anyhow/issues/354\">#354</a> from dtolnay/deadcode</li>\n<li><a href=\"https://github.com/dtolnay/anyhow/commit/a2eb7dd5e13add83f254b6dac0f68e043effc521\"><code>a2eb7dd</code></a> Make compatible with -Dwarnings</li>\n<li><a href=\"https://github.com/dtolnay/anyhow/commit/54437197ee79c20678db433d98616fab7ddff1a5\"><code>5443719</code></a> Release 1.0.80</li>\n<li><a href=\"https://github.com/dtolnay/anyhow/commit/dfc7bc07d4c41b61093c3251ed82becb51810bd4\"><code>dfc7bc0</code></a> Work around prelude redundant import warnings</li>\n<li><a href=\"https://github.com/dtolnay/anyhow/commit/6e4f86b48b5182ec71dbc8e308db9dc91e2ec8a5\"><code>6e4f86b</code></a> Import from alloc not std, where possible</li>\n<li><a href=\"https://github.com/dtolnay/anyhow/commit/f885a133ede579c45e90ab489455126403d05db1\"><code>f885a13</code></a> Ignore incompatible_msrv clippy false positives in test</li>\n<li><a href=\"https://github.com/dtolnay/anyhow/commit/fefbcbcb0b336a2d6c2ce6f0ee6d3fd02ef2cd3b\"><code>fefbcbc</code></a> Ignore incompatible_msrv clippy lint</li>\n<li><a href=\"https://github.com/dtolnay/anyhow/commit/78f2d81cc71b79050a2fda270c45ff267557d853\"><code>78f2d81</code></a> Update ui test suite to nightly-2024-02-08</li>\n<li><a href=\"https://github.com/dtolnay/anyhow/commit/edd88d3a43f11f1931330d3dd54189353ef00203\"><code>edd88d3</code></a> Update ui test suite to nightly-2024-01-31</li>\n<li>Additional commits viewable in <a href=\"https://github.com/dtolnay/anyhow/compare/1.0.68...1.0.81\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `clap` from 4.1.4 to 4.5.4\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/clap-rs/clap/releases\">clap's releases</a>.</em></p>\n<blockquote>\n<h2>v4.5.4</h2>\n<h2>[4.5.4] - 2024-03-25</h2>\n<h3>Fixes</h3>\n<ul>\n<li><em>(derive)</em> Allow non-literal <code>#[arg(id)]</code> attributes again</li>\n</ul>\n<h2>v4.5.3</h2>\n<h2>[4.5.3] - 2024-03-15</h2>\n<h3>Internal</h3>\n<ul>\n<li><em>(derive)</em> Update <code>heck</code></li>\n</ul>\n<h2>v4.5.2</h2>\n<h2>[4.5.2] - 2024-03-06</h2>\n<h3>Fixes</h3>\n<ul>\n<li><em>(macros)</em> Silence a warning</li>\n</ul>\n<h2>v4.5.1</h2>\n<h2>[4.5.1] - 2024-02-16</h2>\n<h3>Fixes</h3>\n<ul>\n<li><em>(error)</em> Include suggestion to add <code>--</code> even if there is a &quot;did you mean&quot; so long as <code>last</code> or <code>trailing_var_arg</code> is used</li>\n</ul>\n<h2>v4.5.0</h2>\n<p>No release notes provided.</p>\n<h2>v4.4.18</h2>\n<h2>[4.4.18] - 2024-01-16</h2>\n<h3>Fixes</h3>\n<ul>\n<li><em>(error)</em> When lacking <code>usage</code> feature, ensure the list of required arguments is unique</li>\n</ul>\n<h2>v4.4.17</h2>\n<h2>[4.4.17] - 2024-01-15</h2>\n<h3>Fixes</h3>\n<ul>\n<li>Fix <code>panic!</code> when mixing <code>args_conflicts_with_subcommands</code> with <code>ArgGroup</code> (which is implicit with <code>derive</code>) introduced in 4.4.15</li>\n</ul>\n<h2>v4.4.16</h2>\n<h2>[4.4.16] - 2024-01-12</h2>\n<h3>Fixes</h3>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/clap-rs/clap/blob/master/CHANGELOG.md\">clap's changelog</a>.</em></p>\n<blockquote>\n<h2>[4.5.4] - 2024-03-25</h2>\n<h3>Fixes</h3>\n<ul>\n<li><em>(derive)</em> Allow non-literal <code>#[arg(id)]</code> attributes again</li>\n</ul>\n<h2>[4.5.3] - 2024-03-15</h2>\n<h3>Internal</h3>\n<ul>\n<li><em>(derive)</em> Update <code>heck</code></li>\n</ul>\n<h2>[4.5.2] - 2024-03-06</h2>\n<h3>Fixes</h3>\n<ul>\n<li><em>(macros)</em> Silence a warning</li>\n</ul>\n<h2>[4.5.1] - 2024-02-16</h2>\n<h3>Fixes</h3>\n<ul>\n<li><em>(error)</em> Include suggestion to add <code>--</code> even if there is a &quot;did you mean&quot; so long as <code>last</code> or <code>trailing_var_arg</code> is used</li>\n</ul>\n<h2>[4.5.0] - 2024-02-08</h2>\n<h3>Compatibility</h3>\n<ul>\n<li>Update MSRV to 1.74</li>\n</ul>\n<h2>[4.4.18] - 2024-01-16</h2>\n<h3>Fixes</h3>\n<ul>\n<li><em>(error)</em> When lacking <code>usage</code> feature, ensure the list of required arguments is unique</li>\n</ul>\n<h2>[4.4.17] - 2024-01-15</h2>\n<h3>Fixes</h3>\n<ul>\n<li>Fix <code>panic!</code> when mixing <code>args_conflicts_with_subcommands</code> with <code>ArgGroup</code> (which is implicit with <code>derive</code>) introduced in 4.4.15</li>\n</ul>\n<h2>[4.4.16] - 2024-01-12</h2>\n<h3>Fixes</h3>\n<ul>\n<li>Ensure invalid escape sequences in user-defined strings are correctly stripped when terminal doesn't support color</li>\n</ul>\n<h2>[4.4.15] - 2024-01-11</h2>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/clap-rs/clap/commit/5e4facf76fb38e04edba6cb1ab67d4f2b1ec8550\"><code>5e4facf</code></a> chore: Release</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/8880b0a5da1160892187c4b372881c9a5e2280c2\"><code>8880b0a</code></a> docs: Update changelog</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/132b5dded50e3e4341931f4894ccb2746196c741\"><code>132b5dd</code></a> Merge pull request <a href=\"https://redirect.github.com/clap-rs/clap/issues/5425\">#5425</a> from epage/lit</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/df915fefefba42493290c4f7c4ac627807e9ebd4\"><code>df915fe</code></a> fix(derive): Re-allow expressions for id's</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/8eab48fa3c9d6a40128c601b2520d33c7b3e6c2a\"><code>8eab48f</code></a> refactor(derive): Make it easier to work with 'Name'</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/be73195ecfe8a082783765f87036ce9ecf1ce7c8\"><code>be73195</code></a> refactor(derive): Clarify tests</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/024089bb602ee6f55ab1fd8494a20eb9b21c6b5e\"><code>024089b</code></a> Merge pull request <a href=\"https://redirect.github.com/clap-rs/clap/issues/5415\">#5415</a> from Pi-Cla/patch-1</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/3b35dba1600ff84e6207668d9cba11276fa1c5b5\"><code>3b35dba</code></a> docs: Add mention of nushell to clap_complete README</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/58469d1669fa1e05080263fb38b12fb2d7b78180\"><code>58469d1</code></a> Merge pull request <a href=\"https://redirect.github.com/clap-rs/clap/issues/5405\">#5405</a> from epage/docs</li>\n<li><a href=\"https://github.com/clap-rs/clap/commit/655d8295a7f2e8a4c655a11ba578636428a3c9ac\"><code>655d829</code></a> docs(derive): Fix ToC links within tutorial chapters</li>\n<li>Additional commits viewable in <a href=\"https://github.com/clap-rs/clap/compare/clap_complete-v4.1.4...v4.5.4\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `const_format` from 0.2.30 to 0.2.32\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/rodrimati1992/const_format_crates/blob/master/Changelog.md\">const_format's changelog</a>.</em></p>\n<blockquote>\n<h3>0.2.32</h3>\n<p>Breaking change: bumped Minimum Supported Rust Version to Rust 1.57 and changed crate's edition to 2021. This change is motivated by proc-macro2 increasing its MSRV to 1.56.</p>\n<p>Changed these items that needed the <code>&quot;rust_1_51&quot;</code> feature into always being enabled:</p>\n<ul>\n<li><code>map_ascii_case</code></li>\n<li><code>str_replace</code></li>\n</ul>\n<h3>0.2.31</h3>\n<p>Added a workaround for rustdoc bug (<a href=\"https://redirect.github.com/rust-lang/rust/issues/112085\">rust-lang/rust#112085</a>).</p>\n<h3>0.2.29</h3>\n<p>Added lowercase hexadecimal formatting support.</p>\n<p>Breaking: to add lowercase hexadecimal formatting, this crate changed the uppercase hexadecimal formatter from <code>{:x}</code> to <code>{:X}</code></p>\n<h3>0.2.27</h3>\n<p>Replacing existing features with these:</p>\n<ul>\n<li><code>&quot;rust_1_64&quot;</code>: superceeding the soft-deprecated <code>&quot;more_str_macros&quot;</code> feature.</li>\n<li><code>&quot;rust_1_51&quot;</code>: superceeding the soft-deprecated <code>&quot;const_generics&quot;</code> feature.\nThe new features are enabled by the feature they superceede.</li>\n</ul>\n<p>Now the <code>&quot;fmt&quot;</code> feature enables the <code>&quot;rust_1_64&quot;</code> feature.</p>\n<h3>0.2.26</h3>\n<p>Added <code>&quot;more_str_macros&quot;</code> crate feature.</p>\n<p>Added <code>str_split</code> macro, conditional on the <code>&quot;more_str_macros&quot;</code> feature.</p>\n<p>Added <code>char</code> pattern support to <code>str_replace</code>.</p>\n<h3>0.2.25</h3>\n<p>Fixed the <code>clippy::double_parens</code> (false positive) warning by\nencoding the <code>&amp;'static str</code> type annotation some other way.</p>\n<p>Made <code>SplicedStr</code>, <code>Formatting</code>, and <code>NumberFormatting</code> derive <code>Eq</code> .</p>\n<h3>0.2.24</h3>\n<p>Fixed error that caused formatting macros not to be usable in statement position.</p>\n<h3>0.2.23</h3>\n<p>Added type annotations to <code>concatp</code>, <code>concatcp</code>, <code>formatc</code> and <code>formatcp</code> macros to help IDEs infer the type.</p>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li>See full diff in <a href=\"https://github.com/rodrimati1992/const_format_crates/commits\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `zip` from 0.6.4 to 0.6.6\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/zip-rs/zip/blob/master/CHANGELOG.md\">zip's changelog</a>.</em></p>\n<blockquote>\n<h2>[0.6.6]</h2>\n<h3>Changed</h3>\n<ul>\n<li>Updated <code>aes</code> dependency to <code>0.8.2</code> (<a href=\"https://redirect.github.com/zip-rs/zip/pull/354\">zip-rs/zip#354</a>)</li>\n</ul>\n<h2>[0.6.5]</h2>\n<h3>Changed</h3>\n<ul>\n<li>Added experimental [<code>zip::unstable::write::FileOptions::with_deprecated_encryption</code>] API to enable encrypting files with PKWARE encryption.</li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li>See full diff in <a href=\"https://github.com/zip-rs/zip/commits\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `zip-extensions` from 0.6.1 to 0.6.2\n<details>\n<summary>Commits</summary>\n<ul>\n<li>See full diff in <a href=\"https://github.com/matzefriedrich/zip-extensions-rs/commits/v0.6.2\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `log` from 0.4.17 to 0.4.21\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/rust-lang/log/blob/master/CHANGELOG.md\">log's changelog</a>.</em></p>\n<blockquote>\n<h2>[0.4.21] - 2024-02-27</h2>\n<h2>What's Changed</h2>\n<ul>\n<li>Minor clippy nits by <a href=\"https://github.com/nyurik\"><code>@nyurik</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/578\">rust-lang/log#578</a></li>\n<li>Simplify Display impl by <a href=\"https://github.com/nyurik\"><code>@nyurik</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/579\">rust-lang/log#579</a></li>\n<li>Set all crates to 2021 edition by <a href=\"https://github.com/nyurik\"><code>@nyurik</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/580\">rust-lang/log#580</a></li>\n<li>Various changes based on review by <a href=\"https://github.com/Thomasdezeeuw\"><code>@Thomasdezeeuw</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/583\">rust-lang/log#583</a></li>\n<li>Fix typo in file_static() method doc by <a href=\"https://github.com/dimo414\"><code>@dimo414</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/590\">rust-lang/log#590</a></li>\n<li>Specialize empty key value pairs by <a href=\"https://github.com/EFanZh\"><code>@EFanZh</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/576\">rust-lang/log#576</a></li>\n<li>Fix incorrect lifetime in Value::to_str() by <a href=\"https://github.com/peterjoel\"><code>@peterjoel</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/587\">rust-lang/log#587</a></li>\n<li>Remove some API of the key-value feature by <a href=\"https://github.com/Thomasdezeeuw\"><code>@Thomasdezeeuw</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/585\">rust-lang/log#585</a></li>\n<li>Add logcontrol-log and log-reload by <a href=\"https://github.com/swsnr\"><code>@swsnr</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/595\">rust-lang/log#595</a></li>\n<li>Add Serialization section to kv::Value docs by <a href=\"https://github.com/Thomasdezeeuw\"><code>@Thomasdezeeuw</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/593\">rust-lang/log#593</a></li>\n<li>Rename Value::to_str to to_cow_str by <a href=\"https://github.com/Thomasdezeeuw\"><code>@Thomasdezeeuw</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/592\">rust-lang/log#592</a></li>\n<li>Clarify documentation and simplify initialization of <code>STATIC_MAX_LEVEL</code> by <a href=\"https://github.com/ptosi\"><code>@ptosi</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/594\">rust-lang/log#594</a></li>\n<li>Update docs to 2021 edition, test by <a href=\"https://github.com/nyurik\"><code>@nyurik</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/577\">rust-lang/log#577</a></li>\n<li>Add &quot;alterable_logger&quot; link to README.md by <a href=\"https://github.com/brummer-simon\"><code>@brummer-simon</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/589\">rust-lang/log#589</a></li>\n<li>Normalize line ending by <a href=\"https://github.com/EFanZh\"><code>@EFanZh</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/602\">rust-lang/log#602</a></li>\n<li>Remove <code>ok_or</code> in favor of <code>Option::ok_or</code> by <a href=\"https://github.com/AngelicosPhosphoros\"><code>@AngelicosPhosphoros</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/607\">rust-lang/log#607</a></li>\n<li>Use <code>Acquire</code> ordering for initialization check by <a href=\"https://github.com/AngelicosPhosphoros\"><code>@AngelicosPhosphoros</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/610\">rust-lang/log#610</a></li>\n<li>Get structured logging API ready for stabilization by <a href=\"https://github.com/KodrAus\"><code>@KodrAus</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/613\">rust-lang/log#613</a></li>\n</ul>\n<h2>New Contributors</h2>\n<ul>\n<li><a href=\"https://github.com/nyurik\"><code>@nyurik</code></a> made their first contribution in <a href=\"https://redirect.github.com/rust-lang/log/pull/578\">rust-lang/log#578</a></li>\n<li><a href=\"https://github.com/dimo414\"><code>@dimo414</code></a> made their first contribution in <a href=\"https://redirect.github.com/rust-lang/log/pull/590\">rust-lang/log#590</a></li>\n<li><a href=\"https://github.com/peterjoel\"><code>@peterjoel</code></a> made their first contribution in <a href=\"https://redirect.github.com/rust-lang/log/pull/587\">rust-lang/log#587</a></li>\n<li><a href=\"https://github.com/ptosi\"><code>@ptosi</code></a> made their first contribution in <a href=\"https://redirect.github.com/rust-lang/log/pull/594\">rust-lang/log#594</a></li>\n<li><a href=\"https://github.com/brummer-simon\"><code>@brummer-simon</code></a> made their first contribution in <a href=\"https://redirect.github.com/rust-lang/log/pull/589\">rust-lang/log#589</a></li>\n<li><a href=\"https://github.com/AngelicosPhosphoros\"><code>@AngelicosPhosphoros</code></a> made their first contribution in <a href=\"https://redirect.github.com/rust-lang/log/pull/607\">rust-lang/log#607</a></li>\n</ul>\n<h2>[0.4.20] - 2023-07-11</h2>\n<ul>\n<li>Remove rustversion dev-dependency by <a href=\"https://github.com/Thomasdezeeuw\"><code>@Thomasdezeeuw</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/568\">rust-lang/log#568</a></li>\n<li>Remove <code>local_inner_macros</code> usage by <a href=\"https://github.com/EFanZh\"><code>@EFanZh</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/570\">rust-lang/log#570</a></li>\n</ul>\n<h2>[0.4.19] - 2023-06-10</h2>\n<ul>\n<li>Use target_has_atomic instead of the old atomic_cas cfg by <a href=\"https://github.com/GuillaumeGomez\"><code>@GuillaumeGomez</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/555\">rust-lang/log#555</a></li>\n<li>Put MSRV into Cargo.toml by <a href=\"https://github.com/est31\"><code>@est31</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/557\">rust-lang/log#557</a></li>\n</ul>\n<h2>[0.4.18] - 2023-05-28</h2>\n<ul>\n<li>fix markdown links (again) by <a href=\"https://github.com/hellow554\"><code>@hellow554</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/513\">rust-lang/log#513</a></li>\n<li>add cargo doc to workflow by <a href=\"https://github.com/hellow554\"><code>@hellow554</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/515\">rust-lang/log#515</a></li>\n<li>Apply Clippy lints by <a href=\"https://github.com/hellow554\"><code>@hellow554</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/516\">rust-lang/log#516</a></li>\n<li>Replace ad-hoc eq_ignore_ascii_case with slice::eq_ignore_ascii_case by <a href=\"https://github.com/glandium\"><code>@glandium</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/519\">rust-lang/log#519</a></li>\n<li>fix up windows targets by <a href=\"https://github.com/KodrAus\"><code>@KodrAus</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/528\">rust-lang/log#528</a></li>\n<li>typo fix by <a href=\"https://github.com/jiangying000\"><code>@jiangying000</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/529\">rust-lang/log#529</a></li>\n<li>Remove dependency on cfg_if by <a href=\"https://github.com/EriKWDev\"><code>@EriKWDev</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/536\">rust-lang/log#536</a></li>\n<li>GitHub Workflows security hardening by <a href=\"https://github.com/sashashura\"><code>@sashashura</code></a> in <a href=\"https://redirect.github.com/rust-lang/log/pull/538\">rust-lang/log#538</a></li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/rust-lang/log/commit/3ccdc286fef3076747fe18a2a93658ea4d4ae012\"><code>3ccdc28</code></a> Merge pull request <a href=\"https://redirect.github.com/rust-lang/log/issues/617\">#617</a> from rust-lang/cargo/0.4.21</li>\n<li><a href=\"https://github.com/rust-lang/log/commit/6153cb289f0e7b80f00ae07dbe5ee41cf3d3fcb0\"><code>6153cb2</code></a> prepare for 0.4.21 release</li>\n<li><a href=\"https://github.com/rust-lang/log/commit/f0f74946a4bfb02cfc407795a3499c4b69d7a290\"><code>f0f7494</code></a> Merge pull request <a href=\"https://redirect.github.com/rust-lang/log/issues/613\">#613</a> from rust-lang/feat/kv-cleanup</li>\n<li><a href=\"https://github.com/rust-lang/log/commit/2b220bf3b705f2abc0ee591c7eb17972a979da3a\"><code>2b220bf</code></a> clean up structured logging example</li>\n<li><a href=\"https://github.com/rust-lang/log/commit/646e9ab9917fb79e44b6b36b8375106a1a09766c\"><code>646e9ab</code></a> use original Visitor name for VisitValue</li>\n<li><a href=\"https://github.com/rust-lang/log/commit/cf85c38d3519745d60e7b891c4b2025050a8389f\"><code>cf85c38</code></a> add needed subfeatures to kv_unstable</li>\n<li><a href=\"https://github.com/rust-lang/log/commit/73e953905b970ef765a86bf6cbd69bc2c5e2bac4\"><code>73e9539</code></a> fix up capturing of :err</li>\n<li><a href=\"https://github.com/rust-lang/log/commit/31bb4b0ff36e458c6bef304a336b71f6342ddcc7\"><code>31bb4b0</code></a> move error macros together</li>\n<li><a href=\"https://github.com/rust-lang/log/commit/ad917118a5e781d0dd60b3a75ba519ce9839ba70\"><code>ad91711</code></a> support field shorthand in macros</li>\n<li><a href=\"https://github.com/rust-lang/log/commit/90a347bd836873264a393a35bfd90fe478fadae2\"><code>90a347b</code></a> restore removed APIs as deprecated</li>\n<li>Additional commits viewable in <a href=\"https://github.com/rust-lang/log/compare/0.4.17...0.4.21\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `env_logger` from 0.10.0 to 0.11.3\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/rust-cli/env_logger/releases\">env_logger's releases</a>.</em></p>\n<blockquote>\n<h2>v0.11.3</h2>\n<h2>[0.11.3] - 2024-03-05</h2>\n<h3>Features</h3>\n<ul>\n<li>Experimental support for key-value logging behind <code>unstable-kv</code></li>\n</ul>\n<h2>v0.11.2</h2>\n<h2>[0.11.2] - 2024-02-13</h2>\n<h2>v0.11.1</h2>\n<h2>What's Changed</h2>\n<ul>\n<li>fix(fmt): Fix passing of WriteStyle when using Target::Pipe by <a href=\"https://github.com/Bobo1239\"><code>@Bobo1239</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/302\">rust-cli/env_logger#302</a></li>\n</ul>\n<h2>New Contributors</h2>\n<ul>\n<li><a href=\"https://github.com/Bobo1239\"><code>@Bobo1239</code></a> made their first contribution in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/302\">rust-cli/env_logger#302</a></li>\n</ul>\n<p><strong>Full Changelog</strong>: <a href=\"https://github.com/rust-cli/env_logger/compare/v0.11.0...v0.11.1\">https://github.com/rust-cli/env_logger/compare/v0.11.0...v0.11.1</a></p>\n<h2>v0.11.0</h2>\n<h2>What's Changed</h2>\n<ul>\n<li>refactor(fmt): More anstream prep by <a href=\"https://github.com/epage\"><code>@epage</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/297\">rust-cli/env_logger#297</a></li>\n<li>fix(fmt): Improve terminal styling support by <a href=\"https://github.com/epage\"><code>@epage</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/298\">rust-cli/env_logger#298</a></li>\n<li>refactor: Split out env_filter package  by <a href=\"https://github.com/epage\"><code>@epage</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/299\">rust-cli/env_logger#299</a></li>\n<li>feat(filter): Add a Logger decorator by <a href=\"https://github.com/epage\"><code>@epage</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/300\">rust-cli/env_logger#300</a></li>\n</ul>\n<p><strong>Full Changelog</strong>: <a href=\"https://github.com/rust-cli/env_logger/compare/v0.10.2...v0.11.0\">https://github.com/rust-cli/env_logger/compare/v0.10.2...v0.11.0</a></p>\n<h2>v0.10.2</h2>\n<h2>What's Changed</h2>\n<ul>\n<li>refactor: Move impls next to types by <a href=\"https://github.com/epage\"><code>@epage</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/283\">rust-cli/env_logger#283</a></li>\n<li>chore(deps): update github/codeql-action action to v3 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/292\">rust-cli/env_logger#292</a></li>\n<li>chore(deps): update actions/setup-python action to v5 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/291\">rust-cli/env_logger#291</a></li>\n<li>fix(fmt): Address a couple of bugs by <a href=\"https://github.com/epage\"><code>@epage</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/296\">rust-cli/env_logger#296</a></li>\n</ul>\n<p><strong>Full Changelog</strong>: <a href=\"https://github.com/rust-cli/env_logger/compare/v0.10.1...v0.10.2\">https://github.com/rust-cli/env_logger/compare/v0.10.1...v0.10.2</a></p>\n<h2>v0.10.1</h2>\n<h2>What's Changed</h2>\n<ul>\n<li>chore(deps): update actions/setup-python action to v4 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/253\">rust-cli/env_logger#253</a></li>\n<li>chore(deps): update swatinem/rust-cache action to v2 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/254\">rust-cli/env_logger#254</a></li>\n<li>chore(ci): Remove unused CI bin by <a href=\"https://github.com/epage\"><code>@epage</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/262\">rust-cli/env_logger#262</a></li>\n<li>chore Update from '_rust/main' template by <a href=\"https://github.com/epage\"><code>@epage</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/261\">rust-cli/env_logger#261</a></li>\n<li>chore: Update from '_rust/main' template by <a href=\"https://github.com/epage\"><code>@epage</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/265\">rust-cli/env_logger#265</a></li>\n<li>correction of a misprint in the documentation by <a href=\"https://github.com/xprgv\"><code>@xprgv</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/267\">rust-cli/env_logger#267</a></li>\n<li>chore: Update from '_rust/main' template by <a href=\"https://github.com/epage\"><code>@epage</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/270\">rust-cli/env_logger#270</a></li>\n<li>Use cargo add instead of a toml snippet in README by <a href=\"https://github.com/rnestler\"><code>@rnestler</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/255\">rust-cli/env_logger#255</a></li>\n<li>chore(deps): update actions/checkout action to v4 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/rust-cli/env_logger/pull/279\">rust-cli/env_logger#279</a></li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/rust-cli/env_logger/blob/main/CHANGELOG.md\">env_logger's changelog</a>.</em></p>\n<blockquote>\n<h2>[0.11.3] - 2024-03-05</h2>\n<h3>Features</h3>\n<ul>\n<li>Experimental support for key-value logging behind <code>unstable-kv</code></li>\n</ul>\n<h2>[0.11.2] - 2024-02-13</h2>\n<h2>[0.11.1] - 2024-01-27</h2>\n<h3>Fixes</h3>\n<ul>\n<li>Allow styling with <code>Target::Pipe</code></li>\n</ul>\n<h2>[0.11.0] - 2024-01-19</h2>\n<h3>Migration Guide</h3>\n<p><strong>env_logger::fmt::Style:</strong>\nThe bespoke styling API, behind <code>color</code>, was removed, in favor of accepting any\nANSI styled string and adapting it to the target stream's capabilities.</p>\n<p>Possible styling libraries include:</p>\n<ul>\n<li><a href=\"https://docs.rs/anstyle\">anstyle</a> is a minimal, runtime string styling API and is re-exported as <code>env_logger::fmt::style</code></li>\n<li><a href=\"https://docs.rs/owo-colors\">owo-colors</a> is a feature rich runtime string styling API</li>\n<li><a href=\"https://docs.rs/color-print\">color-print</a> for feature-rich compile-time styling API</li>\n</ul>\n<p><a href=\"https://docs.rs/env_logger/latest/src/custom_format/custom_format.rs.html\">custom_format.rs</a>\nuses <code>anstyle</code> via\n<a href=\"https://docs.rs/env_logger/latest/env_logger/fmt/struct.Formatter.html#method.default_level_style\"><code>Formatter::default_level_style</code></a></p>\n<h3>Breaking Change</h3>\n<ul>\n<li>Removed bespoke styling API\n<ul>\n<li><code>env_logger::fmt::Formatter::style</code></li>\n<li><code>env_logger::fmt::Formatter::default_styled_level</code></li>\n<li><code>env_logger::fmt::Style</code></li>\n<li><code>env_logger::fmt::Color</code></li>\n<li><code>env_logger::fmt::StyledValue</code></li>\n</ul>\n</li>\n<li>Removed <code>env_logger::filter</code> in favor of <code>env_filter</code></li>\n</ul>\n<h3>Compatibility</h3>\n<p>MSRV changed to 1.71</p>\n<h3>Features</h3>\n<ul>\n<li>Automatically adapt ANSI escape codes in logged messages to the current terminal's capabilities</li>\n<li>Add support for <code>NO_COLOR</code> and <code>CLICOLOR_FORCE</code>, see <a href=\"https://bixense.com/clicolors/\">https://bixense.com/clicolors/</a></li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/rust-cli/env_logger/commit/98ce8038803d048bf415a5ab13f7cc1aa61d242e\"><code>98ce803</code></a> chore: Release</li>\n<li><a href=\"https://github.com/rust-cli/env_logger/commit/7a161300c26d1a2b1f71c99e75e36d02ee11d094\"><code>7a16130</code></a> docs: Update changelog</li>\n<li><a href=\"https://github.com/rust-cli/env_logger/commit/e55af6f7c3be0731c902025a76b42a97a97ead8e\"><code>e55af6f</code></a> Merge pull request <a href=\"https://redirect.github.com/rust-cli/env_logger/issues/137\">#137</a> from tmccombs/structured</li>\n<li><a href=\"https://github.com/rust-cli/env_logger/commit/f6e2d45615057917b11dfc140b0be325b7ffd1b0\"><code>f6e2d45</code></a> feat(kv): Use now-stable kv feature of log crate</li>\n<li><a href=\"https://github.com/rust-cli/env_logger/commit/9f4a33aac0745fd4d5ad0256b747ed44652cf6eb\"><code>9f4a33a</code></a> feat(kv): Add styling for key in default format</li>\n<li><a href=\"https://github.com/rust-cli/env_logger/commit/9d26ad586ef5d6b4f77b0b3752dc7b624e82d29b\"><code>9d26ad5</code></a> feat: Add support for Key-Value data in log records</li>\n<li><a href=\"https://github.com/rust-cli/env_logger/commit/8962096976b0fa9c05b8b5ba5251861d60abf943\"><code>8962096</code></a> Merge pull request <a href=\"https://redirect.github.com/rust-cli/env_logger/issues/314\">#314</a> from rust-cli/renovate/pre-commit-action-3.x</li>\n<li><a href=\"https://github.com/rust-cli/env_logger/commit/41272282713fd4ffa593133204a458fe24e3265d\"><code>4127228</code></a> chore(deps): update pre-commit/action action to v3.0.1</li>\n<li><a href=\"https://github.com/rust-cli/env_logger/commit/b0e3ea938427fa9a4350f816e579a7dab3d75041\"><code>b0e3ea9</code></a> chore: Release</li>\n<li><a href=\"https://github.com/rust-cli/env_logger/commit/522ce17fff0f9b46fb0741bea32aaacb1ff77cff\"><code>522ce17</code></a> Merge pull request <a href=\"https://redirect.github.com/rust-cli/env_logger/issues/310\">#310</a> from epage/docs</li>\n<li>Additional commits viewable in <a href=\"https://github.com/rust-cli/env_logger/compare/v0.10.0...v0.11.3\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `serde` from 1.0.152 to 1.0.193\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/serde-rs/serde/releases\">serde's releases</a>.</em></p>\n<blockquote>\n<h2>v1.0.193</h2>\n<ul>\n<li>Fix field names used for the deserialization of <code>RangeFrom</code> and <code>RangeTo</code> (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2653\">#2653</a>, <a href=\"https://redirect.github.com/serde-rs/serde/issues/2654\">#2654</a>, <a href=\"https://redirect.github.com/serde-rs/serde/issues/2655\">#2655</a>, thanks <a href=\"https://github.com/emilbonnek\"><code>@emilbonnek</code></a>)</li>\n</ul>\n<h2>v1.0.192</h2>\n<ul>\n<li>Allow internal tag field in untagged variant (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2646\">#2646</a>, thanks <a href=\"https://github.com/robsdedude\"><code>@robsdedude</code></a>)</li>\n</ul>\n<h2>v1.0.191</h2>\n<ul>\n<li>Documentation improvements</li>\n</ul>\n<h2>v1.0.190</h2>\n<ul>\n<li>Preserve NaN sign when deserializing f32 from f64 or vice versa (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2637\">#2637</a>)</li>\n</ul>\n<h2>v1.0.189</h2>\n<ul>\n<li>Fix &quot;cannot infer type&quot; error when internally tagged enum contains untagged variant (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2613\">#2613</a>, thanks <a href=\"https://github.com/ahl\"><code>@ahl</code></a>)</li>\n</ul>\n<h2>v1.0.188</h2>\n<ul>\n<li>Fix <em>&quot;failed to parse manifest&quot;</em> error when building serde using a Cargo version between 1.45 and 1.50 (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2603\">#2603</a>)</li>\n</ul>\n<h2>v1.0.187</h2>\n<ul>\n<li>Remove support for Emscripten targets on rustc older than 1.40 (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2600\">#2600</a>)</li>\n</ul>\n<h2>v1.0.186</h2>\n<ul>\n<li>Disallow incompatible versions of <code>serde_derive</code> and <code>serde</code> in the dependency graph (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2588\">#2588</a>, thanks <a href=\"https://github.com/soqb\"><code>@soqb</code></a>)</li>\n</ul>\n<h2>v1.0.185</h2>\n<ul>\n<li>Fix error <em>&quot;cannot move out of <code>*self</code> which is behind a shared reference&quot;</em> deriving Serialize on a non_exhaustive enum (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2591\">#2591</a>)</li>\n</ul>\n<h2>v1.0.184</h2>\n<ul>\n<li>Restore from-source <code>serde_derive</code> build on all platforms  eventually we'd like to use a first-class precompiled macro if such a thing becomes supported by cargo / crates.io</li>\n</ul>\n<h2>v1.0.183</h2>\n<ul>\n<li>Support deserializing <code>Box&lt;OsStr&gt;</code> with an equivalent representation as <code>OsString</code> (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2556\">#2556</a>, thanks <a href=\"https://github.com/DBLouis\"><code>@DBLouis</code></a>)</li>\n</ul>\n<h2>v1.0.182</h2>\n<ul>\n<li>Render field aliases in sorted order in error messages (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2458\">#2458</a>, thanks <a href=\"https://github.com/Mingun\"><code>@Mingun</code></a>)</li>\n<li>Support <code>serde(default)</code> on tuple structs (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2553\">#2553</a>, thanks <a href=\"https://github.com/Mingun\"><code>@Mingun</code></a>)</li>\n</ul>\n<h2>v1.0.181</h2>\n<ul>\n<li>Make <code>serde(alias)</code> work in combination with <code>flatten</code> when using in-place deserialization (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2443\">#2443</a>, thanks <a href=\"https://github.com/Mingun\"><code>@Mingun</code></a>)</li>\n<li>Improve the representation of adjacently tagged enums in formats where enum tags are serialized by index, as opposed to by string name (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2505\">#2505</a>, <a href=\"https://redirect.github.com/serde-rs/serde/issues/2496\">#2496</a>, thanks <a href=\"https://github.com/Baptistemontan\"><code>@Baptistemontan</code></a>)</li>\n</ul>\n<h2>v1.0.180</h2>\n<ul>\n<li>Update to 2018 edition</li>\n</ul>\n<h2>v1.0.179</h2>\n<ul>\n<li>Support serialization of tuple variants inside a flattened field (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2448\">#2448</a>, thanks <a href=\"https://github.com/Mingun\"><code>@Mingun</code></a>)</li>\n</ul>\n<h2>v1.0.178</h2>\n<ul>\n<li>Fix build error when using serde with &quot;std&quot; feature turned off and &quot;unstable&quot; feature turned on (<a href=\"https://redirect.github.com/serde-rs/serde/issues/2541\">#2541</a>)</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/serde-rs/serde/commit/44613c7d0190dbb5ecd2d5ec19c636f45b7488cc\"><code>44613c7</code></a> Release 1.0.193</li>\n<li><a href=\"https://github.com/serde-rs/serde/commit/c706281df3c8d50dba1763f19c856df2746eba6c\"><code>c706281</code></a> Merge pull request <a href=\"https://redirect.github.com/serde-rs/serde/issues/2655\">#2655</a> from dtolnay/rangestartend</li>\n<li><a href=\"https://github.com/serde-rs/serde/commit/65d75b8fe3105f00ab2e01537d568d4587167582\"><code>65d75b8</code></a> Add RangeFrom and RangeTo tests</li>\n<li><a href=\"https://github.com/serde-rs/serde/commit/332b0cba40bcbcc7a6b23a9706277c54791a9856\"><code>332b0cb</code></a> Merge pull request <a href=\"https://redirect.github.com/serde-rs/serde/issues/2654\">#2654</a> from dtolnay/rangestartend</li>\n<li><a href=\"https://github.com/serde-rs/serde/commit/8c4af412969086bc8f54fdc2a079d373632e0a03\"><code>8c4af41</code></a> Fix more RangeFrom / RangeEnd mixups</li>\n<li><a href=\"https://github.com/serde-rs/serde/commit/24a78f071b22ae491eec4127be696ac255b9b5d3\"><code>24a78f0</code></a> Merge pull request <a href=\"https://redirect.github.com/serde-rs/serde/issues/2653\">#2653</a> from emilbonnek/fix/range-to-from-de-mixup</li>\n<li><a href=\"https://github.com/serde-rs/serde/commit/c91c33436d7aaef7472ebc18b734ddc9b5bd11fa\"><code>c91c334</code></a> Fix Range{From,To} deserialize mixup</li>\n<li><a href=\"https://github.com/serde-rs/serde/commit/2083f43a287cac8302009fda5bbe41518dd83209\"><code>2083f43</code></a> Update ui test suite to nightly-2023-11-19</li>\n<li><a href=\"https://github.com/serde-rs/serde/commit/4676abdc9e6bbbddfb33a00ce8d7e81e92f01120\"><code>4676abd</code></a> Release 1.0.192</li>\n<li><a href=\"https://github.com/serde-rs/serde/commit/35700eb23e21d8cb198ef4a422ddad13b855ce3b\"><code>35700eb</code></a> Merge pull request <a href=\"https://redirect.github.com/serde-rs/serde/issues/2646\">#2646</a> from robsdedude/fix/2643/allow-tag-field-in-untagged</li>\n<li>Additional commits viewable in <a href=\"https://github.com/serde-rs/serde/compare/v1.0.152...v1.0.193\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `serde_json` from 1.0.91 to 1.0.109\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/serde-rs/json/releases\">serde_json's releases</a>.</em></p>\n<blockquote>\n<h2>v1.0.109</h2>\n<ul>\n<li>Documentation improvements</li>\n</ul>\n<h2>v1.0.108</h2>\n<ul>\n<li>Documentation improvements (<a href=\"https://redirect.github.com/serde-rs/json/issues/1075\">#1075</a>, <a href=\"https://redirect.github.com/serde-rs/json/issues/1081\">#1081</a>, <a href=\"https://redirect.github.com/serde-rs/json/issues/1082\">#1082</a>, thanks <a href=\"https://github.com/dimo414\"><code>@dimo414</code></a> and <a href=\"https://github.com/fritzrehde\"><code>@fritzrehde</code></a>)</li>\n</ul>\n<h2>v1.0.107</h2>\n<ul>\n<li>impl IntoDeserializer for &amp;RawValue (<a href=\"https://redirect.github.com/serde-rs/json/issues/1071\">#1071</a>)</li>\n</ul>\n<h2>v1.0.106</h2>\n<ul>\n<li>Add <code>Value::as_number</code> accessor (<a href=\"https://redirect.github.com/serde-rs/json/issues/1069\">#1069</a>, thanks <a href=\"https://github.com/chanced\"><code>@chanced</code></a>)</li>\n<li>Add <code>Number::as_str</code> accessor under &quot;arbitrary_precision&quot; feature (<a href=\"https://redirect.github.com/serde-rs/json/issues/1067\">#1067</a>, thanks <a href=\"https://github.com/chanced\"><code>@chanced</code></a>)</li>\n</ul>\n<h2>v1.0.105</h2>\n<ul>\n<li>Support bool in map keys (<a href=\"https://redirect.github.com/serde-rs/json/issues/1054\">#1054</a>)</li>\n</ul>\n<h2>v1.0.104</h2>\n<ul>\n<li>Provide IntoDeserializer impl for &amp;serde_json::Value (<a href=\"https://redirect.github.com/serde-rs/json/issues/1045\">#1045</a>, thanks <a href=\"https://github.com/ZetaNumbers\"><code>@ZetaNumbers</code></a>)</li>\n</ul>\n<h2>v1.0.103</h2>\n<ul>\n<li>Documentation improvements</li>\n</ul>\n<h2>v1.0.102</h2>\n<ul>\n<li>Add a way to customize the serialization of byte arrays (<a href=\"https://redirect.github.com/serde-rs/json/issues/1039\">#1039</a>)</li>\n</ul>\n<h2>v1.0.101</h2>\n<ul>\n<li>Allow f32 and f64 as keys in maps (<a href=\"https://redirect.github.com/serde-rs/json/issues/1027\">#1027</a>, thanks <a href=\"https://github.com/overdrivenpotato\"><code>@overdrivenpotato</code></a>)</li>\n</ul>\n<h2>v1.0.100</h2>\n<ul>\n<li>Support <code>-Z minimal-versions</code></li>\n</ul>\n<h2>v1.0.99</h2>\n<ul>\n<li>Support serializing serde's <strong>option</strong> type in a map key (<a href=\"https://redirect.github.com/serde-rs/json/issues/1030\">#1030</a>, thanks <a href=\"https://github.com/LPGhatguy\"><code>@LPGhatguy</code></a>)</li>\n</ul>\n<h2>v1.0.98</h2>\n<ul>\n<li>Update indexmap dependency used by &quot;preserve_order&quot; feature to version 2</li>\n</ul>\n<h2>v1.0.97</h2>\n<ul>\n<li>Add <code>io_error_kind()</code> method to serde_json::Error: <code>fn io_error_kind(&amp;self) -&gt; Option&lt;std::io::ErrorKind&gt;</code> (<a href=\"https://redirect.github.com/serde-rs/json/issues/1026\">#1026</a>)</li>\n</ul>\n<h2>v1.0.96</h2>\n<ul>\n<li>Guarantee that <code>to_writer</code> only writes valid UTF-8 strings (<a href=\"https://redirect.github.com/serde-rs/json/issues/1011\">#1011</a>, thanks <a href=\"https://github.com/stepancheg\"><code>@stepancheg</code></a>)</li>\n</ul>\n<h2>v1.0.95</h2>\n<ul>\n<li>Preserve f32 precision when serializing f32 -&gt; serde_json::Value -&gt; JSON string in &quot;arbitrary_precision&quot; mode (<a href=\"https://redirect.github.com/serde-rs/json/issues/1004\">#1004</a>, <a href=\"https://redirect.github.com/serde-rs/json/issues/1005\">#1005</a>)</li>\n</ul>\n<h2>v1.0.94</h2>\n<ul>\n<li>Fix message duplication between serde_json::Error's <code>Display</code> and <code>source()</code> (<a href=\"https://redirect.github.com/serde-rs/json/issues/991\">#991</a>, <a href=\"https://redirect.github.com/serde-rs/json/issues/992\">#992</a>)</li>\n</ul>\n<h2>v1.0.93</h2>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/serde-rs/json/commit/f88bf1fccb05aa4de129675de44eb6aaf3fec0a0\"><code>f88bf1f</code></a> Release 1.0.109</li>\n<li><a href=\"https://github.com/serde-rs/json/commit/bb62c73ecef901e689b0a7a67ed613a32975520c\"><code>bb62c73</code></a> Merge pull request <a href=\"https://redirect.github.com/serde-rs/json/issues/1097\">#1097</a> from serde-rs/doccfg</li>\n<li><a href=\"https://github.com/serde-rs/json/commit/df36d109fd9f9cdd22a874c0177cafec12237f95\"><code>df36d10</code></a> Restore doc cfg on re-exports</li>\n<li><a href=\"https://github.com/serde-rs/json/commit/c3670913423329c166add9d85ecdfc3e3da21e7a\"><code>c367091</code></a> Merge pull request <a href=\"https://redirect.github.com/serde-rs/json/issues/1095\">#1095</a> from dtolnay/hashtest</li>\n<li><a href=\"https://github.com/serde-rs/json/commit/b328ee7df4dd772922f084600aa7cea39218b694\"><code>b328ee7</code></a> Eliminate hash closure in favor of calling hash_one directly</li>\n<li><a href=\"https://github.com/serde-rs/json/commit/b9bcbad3c094042f79f1a45189ec0edbb8f9f322\"><code>b9bcbad</code></a> Use BuildHasher::hash_one</li>\n<li><a href=\"https://github.com/serde-rs/json/commit/7ff6c9e30c2ecc2cdcf089ed86c7ccfe7a41721c\"><code>7ff6c9e</code></a> Use random hasher state for number hashing test</li>\n<li><a href=\"https://github.com/serde-rs/json/commit/fe031cd1de4dde5b47e0f18934632b41bd18b48d\"><code>fe031cd</code></a> Delete trace_macros! functionality from test</li>\n<li><a href=\"https://github.com/serde-rs/json/commit/05196caf16456cfe6e738e946f459691c5fbf0c6\"><code>05196ca</code></a> Update ui test suite to nightly-2023-11-19</li>\n<li><a href=\"https://github.com/serde-rs/json/commit/4bc1eaa03a6160593575bc9bc60c94dba4cab1e3\"><code>4bc1eaa</code></a> Release 1.0.108</li>\n<li>Additional commits viewable in <a href=\"https://github.com/serde-rs/json/compare/v1.0.91...v1.0.109\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `regex` from 1.7.1 to 1.9.4\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/rust-lang/regex/blob/master/CHANGELOG.md\">regex's changelog</a>.</em></p>\n<blockquote>\n<h1>1.9.4 (2023-08-26)</h1>\n<p>This is a patch release that fixes a bug where <code>RegexSet::is_match(..)</code> could\nincorrectly return false (even when <code>RegexSet::matches(..).matched_any()</code>\nreturns true).</p>\n<p>Bug fixes:</p>\n<ul>\n<li>[BUG <a href=\"https://redirect.github.com/rust-lang/regex/issues/1070\">#1070</a>](<a href=\"https://redirect.github.com/rust-lang/regex/issues/1070\">rust-lang/regex#1070</a>):\nFix a bug where a prefilter was incorrectly configured for a <code>RegexSet</code>.</li>\n</ul>\n<h1>1.9.3 (2023-08-05)</h1>\n<p>This is a patch release that fixes a bug where some searches could result in\nincorrect match offsets being reported. It is difficult to characterize the\ntypes of regexes susceptible to this bug. They generally involve patterns\nthat contain no prefix or suffix literals, but have an inner literal along with\na regex prefix that can conditionally match.</p>\n<p>Bug fixes:</p>\n<ul>\n<li>[BUG <a href=\"https://redirect.github.com/rust-lang/regex/issues/1060\">#1060</a>](<a href=\"https://redirect.github.com/rust-lang/regex/issues/1060\">rust-lang/regex#1060</a>):\nFix a bug with the reverse inner literal optimization reporting incorrect match\noffsets.</li>\n</ul>\n<h1>1.9.2 (2023-08-05)</h1>\n<p>This is a patch release that fixes another memory usage regression. This\nparticular regression occurred only when using a <code>RegexSet</code>. In some cases,\nmuch more heap memory (by one or two orders of magnitude) was allocated than in\nversions prior to 1.9.0.</p>\n<p>Bug fixes:</p>\n<ul>\n<li>[BUG <a href=\"https://redirect.github.com/rust-lang/regex/issues/1059\">#1059</a>](<a href=\"https://redirect.github.com/rust-lang/regex/issues/1059\">rust-lang/regex#1059</a>):\nFix a memory usage regression when using a <code>RegexSet</code>.</li>\n</ul>\n<h1>1.9.1 (2023-07-07)</h1>\n<p>This is a patch release which fixes a memory usage regression. In the regex\n1.9 release, one of the internal engines used a more aggressive allocation\nstrategy than what was done previously. This patch release reverts to the\nprior on-demand strategy.</p>\n<p>Bug fixes:</p>\n<ul>\n<li>[BUG <a href=\"https://redirect.github.com/rust-lang/regex/issues/1027\">#1027</a>](<a href=\"https://redirect.github.com/rust-lang/regex/issues/1027\">rust-lang/regex#1027</a>):</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/rust-lang/regex/commit/f39ab4d1b7229924f0cf310c9f3e19822fa19b8a\"><code>f39ab4d</code></a> 1.9.4</li>\n<li><a href=\"https://github.com/rust-lang/regex/commit/3f15f1cf355577fe369c15ce60e1d225a163bf29\"><code>3f15f1c</code></a> deps: bump regex-syntax and regex-automata versions</li>\n<li><a href=\"https://github.com/rust-lang/regex/commit/89b452af302a00458a129f8f40f3b65daf7a278a\"><code>89b452a</code></a> regex-automata-0.3.7</li>\n<li><a href=\"https://github.com/rust-lang/regex/commit/990979bbdc28fa841e3ad55934ee445cd710d110\"><code>990979b</code></a> regex-syntax-0.7.5</li>\n<li><a href=\"https://github.com/rust-lang/regex/commit/e008f83090c1fa858cd602da94e9ffdf38fd7317\"><code>e008f83</code></a> changelog: 1.9.4</li>\n<li><a href=\"https://github.com/rust-lang/regex/commit/c788378d6fe407f4774df98a78436cea5d98525b\"><code>c788378</code></a> ci: drop mips, add powerpc and s390x</li>\n<li><a href=\"https://github.com/rust-lang/regex/commit/de0339959b491ae0a26e6f96c0b0dc1635bc0f94\"><code>de03399</code></a> automata: fix incorrect use of Aho-Corasick's &quot;standard&quot; semantics</li>\n<li><a href=\"https://github.com/rust-lang/regex/commit/7536e055840f74f1f7bda8ffecf851cb3e500147\"><code>7536e05</code></a> syntax: remove superfluous <code>borrow</code></li>\n<li><a href=\"https://github.com/rust-lang/regex/commit/81e328a29f8c57cb3622930104177e8606270230\"><code>81e328a</code></a> doc: fix typo in module-level doc</li>\n<li><a href=\"https://github.com/rust-lang/regex/commit/10faa44da9134c053c28a55857068909ca29a452\"><code>10faa44</code></a> doc: fix a couple typos</li>\n<li>Additional commits viewable in <a href=\"https://github.com/rust-lang/regex/compare/1.7.1...1.9.4\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `rust-embed` from 8.0.0 to 8.3.0\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/pyrossh/rust-embed/blob/master/changelog.md\">rust-embed's changelog</a>.</em></p>\n<blockquote>\n<h2>[8.3.0] - 2024-02-26</h2>\n<ul>\n<li>Fix symbolic links in debug builds <a href=\"https://redirect.github.com/pyrossh/rust-embed/pull/235/files\">#235</a>. Thanks to <a href=\"https://github.com/Buckram123\">Buckram123</a></li>\n</ul>\n<h2>[8.2.0] - 2023-12-29</h2>\n<ul>\n<li>Fix naming collisions in macros <a href=\"https://redirect.github.com/pyrossh/rust-embed/pull/230/files\">#230</a>. Thanks to <a href=\"https://github.com/hwittenborn\">hwittenborn</a></li>\n</ul>\n<h2>[8.1.0] - 2023-12-08</h2>\n<ul>\n<li>Add created to file metadata. <a href=\"https://redirect.github.com/pyrossh/rust-embed/pull/225/files\">#225</a>. Thanks to <a href=\"https://github.com/ngalaiko\">ngalaiko</a></li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li>See full diff in <a href=\"https://github.com/pyros2097/rust-embed/commits\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `which` from 5.0.0 to 6.0.1\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/harryfei/which-rs/releases\">which's releases</a>.</em></p>\n<blockquote>\n<h2>6.0.1</h2>\n<ul>\n<li>Remove dependency on <code>once_cell</code> for Windows users, replace with <code>std::sync::OnceLock</code>.</li>\n</ul>\n<h2>6.0.0</h2>\n<ul>\n<li>MSRV is now 1.70</li>\n<li>Upgraded all dependencies to latest version</li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/harryfei/which-rs/blob/master/CHANGELOG.md\">which's changelog</a>.</em></p>\n<blockquote>\n<h2>6.0.1</h2>\n<ul>\n<li>Remove dependency on <code>once_cell</code> for Windows users, replace with <code>std::sync::OnceLock</code>.</li>\n</ul>\n<h2>6.0.0</h2>\n<ul>\n<li>MSRV is now 1.70</li>\n<li>Upgraded all dependencies to latest version</li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/harryfei/which-rs/commit/7c8a898a0d358cf0554887d101be55a21a5128d7\"><code>7c8a898</code></a> bump patch version</li>\n<li><a href=\"https://github.com/harryfei/which-rs/commit/e95dca277b618d1ddab325747369dd5d9487b563\"><code>e95dca2</code></a> remove dependency on once_cell</li>\n<li><a href=\"https://github.com/harryfei/which-rs/commit/071683c2d5af17f3b0a61f8f706e47a430f08555\"><code>071683c</code></a> Use winsafe over windows-sys, and reduce dependency on rustix</li>\n<li><a href=\"https://github.com/harryfei/which-rs/commit/96a8004f453830ec249d4d88f91ba124f4859239\"><code>96a8004</code></a> Upgrade deps, move to 6.0.0</li>\n<li><a href=\"https://github.com/harryfei/which-rs/commit/f50675ac1d5363b1a35a095999ad7aa618c59594\"><code>f50675a</code></a> Prep 5.0.0 release</li>\n<li><a href=\"https://github.com/harryfei/which-rs/commit/e776ff05bc7c36b5393441a73f104145602dff85\"><code>e776ff0</code></a> Return appropriate error if path list defined and empty</li>\n<li><a href=\"https://github.com/harryfei/which-rs/commit/70d2d1c9704802546eb285217c6def3c9cc94d17\"><code>70d2d1c</code></a> Null terminate string for windows api</li>\n<li><a href=\"https://github.com/harryfei/which-rs/commit/5c6208b69e01243e937607ff40288a496478f2c2\"><code>5c6208b</code></a> Change how unit test gets current exe</li>\n<li><a href=\"https://github.com/harryfei/which-rs/commit/6a027d16bd5a53921cd1937901dc76c3242e62cd\"><code>6a027d1</code></a> Add unit test for extensionless Windows executable</li>\n<li>See full diff in <a href=\"https://github.com/harryfei/which-rs/compare/5.0.0...6.0.1\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `sha256` from 1.4.0 to 1.5.0\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/baoyachi/sha256-rs/commit/4184f8ef58a6f148f1dda5c83dcf2a98962f541e\"><code>4184f8e</code></a> Update Cargo.toml</li>\n<li><a href=\"https://github.com/baoyachi/sha256-rs/commit/70471a85cd4ab8a86605a6e5bddf6f09022afb3c\"><code>70471a8</code></a> Merge pull request <a href=\"https://redirect.github.com/baoyachi/sha256-rs/issues/21\">#21</a> from baoyachi/support_char_type</li>\n<li><a href=\"https://github.com/baoyachi/sha256-rs/commit/5671f6cf77235f6e8bbff90913b4f992e8019185\"><code>5671f6c</code></a> support char type</li>\n<li>See full diff in <a href=\"https://github.com/baoyachi/sha256-rs/compare/1.4.0...1.5.0\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `chrono` from 0.4.23 to 0.4.37\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/chronotope/chrono/releases\">chrono's releases</a>.</em></p>\n<blockquote>\n<h2>v0.4.37</h2>\n<p>Version 0.4.36 introduced an unexpected breaking change and was yanked. In it <code>LocalResult</code> was renamed to <code>MappedLocalTime</code> to avoid the impression that it is a <code>Result</code> type were some of the results are errors. For backwards compatibility a type alias with the old name was added.</p>\n<p>As it turns out there is one case where a type alias behaves differently from the regular enum: you can't import enum variants from a type alias with <code>use chrono::LocalResult::*</code>. With 0.4.37 we make the new name <code>MappedLocalTime</code> the alias, but keep using it in function signatures and the documentation as much as possible.</p>\n<p>See also the release notes of <a href=\"https://github.com/chronotope/chrono/releases/tag/v0.4.36\">chrono 0.4.36</a> from yesterday for the yanked release.</p>\n<h2>v0.4.36</h2>\n<p>This release un-deprecates the methods on <code>TimeDelta</code> that were deprecated with the 0.4.35 release because of the churn they are causing for the ecosystem.</p>\n<p>New is the <code>DateTime::with_time()</code> method. As an example of when it is useful:</p>\n<pre lang=\"rust\"><code>use chrono::{Local, NaiveTime};\n// Today at 12:00:00\nlet today_noon = Local::now().with_time(NaiveTime::from_hms_opt(12, 0, 0).unwrap());\n</code></pre>\n<h1>Additions</h1>\n<ul>\n<li>Add <code>DateTime::with_time()</code> (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1510\">#1510</a>)</li>\n</ul>\n<h1>Deprecations</h1>\n<ul>\n<li>Revert <code>TimeDelta</code> deprecations (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1543\">#1543</a>)</li>\n<li>Deprecate <code>TimeStamp::timestamp_subsec_nanos</code>, which was missed in the 0.4.35 release (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1486\">#1486</a>)</li>\n</ul>\n<h1>Documentation</h1>\n<ul>\n<li>Correct version number of deprecation notices (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1486\">#1486</a>)</li>\n<li>Fix some typos (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1505\">#1505</a>)</li>\n<li>Slightly improve serde documentation (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1519\">#1519</a>)</li>\n<li>Main documentation: simplify links and reflow text (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1535\">#1535</a>)</li>\n</ul>\n<h1>Internal</h1>\n<ul>\n<li>CI: Lint benchmarks (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1489\">#1489</a>)</li>\n<li>Remove unnessary <code>Copy</code> and <code>Send</code> impls (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1492\">#1492</a>, thanks <a href=\"https://github.com/erickt\"><code>@erickt</code></a>)</li>\n<li>Backport streamlined <code>NaiveDate</code> unit tests (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1500\">#1500</a>, thanks <a href=\"https://github.com/Zomtir\"><code>@Zomtir</code></a>)</li>\n<li>Rename <code>LocalResult</code> to <code>TzResolution</code>, add alias (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1501\">#1501</a>)</li>\n<li>Update windows-bindgen to 0.55 (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1504\">#1504</a>)</li>\n<li>Avoid duplicate imports, which generate warnings on nightly (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1507\">#1507</a>)</li>\n<li>Add extra debug assertions to <code>NaiveDate::from_yof</code> (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1518\">#1518</a>)</li>\n<li>Some small simplifications to <code>DateTime::date_naive</code> and <code>NaiveDate::diff_months</code> (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1530\">#1530</a>)</li>\n<li>Remove <code>unwrap</code> in Unix <code>Local</code> type (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1533\">#1533</a>)</li>\n<li>Use different method to ignore feature-dependent doctests (<a href=\"https://redirect.github.com/chronotope/chrono/issues/1534\">#1534</a>)</li>\n</ul>\n<p>Thanks to all contributors on behalf of the chrono team, <a href=\"https://github.com/djc\"><code>@djc</code></a> and <a href=\"https://github.com/pitdicker\"><code>@pitdicker</code></a>!</p>\n<h2>v0.4.35</h2>\n<p>Most of our efforts have shifted to improving the API for a 0.5 release, for which cleanups and refactorings are landing on the 0.4.x branch.</p>\n<p>The most significant changes in this release are two sets of deprecations.</p>\n<ul>\n<li>We deprecated all timestamp-related methods on <code>NaiveDateTime</code>. The reason is that a timestamp is defined to be in UTC. The <code>NaiveDateTime</code> type doesn't know the offset from UTC, so it was technically wrong to have these methods. The alternative is to use the similar methods on the <code>DateTime&lt;Utc&gt;</code> type, or from the <code>TimeZone</code> trait.</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/chronotope/chrono/commit/7d62045ec4cd667e240fde899a99458bf8eae1f1\"><code>7d62045</code></a> Prepare 0.4.37</li>\n<li><a href=\"https://github.com/chronotope/chrono/commit/6857d00070378037392fd9f029ccbf78a19ef2c3\"><code>6857d00</code></a> Hide re-export of <code>LocalResult</code> in docs</li>\n<li><a href=\"https://github.com/chronotope/chrono/commit/9e22e48d156d4c581e4f3d54cd8b2dcf77b5ae0a\"><code>9e22e48</code></a> Swap <code>MappedLocalTime</code> and <code>LocalResult</code> type alias</li>\n<li><a href=\"https://github.com/chronotope/chrono/commit/ca3c3b6293c20284405b1fa6c6895c7f2a33caf9\"><code>ca3c3b6</code></a> Prepare 0.4.36</li>\n<li><a href=\"https://github.com/chronotope/chrono/commit/1850198da9f91fb0f4181e30947cbecb944cde74\"><code>1850198</code></a> Revert <code>TimeDelta</code> deprecations</li>\n<li><a href=\"https://github.com/chronotope/chrono/commit/e05ba8b9c2a98943d129e664c7615bd3724e069e\"><code>e05ba8b</code></a> Add <code>MappedLocalTime::and_then</code></li>\n<li><a href=\"https://github.com/chronotope/chrono/commit/3adfd88ce05756e3bd0baa7e008abbe6d5b61076\"><code>3adfd88</code></a> Main documentation: simplify links and reflow text</li>\n<li><a href=\"https://github.com/chronotope/chrono/commit/1e8df65f47577c0db3e2790660b00d728145cde2\"><code>1e8df65</code></a> Rustfmt doc comments</li>\n<li><a href=\"https://github.com/chronotope/chrono/commit/1b578597827d0a850acb81b9cbbd1835b2141a8d\"><code>1b57859</code></a> Run doctests with <code>alloc</code> feature if possible</li>\n<li><a href=\"https://github.com/chronotope/chrono/commit/6f2c7ccabd94e78f4bbf585085b54e21eb6e99fe\"><code>6f2c7cc</code></a> Use different method to run feature-dependent doctests</li>\n<li>Additional commits viewable in <a href=\"https://github.com/chronotope/chrono/compare/v0.4.23...v0.4.37\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `android_logger` from 0.13.0 to 0.13.3\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/rust-mobile/android_logger-rs/releases\">android_logger's releases</a>.</em></p>\n<blockquote>\n<h2>0.13.1</h2>\n<p><a href=\"https://docs.rs/android_logger/0.13.1\">API docs</a><br />\n<a href=\"https://github.com/Nercury/android_logger-rs/blob/v0.13.1/CHANGELOG.md#0131--2023-03-07\">Changelog</a></p>\n</blockquote>\n</details>\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/rust-mobile/android_logger-rs/blob/master/CHANGELOG.md\">android_logger's changelog</a>.</em></p>\n<blockquote>\n<h1><code>android_logger</code> changelog</h1>\n<p>All user visible changes to this project will be documented in this file. This project uses [Semantic Versioning 2.0.0].</p>\n<h2><a href=\"/../../tree/v0.13.1\">0.13.1</a>  2023-03-07</h2>\n<p><a href=\"https://github.com/rust-mobile/android_logger-rs/compare/v0.13.0...v0.13.1\">Diff</a></p>\n<h3>Fixed</h3>\n<ul>\n<li>Missing logs on [Android] API 26 and earlier. (<a href=\"https://redirect.github.com/rust-mobile/android_logger-rs/issues/66\">#66</a>, <a href=\"https://redirect.github.com/rust-mobile/android_logger-rs/issues/67\">#67</a>)</li>\n</ul>\n<p><a href=\"https://redirect.github.com/rust-mobile/android_logger-rs/issues/66\">#66</a>: /../../issues/66\n<a href=\"https://redirect.github.com/rust-mobile/android_logger-rs/issues/67\">#67</a>: /../../pull/67</p>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li>See full diff in <a href=\"https://github.com/rust-mobile/android_logger-rs/commits\">compare view</a></li>\n</ul>\n</details>\n<br />\n\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[//]: # (dependabot-automerge-start)\n[//]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options</summary>\n<br />\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot show <dependency name> ignore conditions` will show all of the ignore conditions of the specified dependency\n- `@dependabot ignore <dependency name> major version` will close this group update PR and stop Dependabot creating any more for the specific dependency's major version (unless you unignore this specific dependency's major version or upgrade to it yourself)\n- `@dependabot ignore <dependency name> minor version` will close this group update PR and stop Dependabot creating any more for the specific dependency's minor version (unless you unignore this specific dependency's minor version or upgrade to it yourself)\n- `@dependabot ignore <dependency name>` will close this gro...\n\n_Description has been truncated_", "diff": "diff --git a/apd/Cargo.lock b/apd/Cargo.lock\nindex e65146e70..8b797b69e 100644\n--- a/apd/Cargo.lock\n+++ b/apd/Cargo.lock\n@@ -25,21 +25,20 @@ checksum = \"aae1277d39aeec15cb388266ecc24b11c80469deae6067e17a1a7aa9e5c1f234\"\n \n [[package]]\n name = \"aes\"\n-version = \"0.7.5\"\n+version = \"0.8.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9e8b47f52ea9bae42228d07ec09eb676433d7c4ed1ebdf0f1d1c29ed446f1ab8\"\n+checksum = \"b169f7a6d4742236a0a00c541b845991d0ac43e546831af1249753ab4c3aa3a0\"\n dependencies = [\n  \"cfg-if\",\n  \"cipher\",\n  \"cpufeatures\",\n- \"opaque-debug\",\n ]\n \n [[package]]\n name = \"aho-corasick\"\n-version = \"0.7.20\"\n+version = \"1.1.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"cc936419f96fa211c1b9166887b38e5e40b19958e5b895be7c1f93adec7071ac\"\n+checksum = \"8e60d3430d3a69478ad0993f19238d2df97c507009a52b3c10addcd7f6bcb916\"\n dependencies = [\n  \"memchr\",\n ]\n@@ -50,6 +49,12 @@ version = \"0.2.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"fc7eb209b1518d6bb87b283c20095f5228ecda460da70b44f0802523dea6da04\"\n \n+[[package]]\n+name = \"android-tzdata\"\n+version = \"0.1.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"e999941b234f3131b00bc13c22d06e8c5ff726d1b6318ac7eb276997bbb4fef0\"\n+\n [[package]]\n name = \"android_log-sys\"\n version = \"0.3.0\"\n@@ -58,12 +63,12 @@ checksum = \"27f0fc03f560e1aebde41c2398b691cb98b5ea5996a6184a7a67bbbb77448969\"\n \n [[package]]\n name = \"android_logger\"\n-version = \"0.13.0\"\n+version = \"0.13.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7d70a974711fabdc7555de36765bbc237f093f5992d62cab3dcaa0b0bfc7d756\"\n+checksum = \"c494134f746c14dc653a35a4ea5aca24ac368529da5370ecf41fe0341c35772f\"\n dependencies = [\n  \"android_log-sys\",\n- \"env_logger\",\n+ \"env_logger 0.10.2\",\n  \"log\",\n  \"once_cell\",\n ]\n@@ -77,11 +82,59 @@ dependencies = [\n  \"libc\",\n ]\n \n+[[package]]\n+name = \"anstream\"\n+version = \"0.6.13\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"d96bd03f33fe50a863e394ee9718a706f988b9079b20c3784fb726e7678b62fb\"\n+dependencies = [\n+ \"anstyle\",\n+ \"anstyle-parse\",\n+ \"anstyle-query\",\n+ \"anstyle-wincon\",\n+ \"colorchoice\",\n+ \"utf8parse\",\n+]\n+\n+[[package]]\n+name = \"anstyle\"\n+version = \"1.0.6\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"8901269c6307e8d93993578286ac0edf7f195079ffff5ebdeea6a59ffb7e36bc\"\n+\n+[[package]]\n+name = \"anstyle-parse\"\n+version = \"0.2.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"c75ac65da39e5fe5ab759307499ddad880d724eed2f6ce5b5e8a26f4f387928c\"\n+dependencies = [\n+ \"utf8parse\",\n+]\n+\n+[[package]]\n+name = \"anstyle-query\"\n+version = \"1.0.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"e28923312444cdd728e4738b3f9c9cac739500909bb3d3c94b43551b16517648\"\n+dependencies = [\n+ \"windows-sys\",\n+]\n+\n+[[package]]\n+name = \"anstyle-wincon\"\n+version = \"3.0.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"1cd54b81ec8d6180e24654d0b371ad22fc3dd083b6ff8ba325b72e00c87660a7\"\n+dependencies = [\n+ \"anstyle\",\n+ \"windows-sys\",\n+]\n+\n [[package]]\n name = \"anyhow\"\n-version = \"1.0.68\"\n+version = \"1.0.81\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"2cb2f989d18dd141ab8ae82f64d1a8cdd37e0840f73a406896cf5e99502fab61\"\n+checksum = \"0952808a6c2afd1aa8947271f3a60f1a6763c7b912d210184c5149b5cf147247\"\n \n [[package]]\n name = \"apd\"\n@@ -95,7 +148,7 @@ dependencies = [\n  \"const_format\",\n  \"derive-new\",\n  \"encoding_rs\",\n- \"env_logger\",\n+ \"env_logger 0.11.3\",\n  \"extattr\",\n  \"getopts\",\n  \"humansize\",\n@@ -116,7 +169,7 @@ dependencies = [\n  \"sha256\",\n  \"tempdir\",\n  \"which\",\n- \"zip 0.6.4\",\n+ \"zip\",\n  \"zip-extensions\",\n ]\n \n@@ -235,64 +288,67 @@ checksum = \"baf1de4339761588bc0619e3cbc0120ee582ebb74b53b4efbf79117bd2da40fd\"\n \n [[package]]\n name = \"chrono\"\n-version = \"0.4.23\"\n+version = \"0.4.37\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"16b0a3d9ed01224b22057780a37bb8c5dbfe1be8ba48678e7bf57ec4b385411f\"\n+checksum = \"8a0d04d43504c61aa6c7531f1871dd0d418d91130162063b789da00fd7057a5e\"\n dependencies = [\n+ \"android-tzdata\",\n  \"iana-time-zone\",\n  \"js-sys\",\n- \"num-integer\",\n  \"num-traits\",\n- \"time 0.1.45\",\n  \"wasm-bindgen\",\n- \"winapi\",\n+ \"windows-targets\",\n ]\n \n [[package]]\n name = \"cipher\"\n-version = \"0.3.0\"\n+version = \"0.4.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7ee52072ec15386f770805afd189a01c8841be8696bed250fa2f13c4c0d6dfb7\"\n+checksum = \"773f3b9af64447d2ce9850330c473515014aa235e6a783b02db81ff39e4a3dad\"\n dependencies = [\n- \"generic-array\",\n+ \"crypto-common\",\n+ \"inout\",\n ]\n \n [[package]]\n name = \"clap\"\n-version = \"4.1.4\"\n+version = \"4.5.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"f13b9c79b5d1dd500d20ef541215a6423c75829ef43117e1b4d17fd8af0b5d76\"\n+checksum = \"90bc066a67923782aa8515dbaea16946c5bcc5addbd668bb80af688e53e548a0\"\n dependencies = [\n- \"bitflags 1.3.2\",\n+ \"clap_builder\",\n  \"clap_derive\",\n+]\n+\n+[[package]]\n+name = \"clap_builder\"\n+version = \"4.5.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"ae129e2e766ae0ec03484e609954119f123cc1fe650337e155d03b022f24f7b4\"\n+dependencies = [\n+ \"anstream\",\n+ \"anstyle\",\n  \"clap_lex\",\n- \"is-terminal\",\n- \"once_cell\",\n  \"strsim\",\n- \"termcolor\",\n ]\n \n [[package]]\n name = \"clap_derive\"\n-version = \"4.1.0\"\n+version = \"4.5.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"684a277d672e91966334af371f1a7b5833f9aa00b07c84e92fbce95e00208ce8\"\n+checksum = \"528131438037fd55894f62d6e9f068b8f45ac57ffa77517819645d10aed04f64\"\n dependencies = [\n  \"heck\",\n- \"proc-macro-error\",\n  \"proc-macro2\",\n  \"quote\",\n- \"syn 1.0.107\",\n+ \"syn 2.0.38\",\n ]\n \n [[package]]\n name = \"clap_lex\"\n-version = \"0.3.1\"\n+version = \"0.7.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"783fe232adfca04f90f56201b26d79682d4cd2625e0bc7290b95123afe558ade\"\n-dependencies = [\n- \"os_str_bytes\",\n-]\n+checksum = \"98cc8fbded0c607b7ba9dd60cd98df59af97e84d24e49c8557331cfc26d301ce\"\n \n [[package]]\n name = \"codespan-reporting\"\n@@ -304,20 +360,26 @@ dependencies = [\n  \"unicode-width\",\n ]\n \n+[[package]]\n+name = \"colorchoice\"\n+version = \"1.0.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"acbf1af155f9b9ef647e42cdc158db4b64a1b61f743629225fde6f3e0be2a7c7\"\n+\n [[package]]\n name = \"const_format\"\n-version = \"0.2.30\"\n+version = \"0.2.32\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7309d9b4d3d2c0641e018d449232f2e28f1b22933c137f157d3dbc14228b8c0e\"\n+checksum = \"e3a214c7af3d04997541b18d432afaff4c455e79e2029079647e72fc2bd27673\"\n dependencies = [\n  \"const_format_proc_macros\",\n ]\n \n [[package]]\n name = \"const_format_proc_macros\"\n-version = \"0.2.29\"\n+version = \"0.2.32\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"d897f47bf7270cf70d370f8f98c1abb6d2d4cf60a6845d30e05bfb90c6568650\"\n+checksum = \"c7f6ff08fd20f4f299298a28e2dfa8a8ba1036e6cd2460ac1de7b425d76f2500\"\n dependencies = [\n  \"proc-macro2\",\n  \"quote\",\n@@ -499,9 +561,9 @@ dependencies = [\n \n [[package]]\n name = \"either\"\n-version = \"1.8.1\"\n+version = \"1.10.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7fcaabb2fef8c910e7f4c7ce9f67a1283a1715879a7c230ca9d6d1ae31f16d91\"\n+checksum = \"11157ac094ffbdde99aa67b23417ebdd801842852b500e395a45a9c0aac03e4a\"\n \n [[package]]\n name = \"encoding_rs\"\n@@ -512,17 +574,37 @@ dependencies = [\n  \"cfg-if\",\n ]\n \n+[[package]]\n+name = \"env_filter\"\n+version = \"0.1.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"a009aa4810eb158359dda09d0c87378e4bbb89b5a801f016885a4707ba24f7ea\"\n+dependencies = [\n+ \"log\",\n+ \"regex\",\n+]\n+\n [[package]]\n name = \"env_logger\"\n-version = \"0.10.0\"\n+version = \"0.10.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"85cdab6a89accf66733ad5a1693a4dcced6aeff64602b634530dd73c1f3ee9f0\"\n+checksum = \"4cd405aab171cb85d6735e5c8d9db038c17d3ca007a4d2c25f337935c3d90580\"\n dependencies = [\n- \"humantime\",\n- \"is-terminal\",\n  \"log\",\n  \"regex\",\n- \"termcolor\",\n+]\n+\n+[[package]]\n+name = \"env_logger\"\n+version = \"0.11.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"38b35839ba51819680ba087cd351788c9a3c476841207e0b8cee0b04722343b9\"\n+dependencies = [\n+ \"anstream\",\n+ \"anstyle\",\n+ \"env_filter\",\n+ \"humantime\",\n+ \"log\",\n ]\n \n [[package]]\n@@ -543,7 +625,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"a258e46cdc063eb8519c00b9fc845fc47bcfca4130e2f08e88665ceda8474245\"\n dependencies = [\n  \"libc\",\n- \"windows-sys 0.52.0\",\n+ \"windows-sys\",\n ]\n \n [[package]]\n@@ -610,7 +692,7 @@ checksum = \"c05aeb6a22b8f62540c194aac980f2115af067bfe15a0734d7277a768d396b31\"\n dependencies = [\n  \"cfg-if\",\n  \"libc\",\n- \"wasi 0.11.0+wasi-snapshot-preview1\",\n+ \"wasi\",\n ]\n \n [[package]]\n@@ -621,9 +703,9 @@ checksum = \"b6c80984affa11d98d1b88b66ac8853f143217b399d3c74116778ff8fdb4ed2e\"\n \n [[package]]\n name = \"heck\"\n-version = \"0.4.1\"\n+version = \"0.5.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"95505c38b4572b2d910cecb0281560f54b440a19336cbbcb27bf6ce6adc6f5a8\"\n+checksum = \"2304e00983f87ffb38b55b444b5e3b60a884b5d30c0fca7d82fe33449bbe55ea\"\n \n [[package]]\n name = \"hermit-abi\"\n@@ -651,11 +733,11 @@ dependencies = [\n \n [[package]]\n name = \"home\"\n-version = \"0.5.5\"\n+version = \"0.5.9\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"5444c27eef6923071f7ebcc33e3444508466a76f7a2b93da00ed6e19f30c1ddb\"\n+checksum = \"e3d1354bf6b7235cb4a0576c2619fd4ed18183f689b12b006a0ee7329eeff9a5\"\n dependencies = [\n- \"windows-sys 0.48.0\",\n+ \"windows-sys\",\n ]\n \n [[package]]\n@@ -732,25 +814,12 @@ dependencies = [\n ]\n \n [[package]]\n-name = \"io-lifetimes\"\n-version = \"1.0.5\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"1abeb7a0dd0f8181267ff8adc397075586500b81b28a73e8a0208b00fc170fb3\"\n-dependencies = [\n- \"libc\",\n- \"windows-sys 0.45.0\",\n-]\n-\n-[[package]]\n-name = \"is-terminal\"\n-version = \"0.4.2\"\n+name = \"inout\"\n+version = \"0.1.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"28dfb6c8100ccc63462345b67d1bbc3679177c75ee4bf59bf29c8b1d110b8189\"\n+checksum = \"a0c10553d664a4d0bcff9f4215d0aac67a639cc68ef660840afe309b807bc9f5\"\n dependencies = [\n- \"hermit-abi\",\n- \"io-lifetimes\",\n- \"rustix 0.36.7\",\n- \"windows-sys 0.42.0\",\n+ \"generic-array\",\n ]\n \n [[package]]\n@@ -854,12 +923,6 @@ dependencies = [\n  \"cc\",\n ]\n \n-[[package]]\n-name = \"linux-raw-sys\"\n-version = \"0.1.4\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"f051f77a7c8e6957c0696eac88f26b0117e54f52d3fc682ab19397a8812846a4\"\n-\n [[package]]\n name = \"linux-raw-sys\"\n version = \"0.4.13\"\n@@ -868,12 +931,9 @@ checksum = \"01cda141df6706de531b6c46c3a33ecca755538219bd484262fa09410c13539c\"\n \n [[package]]\n name = \"log\"\n-version = \"0.4.17\"\n+version = \"0.4.21\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"abb12e687cfb44aa40f41fc3978ef76448f9b6038cad6aef4259d3c095a2382e\"\n-dependencies = [\n- \"cfg-if\",\n-]\n+checksum = \"90ed8c1e510134f979dbc4f070f87d4313098b704861a105fe34231c70a3901c\"\n \n [[package]]\n name = \"loopdev\"\n@@ -886,9 +946,9 @@ dependencies = [\n \n [[package]]\n name = \"memchr\"\n-version = \"2.5.0\"\n+version = \"2.7.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"2dffe52ecf27772e601905b7522cb4ef790d2cc203488bbd0e2fe85fcb74566d\"\n+checksum = \"6c8640c5d730cb13ebd907d8d04b52f55ac9a2eec55b440c8892f40d56c76c1d\"\n \n [[package]]\n name = \"memoffset\"\n@@ -924,16 +984,6 @@ dependencies = [\n  \"minimal-lexical\",\n ]\n \n-[[package]]\n-name = \"num-integer\"\n-version = \"0.1.45\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"225d3389fb3509a24c93f5c29eb6bde2586b98d9f016636dff58d7c6f7569cd9\"\n-dependencies = [\n- \"autocfg\",\n- \"num-traits\",\n-]\n-\n [[package]]\n name = \"num-traits\"\n version = \"0.2.15\"\n@@ -968,18 +1018,6 @@ version = \"1.17.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"6f61fba1741ea2b3d6a1e3178721804bb716a68a6aeba1149b5d52e3d464ea66\"\n \n-[[package]]\n-name = \"opaque-debug\"\n-version = \"0.3.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"624a8340c38c1b80fd549087862da4ba43e08858af025b236e509b6649fc13d5\"\n-\n-[[package]]\n-name = \"os_str_bytes\"\n-version = \"6.4.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9b7820b9daea5457c9f21c69448905d723fbd21136ccf521748f23fd49e723ee\"\n-\n [[package]]\n name = \"password-hash\"\n version = \"0.4.2\"\n@@ -1021,30 +1059,6 @@ version = \"0.2.17\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"5b40af805b3121feab8a3c29f04d8ad262fa8e0561883e7653e024ae4479e6de\"\n \n-[[package]]\n-name = \"proc-macro-error\"\n-version = \"1.0.4\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"da25490ff9892aab3fcf7c36f08cfb902dd3e71ca0f9f9517bea02a73a5ce38c\"\n-dependencies = [\n- \"proc-macro-error-attr\",\n- \"proc-macro2\",\n- \"quote\",\n- \"syn 1.0.107\",\n- \"version_check\",\n-]\n-\n-[[package]]\n-name = \"proc-macro-error-attr\"\n-version = \"1.0.4\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a1be40180e52ecc98ad80b184934baf3d0d29f979574e439af5a55274b35f869\"\n-dependencies = [\n- \"proc-macro2\",\n- \"quote\",\n- \"version_check\",\n-]\n-\n [[package]]\n name = \"proc-macro-hack\"\n version = \"0.5.20+deprecated\"\n@@ -1072,7 +1086,7 @@ dependencies = [\n  \"hex\",\n  \"lazy_static\",\n  \"procfs-core\",\n- \"rustix 0.38.21\",\n+ \"rustix 0.38.32\",\n ]\n \n [[package]]\n@@ -1186,9 +1200,21 @@ dependencies = [\n \n [[package]]\n name = \"regex\"\n-version = \"1.7.1\"\n+version = \"1.9.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"12de2eff854e5fa4b1295edd650e227e9d8fb0c9e90b12e7f36d6a6811791a29\"\n+dependencies = [\n+ \"aho-corasick\",\n+ \"memchr\",\n+ \"regex-automata\",\n+ \"regex-syntax\",\n+]\n+\n+[[package]]\n+name = \"regex-automata\"\n+version = \"0.3.9\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"48aaa5748ba571fb95cd2c85c09f629215d3a6ece942baa100950af03a34f733\"\n+checksum = \"59b23e92ee4318893fa3fe3e6fb365258efbfe6ac6ab30f090cdcbb7aa37efa9\"\n dependencies = [\n  \"aho-corasick\",\n  \"memchr\",\n@@ -1197,9 +1223,9 @@ dependencies = [\n \n [[package]]\n name = \"regex-syntax\"\n-version = \"0.6.28\"\n+version = \"0.7.5\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"456c603be3e8d448b072f410900c09faf164fbce2d480456f50eea6e25f9c848\"\n+checksum = \"dbb5fb1acd8a1a18b3dd5be62d25485eb770e05afb408a9627d14d451bae12da\"\n \n [[package]]\n name = \"remove_dir_all\"\n@@ -1227,9 +1253,9 @@ checksum = \"3582f63211428f83597b51b2ddb88e2a91a9d52d12831f9d08f5e624e8977422\"\n \n [[package]]\n name = \"rust-embed\"\n-version = \"8.0.0\"\n+version = \"8.3.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"b1e7d90385b59f0a6bf3d3b757f3ca4ece2048265d70db20a2016043d4509a40\"\n+checksum = \"fb78f46d0066053d16d4ca7b898e9343bc3530f71c61d5ad84cd404ada068745\"\n dependencies = [\n  \"include-flate\",\n  \"rust-embed-impl\",\n@@ -1239,9 +1265,9 @@ dependencies = [\n \n [[package]]\n name = \"rust-embed-impl\"\n-version = \"8.0.0\"\n+version = \"8.3.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"3c3d8c6fd84090ae348e63a84336b112b5c3918b3bf0493a581f7bd8ee623c29\"\n+checksum = \"b91ac2a3c6c0520a3fb3dd89321177c3c692937c4eb21893378219da10c44fc8\"\n dependencies = [\n  \"proc-macro2\",\n  \"quote\",\n@@ -1252,9 +1278,9 @@ dependencies = [\n \n [[package]]\n name = \"rust-embed-utils\"\n-version = \"8.0.0\"\n+version = \"8.3.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"873feff8cb7bf86fdf0a71bb21c95159f4e4a37dd7a4bd1855a940909b583ada\"\n+checksum = \"86f69089032567ffff4eada41c573fc43ff466c7db7c5688b2e7969584345581\"\n dependencies = [\n  \"sha2\",\n  \"walkdir\",\n@@ -1268,43 +1294,29 @@ checksum = \"d626bb9dae77e28219937af045c257c28bfd3f69333c512553507f5f9798cb76\"\n \n [[package]]\n name = \"rustix\"\n-version = \"0.36.7\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"d4fdebc4b395b7fbb9ab11e462e20ed9051e7b16e42d24042c776eca0ac81b03\"\n-dependencies = [\n- \"bitflags 1.3.2\",\n- \"errno 0.2.8\",\n- \"io-lifetimes\",\n- \"libc\",\n- \"linux-raw-sys 0.1.4\",\n- \"windows-sys 0.42.0\",\n-]\n-\n-[[package]]\n-name = \"rustix\"\n-version = \"0.38.21\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"2b426b0506e5d50a7d8dafcf2e81471400deb602392c7dd110815afb4eaf02a3\"\n+version = \"0.38.30\"\n+source = \"git+https://github.com/AndroidPatch/rustix?branch=main#0e270bce2d97466be6b987bb5f7ea5b1e8d84969\"\n dependencies = [\n  \"bitflags 2.4.1\",\n  \"errno 0.3.8\",\n+ \"itoa\",\n  \"libc\",\n- \"linux-raw-sys 0.4.13\",\n- \"windows-sys 0.48.0\",\n+ \"linux-raw-sys\",\n+ \"once_cell\",\n+ \"windows-sys\",\n ]\n \n [[package]]\n name = \"rustix\"\n-version = \"0.38.30\"\n-source = \"git+https://github.com/AndroidPatch/rustix?branch=main#0e270bce2d97466be6b987bb5f7ea5b1e8d84969\"\n+version = \"0.38.32\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"65e04861e65f21776e67888bfbea442b3642beaa0138fdb1dd7a84a52dffdb89\"\n dependencies = [\n  \"bitflags 2.4.1\",\n  \"errno 0.3.8\",\n- \"itoa\",\n  \"libc\",\n- \"linux-raw-sys 0.4.13\",\n- \"once_cell\",\n- \"windows-sys 0.52.0\",\n+ \"linux-raw-sys\",\n+ \"windows-sys\",\n ]\n \n [[package]]\n@@ -1336,15 +1348,29 @@ checksum = \"ddccb15bcce173023b3fedd9436f882a0739b8dfb45e4f6b6002bee5929f61b2\"\n \n [[package]]\n name = \"serde\"\n-version = \"1.0.152\"\n+version = \"1.0.193\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"25dd9975e68d0cb5aa1120c288333fc98731bd1dd12f561e468ea4728c042b89\"\n+dependencies = [\n+ \"serde_derive\",\n+]\n+\n+[[package]]\n+name = \"serde_derive\"\n+version = \"1.0.193\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"bb7d1f0d3021d347a83e556fc4683dea2ea09d87bccdf88ff5c12545d89d5efb\"\n+checksum = \"43576ca501357b9b071ac53cdc7da8ef0cbd9493d8df094cd821777ea6e894d3\"\n+dependencies = [\n+ \"proc-macro2\",\n+ \"quote\",\n+ \"syn 2.0.38\",\n+]\n \n [[package]]\n name = \"serde_json\"\n-version = \"1.0.91\"\n+version = \"1.0.109\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"877c235533714907a8c2464236f5c4b2a17262ef1bd71f38f35ea592c8da6883\"\n+checksum = \"cb0652c533506ad7a2e353cce269330d6afd8bdfb6d75e0ace5b35aacbd7b9e9\"\n dependencies = [\n  \"itoa\",\n  \"ryu\",\n@@ -1375,9 +1401,9 @@ dependencies = [\n \n [[package]]\n name = \"sha256\"\n-version = \"1.4.0\"\n+version = \"1.5.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7895c8ae88588ccead14ff438b939b0c569cd619116f14b4d13fdff7b8333386\"\n+checksum = \"18278f6a914fa3070aa316493f7d2ddfb9ac86ebc06fa3b83bffda487e9065b0\"\n dependencies = [\n  \"async-trait\",\n  \"bytes\",\n@@ -1388,9 +1414,9 @@ dependencies = [\n \n [[package]]\n name = \"strsim\"\n-version = \"0.10.0\"\n+version = \"0.11.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"73473c0e59e6d5812c5dfe2a064a6444949f089e20eec9a2e5506596494e4623\"\n+checksum = \"7da8b5736845d9f2fcb837ea5d9e2628564b3b043a70948a3f0b778838c5fb4f\"\n \n [[package]]\n name = \"subtle\"\n@@ -1439,37 +1465,6 @@ dependencies = [\n  \"winapi-util\",\n ]\n \n-[[package]]\n-name = \"thiserror\"\n-version = \"1.0.38\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"6a9cd18aa97d5c45c6603caea1da6628790b37f7a34b6ca89522331c5180fed0\"\n-dependencies = [\n- \"thiserror-impl\",\n-]\n-\n-[[package]]\n-name = \"thiserror-impl\"\n-version = \"1.0.38\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"1fb327af4685e4d03fa8cbcf1716380da910eeb2bb8be417e7f9fd3fb164f36f\"\n-dependencies = [\n- \"proc-macro2\",\n- \"quote\",\n- \"syn 1.0.107\",\n-]\n-\n-[[package]]\n-name = \"time\"\n-version = \"0.1.45\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"1b797afad3f312d1c66a56d11d0316f916356d11bd158fbc6ca6389ff6bf805a\"\n-dependencies = [\n- \"libc\",\n- \"wasi 0.10.0+wasi-snapshot-preview1\",\n- \"winapi\",\n-]\n-\n [[package]]\n name = \"time\"\n version = \"0.3.20\"\n@@ -1522,6 +1517,12 @@ version = \"0.2.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"f962df74c8c05a667b5ee8bcf162993134c104e96440b663c8daa176dc772d8c\"\n \n+[[package]]\n+name = \"utf8parse\"\n+version = \"0.2.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"711b9620af191e0cdc7468a8d14e709c3dcdb115b36f838e601583af800a370a\"\n+\n [[package]]\n name = \"version_check\"\n version = \"0.9.4\"\n@@ -1539,12 +1540,6 @@ dependencies = [\n  \"winapi-util\",\n ]\n \n-[[package]]\n-name = \"wasi\"\n-version = \"0.10.0+wasi-snapshot-preview1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"1a143597ca7c7793eff794def352d41792a93c481eb1042423ff7ff72ba2c31f\"\n-\n [[package]]\n name = \"wasi\"\n version = \"0.11.0+wasi-snapshot-preview1\"\n@@ -1607,15 +1602,14 @@ checksum = \"0046fef7e28c3804e5e38bfa31ea2a0f73905319b677e57ebe37e49358989b5d\"\n \n [[package]]\n name = \"which\"\n-version = \"5.0.0\"\n+version = \"6.0.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9bf3ea8596f3a0dd5980b46430f2058dfe2c36a27ccfbb1845d6fbfcd9ba6e14\"\n+checksum = \"8211e4f58a2b2805adfbefbc07bab82958fc91e3836339b1ab7ae32465dce0d7\"\n dependencies = [\n  \"either\",\n  \"home\",\n- \"once_cell\",\n- \"rustix 0.38.21\",\n- \"windows-sys 0.48.0\",\n+ \"rustix 0.38.32\",\n+ \"winsafe\",\n ]\n \n [[package]]\n@@ -1649,76 +1643,13 @@ version = \"0.4.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"712e227841d057c1ee1cd2fb22fa7e5a5461ae8e48fa2ca79ec42cfc1931183f\"\n \n-[[package]]\n-name = \"windows-sys\"\n-version = \"0.42.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"5a3e1820f08b8513f676f7ab6c1f99ff312fb97b553d30ff4dd86f9f15728aa7\"\n-dependencies = [\n- \"windows_aarch64_gnullvm 0.42.1\",\n- \"windows_aarch64_msvc 0.42.1\",\n- \"windows_i686_gnu 0.42.1\",\n- \"windows_i686_msvc 0.42.1\",\n- \"windows_x86_64_gnu 0.42.1\",\n- \"windows_x86_64_gnullvm 0.42.1\",\n- \"windows_x86_64_msvc 0.42.1\",\n-]\n-\n-[[package]]\n-name = \"windows-sys\"\n-version = \"0.45.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"75283be5efb2831d37ea142365f009c02ec203cd29a3ebecbc093d52315b66d0\"\n-dependencies = [\n- \"windows-targets 0.42.1\",\n-]\n-\n-[[package]]\n-name = \"windows-sys\"\n-version = \"0.48.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"677d2418bec65e3338edb076e806bc1ec15693c5d0104683f2efe857f61056a9\"\n-dependencies = [\n- \"windows-targets 0.48.5\",\n-]\n-\n [[package]]\n name = \"windows-sys\"\n version = \"0.52.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"282be5f36a8ce781fad8c8ae18fa3f9beff57ec1b52cb3de0789201425d9a33d\"\n dependencies = [\n- \"windows-targets 0.52.0\",\n-]\n-\n-[[package]]\n-name = \"windows-targets\"\n-version = \"0.42.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"8e2522491fbfcd58cc84d47aeb2958948c4b8982e9a2d8a2a35bbaed431390e7\"\n-dependencies = [\n- \"windows_aarch64_gnullvm 0.42.1\",\n- \"windows_aarch64_msvc 0.42.1\",\n- \"windows_i686_gnu 0.42.1\",\n- \"windows_i686_msvc 0.42.1\",\n- \"windows_x86_64_gnu 0.42.1\",\n- \"windows_x86_64_gnullvm 0.42.1\",\n- \"windows_x86_64_msvc 0.42.1\",\n-]\n-\n-[[package]]\n-name = \"windows-targets\"\n-version = \"0.48.5\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9a2fa6e2155d7247be68c096456083145c183cbbbc2764150dda45a87197940c\"\n-dependencies = [\n- \"windows_aarch64_gnullvm 0.48.5\",\n- \"windows_aarch64_msvc 0.48.5\",\n- \"windows_i686_gnu 0.48.5\",\n- \"windows_i686_msvc 0.48.5\",\n- \"windows_x86_64_gnu 0.48.5\",\n- \"windows_x86_64_gnullvm 0.48.5\",\n- \"windows_x86_64_msvc 0.48.5\",\n+ \"windows-targets\",\n ]\n \n [[package]]\n@@ -1727,135 +1658,51 @@ version = \"0.52.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"8a18201040b24831fbb9e4eb208f8892e1f50a37feb53cc7ff887feb8f50e7cd\"\n dependencies = [\n- \"windows_aarch64_gnullvm 0.52.0\",\n- \"windows_aarch64_msvc 0.52.0\",\n- \"windows_i686_gnu 0.52.0\",\n- \"windows_i686_msvc 0.52.0\",\n- \"windows_x86_64_gnu 0.52.0\",\n- \"windows_x86_64_gnullvm 0.52.0\",\n- \"windows_x86_64_msvc 0.52.0\",\n+ \"windows_aarch64_gnullvm\",\n+ \"windows_aarch64_msvc\",\n+ \"windows_i686_gnu\",\n+ \"windows_i686_msvc\",\n+ \"windows_x86_64_gnu\",\n+ \"windows_x86_64_gnullvm\",\n+ \"windows_x86_64_msvc\",\n ]\n \n-[[package]]\n-name = \"windows_aarch64_gnullvm\"\n-version = \"0.42.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"8c9864e83243fdec7fc9c5444389dcbbfd258f745e7853198f365e3c4968a608\"\n-\n-[[package]]\n-name = \"windows_aarch64_gnullvm\"\n-version = \"0.48.5\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"2b38e32f0abccf9987a4e3079dfb67dcd799fb61361e53e2882c3cbaf0d905d8\"\n-\n [[package]]\n name = \"windows_aarch64_gnullvm\"\n version = \"0.52.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"cb7764e35d4db8a7921e09562a0304bf2f93e0a51bfccee0bd0bb0b666b015ea\"\n \n-[[package]]\n-name = \"windows_aarch64_msvc\"\n-version = \"0.42.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"4c8b1b673ffc16c47a9ff48570a9d85e25d265735c503681332589af6253c6c7\"\n-\n-[[package]]\n-name = \"windows_aarch64_msvc\"\n-version = \"0.48.5\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"dc35310971f3b2dbbf3f0690a219f40e2d9afcf64f9ab7cc1be722937c26b4bc\"\n-\n [[package]]\n name = \"windows_aarch64_msvc\"\n version = \"0.52.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"bbaa0368d4f1d2aaefc55b6fcfee13f41544ddf36801e793edbbfd7d7df075ef\"\n \n-[[package]]\n-name = \"windows_i686_gnu\"\n-version = \"0.42.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"de3887528ad530ba7bdbb1faa8275ec7a1155a45ffa57c37993960277145d640\"\n-\n-[[package]]\n-name = \"windows_i686_gnu\"\n-version = \"0.48.5\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a75915e7def60c94dcef72200b9a8e58e5091744960da64ec734a6c6e9b3743e\"\n-\n [[package]]\n name = \"windows_i686_gnu\"\n version = \"0.52.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"a28637cb1fa3560a16915793afb20081aba2c92ee8af57b4d5f28e4b3e7df313\"\n \n-[[package]]\n-name = \"windows_i686_msvc\"\n-version = \"0.42.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"bf4d1122317eddd6ff351aa852118a2418ad4214e6613a50e0191f7004372605\"\n-\n-[[package]]\n-name = \"windows_i686_msvc\"\n-version = \"0.48.5\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"8f55c233f70c4b27f66c523580f78f1004e8b5a8b659e05a4eb49d4166cca406\"\n-\n [[package]]\n name = \"windows_i686_msvc\"\n version = \"0.52.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"ffe5e8e31046ce6230cc7215707b816e339ff4d4d67c65dffa206fd0f7aa7b9a\"\n \n-[[package]]\n-name = \"windows_x86_64_gnu\"\n-version = \"0.42.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"c1040f221285e17ebccbc2591ffdc2d44ee1f9186324dd3e84e99ac68d699c45\"\n-\n-[[package]]\n-name = \"windows_x86_64_gnu\"\n-version = \"0.48.5\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"53d40abd2583d23e4718fddf1ebec84dbff8381c07cae67ff7768bbf19c6718e\"\n-\n [[package]]\n name = \"windows_x86_64_gnu\"\n version = \"0.52.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"3d6fa32db2bc4a2f5abeacf2b69f7992cd09dca97498da74a151a3132c26befd\"\n \n-[[package]]\n-name = \"windows_x86_64_gnullvm\"\n-version = \"0.42.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"628bfdf232daa22b0d64fdb62b09fcc36bb01f05a3939e20ab73aaf9470d0463\"\n-\n-[[package]]\n-name = \"windows_x86_64_gnullvm\"\n-version = \"0.48.5\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"0b7b52767868a23d5bab768e390dc5f5c55825b6d30b86c844ff2dc7414044cc\"\n-\n [[package]]\n name = \"windows_x86_64_gnullvm\"\n version = \"0.52.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"1a657e1e9d3f514745a572a6846d3c7aa7dbe1658c056ed9c3344c4109a6949e\"\n \n-[[package]]\n-name = \"windows_x86_64_msvc\"\n-version = \"0.42.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"447660ad36a13288b1db4d4248e857b510e8c3a225c822ba4fb748c0aafecffd\"\n-\n-[[package]]\n-name = \"windows_x86_64_msvc\"\n-version = \"0.48.5\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"ed94fce61571a4006852b7389a063ab983c02eb1bb37b47f8272ce92d06d9538\"\n-\n [[package]]\n name = \"windows_x86_64_msvc\"\n version = \"0.52.0\"\n@@ -1863,24 +1710,16 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"dff9641d1cd4be8d1a070daf9e3773c5f67e78b4d9d42263020c057706765c04\"\n \n [[package]]\n-name = \"zip\"\n-version = \"0.5.13\"\n+name = \"winsafe\"\n+version = \"0.0.19\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"93ab48844d61251bb3835145c521d88aa4031d7139e8485990f60ca911fa0815\"\n-dependencies = [\n- \"byteorder\",\n- \"bzip2\",\n- \"crc32fast\",\n- \"flate2\",\n- \"thiserror\",\n- \"time 0.1.45\",\n-]\n+checksum = \"d135d17ab770252ad95e9a872d365cf3090e3be864a34ab46f48555993efc904\"\n \n [[package]]\n name = \"zip\"\n-version = \"0.6.4\"\n+version = \"0.6.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"0445d0fbc924bb93539b4316c11afb121ea39296f99a3c4c9edad09e3658cdef\"\n+checksum = \"760394e246e4c28189f19d488c058bf16f564016aefac5d32bb1f3b51d5e9261\"\n dependencies = [\n  \"aes\",\n  \"byteorder\",\n@@ -1892,17 +1731,17 @@ dependencies = [\n  \"hmac\",\n  \"pbkdf2\",\n  \"sha1\",\n- \"time 0.3.20\",\n+ \"time\",\n  \"zstd\",\n ]\n \n [[package]]\n name = \"zip-extensions\"\n-version = \"0.6.1\"\n+version = \"0.6.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a64c3c977bc3434ce2d4bcea8ad3c644672de0f2c402b72b9171ca80a8885d14\"\n+checksum = \"cecf62554c4ff96bce01a7ef123d160c3ffe9180638820f8b4d545c65b221b8c\"\n dependencies = [\n- \"zip 0.5.13\",\n+ \"zip\",\n ]\n \n [[package]]\ndiff --git a/apd/Cargo.toml b/apd/Cargo.toml\nindex e39e14d36..52306e984 100644\n--- a/apd/Cargo.toml\n+++ b/apd/Cargo.toml\n@@ -14,7 +14,7 @@ zip = \"0.6\"\n zip-extensions = \"0.6\"\n java-properties = \"2.0.0\"\n log = \"0.4\"\n-env_logger = \"0.10\"\n+env_logger = \"0.11\"\n serde = { version = \"1\" }\n serde_json = \"1\"\n regex = \"1\"\n@@ -27,11 +27,11 @@ jwalk = \"0.8\"\n is_executable = \"1\"\n nom = \"7\"\n derive-new = \"0.6.0\"\n-rust-embed = { version = \"8.0.0\", features = [\n+rust-embed = { version = \"8.3.0\", features = [\n     \"debug-embed\",\n     \"compression\", # must clean build after updating binaries\n ] }\n-which = \"5\"\n+which = \"6\"\n getopts = \"0.2\"\n sha256 = \"1\"\n tempdir = \"0.3\"\n", "changes": [{"file": "apd/Cargo.toml", "module": "apd.CargoToml", "range": [{"start": 17, "end": 18}, {"start": 30, "end": 31}, {"start": 34, "end": 35}]}, {"file": "apd/Cargo.lock", "module": "apd.CargoLock", "range": [{"start": 28, "end": 29}, {"start": 30, "end": 31}, {"start": 35, "end": 35}, {"start": 40, "end": 41}, {"start": 42, "end": 43}, {"start": 53, "end": 53}, {"start": 61, "end": 62}, {"start": 63, "end": 64}, {"start": 66, "end": 67}, {"start": 80, "end": 80}, {"start": 82, "end": 83}, {"start": 84, "end": 85}, {"start": 98, "end": 99}, {"start": 119, "end": 120}, {"start": 238, "end": 239}, {"start": 240, "end": 241}, {"start": 242, "end": 242}, {"start": 244, "end": 244}, {"start": 246, "end": 246}, {"start": 248, "end": 249}, {"start": 253, "end": 254}, {"start": 255, "end": 256}, {"start": 257, "end": 258}, {"start": 262, "end": 263}, {"start": 264, "end": 265}, {"start": 266, "end": 267}, {"start": 268, "end": 268}, {"start": 269, "end": 270}, {"start": 272, "end": 272}, {"start": 277, "end": 278}, {"start": 279, "end": 280}, {"start": 282, "end": 282}, {"start": 285, "end": 286}, {"start": 290, "end": 291}, {"start": 292, "end": 296}, {"start": 307, "end": 307}, {"start": 309, "end": 310}, {"start": 311, "end": 312}, {"start": 318, "end": 319}, {"start": 320, "end": 321}, {"start": 502, "end": 503}, {"start": 504, "end": 505}, {"start": 515, "end": 515}, {"start": 517, "end": 518}, {"start": 519, "end": 520}, {"start": 521, "end": 522}, {"start": 525, "end": 526}, {"start": 546, "end": 547}, {"start": 613, "end": 614}, {"start": 624, "end": 625}, {"start": 626, "end": 627}, {"start": 654, "end": 655}, {"start": 656, "end": 657}, {"start": 658, "end": 659}, {"start": 735, "end": 747}, {"start": 748, "end": 749}, {"start": 750, "end": 754}, {"start": 857, "end": 862}, {"start": 871, "end": 872}, {"start": 873, "end": 877}, {"start": 889, "end": 890}, {"start": 891, "end": 892}, {"start": 927, "end": 936}, {"start": 971, "end": 982}, {"start": 1024, "end": 1047}, {"start": 1075, "end": 1076}, {"start": 1189, "end": 1190}, {"start": 1191, "end": 1192}, {"start": 1200, "end": 1201}, {"start": 1202, "end": 1203}, {"start": 1230, "end": 1231}, {"start": 1232, "end": 1233}, {"start": 1242, "end": 1243}, {"start": 1244, "end": 1245}, {"start": 1255, "end": 1256}, {"start": 1257, "end": 1258}, {"start": 1271, "end": 1288}, {"start": 1291, "end": 1291}, {"start": 1292, "end": 1294}, {"start": 1298, "end": 1300}, {"start": 1303, "end": 1303}, {"start": 1305, "end": 1308}, {"start": 1339, "end": 1340}, {"start": 1341, "end": 1342}, {"start": 1345, "end": 1346}, {"start": 1347, "end": 1348}, {"start": 1378, "end": 1379}, {"start": 1380, "end": 1381}, {"start": 1391, "end": 1392}, {"start": 1393, "end": 1394}, {"start": 1442, "end": 1472}, {"start": 1525, "end": 1525}, {"start": 1542, "end": 1547}, {"start": 1610, "end": 1611}, {"start": 1612, "end": 1613}, {"start": 1616, "end": 1619}, {"start": 1652, "end": 1684}, {"start": 1691, "end": 1722}, {"start": 1730, "end": 1737}, {"start": 1739, "end": 1750}, {"start": 1757, "end": 1768}, {"start": 1775, "end": 1786}, {"start": 1793, "end": 1804}, {"start": 1811, "end": 1822}, {"start": 1829, "end": 1840}, {"start": 1847, "end": 1858}, {"start": 1866, "end": 1868}, {"start": 1869, "end": 1878}, {"start": 1881, "end": 1882}, {"start": 1883, "end": 1884}, {"start": 1895, "end": 1896}, {"start": 1901, "end": 1902}, {"start": 1903, "end": 1904}, {"start": 1905, "end": 1906}]}]}]}
{"url": "https://github.com/mostafaalagamy/Metrolist/issues/1702", "repo": {"url": "https://github.com/mostafaalagamy/Metrolist", "name": "Metrolist", "owner": "mostafaalagamy", "modules": ["com.metrolist.innertube", "com.metrolist.innertube.models", "com.metrolist.innertube.models.body", "com.metrolist.innertube.models.response", "com.metrolist.innertube.pages", "com.metrolist.innertube.utils", "com.metrolist.kugou", "com.metrolist.kugou.models", "com.metrolist.lastfm", "com.metrolist.lastfm.models", "com.metrolist.lrclib", "com.metrolist.lrclib.models", "com.metrolist.music", "com.metrolist.music.constants", "com.metrolist.music.db", "com.metrolist.music.db.entities", "com.metrolist.music.di", "com.metrolist.music.extensions", "com.metrolist.music.lyrics", "com.metrolist.music.models", "com.metrolist.music.playback", "com.metrolist.music.playback.queues", "com.metrolist.music.ui.component", "com.metrolist.music.ui.component.shimmer", "com.metrolist.music.ui.menu", "com.metrolist.music.ui.player", "com.metrolist.music.ui.screens", "com.metrolist.music.ui.screens.artist", "com.metrolist.music.ui.screens.library", "com.metrolist.music.ui.screens.playlist", "com.metrolist.music.ui.screens.search", "com.metrolist.music.ui.screens.settings", "com.metrolist.music.ui.screens.settings.integrations", "com.metrolist.music.ui.theme", "com.metrolist.music.ui.utils", "com.metrolist.music.utils", "com.metrolist.music.viewmodels", "com.my.kizzy.gateway", "com.my.kizzy.gateway.entities", "com.my.kizzy.gateway.entities.op", "com.my.kizzy.gateway.entities.presence", "com.my.kizzy.remote", "com.my.kizzy.repository", "com.my.kizzy.rpc", "com.my.kizzy.utils"]}, "issue": {"number": 1702, "url": "https://github.com/mostafaalagamy/Metrolist/issues/1702", "state": "closed", "title": "Song cover in Discord RPC is bugged out", "body": "### Checklist\n\n- [x] I am able to reproduce the bug with the [latest debug version](https://github.com/mostafaalagamy/Metrolist/actions).\n- [x] I've checked that there is no open or closed issue about this bug.\n- [x] This issue contains only one bug.\n- [x] The title of this issue accurately describes the bug.\n\n### Steps to reproduce the bug\n\n1. Enable Discord Integration (RPC) on Metrolist\n2. Play a song on Metrolist\n3. Check your Rich Presence on Discord, there's a like 1/3 chance it might be just bugged out and replaced by the fallback Metrolist icon, it does not happen every time\n\n### Expected behavior\n\nSong cover should be displayed as the actual one on the Discord RPC\n\n### Actual behavior\n\nSong cover was replaced by Metrolist icon on Discord RPC (fallback picture?)\n\n### Screenshots/Screen recordings\n\n![Image](https://github.com/user-attachments/assets/f6391934-e649-4185-8958-0fdcac94a917)\n![Image](https://github.com/user-attachments/assets/7860feb1-24a1-4a0f-a6e5-78b880d057b5)\n\n\n### Logs\n\n[ml_logcat.txt](https://github.com/user-attachments/files/22602690/ml_logcat.txt)\n\n### Metrolist version\n\n12.6.0 (latest debug)\n\n### Android version\n\nAndroid 16\n\n### Additional information\n\n_No response_", "logs": [{"name": "ml_logcat.txt", "url": "https://github.com/user-attachments/files/22602690/ml_logcat.txt"}]}, "pull_request": [{"number": 569, "url": "https://github.com/mostafaalagamy/Metrolist/pull/569", "diff_url": "https://github.com/mostafaalagamy/Metrolist/pull/569.diff", "patch_url": "https://github.com/mostafaalagamy/Metrolist/pull/569.patch", "title": "build(deps): bump org.jsoup:jsoup from 1.18.1 to 1.19.1", "content": "Bumps [org.jsoup:jsoup](https://github.com/jhy/jsoup) from 1.18.1 to 1.19.1.\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/jhy/jsoup/releases\">org.jsoup:jsoup's releases</a>.</em></p>\n<blockquote>\n<h2>jsoup 1.19.1</h2>\n<h3>Changes</h3>\n<ul>\n<li>Added support for <strong>http/2</strong> requests in <code>Jsoup.connect()</code>, when running on Java 11+, via the Java HttpClient\nimplementation. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2257\">#2257</a>.\n<ul>\n<li>In this version of jsoup, the default is to make requests via the HttpUrlConnection implementation: use\n<strong><code>System.setProperty(&quot;jsoup.useHttpClient&quot;, &quot;true&quot;);</code></strong> to enable making requests via the HttpClient instead ,\nwhich will enable http/2 support, if available. This will become the default in a later version of jsoup, so now is\na good time to validate it.</li>\n<li>If you are repackaging the jsoup jar in your deployment (i.e. creating a shaded- or a fat-jar), make sure to specify\nthat as a Multi-Release\nJAR.</li>\n<li>If the <code>HttpClient</code> impl is not available in your JRE, requests will continue to be made via\n<code>HttpURLConnection</code> (in <code>http/1.1</code> mode).</li>\n</ul>\n</li>\n<li>Updated the minimum Android API Level validation from 10 to <strong>21</strong>. As with previous jsoup versions, Android\ndevelopers need to enable core library desugaring. The minimum Java version remains Java 8.\n<a href=\"https://redirect.github.com/jhy/jsoup/pull/2173\">#2173</a></li>\n<li>Removed previously deprecated class: <code>org.jsoup.UncheckedIOException</code> (replace with <code>java.io.UncheckedIOException</code>);\nmoved previously deprecated method <code>Element Element#forEach(Consumer)</code> to\n<code>void Element#forEach(Consumer())</code>. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2246\">#2246</a></li>\n<li>Deprecated the methods <code>Document#updateMetaCharsetElement(bool)</code> and <code>#Document#updateMetaCharsetElement()</code>, as the\nsetting had no effect. When <code>Document#charset(Charset)</code> is called, the document's meta charset or XML encoding\ninstruction is always set. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2247\">#2247</a></li>\n</ul>\n<h3>Improvements</h3>\n<ul>\n<li>When cleaning HTML with a <code>Safelist</code> that preserves relative links, the <code>isValid()</code> method will now consider these\nlinks valid. Additionally, the enforced attribute <code>rel=nofollow</code> will only be added to external links when configured\nin the safelist. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2245\">#2245</a></li>\n<li>Added <code>Element#selectStream(String query)</code> and <code>Element#selectStream(Evaluator)</code> methods, that return a <code>Stream</code> of\nmatching elements. Elements are evaluated and returned as they are found, and the stream can be\nterminated early. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2092\">#2092</a></li>\n<li><code>Element</code> objects now implement <code>Iterable</code>, enabling them to be used in enhanced for loops.</li>\n<li>Added support for fragment parsing from a <code>Reader</code> via\n<code>Parser#parseFragmentInput(Reader, Element, String)</code>. <a href=\"https://redirect.github.com/jhy/jsoup/issues/1177\">#1177</a></li>\n<li>Reintroduced CLI executable examples, in <code>jsoup-examples.jar</code>. <a href=\"https://redirect.github.com/jhy/jsoup/issues/1702\">#1702</a></li>\n<li>Optimized performance of selectors like <code>#id .class</code> (and other similar descendant queries) by around 4.6x, by better\nbalancing the Ancestor evaluator's cost function in the query\nplanner. <a href=\"https://redirect.github.com/jhy/jsoup/issues/2254\">#2254</a></li>\n<li>Removed the legacy parsing rules for <code>&lt;isindex&gt;</code> tags, which would autovivify a <code>form</code> element with labels. This is no\nlonger in the spec.</li>\n<li>Added <code>Elements.selectFirst(String cssQuery)</code> and <code>Elements.expectFirst(String cssQuery)</code>, to select the first\nmatching element from an <code>Elements</code> list.  <a href=\"https://redirect.github.com/jhy/jsoup/pull/2263/\">#2263</a></li>\n<li>When parsing with the XML parser, XML Declarations and Processing Instructions are directly handled, vs bouncing\nthrough the HTML parser's bogus comment handler. Serialization for non-doctype declarations no longer end with a\nspurious <code>!</code>. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2275\">#2275</a></li>\n<li>When converting parsed HTML to XML or the W3C DOM, element names containing <code>&lt;</code> are normalized to <code>_</code> to ensure valid\nXML. For example, <code>&lt;foo&lt;bar&gt;</code> becomes <code>&lt;foo_bar&gt;</code>, as XML does not allow <code>&lt;</code> in element names, but HTML5\ndoes. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2276\">#2276</a></li>\n<li>Reimplemented the HTML5 Adoption Agency Algorithm to the current spec. This handles mis-nested formating / structural elements. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2278\">#2278</a></li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/jhy/jsoup/blob/master/CHANGES.md\">org.jsoup:jsoup's changelog</a>.</em></p>\n<blockquote>\n<h2>1.19.1 (2025-03-04)</h2>\n<h3>Changes</h3>\n<ul>\n<li>Added support for <strong>http/2</strong> requests in <code>Jsoup.connect()</code>, when running on Java 11+, via the Java HttpClient\nimplementation. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2257\">#2257</a>.\n<ul>\n<li>In this version of jsoup, the default is to make requests via the HttpUrlConnection implementation: use\n<strong><code>System.setProperty(&quot;jsoup.useHttpClient&quot;, &quot;true&quot;);</code></strong> to enable making requests via the HttpClient instead ,\nwhich will enable http/2 support, if available. This will become the default in a later version of jsoup, so now is\na good time to validate it.</li>\n<li>If you are repackaging the jsoup jar in your deployment (i.e. creating a shaded- or a fat-jar), make sure to specify\nthat as a Multi-Release\nJAR.</li>\n<li>If the <code>HttpClient</code> impl is not available in your JRE, requests will continue to be made via\n<code>HttpURLConnection</code> (in <code>http/1.1</code> mode).</li>\n</ul>\n</li>\n<li>Updated the minimum Android API Level validation from 10 to <strong>21</strong>. As with previous jsoup versions, Android\ndevelopers need to enable core library desugaring. The minimum Java version remains Java 8.\n<a href=\"https://redirect.github.com/jhy/jsoup/pull/2173\">#2173</a></li>\n<li>Removed previously deprecated class: <code>org.jsoup.UncheckedIOException</code> (replace with <code>java.io.UncheckedIOException</code>);\nmoved previously deprecated method <code>Element Element#forEach(Consumer)</code> to\n<code>void Element#forEach(Consumer())</code>. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2246\">#2246</a></li>\n<li>Deprecated the methods <code>Document#updateMetaCharsetElement(boolean)</code> and <code>Document#updateMetaCharsetElement()</code>, as the\nsetting had no effect. When <code>Document#charset(Charset)</code> is called, the document's meta charset or XML encoding\ninstruction is always set. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2247\">#2247</a></li>\n</ul>\n<h3>Improvements</h3>\n<ul>\n<li>When cleaning HTML with a <code>Safelist</code> that preserves relative links, the <code>isValid()</code> method will now consider these\nlinks valid. Additionally, the enforced attribute <code>rel=nofollow</code> will only be added to external links when configured\nin the safelist. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2245\">#2245</a></li>\n<li>Added <code>Element#selectStream(String query)</code> and <code>Element#selectStream(Evaluator)</code> methods, that return a <code>Stream</code> of\nmatching elements. Elements are evaluated and returned as they are found, and the stream can be\nterminated early. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2092\">#2092</a></li>\n<li><code>Element</code> objects now implement <code>Iterable</code>, enabling them to be used in enhanced for loops.</li>\n<li>Added support for fragment parsing from a <code>Reader</code> via\n<code>Parser#parseFragmentInput(Reader, Element, String)</code>. <a href=\"https://redirect.github.com/jhy/jsoup/issues/1177\">#1177</a></li>\n<li>Reintroduced CLI executable examples, in <code>jsoup-examples.jar</code>. <a href=\"https://redirect.github.com/jhy/jsoup/issues/1702\">#1702</a></li>\n<li>Optimized performance of selectors like <code>#id .class</code> (and other similar descendant queries) by around 4.6x, by better\nbalancing the Ancestor evaluator's cost function in the query\nplanner. <a href=\"https://redirect.github.com/jhy/jsoup/issues/2254\">#2254</a></li>\n<li>Removed the legacy parsing rules for <code>&lt;isindex&gt;</code> tags, which would autovivify a <code>form</code> element with labels. This is no\nlonger in the spec.</li>\n<li>Added <code>Elements.selectFirst(String cssQuery)</code> and <code>Elements.expectFirst(String cssQuery)</code>, to select the first\nmatching element from an <code>Elements</code> list.  <a href=\"https://redirect.github.com/jhy/jsoup/pull/2263/\">#2263</a></li>\n<li>When parsing with the XML parser, XML Declarations and Processing Instructions are directly handled, vs bouncing\nthrough the HTML parser's bogus comment handler. Serialization for non-doctype declarations no longer end with a\nspurious <code>!</code>. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2275\">#2275</a></li>\n<li>When converting parsed HTML to XML or the W3C DOM, element names containing <code>&lt;</code> are normalized to <code>_</code> to ensure valid\nXML. For example, <code>&lt;foo&lt;bar&gt;</code> becomes <code>&lt;foo_bar&gt;</code>, as XML does not allow <code>&lt;</code> in element names, but HTML5\ndoes. <a href=\"https://redirect.github.com/jhy/jsoup/pull/2276\">#2276</a></li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/jhy/jsoup/commit/5c4c09a5cbf1271ceeac32452cbc77d0795b81f9\"><code>5c4c09a</code></a> [maven-release-plugin] prepare release jsoup-1.19.1</li>\n<li><a href=\"https://github.com/jhy/jsoup/commit/7de25be1ed3ee28c1500e465f60ec9968e9e9aeb\"><code>7de25be</code></a> Updated changelog in preparation of release</li>\n<li><a href=\"https://github.com/jhy/jsoup/commit/6d7a058efb6f3ab97fdd262602b6331dd8750b2d\"><code>6d7a058</code></a> Use 'el' instead of 'node' in adoption agency</li>\n<li><a href=\"https://github.com/jhy/jsoup/commit/0679bef07f1e29ae72ae54102d5af9a1f80d45d4\"><code>0679bef</code></a> Perf: removed redundant lowercase normalization</li>\n<li><a href=\"https://github.com/jhy/jsoup/commit/d80275e16ebd34bae5b48f29f3e4437e1b207955\"><code>d80275e</code></a> Performance tweak when appending tag names</li>\n<li><a href=\"https://github.com/jhy/jsoup/commit/4b733b16a8ac0dd417c1c57db78743a2b13ea1a1\"><code>4b733b1</code></a> Updated InScope search basetypes to be namespace aware</li>\n<li><a href=\"https://github.com/jhy/jsoup/commit/d89d75794a3daffb5806eaf683d2ad07b66b9647\"><code>d89d757</code></a> Changelog tidy</li>\n<li><a href=\"https://github.com/jhy/jsoup/commit/5fde3d992626d0d255793d030c241f2021d39faa\"><code>5fde3d9</code></a> Changelog for <a href=\"https://redirect.github.com/jhy/jsoup/issues/2281\">#2281</a></li>\n<li><a href=\"https://github.com/jhy/jsoup/commit/d55469aa637a3fea7d2a8a7a6291f6ca1774df4f\"><code>d55469a</code></a> Clone the Parser when cloning a Document</li>\n<li><a href=\"https://github.com/jhy/jsoup/commit/11a033427bd7e69f485222998ab7ab60e017dbe3\"><code>11a0334</code></a> Concurrency note</li>\n<li>Additional commits viewable in <a href=\"https://github.com/jhy/jsoup/compare/jsoup-1.18.1...jsoup-1.19.1\">compare view</a></li>\n</ul>\n</details>\n<br />\n\n\n[![Dependabot compatibility score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=org.jsoup:jsoup&package-manager=gradle&previous-version=1.18.1&new-version=1.19.1)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[//]: # (dependabot-automerge-start)\n[//]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options</summary>\n<br />\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot show <dependency name> ignore conditions` will show all of the ignore conditions of the specified dependency\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\n\n\n</details>", "diff": "diff --git a/app/build.gradle.kts b/app/build.gradle.kts\nold mode 100755\nnew mode 100644\nindex 25538ae0a2..8822eedf26\n--- a/app/build.gradle.kts\n+++ b/app/build.gradle.kts\n@@ -179,7 +179,7 @@ dependencies {\n     implementation(libs.apache.lang3)\n \n     implementation(libs.hilt)\n-    implementation(\"org.jsoup:jsoup:1.18.1\")\n+    implementation(\"org.jsoup:jsoup:1.19.1\")\n     kapt(libs.hilt.compiler)\n \n     implementation(projects.innertube)\n", "changes": [{"file": "app/build.gradle.kts", "module": "app.build.gradle.kts", "range": [{"start": 182, "end": 183}]}]}]}
{"url": "https://github.com/home-assistant/android/issues/4294", "repo": {"url": "https://github.com/home-assistant/android", "name": "android", "owner": "home-assistant", "modules": ["android.os", "io.homeassistant.companion.android", "io.homeassistant.lint", "io.homeassistant.lint.annotation", "io.homeassistant.lint.room", "io.homeassistant.lint.serialization", "io.homeassistant.lint.utils"]}, "issue": {"number": 4294, "url": "https://github.com/home-assistant/android/issues/4294", "state": "closed", "title": "reconnection logic error (internal and external url)", "body": "<!-- READ THIS FIRST:\r\n- Make sure you run the latest version of the Android app\r\n- Make sure you run the latest version of Home Assistant\r\n- Make sure to check the Companion docs for troubleshooting and configuration: https://companion.home-assistant.io/\r\n- Make sure the bug you found is not already reported, we love to put work in bugfixes instead of closing duplicate bug reports\r\n  DO NOT DELETE ANY TEXT from this template! All requested information is important.\r\n-->\r\n\r\n<!-- If you are reporting an issue for Wear OS please list both devices for the below 3 fields -->\r\n**Home Assistant Android app version(s):**\r\n2024.1.5-full\r\n**Android version(s):**\r\n13\r\n**Device model(s):**\r\nSamsung Galaxy S21\r\n**Home Assistant version:**\r\n2024.3.3\r\n**Last working Home Assistant release (if known):**\r\nnot known\r\n**Description of problem, include YAML if issue is related to notifications:**\r\nRelated Issues:\r\n#1361 \r\n[HA roaming](https://community.home-assistant.io/t/home-assistant-companion-android-app-roaming-wifi-aps-in-house/638856/7)\r\n\r\nOn my phone I can connect to both internal/external URLs, but switching between the two requires me to shutdown the HA app.\r\nWhen leaving the Home Network Wifi, th HA app gives: \"Connection lost. Reconnecting...\" until I shutdown the HA app and start it again.\r\n\r\nThis happens in both directions:\r\n- coming home after the phone switches to the wifi (ssl handshake fail -> force closing app)\r\n- leaving the house the phone switches to 4G (Connection lost, retrying ... -> but nothing happens)\r\n\r\nThe internal is \"mydomain.de\" and the external \"mydomain.de:8123\". \r\nThe external url is a cloudflare tunnel. On internal use with same url \"mydomain.de\" there's a dns rewrite rule to the correct HA ip.\r\n\r\nIf i leave my home wlan, the connection is lost. It appears a pop-up mentioned [here](https://github.com/home-assistant/android/issues/1361#issuecomment-780036142) but nothing changes with these options. After closing the app it connects to the external URL when i'm connected to GSM.\r\n\r\nIf i dont close the app and reconnect to my home wlan again, the app connects to homeassistant successfully. So i think the app never tries to connect to the external URL automatically (don`t see any reconnection logic, see attached log).\r\nI also receive a ssl handshake error (didn't close the app) if coming from external url when connecting to my home wifi. Then the app log shows:\r\n```\r\n03-25 09:16:13.996  4919  5259 D WebviewActivity: External bus {\"type\":\"connection-status\",\"payload\":{\"event\":\"disconnected\"},\"id\":5}\r\n03-25 09:16:14.170  4919  5147 I cr_X509Util: Failed to validate the certificate chain, error: java.security.cert.CertPathValidatorException: Trust anchor for certification path not found.\r\n03-25 09:16:14.171  4919  5182 E chromium: [ERROR:ssl_client_socket_impl.cc(970)] handshake failed; returned -1, SSL error code 1, net_error -202\r\n03-25 09:16:14.192  4919  4919 E WebviewActivity: onReceivedSslError: primary error: 3 certificate: Issued to: CN=192.168.1.10,O=server,ST=Some-State,C=DE;\r\n03-25 09:16:14.192  4919  4919 E WebviewActivity: Issued by: CN=192.168.1.10,O=server,ST=Some-State,C=DE;\r\n03-25 09:16:14.192  4919  4919 E WebviewActivity:  on URL: wss://mydomain.de/api/websocket\r\n\r\n```\r\nwhen closing app and reopen it, it connects as normal.\r\n\r\nThe issue is exists at least for one year for me.\r\n\r\n<!--\r\n- For Wear OS devices we will need the LogCat logs from the device.\r\n- For Android Auto the logs can be retrieved from the connected device.\r\n- Logs from the device can be taken from Settings > Companion App Troubleshooting > Show and Share Logs\r\n-->\r\n**Companion App Logs:**\r\n\r\n```\r\n03-25 08:37:34.257 12798 12798 D IntegrationRepository: isAppLocked(): false. (LockEnabled: false, appActive: true, expireMillis: 1711352226396, currentMillis: 1711352254257)\r\n03-25 08:37:34.257 12798 12798 D IntegrationRepository: setAppActive(): true\r\n03-25 08:37:34.258 12798 12798 D InputMethodManager: startInputInner - Id : 0\r\n03-25 08:37:34.258 12798 12798 I InputMethodManager: startInputInner - mService.startInputOrWindowGainedFocus\r\n03-25 08:37:35.327 12798 12798 D SensorReceiver: Received intent: android.net.wifi.STATE_CHANGE\r\n03-25 08:37:35.369 12798 15472 D WebviewActivity: External bus {\"type\":\"connection-status\",\"payload\":{\"event\":\"disconnected\"},\"id\":11}\r\n03-25 08:37:35.600 12798 12798 D SensorReceiver: Received intent: android.net.wifi.WIFI_STATE_CHANGED\r\n03-25 08:37:35.677 12798 12829 D ServerConnectionInfo: localUrl is: true, usesInternalSsid is: false, usesWifi is: false\r\n03-25 08:37:35.690 12798 12865 D ServerConnectionInfo: localUrl is: true, usesInternalSsid is: false, usesWifi is: false\r\n03-25 08:37:35.692 12798 12824 I WM-WorkerWrapper: Worker result SUCCESS for Work [ id=2bcf43f4-0921-49ae-a692-39ba1ac4fc77, tags={ io.homeassistant.companion.android.websocket.WebsocketManager } ]\r\n03-25 08:37:35.697 12798 12864 D ServerConnectionInfo: localUrl is: true, usesInternalSsid is: false, usesWifi is: false\r\n03-25 08:37:35.868 12798 12798 D ForegrndServiceLauncher: Check if service HighAccuracyLocationService is running. Service running = false\r\n03-25 08:37:35.915 12798 12798 D ForegrndServiceLauncher: Check if service HighAccuracyLocationService is running. Service running = false\r\n03-25 08:37:36.030 12798 12868 D ServerConnectionInfo: localUrl is: true, usesInternalSsid is: false, usesWifi is: false\r\n03-25 08:37:36.034 12798 12868 D ServerConnectionInfo: localUrl is: true, usesInternalSsid is: false, usesWifi is: false\r\n03-25 08:37:36.040 12798 12829 D ServerConnectionInfo: localUrl is: true, usesInternalSsid is: false, usesWifi is: false\r\n03-25 08:37:36.044 12798 12829 D ServerConnectionInfo: localUrl is: true, usesInternalSsid is: false, usesWifi is: false\r\n03-25 08:37:36.096 12798 25162 D TrafficStats: tagSocket(131) with statsTag=0xffffffff, statsUid=-1\r\n03-25 08:37:36.097 12798 25552 D TrafficStats: tagSocket(141) with statsTag=0xffffffff, statsUid=-1\r\n03-25 08:37:37.790 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:37.878 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:37.898 12798 12829 D LogcatReader: Read logcat for pid 12798\r\n03-25 08:37:38.133 12798 12829 D LogcatReader: Done reading logcat for pid 12798\r\n03-25 08:37:38.250 12798 12807 D InputTransport: Input channel destroyed: 'ClientS', fd=152\r\n03-25 08:37:38.988 12798 12798 I Choreographer: Skipped 31 frames!  The application may be doing too much work on its main thread.\r\n03-25 08:37:39.625 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:39.826 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:40.478 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:40.934 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:41.237 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:41.696 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:42.595 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:43.338 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:43.756 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:44.389 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:45.074 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:46.112 12798 25162 D TrafficStats: tagSocket(105) with statsTag=0xffffffff, statsUid=-1\r\n03-25 08:37:46.112 12798 25552 D TrafficStats: tagSocket(143) with statsTag=0xffffffff, statsUid=-1\r\n03-25 08:37:46.656 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:47.051 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:47.537 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:50.078 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:50.312 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:50.916 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:51.235 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:52.281 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:52.885 12798 12798 D ForegrndServiceLauncher: Check if service HighAccuracyLocationService is running. Service running = false\r\n03-25 08:37:53.148 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:54.033 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:54.383 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:54.753 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:55.628 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:55.895 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:56.124 12798 25552 D TrafficStats: tagSocket(98) with statsTag=0xffffffff, statsUid=-1\r\n03-25 08:37:56.125 12798 25162 D TrafficStats: tagSocket(138) with statsTag=0xffffffff, statsUid=-1\r\n03-25 08:37:56.660 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:56.948 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:57.710 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:58.028 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:58.777 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:37:59.434 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:37:59.751 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:38:01.043 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:38:01.317 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:38:03.170 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 0\r\n03-25 08:38:03.276 12798 12798 I ViewRootImpl@55c5706[SettingsActivity]: ViewPostIme pointer 1\r\n03-25 08:38:03.282 12798 12829 D LogcatReader: Read logcat for pid 12798\r\n\r\n```\r\n\r\n**Screenshot or video of problem:**\r\n![image](https://github.com/home-assistant/android/assets/49484063/20747679-920b-4dce-97c4-2de96c87e13e)\r\n![image](https://github.com/home-assistant/android/assets/49484063/83c8dd6d-a504-4e8a-af52-db23871bcc5a)\r\n\r\n**Additional information:**\r\nanother log: \r\n[log.txt](https://github.com/home-assistant/android/files/14741720/log.txt)\r\n\r\nis it a normal behaviour that \"ServerConnectionInfo: localUrl is: true\" is always \"true\"?\r\nrelated issue #1361", "logs": [{"name": "log.txt", "url": "https://github.com/home-assistant/android/files/14741720/log.txt"}]}, "pull_request": [{"number": 4297, "url": "https://github.com/home-assistant/android/pull/4297", "diff_url": "https://github.com/home-assistant/android/pull/4297.diff", "patch_url": "https://github.com/home-assistant/android/pull/4297.patch", "title": "Check protocol/port when determining reload for WebView", "content": " <!-- Thank you for submitting a Pull Request and helping to improve Home Assistant. Please complete the following sections to help the processing and review of your changes. Please do not delete anything from this template. -->\r\n\r\n## Summary\r\n<!-- Provide a brief summary of the changes you have made and most importantly what they aim to achieve -->\r\nWhen determining whether the WebView should be reloaded with the current server URL, also check that the protocol (http/https) and port (8123, 443, ...) match and if not reload.\r\n\r\nShould fix #4294 as the only difference between the user's URLs is the port and it works correctly when closing/reopening the app which forces a reload with the current URL to use for the webview. This has nothing to do with Cloudflare or the needlessly complicated network setup.\r\n\r\n## Screenshots\r\n<!-- If this is a user-facing change not in the frontend, please include screenshots in light and dark mode. -->\r\nn/a\r\n\r\n## Link to pull request in Documentation repository\r\n<!-- Pull requests that add, change or remove functionality must have a corresponding pull request in the Companion App Documentation repository (https://github.com/home-assistant/companion.home-assistant). Please add the number of this pull request after the \"#\" -->\r\nn/a\r\n\r\n## Any other notes\r\n<!-- If there is any other information of note, like if this Pull Request is part of a bigger change, please include it here. -->", "diff": "diff --git a/app/src/main/java/io/homeassistant/companion/android/webview/WebViewPresenterImpl.kt b/app/src/main/java/io/homeassistant/companion/android/webview/WebViewPresenterImpl.kt\nindex 20eb6212bd5..3bb397439cd 100644\n--- a/app/src/main/java/io/homeassistant/companion/android/webview/WebViewPresenterImpl.kt\n+++ b/app/src/main/java/io/homeassistant/companion/android/webview/WebViewPresenterImpl.kt\n@@ -100,7 +100,12 @@ class WebViewPresenterImpl @Inject constructor(\n             loosing wifi signal and reopening app. Without this we would still be trying to use the\n             internal url externally.\n              */\n-            if (oldUrlForServer != urlForServer || oldUrl?.host != url?.host) {\n+            if (\n+                oldUrlForServer != urlForServer ||\n+                oldUrl?.protocol != url?.protocol ||\n+                oldUrl?.host != url?.host ||\n+                oldUrl?.port != url?.port\n+            ) {\n                 view.loadUrl(\n                     url = Uri.parse(url.toString())\n                         .buildUpon()\n", "changes": [{"file": "app/src/main/java/io/homeassistant/companion/android/webview/WebViewPresenterImpl.kt", "module": "io.homeassistant.companion.android.webview.WebViewPresenterImpl", "range": [{"start": 103, "end": 104}]}]}]}
{"url": "https://github.com/home-assistant/android/issues/3893", "repo": {"url": "https://github.com/home-assistant/android", "name": "android", "owner": "home-assistant", "modules": ["android.os", "io.homeassistant.companion.android", "io.homeassistant.lint", "io.homeassistant.lint.annotation", "io.homeassistant.lint.room", "io.homeassistant.lint.serialization", "io.homeassistant.lint.utils"]}, "issue": {"number": 3893, "url": "https://github.com/home-assistant/android/issues/3893", "state": "closed", "title": "Service Button Widgets Do Not Open Authentication Window On Android 14 QPR1+", "body": "<!-- READ THIS FIRST:\r\n- Make sure you run the latest version of the Android app\r\n- Make sure you run the latest version of Home Assistant\r\n- Make sure to check the Companion docs for troubleshooting and configuration: https://companion.home-assistant.io/\r\n- Make sure the bug you found is not already reported, we love to put work in bugfixes instead of closing duplicate bug reports\r\n  DO NOT DELETE ANY TEXT from this template! All requested information is important.\r\n-->\r\n\r\n<!-- If you are reporting an issue for Wear OS please list both devices for the below 3 fields -->\r\n**Home Assistant Android app version(s):**\r\n2023.9.2-full\r\n\r\n**Android version(s):**\r\nU1B1.230908.003 (Android 14 QPR 1)\r\n\r\n**Device model(s):**\r\nPixel Fold\r\n\r\n**Home Assistant version:**\r\n2023.9.3\r\n\r\n**Last working Home Assistant release (if known):**\r\n2023.9.2 (HAOS)\r\n2023.9.2-full (Android)\r\n\r\n**Description of problem, include YAML if issue is related to notifications:**\r\nAndroid service button widgets that have authentication enabled no longer work on Android 14 QPR Beta 1. Clicking the widget does nothing, but spam clicking the widget may inconsistently bring up the authentication window. Disabling authentication allows the widget to work (albeit without authentication). Service button widgets with authentication did work on Android 14 Beta 5.3. Recreating the widget or restarting the device does not fix the issue.\r\n\r\n<!--\r\n- For Wear OS devices we will need the LogCat logs from the device.\r\n- For Android Auto the logs can be retrieved from the connected device.\r\n- Logs from the device can be taken from Settings > Companion App Troubleshooting > Show and Share Logs\r\n-->\r\n**Companion App Logs:**\r\nThe last bit of the attached companion app log seems relevant. Widget authentication is cancelling before authentication pops up.\r\n```\r\n09-26 21:10:26.203  4534  4534 D ButtonWidget: Broadcast received: \r\n09-26 21:10:26.203  4534  4534 D ButtonWidget: Broadcast action: io.homeassistant.companion.android.widgets.button.ButtonWidget.CALL_SERVICE_AUTH\r\n09-26 21:10:26.203  4534  4534 D ButtonWidget: AppWidgetId: 163\r\n09-26 21:10:26.203  4534  4534 D ButtonWidget: Calling authentication, then configured service\r\n09-26 21:10:26.237  4534  4534 D WidgetAuthenticationA: onCreate in WidgetAuthenticationActivity called\r\n09-26 21:10:26.260  4534  4534 D Unlock  : onAuthenticationError -> 10 :: Authentication canceled\r\n09-26 21:10:26.260  4534  4534 D WidgetAuthenticationA: Authentication canceled by user, closing activity\r\n09-26 21:10:26.269  4534  4534 W WindowOnBackDispatcher: sendCancelIfRunning: isInProgress=falsecallback=androidx.activity.OnBackPressedDispatcher$Api33Impl$$ExternalSyntheticLambda0@5b589b6\r\n09-26 21:10:26.294  4534  4534 W WindowOnBackDispatcher: sendCancelIfRunning: isInProgress=falsecallback=android.app.Activity$$ExternalSyntheticLambda0@b86b8d5\r\n09-26 21:10:27.644  4534  4534 D IntegrationRepository: isAppLocked(): false. (LockEnabled: false, appActive: false, expireMillis: 1695777025122, currentMillis: 1695777027644)\r\n09-26 21:10:27.668  4534  4534 W Choreographer: Frame time is 0.153961 ms in the future!  Check that graphics HAL is generating vsync timestamps using the correct timebase.\r\n09-26 21:10:27.698  4534  4534 D IntegrationRepository: isAppLocked(): false. (LockEnabled: false, appActive: false, expireMillis: 1695777025122, currentMillis: 1695777027698)\r\n09-26 21:10:27.698  4534  4534 D IntegrationRepository: setAppActive(): true\r\n09-26 21:10:29.180  4534 21357 D LogcatReader: Read logcat for pid 4534\r\n```\r\n[homeassistant_companion_log_8-26-2023_21-10-37.txt](https://github.com/home-assistant/android/files/12733066/homeassistant_companion_log_8-26-2023_21-10-37.txt)\r\n\r\n\r\n**Screenshot or video of problem:**\r\n\r\nhttps://github.com/home-assistant/android/assets/43071698/b7c2ab62-ac3e-408c-bef3-0b0426c60980\r\n\r\n\r\n\r\n**Additional information:**\r\nThis may be an issue with Android 14 QPR Beta 1 and a bug for it has also been created in the Google issue tracker: https://issuetracker.google.com/issues/302159855\r\n", "logs": [{"name": "homeassistant_companion_log_8-26-2023_21-10-37.txt", "url": "https://github.com/home-assistant/android/files/12733066/homeassistant_companion_log_8-26-2023_21-10-37.txt"}]}, "pull_request": [{"number": 4066, "url": "https://github.com/home-assistant/android/pull/4066", "diff_url": "https://github.com/home-assistant/android/pull/4066.diff", "patch_url": "https://github.com/home-assistant/android/pull/4066.patch", "title": "Fix button widget authentication dismissed due to non-foreground window", "content": "<!-- Thank you for submitting a Pull Request and helping to improve Home Assistant. Please complete the following sections to help the processing and review of your changes. Please do not delete anything from this template. -->\r\n\r\n## Summary\r\n<!-- Provide a brief summary of the changes you have made and most importantly what they aim to achieve -->\r\nFixes #3893: prevent the button widget authentication dialog automatically being dismissed when triggered on Android 14 QPR1+, because the window was not in the foreground. It looks like the framework check for this was bugged before QPR1, and the Home Assistant app was showing the authentication dialog before the window (which is transparent) was in the foreground.\r\n\r\nMore details about how I found this in my last comment on the issue.\r\n\r\n## Screenshots\r\n<!-- If this is a user-facing change not in the frontend, please include screenshots in light and dark mode. -->\r\nNo visual changes except maybe you have to wait 50-100ms longer for the window to get to the foreground compared to older versions?\r\n\r\nhttps://github.com/home-assistant/android/assets/8148535/d526e696-9a98-4a0a-9cfe-47f6bce48ae7\r\n\r\n## Link to pull request in Documentation repository\r\n<!-- Pull requests that add, change or remove functionality must have a corresponding pull request in the Companion App Documentation repository (https://github.com/home-assistant/companion.home-assistant). Please add the number of this pull request after the \"#\" -->\r\nn/a\r\n\r\n## Any other notes\r\n<!-- If there is any other information of note, like if this Pull Request is part of a bigger change, please include it here. -->", "diff": "diff --git a/app/src/main/java/io/homeassistant/companion/android/widgets/common/WidgetAuthenticationActivity.kt b/app/src/main/java/io/homeassistant/companion/android/widgets/common/WidgetAuthenticationActivity.kt\nindex bc07f04e769..44296e30310 100644\n--- a/app/src/main/java/io/homeassistant/companion/android/widgets/common/WidgetAuthenticationActivity.kt\n+++ b/app/src/main/java/io/homeassistant/companion/android/widgets/common/WidgetAuthenticationActivity.kt\n@@ -15,12 +15,20 @@ class WidgetAuthenticationActivity : AppCompatActivity() {\n         private const val TAG = \"WidgetAuthenticationA\"\n     }\n \n+    private var authenticating = false\n+\n     override fun onCreate(savedInstanceState: Bundle?) {\n         super.onCreate(savedInstanceState)\n         Log.d(TAG, \"onCreate in WidgetAuthenticationActivity called\")\n+    }\n \n-        val authenticator = Authenticator(this, this, ::authenticationResult)\n-        authenticator.authenticate(getString(R.string.biometric_set_title))\n+    override fun onWindowFocusChanged(hasFocus: Boolean) {\n+        super.onWindowFocusChanged(hasFocus)\n+        if (hasFocus && !isFinishing && !authenticating) {\n+            val authenticator = Authenticator(this, this, ::authenticationResult)\n+            authenticator.authenticate(getString(R.string.biometric_set_title))\n+            authenticating = true\n+        }\n     }\n \n     private fun authenticationResult(result: Int) {\n", "changes": [{"file": "app/src/main/java/io/homeassistant/companion/android/widgets/common/WidgetAuthenticationActivity.kt", "module": "io.homeassistant.companion.android.widgets.common.WidgetAuthenticationActivity", "range": [{"start": 18, "end": 18}, {"start": 21, "end": 21}, {"start": 22, "end": 24}]}]}]}
{"url": "https://github.com/home-assistant/android/issues/3770", "repo": {"url": "https://github.com/home-assistant/android", "name": "android", "owner": "home-assistant", "modules": ["android.os", "io.homeassistant.companion.android", "io.homeassistant.lint", "io.homeassistant.lint.annotation", "io.homeassistant.lint.room", "io.homeassistant.lint.serialization", "io.homeassistant.lint.utils"]}, "issue": {"number": 3770, "url": "https://github.com/home-assistant/android/issues/3770", "state": "closed", "title": "App crashes every time I select \"Android Auto Favourite\" or Quick Setting Tiles", "body": "<!-- READ THIS FIRST:\r\n- Make sure you run the latest version of the Android app\r\n- Make sure you run the latest version of Home Assistant\r\n- Make sure to check the Companion docs for troubleshooting and configuration: https://companion.home-assistant.io/\r\n- Make sure the bug you found is not already reported, we love to put work in bugfixes instead of closing duplicate bug reports\r\n  DO NOT DELETE ANY TEXT from this template! All requested information is important.\r\n-->\r\n\r\n<!-- If you are reporting an issue for Wear OS please list both devices for the below 3 fields -->\r\n**Home Assistant Android app version(s):**\r\n2023.8.1-full \r\n**Android version(s):**\r\n13\r\n**Device model(s):**\r\nGalaxy S23 Ultra (SM-S918B)\r\n**Home Assistant version:**\r\n2023.8.1\r\n**Last working Home Assistant release (if known):**\r\nThis feature has never worked for me\r\n**Description of problem, include YAML if issue is related to notifications:**\r\nEvery time I try to add an \"Adroid Auto Favourite\" the app crashes and restarts approx 1 second after I select \"Android Auto Favourites\" (the list does not populate)\r\n\r\n<!--\r\n- For Wear OS devices we will need the LogCat logs from the device.\r\n- For Android Auto the logs can be retrieved from the connected device.\r\n- Logs from the device can be taken from Settings > Companion App > Show and Share Logs\r\n-->\r\n**Companion App Logs:**\r\n[homeassistant_companion_log_7-8-2023_10-30-51.txt](https://github.com/home-assistant/android/files/12286071/homeassistant_companion_log_7-8-2023_10-30-51.txt)\r\n```\r\n\r\n```\r\n\r\n**Screenshot or video of problem:**\r\n\r\n\r\n\r\n**Additional information:**\r\n", "logs": [{"name": "homeassistant_companion_log_7-8-2023_10-30-51.txt", "url": "https://github.com/home-assistant/android/files/12286071/homeassistant_companion_log_7-8-2023_10-30-51.txt"}]}, "pull_request": [{"number": 4642, "url": "https://github.com/home-assistant/android/pull/4642", "diff_url": "https://github.com/home-assistant/android/pull/4642.diff", "patch_url": "https://github.com/home-assistant/android/pull/4642.patch", "title": "Bump kotlinx-coroutines from 1.8.1 to 1.9.0", "content": "Bumps `kotlinx-coroutines` from 1.8.1 to 1.9.0.\nUpdates `org.jetbrains.kotlinx:kotlinx-coroutines-guava` from 1.8.1 to 1.9.0\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/Kotlin/kotlinx.coroutines/releases\">org.jetbrains.kotlinx:kotlinx-coroutines-guava's releases</a>.</em></p>\n<blockquote>\n<h2>1.9.0</h2>\n<h3>Features</h3>\n<ul>\n<li>Wasm/WASI target support (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4064\">#4064</a>). Thanks, <a href=\"https://github.com/igoriakovlev\"><code>@igoriakovlev</code></a>!</li>\n<li><code>limitedParallelism</code> now optionally accepts the name of the dispatcher view for easier debugging (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4023\">#4023</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Introduced the <code>Flow&lt;T&gt;.chunked(size: Int): Flow&lt;List&lt;T&gt;&gt;</code> operator that groups emitted values into groups of the given size (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/1290\">#1290</a>).</li>\n<li>Closeable dispatchers are instances of <code>AutoCloseable</code> now (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4123\">#4123</a>).</li>\n</ul>\n<h3>Fixes</h3>\n<ul>\n<li>Calling <code>hasNext</code> on a <code>Channel</code>'s iterator is idempotent (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4065\">#4065</a>). Thanks, <a href=\"https://github.com/gitpaxultek\"><code>@gitpaxultek</code></a>!</li>\n<li><code>CoroutineScope()</code> created without an explicit dispatcher uses <code>Dispatchers.Default</code> on Native (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4074\">#4074</a>). Thanks, <a href=\"https://github.com/whyoleg\"><code>@whyoleg</code></a>!</li>\n<li>Fixed a bug that prevented non-Android <code>Dispatchers.Main</code> from initializing when the Firebase dependency is used (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3914\">#3914</a>).</li>\n<li>Ensured a more intuitive ordering of tasks in <code>runBlocking</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4134\">#4134</a>).</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n</ul>\n<h3>Deprecations and promotions</h3>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4173\">#4173</a>).</li>\n<li>Promoted <code>CoroutineDispatcher.limitedParallelism</code> to stable (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3864\">#3864</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Promoted <code>CancellableContinuation.resume</code> with an <code>onCancellation</code> lambda to stable, providing extra arguments to the lambda (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4088\">#4088</a>).</li>\n<li>Marked the classes and interfaces that are not supposed to be inherited from with the new <code>InternalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n<li>Marked the classes and interfaces inheriting from which is not stable with the new <code>ExperimentalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n</ul>\n<h3>Other</h3>\n<ul>\n<li>Kotlin was updated to 2.0 (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4137\">#4137</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Simplified the internal implementation of <code>Job</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4053\">#4053</a>).</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<h2>1.9.0-RC.2</h2>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n<li>Fixed a bug that disallowed setting a custom <code>probeCoroutineResumed</code> when starting coroutines with <code>UNDISPATCHED</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4162\">#4162</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<h2>1.9.0-RC</h2>\n<ul>\n<li>Kotlin was updated to 2.0 (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4137\">#4137</a>).</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/Kotlin/kotlinx.coroutines/blob/master/CHANGES.md\">org.jetbrains.kotlinx:kotlinx-coroutines-guava's changelog</a>.</em></p>\n<blockquote>\n<h2>Version 1.9.0</h2>\n<h3>Features</h3>\n<ul>\n<li>Wasm/WASI target support (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4064\">#4064</a>). Thanks, <a href=\"https://github.com/igoriakovlev\"><code>@igoriakovlev</code></a>!</li>\n<li><code>limitedParallelism</code> now optionally accepts the name of the dispatcher view for easier debugging (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4023\">#4023</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Introduced the <code>Flow&lt;T&gt;.chunked(size: Int): Flow&lt;List&lt;T&gt;&gt;</code> operator that groups emitted values into groups of the given size (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/1290\">#1290</a>).</li>\n<li>Closeable dispatchers are instances of <code>AutoCloseable</code> now (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4123\">#4123</a>).</li>\n</ul>\n<h3>Fixes</h3>\n<ul>\n<li>Calling <code>hasNext</code> on a <code>Channel</code>'s iterator is idempotent (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4065\">#4065</a>). Thanks, <a href=\"https://github.com/gitpaxultek\"><code>@gitpaxultek</code></a>!</li>\n<li><code>CoroutineScope()</code> created without an explicit dispatcher uses <code>Dispatchers.Default</code> on Native (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4074\">#4074</a>). Thanks, <a href=\"https://github.com/whyoleg\"><code>@whyoleg</code></a>!</li>\n<li>Fixed a bug that prevented non-Android <code>Dispatchers.Main</code> from initializing when the Firebase dependency is used (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3914\">#3914</a>).</li>\n<li>Ensured a more intuitive ordering of tasks in <code>runBlocking</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4134\">#4134</a>).</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n</ul>\n<h3>Deprecations and promotions</h3>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4173\">#4173</a>).</li>\n<li>Promoted <code>CoroutineDispatcher.limitedParallelism</code> to stable (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3864\">#3864</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Promoted <code>CancellableContinuation.resume</code> with an <code>onCancellation</code> lambda to stable, providing extra arguments to the lambda (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4088\">#4088</a>).</li>\n<li>Marked the classes and interfaces that are not supposed to be inherited from with the new <code>InternalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n<li>Marked the classes and interfaces inheriting from which is not stable with the new <code>ExperimentalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n</ul>\n<h3>Other</h3>\n<ul>\n<li>Kotlin was updated to 2.0 (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4137\">#4137</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Simplified the internal implementation of <code>Job</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4053\">#4053</a>).</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<h2>Version 1.9.0-RC.2</h2>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4173\">#4173</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n<li>Fixed a bug that disallowed setting a custom <code>probeCoroutineResumed</code> when starting coroutines with <code>UNDISPATCHED</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4162\">#4162</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/d8d6f8f37978b8e202d93b34f23f101df9c5724d\"><code>d8d6f8f</code></a> Version 1.9.0</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/3a1be8c6b9462423563e95c4e85f1efdcc25bcc1\"><code>3a1be8c</code></a> Remove obsolete npm folder from the doc (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4189\">#4189</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/d38672a53ccdfda6319ab5f11669af8ad96d60a5\"><code>d38672a</code></a> Version 1.9.0-RC.2</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/4801c6577e6f61b38271323994467945a795adc8\"><code>4801c65</code></a> Merge remote-tracking branch 'origin/master' into develop</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/cc34948215393a9bbcefe8fdee690495c1bdfa1b\"><code>cc34948</code></a> Rework the KDoc for <code>CoroutineStart</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/a7fe247daaaef1c1302af820994c74a0bfae1b0b\"><code>a7fe247</code></a> Fix flaky test, ensure job suspension where expected by the test (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4204\">#4204</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/b286646ad206f0729ce00bac416b5841096fecd3\"><code>b286646</code></a> Remove various obsolete code (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4196\">#4196</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/f0bdf002b11adeefa94cd1b53dd2f72cae930f1f\"><code>f0bdf00</code></a> Increase the deprecation levels for the old test framework API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/5c8e6502515a10b6bb6cd1c148796dde762d66e0\"><code>5c8e650</code></a> Increase the deprecation levels for BroadcastChannel APIs (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/d0101106d3f53385de04cb40c38165266c76de91\"><code>d010110</code></a> Rerun apiDump (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4207\">#4207</a>)</li>\n<li>Additional commits viewable in <a href=\"https://github.com/Kotlin/kotlinx.coroutines/compare/1.8.1...1.9.0\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `org.jetbrains.kotlinx:kotlinx-coroutines-play-services` from 1.8.1 to 1.9.0\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/Kotlin/kotlinx.coroutines/releases\">org.jetbrains.kotlinx:kotlinx-coroutines-play-services's releases</a>.</em></p>\n<blockquote>\n<h2>1.9.0</h2>\n<h3>Features</h3>\n<ul>\n<li>Wasm/WASI target support (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4064\">#4064</a>). Thanks, <a href=\"https://github.com/igoriakovlev\"><code>@igoriakovlev</code></a>!</li>\n<li><code>limitedParallelism</code> now optionally accepts the name of the dispatcher view for easier debugging (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4023\">#4023</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Introduced the <code>Flow&lt;T&gt;.chunked(size: Int): Flow&lt;List&lt;T&gt;&gt;</code> operator that groups emitted values into groups of the given size (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/1290\">#1290</a>).</li>\n<li>Closeable dispatchers are instances of <code>AutoCloseable</code> now (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4123\">#4123</a>).</li>\n</ul>\n<h3>Fixes</h3>\n<ul>\n<li>Calling <code>hasNext</code> on a <code>Channel</code>'s iterator is idempotent (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4065\">#4065</a>). Thanks, <a href=\"https://github.com/gitpaxultek\"><code>@gitpaxultek</code></a>!</li>\n<li><code>CoroutineScope()</code> created without an explicit dispatcher uses <code>Dispatchers.Default</code> on Native (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4074\">#4074</a>). Thanks, <a href=\"https://github.com/whyoleg\"><code>@whyoleg</code></a>!</li>\n<li>Fixed a bug that prevented non-Android <code>Dispatchers.Main</code> from initializing when the Firebase dependency is used (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3914\">#3914</a>).</li>\n<li>Ensured a more intuitive ordering of tasks in <code>runBlocking</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4134\">#4134</a>).</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n</ul>\n<h3>Deprecations and promotions</h3>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4173\">#4173</a>).</li>\n<li>Promoted <code>CoroutineDispatcher.limitedParallelism</code> to stable (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3864\">#3864</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Promoted <code>CancellableContinuation.resume</code> with an <code>onCancellation</code> lambda to stable, providing extra arguments to the lambda (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4088\">#4088</a>).</li>\n<li>Marked the classes and interfaces that are not supposed to be inherited from with the new <code>InternalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n<li>Marked the classes and interfaces inheriting from which is not stable with the new <code>ExperimentalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n</ul>\n<h3>Other</h3>\n<ul>\n<li>Kotlin was updated to 2.0 (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4137\">#4137</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Simplified the internal implementation of <code>Job</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4053\">#4053</a>).</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<h2>1.9.0-RC.2</h2>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n<li>Fixed a bug that disallowed setting a custom <code>probeCoroutineResumed</code> when starting coroutines with <code>UNDISPATCHED</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4162\">#4162</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<h2>1.9.0-RC</h2>\n<ul>\n<li>Kotlin was updated to 2.0 (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4137\">#4137</a>).</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/Kotlin/kotlinx.coroutines/blob/master/CHANGES.md\">org.jetbrains.kotlinx:kotlinx-coroutines-play-services's changelog</a>.</em></p>\n<blockquote>\n<h2>Version 1.9.0</h2>\n<h3>Features</h3>\n<ul>\n<li>Wasm/WASI target support (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4064\">#4064</a>). Thanks, <a href=\"https://github.com/igoriakovlev\"><code>@igoriakovlev</code></a>!</li>\n<li><code>limitedParallelism</code> now optionally accepts the name of the dispatcher view for easier debugging (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4023\">#4023</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Introduced the <code>Flow&lt;T&gt;.chunked(size: Int): Flow&lt;List&lt;T&gt;&gt;</code> operator that groups emitted values into groups of the given size (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/1290\">#1290</a>).</li>\n<li>Closeable dispatchers are instances of <code>AutoCloseable</code> now (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4123\">#4123</a>).</li>\n</ul>\n<h3>Fixes</h3>\n<ul>\n<li>Calling <code>hasNext</code> on a <code>Channel</code>'s iterator is idempotent (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4065\">#4065</a>). Thanks, <a href=\"https://github.com/gitpaxultek\"><code>@gitpaxultek</code></a>!</li>\n<li><code>CoroutineScope()</code> created without an explicit dispatcher uses <code>Dispatchers.Default</code> on Native (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4074\">#4074</a>). Thanks, <a href=\"https://github.com/whyoleg\"><code>@whyoleg</code></a>!</li>\n<li>Fixed a bug that prevented non-Android <code>Dispatchers.Main</code> from initializing when the Firebase dependency is used (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3914\">#3914</a>).</li>\n<li>Ensured a more intuitive ordering of tasks in <code>runBlocking</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4134\">#4134</a>).</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n</ul>\n<h3>Deprecations and promotions</h3>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4173\">#4173</a>).</li>\n<li>Promoted <code>CoroutineDispatcher.limitedParallelism</code> to stable (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3864\">#3864</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Promoted <code>CancellableContinuation.resume</code> with an <code>onCancellation</code> lambda to stable, providing extra arguments to the lambda (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4088\">#4088</a>).</li>\n<li>Marked the classes and interfaces that are not supposed to be inherited from with the new <code>InternalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n<li>Marked the classes and interfaces inheriting from which is not stable with the new <code>ExperimentalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n</ul>\n<h3>Other</h3>\n<ul>\n<li>Kotlin was updated to 2.0 (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4137\">#4137</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Simplified the internal implementation of <code>Job</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4053\">#4053</a>).</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<h2>Version 1.9.0-RC.2</h2>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4173\">#4173</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n<li>Fixed a bug that disallowed setting a custom <code>probeCoroutineResumed</code> when starting coroutines with <code>UNDISPATCHED</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4162\">#4162</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/d8d6f8f37978b8e202d93b34f23f101df9c5724d\"><code>d8d6f8f</code></a> Version 1.9.0</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/3a1be8c6b9462423563e95c4e85f1efdcc25bcc1\"><code>3a1be8c</code></a> Remove obsolete npm folder from the doc (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4189\">#4189</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/d38672a53ccdfda6319ab5f11669af8ad96d60a5\"><code>d38672a</code></a> Version 1.9.0-RC.2</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/4801c6577e6f61b38271323994467945a795adc8\"><code>4801c65</code></a> Merge remote-tracking branch 'origin/master' into develop</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/cc34948215393a9bbcefe8fdee690495c1bdfa1b\"><code>cc34948</code></a> Rework the KDoc for <code>CoroutineStart</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/a7fe247daaaef1c1302af820994c74a0bfae1b0b\"><code>a7fe247</code></a> Fix flaky test, ensure job suspension where expected by the test (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4204\">#4204</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/b286646ad206f0729ce00bac416b5841096fecd3\"><code>b286646</code></a> Remove various obsolete code (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4196\">#4196</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/f0bdf002b11adeefa94cd1b53dd2f72cae930f1f\"><code>f0bdf00</code></a> Increase the deprecation levels for the old test framework API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/5c8e6502515a10b6bb6cd1c148796dde762d66e0\"><code>5c8e650</code></a> Increase the deprecation levels for BroadcastChannel APIs (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/d0101106d3f53385de04cb40c38165266c76de91\"><code>d010110</code></a> Rerun apiDump (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4207\">#4207</a>)</li>\n<li>Additional commits viewable in <a href=\"https://github.com/Kotlin/kotlinx.coroutines/compare/1.8.1...1.9.0\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `org.jetbrains.kotlinx:kotlinx-coroutines-android` from 1.8.1 to 1.9.0\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/Kotlin/kotlinx.coroutines/releases\">org.jetbrains.kotlinx:kotlinx-coroutines-android's releases</a>.</em></p>\n<blockquote>\n<h2>1.9.0</h2>\n<h3>Features</h3>\n<ul>\n<li>Wasm/WASI target support (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4064\">#4064</a>). Thanks, <a href=\"https://github.com/igoriakovlev\"><code>@igoriakovlev</code></a>!</li>\n<li><code>limitedParallelism</code> now optionally accepts the name of the dispatcher view for easier debugging (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4023\">#4023</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Introduced the <code>Flow&lt;T&gt;.chunked(size: Int): Flow&lt;List&lt;T&gt;&gt;</code> operator that groups emitted values into groups of the given size (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/1290\">#1290</a>).</li>\n<li>Closeable dispatchers are instances of <code>AutoCloseable</code> now (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4123\">#4123</a>).</li>\n</ul>\n<h3>Fixes</h3>\n<ul>\n<li>Calling <code>hasNext</code> on a <code>Channel</code>'s iterator is idempotent (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4065\">#4065</a>). Thanks, <a href=\"https://github.com/gitpaxultek\"><code>@gitpaxultek</code></a>!</li>\n<li><code>CoroutineScope()</code> created without an explicit dispatcher uses <code>Dispatchers.Default</code> on Native (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4074\">#4074</a>). Thanks, <a href=\"https://github.com/whyoleg\"><code>@whyoleg</code></a>!</li>\n<li>Fixed a bug that prevented non-Android <code>Dispatchers.Main</code> from initializing when the Firebase dependency is used (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3914\">#3914</a>).</li>\n<li>Ensured a more intuitive ordering of tasks in <code>runBlocking</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4134\">#4134</a>).</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n</ul>\n<h3>Deprecations and promotions</h3>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4173\">#4173</a>).</li>\n<li>Promoted <code>CoroutineDispatcher.limitedParallelism</code> to stable (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3864\">#3864</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Promoted <code>CancellableContinuation.resume</code> with an <code>onCancellation</code> lambda to stable, providing extra arguments to the lambda (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4088\">#4088</a>).</li>\n<li>Marked the classes and interfaces that are not supposed to be inherited from with the new <code>InternalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n<li>Marked the classes and interfaces inheriting from which is not stable with the new <code>ExperimentalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n</ul>\n<h3>Other</h3>\n<ul>\n<li>Kotlin was updated to 2.0 (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4137\">#4137</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Simplified the internal implementation of <code>Job</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4053\">#4053</a>).</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<h2>1.9.0-RC.2</h2>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n<li>Fixed a bug that disallowed setting a custom <code>probeCoroutineResumed</code> when starting coroutines with <code>UNDISPATCHED</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4162\">#4162</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<h2>1.9.0-RC</h2>\n<ul>\n<li>Kotlin was updated to 2.0 (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4137\">#4137</a>).</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/Kotlin/kotlinx.coroutines/blob/master/CHANGES.md\">org.jetbrains.kotlinx:kotlinx-coroutines-android's changelog</a>.</em></p>\n<blockquote>\n<h2>Version 1.9.0</h2>\n<h3>Features</h3>\n<ul>\n<li>Wasm/WASI target support (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4064\">#4064</a>). Thanks, <a href=\"https://github.com/igoriakovlev\"><code>@igoriakovlev</code></a>!</li>\n<li><code>limitedParallelism</code> now optionally accepts the name of the dispatcher view for easier debugging (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4023\">#4023</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Introduced the <code>Flow&lt;T&gt;.chunked(size: Int): Flow&lt;List&lt;T&gt;&gt;</code> operator that groups emitted values into groups of the given size (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/1290\">#1290</a>).</li>\n<li>Closeable dispatchers are instances of <code>AutoCloseable</code> now (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4123\">#4123</a>).</li>\n</ul>\n<h3>Fixes</h3>\n<ul>\n<li>Calling <code>hasNext</code> on a <code>Channel</code>'s iterator is idempotent (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4065\">#4065</a>). Thanks, <a href=\"https://github.com/gitpaxultek\"><code>@gitpaxultek</code></a>!</li>\n<li><code>CoroutineScope()</code> created without an explicit dispatcher uses <code>Dispatchers.Default</code> on Native (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4074\">#4074</a>). Thanks, <a href=\"https://github.com/whyoleg\"><code>@whyoleg</code></a>!</li>\n<li>Fixed a bug that prevented non-Android <code>Dispatchers.Main</code> from initializing when the Firebase dependency is used (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3914\">#3914</a>).</li>\n<li>Ensured a more intuitive ordering of tasks in <code>runBlocking</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4134\">#4134</a>).</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n</ul>\n<h3>Deprecations and promotions</h3>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4173\">#4173</a>).</li>\n<li>Promoted <code>CoroutineDispatcher.limitedParallelism</code> to stable (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3864\">#3864</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Promoted <code>CancellableContinuation.resume</code> with an <code>onCancellation</code> lambda to stable, providing extra arguments to the lambda (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4088\">#4088</a>).</li>\n<li>Marked the classes and interfaces that are not supposed to be inherited from with the new <code>InternalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n<li>Marked the classes and interfaces inheriting from which is not stable with the new <code>ExperimentalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n</ul>\n<h3>Other</h3>\n<ul>\n<li>Kotlin was updated to 2.0 (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4137\">#4137</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Simplified the internal implementation of <code>Job</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4053\">#4053</a>).</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<h2>Version 1.9.0-RC.2</h2>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4173\">#4173</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n<li>Fixed a bug that disallowed setting a custom <code>probeCoroutineResumed</code> when starting coroutines with <code>UNDISPATCHED</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4162\">#4162</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/d8d6f8f37978b8e202d93b34f23f101df9c5724d\"><code>d8d6f8f</code></a> Version 1.9.0</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/3a1be8c6b9462423563e95c4e85f1efdcc25bcc1\"><code>3a1be8c</code></a> Remove obsolete npm folder from the doc (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4189\">#4189</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/d38672a53ccdfda6319ab5f11669af8ad96d60a5\"><code>d38672a</code></a> Version 1.9.0-RC.2</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/4801c6577e6f61b38271323994467945a795adc8\"><code>4801c65</code></a> Merge remote-tracking branch 'origin/master' into develop</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/cc34948215393a9bbcefe8fdee690495c1bdfa1b\"><code>cc34948</code></a> Rework the KDoc for <code>CoroutineStart</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/a7fe247daaaef1c1302af820994c74a0bfae1b0b\"><code>a7fe247</code></a> Fix flaky test, ensure job suspension where expected by the test (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4204\">#4204</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/b286646ad206f0729ce00bac416b5841096fecd3\"><code>b286646</code></a> Remove various obsolete code (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4196\">#4196</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/f0bdf002b11adeefa94cd1b53dd2f72cae930f1f\"><code>f0bdf00</code></a> Increase the deprecation levels for the old test framework API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/5c8e6502515a10b6bb6cd1c148796dde762d66e0\"><code>5c8e650</code></a> Increase the deprecation levels for BroadcastChannel APIs (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>)</li>\n<li><a href=\"https://github.com/Kotlin/kotlinx.coroutines/commit/d0101106d3f53385de04cb40c38165266c76de91\"><code>d010110</code></a> Rerun apiDump (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4207\">#4207</a>)</li>\n<li>Additional commits viewable in <a href=\"https://github.com/Kotlin/kotlinx.coroutines/compare/1.8.1...1.9.0\">compare view</a></li>\n</ul>\n</details>\n<br />\n\nUpdates `org.jetbrains.kotlinx:kotlinx-coroutines-core` from 1.8.1 to 1.9.0\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/Kotlin/kotlinx.coroutines/releases\">org.jetbrains.kotlinx:kotlinx-coroutines-core's releases</a>.</em></p>\n<blockquote>\n<h2>1.9.0</h2>\n<h3>Features</h3>\n<ul>\n<li>Wasm/WASI target support (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4064\">#4064</a>). Thanks, <a href=\"https://github.com/igoriakovlev\"><code>@igoriakovlev</code></a>!</li>\n<li><code>limitedParallelism</code> now optionally accepts the name of the dispatcher view for easier debugging (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4023\">#4023</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Introduced the <code>Flow&lt;T&gt;.chunked(size: Int): Flow&lt;List&lt;T&gt;&gt;</code> operator that groups emitted values into groups of the given size (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/1290\">#1290</a>).</li>\n<li>Closeable dispatchers are instances of <code>AutoCloseable</code> now (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4123\">#4123</a>).</li>\n</ul>\n<h3>Fixes</h3>\n<ul>\n<li>Calling <code>hasNext</code> on a <code>Channel</code>'s iterator is idempotent (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4065\">#4065</a>). Thanks, <a href=\"https://github.com/gitpaxultek\"><code>@gitpaxultek</code></a>!</li>\n<li><code>CoroutineScope()</code> created without an explicit dispatcher uses <code>Dispatchers.Default</code> on Native (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4074\">#4074</a>). Thanks, <a href=\"https://github.com/whyoleg\"><code>@whyoleg</code></a>!</li>\n<li>Fixed a bug that prevented non-Android <code>Dispatchers.Main</code> from initializing when the Firebase dependency is used (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3914\">#3914</a>).</li>\n<li>Ensured a more intuitive ordering of tasks in <code>runBlocking</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4134\">#4134</a>).</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n</ul>\n<h3>Deprecations and promotions</h3>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4173\">#4173</a>).</li>\n<li>Promoted <code>CoroutineDispatcher.limitedParallelism</code> to stable (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3864\">#3864</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Promoted <code>CancellableContinuation.resume</code> with an <code>onCancellation</code> lambda to stable, providing extra arguments to the lambda (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4088\">#4088</a>).</li>\n<li>Marked the classes and interfaces that are not supposed to be inherited from with the new <code>InternalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n<li>Marked the classes and interfaces inheriting from which is not stable with the new <code>ExperimentalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n</ul>\n<h3>Other</h3>\n<ul>\n<li>Kotlin was updated to 2.0 (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4137\">#4137</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Simplified the internal implementation of <code>Job</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4053\">#4053</a>).</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<h2>1.9.0-RC.2</h2>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Reworked the documentation for <code>CoroutineStart</code> and <code>Channel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4147\">#4147</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4148\">#4148</a>, <a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4167\">#4167</a>). Thanks, <a href=\"https://github.com/globsterg\"><code>@globsterg</code></a>!</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n<li>Fixed a bug that disallowed setting a custom <code>probeCoroutineResumed</code> when starting coroutines with <code>UNDISPATCHED</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4162\">#4162</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Small tweaks, fixes, and documentation improvements.</li>\n</ul>\n<h2>1.9.0-RC</h2>\n<ul>\n<li>Kotlin was updated to 2.0 (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4137\">#4137</a>).</li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/Kotlin/kotlinx.coroutines/blob/master/CHANGES.md\">org.jetbrains.kotlinx:kotlinx-coroutines-core's changelog</a>.</em></p>\n<blockquote>\n<h2>Version 1.9.0</h2>\n<h3>Features</h3>\n<ul>\n<li>Wasm/WASI target support (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4064\">#4064</a>). Thanks, <a href=\"https://github.com/igoriakovlev\"><code>@igoriakovlev</code></a>!</li>\n<li><code>limitedParallelism</code> now optionally accepts the name of the dispatcher view for easier debugging (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4023\">#4023</a>).</li>\n<li>No longer initialize <code>Dispatchers.IO</code> on the JVM when other standard dispatchers are accessed (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4166\">#4166</a>). Thanks, <a href=\"https://github.com/metalhead8816\"><code>@metalhead8816</code></a>!</li>\n<li>Introduced the <code>Flow&lt;T&gt;.chunked(size: Int): Flow&lt;List&lt;T&gt;&gt;</code> operator that groups emitted values into groups of the given size (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/1290\">#1290</a>).</li>\n<li>Closeable dispatchers are instances of <code>AutoCloseable</code> now (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4123\">#4123</a>).</li>\n</ul>\n<h3>Fixes</h3>\n<ul>\n<li>Calling <code>hasNext</code> on a <code>Channel</code>'s iterator is idempotent (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4065\">#4065</a>). Thanks, <a href=\"https://github.com/gitpaxultek\"><code>@gitpaxultek</code></a>!</li>\n<li><code>CoroutineScope()</code> created without an explicit dispatcher uses <code>Dispatchers.Default</code> on Native (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4074\">#4074</a>). Thanks, <a href=\"https://github.com/whyoleg\"><code>@whyoleg</code></a>!</li>\n<li>Fixed a bug that prevented non-Android <code>Dispatchers.Main</code> from initializing when the Firebase dependency is used (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3914\">#3914</a>).</li>\n<li>Ensured a more intuitive ordering of tasks in <code>runBlocking</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4134\">#4134</a>).</li>\n<li>Forbid casting a <code>Mutex</code> to <code>Semaphore</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4176\">#4176</a>).</li>\n<li>Worked around a stack overflow that may occur when calling <code>asDeferred</code> on a <code>Future</code> many times (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4156\">#4156</a>).</li>\n</ul>\n<h3>Deprecations and promotions</h3>\n<ul>\n<li>Advanced the deprecation levels for <code>BroadcastChannel</code>-based API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4197\">#4197</a>).</li>\n<li>Advanced the deprecation levels for the old <code>kotlinx-coroutines-test</code> API (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4198\">#4198</a>).</li>\n<li>Deprecated <code>Job.cancelFutureOnCompletion</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4173\">#4173</a>).</li>\n<li>Promoted <code>CoroutineDispatcher.limitedParallelism</code> to stable (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3864\">#3864</a>).</li>\n<li>Promoted <code>CoroutineStart.ATOMIC</code> from <code>ExperimentalCoroutinesApi</code> to <code>DelicateCoroutinesApi</code> (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4169\">#4169</a>).</li>\n<li>Promoted <code>CancellableContinuation.resume</code> with an <code>onCancellation</code> lambda to stable, providing extra arguments to the lambda (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/4088\">#4088</a>).</li>\n<li>Marked the classes and interfaces that are not supposed to be inherited from with the new <code>InternalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n<li>Marked the classes and interfaces inheriting from which is not stable with the new <code>ExperimentalForInheritanceCoroutinesApi</code> opt-in (<a href=\"https://redirect.github.com/Kotlin/kotlinx.coroutines/issues/3770\">#3770</a>).</li>\n</ul>\n<h3>Other</h3>\n<ul>\n<li>Kotlin was updated to 2.0 (<a href=\"https://redirect.gi...\n\n_Description has been truncated_", "diff": "diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml\nindex 6e8af361101..c9b2a8e8ef9 100644\n--- a/gradle/libs.versions.toml\n+++ b/gradle/libs.versions.toml\n@@ -31,7 +31,7 @@ hilt = \"2.52\"\n iconics = \"5.4.0\"\n jackson-module-kotlin = \"2.13.5\"\n javaVersion = \"11\"\n-kotlinx-coroutines = \"1.8.1\"\n+kotlinx-coroutines = \"1.9.0\"\n kotlin = \"2.0.20\"\n ksp = \"2.0.20-1.0.24\"\n ktlint = \"12.1.1\"\n", "changes": [{"file": "gradle/libs.versions.toml", "module": "gradle.libs.versions.toml", "range": [{"start": 34, "end": 35}]}]}]}
{"url": "https://github.com/AntennaPod/AntennaPod/issues/7649", "repo": {"url": "https://github.com/AntennaPod/AntennaPod", "name": "AntennaPod", "owner": "AntennaPod", "modules": ["com.google.android.material", "de.danoeh.antennapod", "de.danoeh.antennapod.actionbutton", "de.danoeh.antennapod.activity", "de.danoeh.antennapod.event", "de.danoeh.antennapod.model", "de.danoeh.antennapod.net", "de.danoeh.antennapod.parser", "de.danoeh.antennapod.playback", "de.danoeh.antennapod.storage", "de.danoeh.antennapod.ui", "de.test.antennapod", "de.test.antennapod.dialogs", "de.test.antennapod.playback", "de.test.antennapod.service", "de.test.antennapod.ui", "de.test.antennapod.util"]}, "issue": {"number": 7649, "url": "https://github.com/AntennaPod/AntennaPod/issues/7649", "state": "closed", "title": "Crash when going to podcast settings", "body": "### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.7.0-beta1\n\n### Android version\n\n15\n\n### Device model\n\nOneplus 12\n\n### First occurred\n\nSince updating to beta\n\n### Steps to reproduce\n\n1. Open a podcast screen\n2. Tap on gear to go to settings\n\n### Expected behaviour\n\nNo crashing\n\n### Current behaviour\n\nAntennaPod crashes\n\n### Logs\n\nLast message is about not being able to convert a boolean to a string\n[full-logs.txt](https://github.com/user-attachments/files/18724682/full-logs.txt)", "logs": [{"name": "full-logs.txt", "url": "https://github.com/user-attachments/files/18724682/full-logs.txt"}]}, "pull_request": [{"number": 7650, "url": "https://github.com/AntennaPod/AntennaPod/pull/7650", "diff_url": "https://github.com/AntennaPod/AntennaPod/pull/7650.diff", "patch_url": "https://github.com/AntennaPod/AntennaPod/pull/7650.patch", "title": "Fix crash on feed settings page", "content": "### Description\r\n\r\nWe migrated from a checkbox to a list preference.\r\nThe (unused) stored value causes a ClassCastException\r\n\r\nCloses #7649\r\n\r\n### Checklist\r\n<!-- \r\n  To help us keep the issue tracker clean and work as efficient as possible,\r\n  please make sure that you have done all of the following.\r\n  You can tick the boxes below by placing an x inside the brackets like this: [x]\r\n-->\r\n- [x] I have read the contribution guidelines: https://github.com/AntennaPod/AntennaPod/blob/develop/CONTRIBUTING.md#submit-a-pull-request\r\n- [x] I have performed a self-review of my code\r\n- [x] I have run the automated code checks using `./gradlew checkstyle spotbugsPlayDebug spotbugsDebug :app:lintPlayDebug`\r\n- [x] My code follows the style guidelines of the AntennaPod project: https://github.com/AntennaPod/AntennaPod/wiki/Code-style\r\n- [x] I have mentioned the corresponding issue and the relevant keyword (e.g., \"Closes: #xy\") in the description (see https://docs.github.com/en/issues/tracking-your-work-with-issues/linking-a-pull-request-to-an-issue)\r\n- [x] If it is a core feature, I have added automated tests\r\n", "diff": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/preferences/FeedSettingsFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/preferences/FeedSettingsFragment.java\nindex 1f390f10922..d8d2093ab9e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/preferences/FeedSettingsFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/feed/preferences/FeedSettingsFragment.java\n@@ -108,7 +108,7 @@ public void onDestroy() {\n \n     public static class FeedSettingsPreferenceFragment extends PreferenceFragmentCompat {\n         private static final String PREF_EPISODE_FILTER = \"episodeFilter\";\n-        private static final String PREF_AUTODOWNLOAD = \"autoDownload\";\n+        private static final String PREF_AUTODOWNLOAD = \"includeAutoDownload\";\n         private static final String PREF_SCREEN = \"feedSettingsScreen\";\n         private static final String PREF_AUTHENTICATION = \"authentication\";\n         private static final String PREF_AUTO_DELETE = \"autoDelete\";\ndiff --git a/app/src/main/res/xml/feed_settings.xml b/app/src/main/res/xml/feed_settings.xml\nindex accd341f20f..15d05f7869b 100644\n--- a/app/src/main/res/xml/feed_settings.xml\n+++ b/app/src/main/res/xml/feed_settings.xml\n@@ -73,7 +73,7 @@\n             android:entries=\"@array/spnEnableAutoDownloadItems\"\n             android:entryValues=\"@array/spnEnableAutoDownloadValues\"\n             android:icon=\"@drawable/ic_download\"\n-            android:key=\"autoDownload\"\n+            android:key=\"includeAutoDownload\"\n             android:title=\"@string/auto_download_label\" />\n \n         <Preference\n", "changes": [{"file": "app/src/main/java/de/danoeh/antennapod/ui/screen/feed/preferences/FeedSettingsFragment.java", "module": "de.danoeh.antennapod.ui.screen.feed.preferences.FeedSettingsFragment.FeedSettingsPreferenceFragment", "range": [{"start": 111, "end": 112}]}]}]}
{"url": "https://github.com/topjohnwu/Magisk/issues/9050", "repo": {"url": "https://github.com/topjohnwu/Magisk", "name": "Magisk", "owner": "topjohnwu", "modules": ["com.topjohnwu.magisk", "com.topjohnwu.magisk.arch", "com.topjohnwu.magisk.core", "com.topjohnwu.magisk.core.base", "com.topjohnwu.magisk.core.data", "com.topjohnwu.magisk.core.data.magiskdb", "com.topjohnwu.magisk.core.di", "com.topjohnwu.magisk.core.download", "com.topjohnwu.magisk.core.ktx", "com.topjohnwu.magisk.core.model", "com.topjohnwu.magisk.core.model.module", "com.topjohnwu.magisk.core.model.su", "com.topjohnwu.magisk.core.repository", "com.topjohnwu.magisk.core.signing", "com.topjohnwu.magisk.core.su", "com.topjohnwu.magisk.core.tasks", "com.topjohnwu.magisk.core.utils", "com.topjohnwu.magisk.core.view", "com.topjohnwu.magisk.databinding", "com.topjohnwu.magisk.dialog", "com.topjohnwu.magisk.dummy", "com.topjohnwu.magisk.events", "com.topjohnwu.magisk.net", "com.topjohnwu.magisk.test", "com.topjohnwu.magisk.ui", "com.topjohnwu.magisk.ui.deny", "com.topjohnwu.magisk.ui.flash", "com.topjohnwu.magisk.ui.home", "com.topjohnwu.magisk.ui.install", "com.topjohnwu.magisk.ui.log", "com.topjohnwu.magisk.ui.module", "com.topjohnwu.magisk.ui.settings", "com.topjohnwu.magisk.ui.superuser", "com.topjohnwu.magisk.ui.surequest", "com.topjohnwu.magisk.ui.theme", "com.topjohnwu.magisk.utils", "com.topjohnwu.magisk.view", "com.topjohnwu.magisk.widget"]}, "issue": {"number": 9050, "url": "https://github.com/topjohnwu/Magisk/issues/9050", "state": "closed", "title": "Magisk 29 shows \"Installed: N/A\" if Superuser Access is set to \"Disabled\"", "body": "If you set Superuser Access to Disabled in the settings, Magisk is no longer recognised by the app. The app then displays Installed: N/A is displayed in the app. It is then no longer possible to reset it, as Superuser Access is then missing in the settings.\n[See here](https://xdaforums.com/t/magisk-general-support-discussion.3432382/page-3003#post-90104508)\n\nDevice: Sony Xperia XZ2 compact\nAndroid version: 15\nMagisk version name: 29.0\nMagisk version code: 29000\n\n[magisk_log_2025-05-19T16.12.32.log](https://github.com/user-attachments/files/20298541/magisk_log_2025-05-19T16.12.32.log)\n", "logs": [{"name": "magisk_log_2025-05-19T16.12.32.log", "url": "https://github.com/user-attachments/files/20298541/magisk_log_2025-05-19T16.12.32.log"}]}, "pull_request": [{"number": 9051, "url": "https://github.com/topjohnwu/Magisk/pull/9051", "diff_url": "https://github.com/topjohnwu/Magisk/pull/9051.diff", "patch_url": "https://github.com/topjohnwu/Magisk/pull/9051.patch", "title": "Ensure manager can always bypass su access policy", "content": "This fixes https://github.com/topjohnwu/Magisk/issues/9050.", "diff": "diff --git a/native/src/core/su/daemon.rs b/native/src/core/su/daemon.rs\nindex ad94f6bcdffe2..35edd1e577f24 100644\n--- a/native/src/core/su/daemon.rs\n+++ b/native/src/core/su/daemon.rs\n@@ -241,6 +241,22 @@ impl MagiskD {\n                 _ => uid,\n             };\n \n+            let mut access = RootSettings::default();\n+            self.get_root_settings(eval_uid, &mut access)?;\n+\n+            // We need to talk to the manager, get the app info\n+            let (mgr_uid, mgr_pkg) =\n+                if access.policy == SuPolicy::Query || access.log || access.notify {\n+                    self.get_manager(to_user_id(eval_uid), true)\n+                } else {\n+                    (-1, String::new())\n+                };\n+\n+            // If it's the manager, allow it silently\n+            if to_app_id(uid) == to_app_id(mgr_uid) {\n+                return Arc::new(SuInfo::allow(uid));\n+            }\n+\n             // Check su access settings\n             match cfg.root_access {\n                 RootAccess::Disabled => {\n@@ -262,22 +278,6 @@ impl MagiskD {\n                 _ => {}\n             };\n \n-            let mut access = RootSettings::default();\n-            self.get_root_settings(eval_uid, &mut access)?;\n-\n-            // We need to talk to the manager, get the app info\n-            let (mgr_uid, mgr_pkg) =\n-                if access.policy == SuPolicy::Query || access.log || access.notify {\n-                    self.get_manager(to_user_id(eval_uid), true)\n-                } else {\n-                    (-1, String::new())\n-                };\n-\n-            // If it's the manager, allow it silently\n-            if to_app_id(uid) == to_app_id(mgr_uid) {\n-                return Arc::new(SuInfo::allow(uid));\n-            }\n-\n             // If still not determined, check if manager exists\n             if access.policy == SuPolicy::Query && mgr_uid < 0 {\n                 return Arc::new(SuInfo::deny(uid));\n", "changes": [{"file": "native/src/core/su/daemon.rs", "module": "native.src.core.su.daemon", "range": [{"start": 244, "end": 244}, {"start": 265, "end": 280}]}]}]}
{"url": "https://github.com/AntennaPod/AntennaPod/issues/7276", "repo": {"url": "https://github.com/AntennaPod/AntennaPod", "name": "AntennaPod", "owner": "AntennaPod", "modules": ["com.google.android.material", "de.danoeh.antennapod", "de.danoeh.antennapod.actionbutton", "de.danoeh.antennapod.activity", "de.danoeh.antennapod.event", "de.danoeh.antennapod.model", "de.danoeh.antennapod.net", "de.danoeh.antennapod.parser", "de.danoeh.antennapod.playback", "de.danoeh.antennapod.storage", "de.danoeh.antennapod.ui", "de.test.antennapod", "de.test.antennapod.dialogs", "de.test.antennapod.playback", "de.test.antennapod.service", "de.test.antennapod.ui", "de.test.antennapod.util"]}, "issue": {"number": 7276, "url": "https://github.com/AntennaPod/AntennaPod/issues/7276", "state": "closed", "title": "Casting requires app restart", "body": "Edit:\r\nI think I am able to consistently reproduce this issue. It may be related to dynamic advertisements.\r\nhttps://github.com/AntennaPod/AntennaPod/issues/7276#issuecomment-2352852693\r\n\r\n### Checklist\r\n\r\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\r\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\r\n- [X] I will describe the problem with as much detail as possible.\r\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n### App version\r\n\r\n3.4.0\r\n\r\n### Where did you get the app from\r\n\r\nGoogle Play\r\n\r\n### Android version\r\n\r\n14 stock Build number AP2A.240605.024\r\n\r\n### Device model\r\n\r\nPixel 7\r\n\r\n### First occurred\r\n\r\nSeveral months or more ago\r\n\r\n### Steps to reproduce\r\n\r\n0. Do not use AntennaPod for several hours. I believe this happens once for the morning set of podcasts and once for the evening set of podcasts. Somewhat difficult to reproduce, but I believe I captured the correct logs.\r\n1. Have Pixel 7 and Pixel Tablet (and NVIDIA Shield) on the same WIFI network.\r\n2. Open AntennaPod, navigate to Queue.\r\n3. Tap the play icon on any podcast.\r\n4. Open the player by tapping on the bottom banner\r\n5. Tap on the cast icon.\r\n6. Select Pixel Tablet.\r\n\r\n### Expected behaviour\r\n\r\nPlayback stops on Pixel 7 AntennaPod app. Playback resumes on Pixel Tablet via casting feature.\r\n\r\n### Current behaviour\r\n\r\nPlayback stops on Pixel 7. Maybe a short burst of sound comes from the Pixel Tablet with the casting screen on, but playback immediately pauses. Playback cannot be resumed from the Pixel 7 AntennaPod app or Pixel Tablet casting screen. AntennaPod must be restarted.\r\n\r\nI only cast to my Pixel Tablet, I haven't tried with other casting devices. My NVIDIA Shield takes so long to turn on due to the TV setup and I'm not sure it would be useful to reproduce. \r\n\r\n### Logs\r\n[full-logs.txt](https://github.com/user-attachments/files/16090594/full-logs.txt)\r\n\r\n## Environment\r\nAndroid version: 14\r\nOS version: 5.10.198-android13-4-00047-g7a2aa337ab82-ab11664978\r\nAntennaPod version: 3.4.0\r\nModel: Pixel 7\r\nDevice: panther\r\nProduct: panther\r\n\r\n## Crash info\r\nTime: 28-05-2024 09:54:06\r\nAntennaPod version: 3.4.0\r\n\r\n## StackTrace\r\n```\r\njava.lang.NullPointerException: Attempt to invoke interface method 'void de.danoeh.antennapod.model.playback.Playable.onPlaybackPause(android.content.Context)' on a null object reference\r\n\tat de.danoeh.antennapod.playback.service.PlaybackService$3.onPlaybackPause(SourceFile:950)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp.onRemoteMediaPlayerStatusUpdated(SourceFile:179)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp.-$$Nest$monRemoteMediaPlayerStatusUpdated(SourceFile:0)\r\n\tat de.danoeh.antennapod.playback.cast.CastPsmp$1.onStatusUpdated(SourceFile:101)\r\n\tat com.google.android.gms.cast.framework.media.zzbp.zzm(SourceFile:6)\r\n\tat com.google.android.gms.cast.internal.zzas.zzaa(SourceFile:1)\r\n\tat com.google.android.gms.cast.internal.zzas.zzQ(SourceFile:63)\r\n\tat com.google.android.gms.cast.framework.media.RemoteMediaClient.onMessageReceived(SourceFile:1)\r\n\tat com.google.android.gms.cast.zzbq.run(SourceFile:4)\r\n\tat android.os.Handler.handleCallback(Handler.java:959)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:100)\r\n\tat android.os.Looper.loopOnce(Looper.java:232)\r\n\tat android.os.Looper.loop(Looper.java:317)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:8501)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:552)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:878)\r\n```\r\n", "logs": [{"name": "full-logs.txt", "url": "https://github.com/user-attachments/files/16090594/full-logs.txt"}]}, "pull_request": [{"number": 7598, "url": "https://github.com/AntennaPod/AntennaPod/pull/7598", "diff_url": "https://github.com/AntennaPod/AntennaPod/pull/7598.diff", "patch_url": "https://github.com/AntennaPod/AntennaPod/pull/7598.patch", "title": "Fix stop of local mediaSession immediately cancelling Cast playback", "content": "### Description\r\n\r\nFix stop of local mediaSession immediately cancelling Cast playback\r\n\r\nCloses #7276\r\n\r\n### Checklist\r\n<!-- \r\n  To help us keep the issue tracker clean and work as efficient as possible,\r\n  please make sure that you have done all of the following.\r\n  You can tick the boxes below by placing an x inside the brackets like this: [x]\r\n-->\r\n- [x] I have read the contribution guidelines: https://github.com/AntennaPod/AntennaPod/blob/develop/CONTRIBUTING.md#submit-a-pull-request\r\n- [x] I have performed a self-review of my code\r\n- [x] I have run the automated code checks using `./gradlew checkstyle spotbugsPlayDebug spotbugsDebug :app:lintPlayDebug`\r\n- [x] My code follows the style guidelines of the AntennaPod project: https://github.com/AntennaPod/AntennaPod/wiki/Code-style\r\n- [x] I have mentioned the corresponding issue and the relevant keyword (e.g., \"Closes: #xy\") in the description (see https://docs.github.com/en/issues/tracking-your-work-with-issues/linking-a-pull-request-to-an-issue)\r\n- [x] If it is a core feature, I have added automated tests\r\n", "diff": "diff --git a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\nindex 44044e84f05..a21e61e7afd 100644\n--- a/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n+++ b/playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java\n@@ -1862,7 +1862,9 @@ public void onPause() {\n         @Override\n         public void onStop() {\n             Log.d(TAG, \"onStop()\");\n-            mediaPlayer.stopPlayback(true);\n+            if (!mediaPlayer.isCasting()) {\n+                mediaPlayer.stopPlayback(true);\n+            }\n         }\n \n         @Override\n", "changes": [{"file": "playback/service/src/main/java/de/danoeh/antennapod/playback/service/PlaybackService.java", "module": "de.danoeh.antennapod.playback.service.PlaybackService", "range": [{"start": 1865, "end": 1866}]}]}]}
{"url": "https://github.com/xchacha20-poly1305/husi/issues/375", "repo": {"url": "https://github.com/xchacha20-poly1305/husi", "name": "husi", "owner": "xchacha20-poly1305", "modules": ["fr.husi.plugin.hysteria2", "fr.husi.plugin.juicity", "fr.husi.plugin.mieru", "fr.husi.plugin.naive", "fr.husi.plugin.shadowquic", "io.nekohasekai.sagernet", "io.nekohasekai.sagernet.aidl", "io.nekohasekai.sagernet.bg", "io.nekohasekai.sagernet.bg.proto", "io.nekohasekai.sagernet.compose", "io.nekohasekai.sagernet.compose.theme", "io.nekohasekai.sagernet.database", "io.nekohasekai.sagernet.database.preference", "io.nekohasekai.sagernet.fmt", "io.nekohasekai.sagernet.fmt.anytls", "io.nekohasekai.sagernet.fmt.config", "io.nekohasekai.sagernet.fmt.direct", "io.nekohasekai.sagernet.fmt.gson", "io.nekohasekai.sagernet.fmt.http", "io.nekohasekai.sagernet.fmt.hysteria", "io.nekohasekai.sagernet.fmt.internal", "io.nekohasekai.sagernet.fmt.juicity", "io.nekohasekai.sagernet.fmt.mieru", "io.nekohasekai.sagernet.fmt.naive", "io.nekohasekai.sagernet.fmt.shadowquic", "io.nekohasekai.sagernet.fmt.shadowsocks", "io.nekohasekai.sagernet.fmt.shadowtls", "io.nekohasekai.sagernet.fmt.socks", "io.nekohasekai.sagernet.fmt.ssh", "io.nekohasekai.sagernet.fmt.trojan", "io.nekohasekai.sagernet.fmt.tuic", "io.nekohasekai.sagernet.fmt.v2ray", "io.nekohasekai.sagernet.fmt.wireguard", "io.nekohasekai.sagernet.group", "io.nekohasekai.sagernet.ktx", "io.nekohasekai.sagernet.plugin", "io.nekohasekai.sagernet.repository", "io.nekohasekai.sagernet.tasker", "io.nekohasekai.sagernet.ui", "io.nekohasekai.sagernet.ui.configuration", "io.nekohasekai.sagernet.ui.dashboard", "io.nekohasekai.sagernet.ui.profile", "io.nekohasekai.sagernet.ui.tools", "io.nekohasekai.sagernet.utils", "io.nekohasekai.sagernet.widget", "io.nekohasekai.sfa.utils"]}, "issue": {"number": 375, "url": "https://github.com/xchacha20-poly1305/husi/issues/375", "state": "closed", "title": "", "body": "### \n\n```shell\n0.11.0-rc.1 (332)\n```\n\n### \n\n\n\n### \n\n1.  A ` A -> ` \n2. \n3.  A VPN \n4.  `{\"action\": \"reject\"}` \n\n\n[husi 4247027002244202184.log](https://github.com/user-attachments/files/21103226/husi.4247027002244202184.log)\n[husi_backup_2025-07-07_21-08-24.json](https://github.com/user-attachments/files/21103261/husi_backup_2025-07-07_21-08-24.json)\n\n### \n\n```shell\n\n```\n\n### \n\n- [x]   \n- [x] \n- [x] ", "logs": [{"name": "husi 4247027002244202184.log", "url": "https://github.com/user-attachments/files/21103226/husi.4247027002244202184.log"}]}, "pull_request": [{"number": 376, "url": "https://github.com/xchacha20-poly1305/husi/pull/376", "diff_url": "https://github.com/xchacha20-poly1305/husi/pull/376.diff", "patch_url": "https://github.com/xchacha20-poly1305/husi/pull/376.patch", "title": "fix: prevent app-specific rules from falling back to global rule", "content": "#375\n\n<!-- This is an auto-generated comment: release notes by coderabbit.ai -->\n## Summary by CodeRabbit\n\n* **Bug Fixes**\n  * Improved handling of user-defined routing rules by skipping rules that reference uninstalled packages, preventing invalid configurations.\n<!-- end of auto-generated comment: release notes by coderabbit.ai -->", "diff": "diff --git a/app/src/main/java/io/nekohasekai/sagernet/fmt/ConfigBuilder.kt b/app/src/main/java/io/nekohasekai/sagernet/fmt/ConfigBuilder.kt\nindex 1830af281..a095cf923 100644\n--- a/app/src/main/java/io/nekohasekai/sagernet/fmt/ConfigBuilder.kt\n+++ b/app/src/main/java/io/nekohasekai/sagernet/fmt/ConfigBuilder.kt\n@@ -588,6 +588,12 @@ fun buildConfig(\n                 PackageCache[it]?.takeIf { uid -> uid >= 1000 }\n             }.toList()\n \n+            if (rule.packages.isNotEmpty() && uidList.isEmpty()) {\n+                // all packages in the rule are not installed\n+                // the rule would be never hit, skipping\n+                continue\n+            }\n+\n             val ruleObj = Rule_Default().apply {\n                 action = SingBoxOptions.ACTION_ROUTE\n                 if (uidList.isNotEmpty()) {\n@@ -1074,4 +1080,4 @@ fun mapNetworkInterfaceStrategy(strategy: Int): String = when (strategy) {\n     NetworkInterfaceStrategy.HYBRID -> SingBoxOptions.STRATEGY_HYBRID\n     NetworkInterfaceStrategy.FALLBACK -> SingBoxOptions.STRATEGY_FALLBACK\n     else -> throw IllegalStateException()\n-}\n\\ No newline at end of file\n+}\n", "changes": [{"file": "app/src/main/java/io/nekohasekai/sagernet/fmt/ConfigBuilder.kt", "module": "io.nekohasekai.sagernet.fmt.ConfigBuilderKt", "range": [{"start": 591, "end": 591}, {"start": 1077, "end": 1077}, {"start": 1078, "end": 1078}]}]}]}
{"url": "https://github.com/openhab/openhab-android/issues/2890", "repo": {"url": "https://github.com/openhab/openhab-android", "name": "openhab-android", "owner": "openhab", "modules": ["de.duenndns.ssl", "org.openhab.habdroid.background", "org.openhab.habdroid.background.tiles", "org.openhab.habdroid.core", "org.openhab.habdroid.core.connection", "org.openhab.habdroid.model", "org.openhab.habdroid.testUtils", "org.openhab.habdroid.ui", "org.openhab.habdroid.ui.activity", "org.openhab.habdroid.ui.homescreenwidget", "org.openhab.habdroid.ui.preference", "org.openhab.habdroid.ui.preference.fragments", "org.openhab.habdroid.ui.preference.widgets", "org.openhab.habdroid.ui.widget", "org.openhab.habdroid.util"]}, "issue": {"number": 2890, "url": "https://github.com/openhab/openhab-android/issues/2890", "state": "closed", "title": "Phone sends false alarms to the server", "body": "### Actual behaviour\r\nI bought a Samsung Galaxy S22 Ultra which regularly sends false times for upcoming alarms. I cannot figure out a pattern that triggers this.\r\nI checked out the logs of the app:\r\n```\r\n04-26 06:15:01.910 10062 10062 D BackgroundTasksManager: onReceive() with intent android.app.action.NEXT_ALARM_CLOCK_CHANGED\r\n04-26 06:15:01.910 10062 10062 D BackgroundTasksManager: Alarm clock changed\r\n04-26 06:15:01.914 10062 10062 D BackgroundTasksManager: Alarm sent by null\r\n04-26 06:15:01.915 10062 10062 D BackgroundTasksManager: Got value 'ValueWithInfo(value=1650953622334, mappedValue=null, type=Timestamp)' for alarmClock\r\n04-26 06:15:01.917 10062 10062 D BackgroundTasksManager: Scheduling work for tag alarmClock\r\n```\r\nAs you can see in line 3 that the [$sender](https://github.com/openhab/openhab-android/blob/main/mobile/src/main/java/org/openhab/habdroid/background/BackgroundTasksManager.kt#L619) is `null`. I suggest checking for `null` and returning in this case\r\n\r\n\r\n### Environment data\r\n#### Client\r\n* Android version: 12 (OneUI 4.1)\r\n* Device model: Samsung Galaxy S22 Ultra\r\n* App version <!-- Can be found under \"About\" -->: 2.20.0\r\n* Build flavor <!-- Play Store and GitHub = \"Full\", F-Droid = \"Foss\". If self-built and you haven't changed the flavor, it's Foss -->: Full\r\n* Device language: German\r\n\r\n### Logs\r\n####\r\n[App log](https://github.com/openhab/openhab-android/files/8577471/4.txt)\r\n(Also you can see some `file not found` exceptions)", "logs": [{"name": "App log", "url": "https://github.com/openhab/openhab-android/files/8577471/4.txt"}]}, "pull_request": [{"number": 3175, "url": "https://github.com/openhab/openhab-android/pull/3175", "diff_url": "https://github.com/openhab/openhab-android/pull/3175.diff", "patch_url": "https://github.com/openhab/openhab-android/pull/3175.patch", "title": "Bump org.mockito:mockito-core from 5.1.0 to 5.1.1", "content": "Bumps [org.mockito:mockito-core](https://github.com/mockito/mockito) from 5.1.0 to 5.1.1.\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/mockito/mockito/releases\">org.mockito:mockito-core's releases</a>.</em></p>\n<blockquote>\n<h2>v5.1.1</h2>\n<p><!-- raw HTML omitted --><!-- raw HTML omitted --><em>Changelog generated by <a href=\"https://github.com/shipkit/shipkit-changelog\">Shipkit Changelog Gradle Plugin</a></em><!-- raw HTML omitted --><!-- raw HTML omitted --></p>\n<h4>5.1.1</h4>\n<ul>\n<li>2023-01-30 - <a href=\"https://github.com/mockito/mockito/compare/v5.1.0...v5.1.1\">1 commit(s)</a> by Andriy Redko</li>\n<li>StackWalker.Option not found on Mockito 5.1.0 [(<a href=\"https://github-redirect.dependabot.com/mockito/mockito/issues/2891\">#2891</a>)](<a href=\"https://github-redirect.dependabot.com/mockito/mockito/pull/2891\">mockito/mockito#2891</a>)</li>\n<li>StackWalker.Option not found on Mockito 5.1.0 [(<a href=\"https://github-redirect.dependabot.com/mockito/mockito/issues/2890\">#2890</a>)](<a href=\"https://github-redirect.dependabot.com/mockito/mockito/issues/2890\">mockito/mockito#2890</a>)</li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/mockito/mockito/commit/50b21cf68b400a29369de58b9286d29e368212a7\"><code>50b21cf</code></a> StackWalker.Option not found on Mockito 5.1.0 (<a href=\"https://github-redirect.dependabot.com/mockito/mockito/issues/2891\">#2891</a>)</li>\n<li>See full diff in <a href=\"https://github.com/mockito/mockito/compare/v5.1.0...v5.1.1\">compare view</a></li>\n</ul>\n</details>\n<br />\n\n\n[![Dependabot compatibility score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=org.mockito:mockito-core&package-manager=gradle&previous-version=5.1.0&new-version=5.1.1)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[//]: # (dependabot-automerge-start)\n[//]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options</summary>\n<br />\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\n\n\n</details>", "diff": "diff --git a/mobile/build.gradle b/mobile/build.gradle\nindex 4f1d80d5ca..13553cc694 100644\n--- a/mobile/build.gradle\n+++ b/mobile/build.gradle\n@@ -177,7 +177,7 @@ dependencies {\n     fossImplementation \"ch.acra:acra-mail:$acra_version\"\n     fossImplementation \"ch.acra:acra-notification:$acra_version\"\n \n-    testImplementation \"org.mockito:mockito-core:5.1.0\"\n+    testImplementation \"org.mockito:mockito-core:5.1.1\"\n     testImplementation \"com.nhaarman.mockitokotlin2:mockito-kotlin:2.2.0\"\n     testImplementation \"junit:junit:4.13.2\"\n     testImplementation \"org.json:json:20220924\"\n", "changes": [{"file": "mobile/build.gradle", "module": "mobile.build.gradle", "range": [{"start": 180, "end": 181}]}]}, {"number": 2891, "url": "https://github.com/openhab/openhab-android/pull/2891", "diff_url": "https://github.com/openhab/openhab-android/pull/2891.diff", "patch_url": "https://github.com/openhab/openhab-android/pull/2891.patch", "title": "Ignore alarm sent by null", "content": "Fixes #2890\r\n\r\nSigned-off-by: mueller-ma <mueller-ma@users.noreply.github.com>", "diff": "diff --git a/mobile/src/main/java/org/openhab/habdroid/background/BackgroundTasksManager.kt b/mobile/src/main/java/org/openhab/habdroid/background/BackgroundTasksManager.kt\nindex ae0adf1d00..f33a55cbc2 100644\n--- a/mobile/src/main/java/org/openhab/habdroid/background/BackgroundTasksManager.kt\n+++ b/mobile/src/main/java/org/openhab/habdroid/background/BackgroundTasksManager.kt\n@@ -617,10 +617,10 @@ class BackgroundTasksManager : BroadcastReceiver() {\n                 val info = alarmManager.nextAlarmClock\n                 val sender = info?.showIntent?.creatorPackage\n                 Log.d(TAG, \"Alarm sent by $sender\")\n-                val time: String = if (sender in IGNORED_PACKAGES_FOR_ALARM) {\n+                val time: String = if (sender == null || sender in IGNORED_PACKAGES_FOR_ALARM) {\n                     \"UNDEF\"\n                 } else {\n-                    info?.triggerTime?.toString() ?: \"UNDEF\"\n+                    info.triggerTime.toString()\n                 }\n \n                 time.let { ItemUpdateWorker.ValueWithInfo(it, type = ItemUpdateWorker.ValueType.Timestamp) }\n", "changes": [{"file": "mobile/src/main/java/org/openhab/habdroid/background/BackgroundTasksManager.kt", "module": "org.openhab.habdroid.background.BackgroundTasksManager", "range": [{"start": 620, "end": 621}, {"start": 623, "end": 624}]}]}]}
{"url": "https://github.com/seedvault-app/seedvault/issues/830", "repo": {"url": "https://github.com/seedvault-app/seedvault", "name": "seedvault", "owner": "seedvault-app", "modules": ["com.stevesoltys.seedvault", "com.stevesoltys.seedvault.backend", "com.stevesoltys.seedvault.backend.saf", "com.stevesoltys.seedvault.backend.webdav", "com.stevesoltys.seedvault.crypto", "com.stevesoltys.seedvault.e2e", "com.stevesoltys.seedvault.e2e.impl", "com.stevesoltys.seedvault.e2e.io", "com.stevesoltys.seedvault.e2e.screen", "com.stevesoltys.seedvault.header", "com.stevesoltys.seedvault.metadata", "com.stevesoltys.seedvault.proto", "com.stevesoltys.seedvault.repo", "com.stevesoltys.seedvault.restore", "com.stevesoltys.seedvault.restore.install", "com.stevesoltys.seedvault.settings", "com.stevesoltys.seedvault.settings.preference", "com.stevesoltys.seedvault.storage", "com.stevesoltys.seedvault.transport", "com.stevesoltys.seedvault.transport.backup", "com.stevesoltys.seedvault.transport.restore", "com.stevesoltys.seedvault.ui", "com.stevesoltys.seedvault.ui.check", "com.stevesoltys.seedvault.ui.files", "com.stevesoltys.seedvault.ui.notification", "com.stevesoltys.seedvault.ui.recoverycode", "com.stevesoltys.seedvault.ui.storage", "com.stevesoltys.seedvault.worker", "de.grobox.storagebackuptester", "de.grobox.storagebackuptester.backup", "de.grobox.storagebackuptester.crypto", "de.grobox.storagebackuptester.plugin", "de.grobox.storagebackuptester.restore", "de.grobox.storagebackuptester.scanner", "de.grobox.storagebackuptester.settings", "org.calyxos.backup.contacts", "org.calyxos.backup.storage", "org.calyxos.backup.storage.api", "org.calyxos.backup.storage.backup", "org.calyxos.backup.storage.check", "org.calyxos.backup.storage.content", "org.calyxos.backup.storage.crypto", "org.calyxos.backup.storage.db", "org.calyxos.backup.storage.prune", "org.calyxos.backup.storage.restore", "org.calyxos.backup.storage.scanner", "org.calyxos.backup.storage.ui", "org.calyxos.seedvault.core", "org.calyxos.seedvault.core.backends", "org.calyxos.seedvault.core.crypto"]}, "issue": {"number": 830, "url": "https://github.com/seedvault-app/seedvault/issues/830", "state": "closed", "title": "Both backup processes happening at once (app backup and file backup running at the same time)", "body": "I often notice (except when manually triggering a backup) that Seedvault triggers the app and file backup proccesses at the same time (or something else is going on that makes that happen), I notice that two notifications show up for each process, one for file backups and one for the apps. Everytime this happens though, the backup process fails.\r\n\r\nI'll get logs next time this happens. I actually have one file right now but it seems more things failed.\r\n[seedvault-14-5.2-1735701949982.txt](https://github.com/user-attachments/files/18284373/seedvault-14-5.2-1735701949982.txt)\r\nHere it is in case it's useful but I'm not sure", "logs": [{"name": "seedvault-14-5.2-1735701949982.txt", "url": "https://github.com/user-attachments/files/18284373/seedvault-14-5.2-1735701949982.txt"}]}, "pull_request": [{"number": 835, "url": "https://github.com/seedvault-app/seedvault/pull/835", "diff_url": "https://github.com/seedvault-app/seedvault/pull/835.diff", "patch_url": "https://github.com/seedvault-app/seedvault/pull/835.patch", "title": " Implement a auto re-trying wrapper backend", "content": "Data to be saved to the backend will now be kept in memory and not directly written to streams. So watch out for out of memory errors!\r\n\r\nThis allows us to keep the data available for re-tries. If a network request times out or fails in a non-permanent way, the new `RetryBackend` will automatically retry all backend operations. Over time, we can find out more transient exceptions and add them to the list. For now, we start small with few real tr-try cases.\r\n\r\nFor ease of combined testing, this MR contains commits that fix unrelated issues:\r\n\r\nCloses #796, #828, #830, #841", "diff": "diff --git a/.cirrus.yml b/.cirrus.yml\nindex 380e5ddc7..882115215 100644\n--- a/.cirrus.yml\n+++ b/.cirrus.yml\n@@ -64,3 +64,5 @@ instrumentation_tests_task:\n       path: \"seedvault_test_results/**/*.mp4\"\n     logcat_artifacts:\n       path: \"seedvault_test_results/**/*.log\"\n+    report_artifacts:\n+      path: \"app/build/reports/**/*\"\ndiff --git a/app/src/androidTest/java/com/stevesoltys/seedvault/PluginTest.kt b/app/src/androidTest/java/com/stevesoltys/seedvault/PluginTest.kt\nindex c9624eb52..bd7b17490 100644\n--- a/app/src/androidTest/java/com/stevesoltys/seedvault/PluginTest.kt\n+++ b/app/src/androidTest/java/com/stevesoltys/seedvault/PluginTest.kt\n@@ -13,10 +13,9 @@ import com.stevesoltys.seedvault.backend.LegacyStoragePlugin\n import com.stevesoltys.seedvault.backend.saf.DocumentsProviderLegacyPlugin\n import com.stevesoltys.seedvault.backend.saf.DocumentsStorage\n import com.stevesoltys.seedvault.settings.SettingsManager\n-import io.mockk.every\n-import io.mockk.mockk\n import kotlinx.coroutines.Dispatchers\n import kotlinx.coroutines.runBlocking\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.backends.LegacyAppBackupFile\n import org.calyxos.seedvault.core.backends.saf.SafBackend\n import org.junit.After\n@@ -28,6 +27,9 @@ import org.junit.Test\n import org.junit.runner.RunWith\n import org.koin.core.component.KoinComponent\n import org.koin.core.component.inject\n+import java.io.OutputStream\n+\n+private const val root = \".SeedvaultPluginTest\"\n \n @RunWith(AndroidJUnit4::class)\n @MediumTest\n@@ -35,13 +37,13 @@ class PluginTest : KoinComponent {\n \n     private val context = InstrumentationRegistry.getInstrumentation().targetContext\n     private val settingsManager: SettingsManager by inject()\n-    private val mockedSettingsManager: SettingsManager = mockk()\n     private val storage = DocumentsStorage(\n         appContext = context,\n         safStorage = settingsManager.getSafProperties() ?: error(\"No SAF storage\"),\n+        root = root,\n     )\n \n-    private val backend = SafBackend(context, storage.safStorage)\n+    private val backend = SafBackend(context, storage.safStorage, root)\n \n     @Suppress(\"Deprecation\")\n     private val legacyStoragePlugin: LegacyStoragePlugin = DocumentsProviderLegacyPlugin(context) {\n@@ -54,9 +56,6 @@ class PluginTest : KoinComponent {\n \n     @Before\n     fun setup() = runBlocking {\n-        every {\n-            mockedSettingsManager.getSafProperties()\n-        } returns settingsManager.getSafProperties()\n         backend.removeAll()\n     }\n \n@@ -93,34 +92,26 @@ class PluginTest : KoinComponent {\n         // no backups available initially\n         assertEquals(0, backend.getAvailableBackupFileHandles().toList().size)\n \n-        // prepare returned tokens requested when initializing device\n-        every { mockedSettingsManager.token } returnsMany listOf(token, token + 1, token + 1)\n-\n         // write metadata (needed for backup to be recognized)\n-        backend.save(LegacyAppBackupFile.Metadata(token))\n-            .writeAndClose(getRandomByteArray())\n+        backend.save(LegacyAppBackupFile.Metadata(token), getSaver(getRandomByteArray()))\n \n         // one backup available now\n         assertEquals(1, backend.getAvailableBackupFileHandles().toList().size)\n \n         // initializing again (with another restore set) does add a restore set\n-        backend.save(LegacyAppBackupFile.Metadata(token + 1))\n-            .writeAndClose(getRandomByteArray())\n+        backend.save(LegacyAppBackupFile.Metadata(token + 1), getSaver(getRandomByteArray()))\n         assertEquals(2, backend.getAvailableBackupFileHandles().toList().size)\n \n         // initializing again (without new restore set) doesn't change number of restore sets\n-        backend.save(LegacyAppBackupFile.Metadata(token + 1))\n-            .writeAndClose(getRandomByteArray())\n+        backend.save(LegacyAppBackupFile.Metadata(token + 1), getSaver(getRandomByteArray()))\n         assertEquals(2, backend.getAvailableBackupFileHandles().toList().size)\n     }\n \n     @Test\n     fun testMetadataWriteRead() = runBlocking(Dispatchers.IO) {\n-        every { mockedSettingsManager.token } returns token\n-\n         // write metadata\n         val metadata = getRandomByteArray()\n-        backend.save(LegacyAppBackupFile.Metadata(token)).writeAndClose(metadata)\n+        backend.save(LegacyAppBackupFile.Metadata(token), getSaver(metadata))\n \n         // get available backups, expect only one with our token and no error\n         var availableBackups = backend.getAvailableBackupFileHandles().toList()\n@@ -132,7 +123,7 @@ class PluginTest : KoinComponent {\n         assertReadEquals(metadata, backend.load(backupHandle))\n \n         // initializing again (without changing storage) keeps restore set with same token\n-        backend.save(LegacyAppBackupFile.Metadata(token)).writeAndClose(metadata)\n+        backend.save(LegacyAppBackupFile.Metadata(token), getSaver(metadata))\n         availableBackups = backend.getAvailableBackupFileHandles().toList()\n         assertEquals(1, availableBackups.size)\n         backupHandle = availableBackups[0] as LegacyAppBackupFile.Metadata\n@@ -144,13 +135,12 @@ class PluginTest : KoinComponent {\n \n     @Test\n     fun v0testApkWriteRead() = runBlocking {\n-        // initialize storage with given token\n-        initStorage(token)\n-\n         // write random bytes as APK\n         val apk1 = getRandomByteArray(1337 * 1024)\n-        backend.save(LegacyAppBackupFile.Blob(token, \"${packageInfo.packageName}.apk\"))\n-            .writeAndClose(apk1)\n+        backend.save(\n+            LegacyAppBackupFile.Blob(token, \"${packageInfo.packageName}.apk\"),\n+            getSaver(apk1)\n+        )\n \n         // assert that read APK bytes match what was written\n         assertReadEquals(\n@@ -162,8 +152,10 @@ class PluginTest : KoinComponent {\n         val suffix2 = getRandomBase64(23)\n         val apk2 = getRandomByteArray(23 * 1024 * 1024)\n \n-        backend.save(LegacyAppBackupFile.Blob(token, \"${packageInfo2.packageName}$suffix2.apk\"))\n-            .writeAndClose(apk2)\n+        backend.save(\n+            LegacyAppBackupFile.Blob(token, \"${packageInfo2.packageName}$suffix2.apk\"),\n+            getSaver(apk2)\n+        )\n \n         // assert that read APK bytes match what was written\n         assertReadEquals(\n@@ -174,22 +166,19 @@ class PluginTest : KoinComponent {\n \n     @Test\n     fun testBackupRestore() = runBlocking {\n-        // initialize storage with given token\n-        initStorage(token)\n-\n         val name1 = getRandomBase64()\n         val name2 = getRandomBase64()\n \n         // write full backup data\n         val data = getRandomByteArray(5 * 1024 * 1024)\n-        backend.save(LegacyAppBackupFile.Blob(token, name1)).writeAndClose(data)\n+        backend.save(LegacyAppBackupFile.Blob(token, name1), getSaver(data))\n \n         // restore data matches backed up data\n         assertReadEquals(data, backend.load(LegacyAppBackupFile.Blob(token, name1)))\n \n         // write and check data for second package\n         val data2 = getRandomByteArray(5 * 1024 * 1024)\n-        backend.save(LegacyAppBackupFile.Blob(token, name2)).writeAndClose(data2)\n+        backend.save(LegacyAppBackupFile.Blob(token, name2), getSaver(data2))\n         assertReadEquals(data2, backend.load(LegacyAppBackupFile.Blob(token, name2)))\n \n         // remove data of first package again and ensure that no more data is found\n@@ -199,8 +188,14 @@ class PluginTest : KoinComponent {\n         backend.remove(LegacyAppBackupFile.Blob(token, name2))\n     }\n \n-    private fun initStorage(token: Long) = runBlocking {\n-        every { mockedSettingsManager.token } returns token\n+    private fun getSaver(bytes: ByteArray) = object : BackendSaver {\n+        override val size: Long = bytes.size.toLong()\n+        override val sha256: String? = null\n+\n+        override fun save(outputStream: OutputStream): Long {\n+            outputStream.write(bytes)\n+            return size\n+        }\n     }\n \n }\ndiff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml\nindex 5cd7945eb..28777f6b8 100644\n--- a/app/src/main/AndroidManifest.xml\n+++ b/app/src/main/AndroidManifest.xml\n@@ -196,6 +196,12 @@\n             android:exported=\"false\"\n             android:foregroundServiceType=\"dataSync\"\n             android:label=\"RestoreService\" />\n+        <!-- Does wait for USB storage root to appear after device was plugged in -->\n+        <service\n+            android:name=\".UsbMonitorService\"\n+            android:exported=\"false\"\n+            android:foregroundServiceType=\"shortService\"\n+            android:label=\"UsbMonitorService\" />\n \n     </application>\n </manifest>\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/App.kt b/app/src/main/java/com/stevesoltys/seedvault/App.kt\nindex 73ced6317..f649cf2f5 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/App.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/App.kt\n@@ -23,7 +23,7 @@ import android.util.Log\n import androidx.work.ExistingPeriodicWorkPolicy.UPDATE\n import androidx.work.WorkManager\n import com.google.android.material.color.DynamicColors\n-import com.stevesoltys.seedvault.MemoryLogger.getMemStr\n+import org.calyxos.seedvault.core.MemoryLogger.getMemStr\n import com.stevesoltys.seedvault.backend.BackendManager\n import com.stevesoltys.seedvault.backend.saf.storagePluginModuleSaf\n import com.stevesoltys.seedvault.backend.webdav.storagePluginModuleWebDav\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/UsbIntentReceiver.kt b/app/src/main/java/com/stevesoltys/seedvault/UsbIntentReceiver.kt\nindex 3ad9afb3b..5afa74c1c 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/UsbIntentReceiver.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/UsbIntentReceiver.kt\n@@ -5,43 +5,61 @@\n \n package com.stevesoltys.seedvault\n \n-import android.app.backup.IBackupManager\n import android.content.BroadcastReceiver\n import android.content.Context\n import android.content.Intent\n-import android.database.ContentObserver\n import android.hardware.usb.UsbDevice\n import android.hardware.usb.UsbInterface\n import android.hardware.usb.UsbManager.ACTION_USB_DEVICE_ATTACHED\n import android.hardware.usb.UsbManager.ACTION_USB_DEVICE_DETACHED\n import android.hardware.usb.UsbManager.EXTRA_DEVICE\n-import android.net.Uri\n-import android.os.Handler\n-import android.os.Looper\n import android.provider.DocumentsContract\n import android.util.Log\n import com.stevesoltys.seedvault.settings.FlashDrive\n import com.stevesoltys.seedvault.settings.SettingsManager\n import com.stevesoltys.seedvault.ui.storage.AUTHORITY_STORAGE\n-import com.stevesoltys.seedvault.worker.BackupRequester.Companion.requestFilesAndAppBackup\n import org.koin.core.context.GlobalContext.get\n import java.util.Date\n \n private val TAG = UsbIntentReceiver::class.java.simpleName\n \n-class UsbIntentReceiver : UsbMonitor() {\n+/**\n+ * When we get the [ACTION_USB_DEVICE_ATTACHED] broadcast, the storage is not yet available.\n+ * So we need to use a ContentObserver inside [UsbMonitorService]\n+ * to request a backup only once available.\n+ * We can't use the ContentObserver here, because if we are not in foreground,\n+ * the system freezes/caches us and queues our broadcasts until we are in foreground again.\n+ */\n+class UsbIntentReceiver : BroadcastReceiver() {\n \n     // using KoinComponent would crash robolectric tests :(\n     private val settingsManager: SettingsManager by lazy { get().get() }\n-    private val backupManager: IBackupManager by lazy { get().get() }\n \n-    override fun shouldMonitorStatus(context: Context, action: String, device: UsbDevice): Boolean {\n+    override fun onReceive(context: Context, intent: Intent) {\n+        val action = intent.action ?: return\n+        if (intent.action == ACTION_USB_DEVICE_ATTACHED ||\n+            intent.action == ACTION_USB_DEVICE_DETACHED\n+        ) {\n+            val device = intent.extras?.getParcelable(EXTRA_DEVICE, UsbDevice::class.java) ?: return\n+            Log.d(TAG, \"New USB mass-storage device attached.\")\n+            device.log()\n+\n+            if (needsBackup(action, device)) {\n+                val i = Intent(context, UsbMonitorService::class.java).apply {\n+                    data = DocumentsContract.buildRootsUri(AUTHORITY_STORAGE)\n+                }\n+                context.startForegroundService(i)\n+            }\n+        }\n+    }\n+\n+    private fun needsBackup(action: String, device: UsbDevice): Boolean {\n         if (action != ACTION_USB_DEVICE_ATTACHED) return false\n-        Log.d(TAG, \"Checking if this is the current backup drive.\")\n+        Log.d(TAG, \"Checking if this is the current backup drive...\")\n         val savedFlashDrive = settingsManager.getFlashDrive() ?: return false\n         val attachedFlashDrive = FlashDrive.from(device)\n         return if (savedFlashDrive == attachedFlashDrive) {\n-            Log.d(TAG, \"Matches stored device, checking backup time...\")\n+            Log.d(TAG, \"  Matches stored device, checking backup time...\")\n             val lastBackupTime = settingsManager.lastBackupTime.value ?: 0\n             val backupMillis = System.currentTimeMillis() - lastBackupTime\n             if (backupMillis >= settingsManager.backupFrequencyInMillis) {\n@@ -54,52 +72,10 @@ class UsbIntentReceiver : UsbMonitor() {\n                 false\n             }\n         } else {\n-            Log.d(TAG, \"Different device attached, ignoring...\")\n+            Log.d(TAG, \"  Different device attached, ignoring...\")\n             false\n         }\n     }\n-\n-    override fun onStatusChanged(context: Context, action: String, device: UsbDevice) {\n-        requestFilesAndAppBackup(context, settingsManager, backupManager)\n-    }\n-\n-}\n-\n-/**\n- * When we get the [ACTION_USB_DEVICE_ATTACHED] broadcast, the storage is not yet available.\n- * So we need to use a ContentObserver to request a backup only once available.\n- */\n-abstract class UsbMonitor : BroadcastReceiver() {\n-\n-    override fun onReceive(context: Context, intent: Intent) {\n-        val action = intent.action ?: return\n-        if (intent.action == ACTION_USB_DEVICE_ATTACHED ||\n-            intent.action == ACTION_USB_DEVICE_DETACHED\n-        ) {\n-            val device = intent.extras?.getParcelable(EXTRA_DEVICE, UsbDevice::class.java) ?: return\n-            Log.d(TAG, \"New USB mass-storage device attached.\")\n-            device.log()\n-\n-            if (!shouldMonitorStatus(context, action, device)) return\n-\n-            val rootsUri = DocumentsContract.buildRootsUri(AUTHORITY_STORAGE)\n-            val contentResolver = context.contentResolver\n-            val handler = Handler(Looper.getMainLooper())\n-            val observer = object : ContentObserver(handler) {\n-                override fun onChange(selfChange: Boolean, uri: Uri?) {\n-                    super.onChange(selfChange, uri)\n-                    onStatusChanged(context, action, device)\n-                    contentResolver.unregisterContentObserver(this)\n-                }\n-            }\n-            contentResolver.registerContentObserver(rootsUri, true, observer)\n-        }\n-    }\n-\n-    abstract fun shouldMonitorStatus(context: Context, action: String, device: UsbDevice): Boolean\n-\n-    abstract fun onStatusChanged(context: Context, action: String, device: UsbDevice)\n-\n }\n \n internal fun UsbDevice.isMassStorage(): Boolean {\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/UsbMonitorService.kt b/app/src/main/java/com/stevesoltys/seedvault/UsbMonitorService.kt\nnew file mode 100644\nindex 000000000..b41a6e7d3\n--- /dev/null\n+++ b/app/src/main/java/com/stevesoltys/seedvault/UsbMonitorService.kt\n@@ -0,0 +1,74 @@\n+/*\n+ * SPDX-FileCopyrightText: 2025 The Calyx Institute\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.stevesoltys.seedvault\n+\n+import android.app.Service\n+import android.app.backup.IBackupManager\n+import android.content.Intent\n+import android.content.pm.ServiceInfo.FOREGROUND_SERVICE_TYPE_MANIFEST\n+import android.database.ContentObserver\n+import android.net.Uri\n+import android.os.Handler\n+import android.os.IBinder\n+import android.os.Looper\n+import android.util.Log\n+import com.stevesoltys.seedvault.settings.SettingsManager\n+import com.stevesoltys.seedvault.ui.notification.BackupNotificationManager\n+import com.stevesoltys.seedvault.ui.notification.NOTIFICATION_ID_USB_MONITOR\n+import com.stevesoltys.seedvault.worker.BackupRequester.Companion.requestFilesAndAppBackup\n+import org.koin.android.ext.android.inject\n+\n+private const val TAG = \"UsbMonitorService\"\n+\n+class UsbMonitorService : Service() {\n+\n+    private val nm: BackupNotificationManager by inject()\n+    private val backupManager: IBackupManager by inject()\n+    private val settingsManager: SettingsManager by inject()\n+\n+    override fun onStartCommand(intent: Intent, flags: Int, startId: Int): Int {\n+        Log.d(TAG, \"onStartCommand $intent $flags $startId\")\n+        startForeground(\n+            NOTIFICATION_ID_USB_MONITOR,\n+            nm.getUsbMonitorNotification(),\n+            FOREGROUND_SERVICE_TYPE_MANIFEST,\n+        )\n+        val rootsUri = intent.data ?: error(\"No URI in start intent.\")\n+        val contentResolver = contentResolver\n+        val handler = Handler(Looper.myLooper() ?: error(\"no looper\"))\n+        val observer = object : ContentObserver(handler) {\n+            override fun onChange(selfChange: Boolean, uri: Uri?) {\n+                super.onChange(selfChange, uri)\n+                Log.i(TAG, \"onChange() requesting backup now!\")\n+                contentResolver.unregisterContentObserver(this)\n+                requestFilesAndAppBackup(applicationContext, settingsManager, backupManager)\n+                Log.i(TAG, \"stopSelf($startId)\")\n+                stopSelf(startId)\n+            }\n+        }\n+        contentResolver.registerContentObserver(rootsUri, true, observer)\n+\n+        return START_NOT_STICKY\n+    }\n+\n+    override fun onTimeout(startId: Int) {\n+        Log.i(TAG, \"onTimeout($startId)\")\n+    }\n+\n+    override fun onTimeout(startId: Int, fgsType: Int) {\n+        Log.i(TAG, \"onTimeout($startId, $fgsType)\")\n+    }\n+\n+    override fun onBind(intent: Intent?): IBinder? {\n+        return null\n+    }\n+\n+    override fun onDestroy() {\n+        Log.d(TAG, \"onDestroy\")\n+        super.onDestroy()\n+        nm.cancelUsbMonitorNotification()\n+    }\n+}\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/backend/BackendManager.kt b/app/src/main/java/com/stevesoltys/seedvault/backend/BackendManager.kt\nindex 933afd2ee..0e5d14a20 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/backend/BackendManager.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/backend/BackendManager.kt\n@@ -15,9 +15,9 @@ import com.stevesoltys.seedvault.settings.SettingsManager\n import com.stevesoltys.seedvault.settings.StoragePluginType\n import org.calyxos.seedvault.core.backends.Backend\n import org.calyxos.seedvault.core.backends.BackendFactory\n+import org.calyxos.seedvault.core.backends.BackendId\n import org.calyxos.seedvault.core.backends.BackendProperties\n import org.calyxos.seedvault.core.backends.IBackendManager\n-import org.calyxos.seedvault.core.backends.saf.SafBackend\n \n class BackendManager(\n     private val context: Context,\n@@ -72,7 +72,7 @@ class BackendManager(\n \n     fun isValidAppPluginSet(): Boolean {\n         if (mBackend == null) return false\n-        if (mBackend is SafBackend) {\n+        if (mBackend?.id == BackendId.SAF) {\n             val storage = settingsManager.getSafProperties() ?: return false\n             if (storage.isUsb) return true\n             return permitDiskReads {\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/backend/saf/DocumentsStorage.kt b/app/src/main/java/com/stevesoltys/seedvault/backend/saf/DocumentsStorage.kt\nindex 48e10ede7..bcbd84669 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/backend/saf/DocumentsStorage.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/backend/saf/DocumentsStorage.kt\n@@ -42,6 +42,7 @@ private val TAG = DocumentsStorage::class.java.simpleName\n internal class DocumentsStorage(\n     private val appContext: Context,\n     internal val safStorage: SafProperties,\n+    private val root: String = DIRECTORY_ROOT,\n ) {\n \n     /**\n@@ -55,7 +56,7 @@ internal class DocumentsStorage(\n             if (field == null) {\n                 val parent = safStorage.getDocumentFile(context)\n                 field = try {\n-                    parent.createOrGetDirectory(context, DIRECTORY_ROOT)\n+                    parent.createOrGetDirectory(context, root)\n                 } catch (e: IOException) {\n                     Log.e(TAG, \"Error creating root backup dir.\", e)\n                     null\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/metadata/Metadata.kt b/app/src/main/java/com/stevesoltys/seedvault/metadata/Metadata.kt\nindex 0fe543918..f3bd79c78 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/metadata/Metadata.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/metadata/Metadata.kt\n@@ -122,6 +122,7 @@ data class PackageMetadata(\n         fun fromSnapshot(app: Snapshot.App) = PackageMetadata(\n             time = app.time,\n             backupType = app.type.toBackupType(),\n+            size = app.size,\n             name = app.name,\n             chunkIds = app.chunkIdsList.hexFromProto(),\n             system = app.system,\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/repo/AppBackupManager.kt b/app/src/main/java/com/stevesoltys/seedvault/repo/AppBackupManager.kt\nindex 5af26180d..386f600f3 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/repo/AppBackupManager.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/repo/AppBackupManager.kt\n@@ -6,13 +6,12 @@\n package com.stevesoltys.seedvault.repo\n \n import androidx.annotation.WorkerThread\n-import com.stevesoltys.seedvault.MemoryLogger\n import com.stevesoltys.seedvault.backend.BackendManager\n import com.stevesoltys.seedvault.crypto.Crypto\n import com.stevesoltys.seedvault.header.VERSION\n import com.stevesoltys.seedvault.settings.SettingsManager\n import io.github.oshai.kotlinlogging.KotlinLogging\n-import kotlinx.coroutines.delay\n+import org.calyxos.seedvault.core.MemoryLogger\n import org.calyxos.seedvault.core.backends.AppBackupFileType.Blob\n import org.calyxos.seedvault.core.backends.AppBackupFileType.Snapshot\n import org.calyxos.seedvault.core.backends.FileInfo\n@@ -98,10 +97,7 @@ internal class AppBackupManager(\n                 // otherwise we'd have partial snapshots\n                 val snapshot = snapshotCreator?.finalizeSnapshot()\n                     ?: error(\"Had no snapshotCreator\")\n-                keepTrying { // TODO remove when we have auto-retrying backends\n-                    // saving this is so important, we even keep trying\n-                    snapshotManager.saveSnapshot(snapshot)\n-                }\n+                snapshotManager.saveSnapshot(snapshot)\n                 // save token and time of last backup\n                 settingsManager.onSuccessfulBackupCompleted(snapshot.token)\n                 // after snapshot was written, we can clear local cache as its info is in snapshot\n@@ -109,7 +105,7 @@ internal class AppBackupManager(\n                 snapshot\n             } else null\n         } catch (e: Exception) {\n-            log.error(e) { \"Error finishing backup\" }\n+            log.error(e) { \"Error finishing backup: \" }\n             null\n         } finally {\n             snapshotCreator = null\n@@ -175,17 +171,4 @@ internal class AppBackupManager(\n         backendManager.backend.remove(TopLevelFolder(crypto.repoId))\n     }\n \n-    private suspend fun keepTrying(n: Int = 3, block: suspend () -> Unit) {\n-        for (i in 1..n) {\n-            try {\n-                block()\n-                return\n-            } catch (e: Exception) {\n-                if (i == n) throw e\n-                log.error(e) { \"Error (#$i), we'll keep trying\" }\n-                delay(1000 * i.toLong())\n-            }\n-        }\n-    }\n-\n }\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/repo/BlobCache.kt b/app/src/main/java/com/stevesoltys/seedvault/repo/BlobCache.kt\nindex 76b718218..a16812faf 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/repo/BlobCache.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/repo/BlobCache.kt\n@@ -11,7 +11,7 @@ import android.content.Context.MODE_PRIVATE\n import androidx.annotation.VisibleForTesting\n import androidx.annotation.WorkerThread\n import com.google.protobuf.ByteString\n-import com.stevesoltys.seedvault.MemoryLogger\n+import org.calyxos.seedvault.core.MemoryLogger\n import com.stevesoltys.seedvault.proto.Snapshot\n import com.stevesoltys.seedvault.proto.Snapshot.Blob\n import io.github.oshai.kotlinlogging.KotlinLogging\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/repo/BlobCreator.kt b/app/src/main/java/com/stevesoltys/seedvault/repo/BlobCreator.kt\nindex ea2719518..6c7400fe5 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/repo/BlobCreator.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/repo/BlobCreator.kt\n@@ -8,7 +8,6 @@ package com.stevesoltys.seedvault.repo\n import androidx.annotation.WorkerThread\n import com.github.luben.zstd.ZstdOutputStream\n import com.google.protobuf.ByteString\n-import com.stevesoltys.seedvault.MemoryLogger\n import com.stevesoltys.seedvault.backend.BackendManager\n import com.stevesoltys.seedvault.crypto.Crypto\n import com.stevesoltys.seedvault.header.VERSION\n@@ -16,11 +15,12 @@ import com.stevesoltys.seedvault.proto.Snapshot.Blob\n import com.stevesoltys.seedvault.proto.SnapshotKt.blob\n import com.stevesoltys.seedvault.repo.Padding.getPadTo\n import okio.Buffer\n-import okio.buffer\n-import okio.sink\n import org.calyxos.seedvault.chunker.Chunk\n+import org.calyxos.seedvault.core.MemoryLogger\n import org.calyxos.seedvault.core.backends.AppBackupFileType\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import java.io.IOException\n+import java.io.OutputStream\n import java.nio.ByteBuffer\n \n /**\n@@ -68,14 +68,14 @@ internal class BlobCreator(\n         // compute hash and save blob\n         val sha256ByteString = buffer.sha256()\n         val handle = AppBackupFileType.Blob(crypto.repoId, sha256ByteString.hex())\n-        // TODO for later: implement a backend wrapper that handles retries for transient errors\n-        val size = backendManager.backend.save(handle).use { outputStream ->\n-            val outputBuffer = outputStream.sink().buffer()\n-            val length = outputBuffer.writeAll(buffer)\n-            // flushing is important here, otherwise data doesn't get fully written!\n-            outputBuffer.flush()\n-            length\n+        val saver = object : BackendSaver {\n+            override val size: Long get() = buffer.size\n+            override val sha256: String get() = sha256ByteString.hex()\n+            override fun save(outputStream: OutputStream): Long {\n+                return buffer.copyTo(outputStream).size\n+            }\n         }\n+        val size = backendManager.backend.save(handle, saver)\n         buffer.clear()\n         return blob {\n             id = ByteString.copyFrom(sha256ByteString.asByteBuffer())\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/repo/Checker.kt b/app/src/main/java/com/stevesoltys/seedvault/repo/Checker.kt\nindex 0fcef5139..fd37c6431 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/repo/Checker.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/repo/Checker.kt\n@@ -7,7 +7,7 @@ package com.stevesoltys.seedvault.repo\n \n import androidx.annotation.WorkerThread\n import com.google.protobuf.ByteString\n-import com.stevesoltys.seedvault.MemoryLogger\n+import org.calyxos.seedvault.core.MemoryLogger\n import com.stevesoltys.seedvault.backend.BackendManager\n import com.stevesoltys.seedvault.crypto.Crypto\n import com.stevesoltys.seedvault.proto.Snapshot\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/repo/SnapshotManager.kt b/app/src/main/java/com/stevesoltys/seedvault/repo/SnapshotManager.kt\nindex 3d8969f73..db4b978de 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/repo/SnapshotManager.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/repo/SnapshotManager.kt\n@@ -13,11 +13,13 @@ import com.stevesoltys.seedvault.header.VERSION\n import com.stevesoltys.seedvault.proto.Snapshot\n import io.github.oshai.kotlinlogging.KotlinLogging\n import org.calyxos.seedvault.core.backends.AppBackupFileType\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.backends.Constants.appSnapshotRegex\n import org.calyxos.seedvault.core.toHexString\n import java.io.ByteArrayOutputStream\n import java.io.File\n import java.io.IOException\n+import java.io.OutputStream\n import java.nio.ByteBuffer\n import java.security.GeneralSecurityException\n \n@@ -99,9 +101,15 @@ internal class SnapshotManager(\n         // compute hash and save blob\n         val sha256 = crypto.sha256(bytes).toHexString()\n         val snapshotHandle = AppBackupFileType.Snapshot(crypto.repoId, sha256)\n-        backendManager.backend.save(snapshotHandle).use { outputStream ->\n-            outputStream.write(bytes)\n+        val saver = object : BackendSaver {\n+            override val size: Long get() = bytes.size.toLong()\n+            override val sha256: String get() = sha256\n+            override fun save(outputStream: OutputStream): Long {\n+                outputStream.write(bytes)\n+                return size\n+            }\n         }\n+        backendManager.backend.save(snapshotHandle, saver)\n         // save to local cache while at it\n         try {\n             if (!snapshotFolder.isDirectory) snapshotFolder.mkdirs()\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/settings/SettingsManager.kt b/app/src/main/java/com/stevesoltys/seedvault/settings/SettingsManager.kt\nindex 0e21fae71..f455f5f52 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/settings/SettingsManager.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/settings/SettingsManager.kt\n@@ -16,9 +16,8 @@ import androidx.preference.PreferenceManager\n import com.stevesoltys.seedvault.backend.webdav.WebDavHandler.Companion.createWebDavProperties\n import com.stevesoltys.seedvault.permitDiskReads\n import org.calyxos.seedvault.core.backends.Backend\n-import org.calyxos.seedvault.core.backends.saf.SafBackend\n+import org.calyxos.seedvault.core.backends.BackendId\n import org.calyxos.seedvault.core.backends.saf.SafProperties\n-import org.calyxos.seedvault.core.backends.webdav.WebDavBackend\n import org.calyxos.seedvault.core.backends.webdav.WebDavConfig\n import org.calyxos.seedvault.core.backends.webdav.WebDavProperties\n import java.util.concurrent.ConcurrentSkipListSet\n@@ -136,9 +135,9 @@ class SettingsManager(private val context: Context) {\n     }\n \n     fun setStorageBackend(plugin: Backend) {\n-        val value = when (plugin) {\n-            is SafBackend -> StoragePluginType.SAF\n-            is WebDavBackend -> StoragePluginType.WEB_DAV\n+        val value = when (plugin.id) {\n+            BackendId.SAF -> StoragePluginType.SAF\n+            BackendId.WEBDAV -> StoragePluginType.WEB_DAV\n             else -> error(\"Unsupported plugin: ${plugin::class.java.simpleName}\")\n         }.name\n         prefs.edit()\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/settings/SettingsViewModel.kt b/app/src/main/java/com/stevesoltys/seedvault/settings/SettingsViewModel.kt\nindex 8fb9f40e6..f0ba26736 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/settings/SettingsViewModel.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/settings/SettingsViewModel.kt\n@@ -31,7 +31,6 @@ import androidx.lifecycle.switchMap\n import androidx.lifecycle.viewModelScope\n import androidx.recyclerview.widget.DiffUtil.calculateDiff\n import androidx.work.ExistingPeriodicWorkPolicy\n-import androidx.work.ExistingPeriodicWorkPolicy.CANCEL_AND_REENQUEUE\n import androidx.work.WorkManager\n import com.stevesoltys.seedvault.BackupStateManager\n import com.stevesoltys.seedvault.R\n@@ -124,19 +123,19 @@ internal class SettingsViewModel(\n \n     private val storageObserver = object : ContentObserver(null) {\n         override fun onChange(selfChange: Boolean, uris: MutableCollection<Uri>, flags: Int) {\n-            onStoragePropertiesChanged()\n+            onBackendPropertiesChanged()\n         }\n     }\n \n     private inner class NetworkObserver : ConnectivityManager.NetworkCallback() {\n         var registered = false\n         override fun onAvailable(network: Network) {\n-            onStoragePropertiesChanged()\n+            onBackendPropertiesChanged()\n         }\n \n         override fun onLost(network: Network) {\n             super.onLost(network)\n-            onStoragePropertiesChanged()\n+            onBackendPropertiesChanged()\n         }\n     }\n \n@@ -169,27 +168,10 @@ internal class SettingsViewModel(\n                 onBackupRunningStateChanged()\n             }\n         }\n-        onStoragePropertiesChanged()\n+        onBackendPropertiesChanged()\n         loadFilesSummary()\n     }\n \n-    override fun onStorageLocationChanged() {\n-        val storage = backendManager.backendProperties ?: return\n-\n-        Log.i(TAG, \"onStorageLocationChanged (isUsb: ${storage.isUsb})\")\n-        if (storage.isUsb) {\n-            // disable storage backup if new storage is on USB\n-            cancelAppBackup()\n-            cancelFilesBackup()\n-        } else {\n-            // enable it, just in case the previous storage was on USB,\n-            // also to update the network requirement of the new storage\n-            scheduleAppBackup(CANCEL_AND_REENQUEUE)\n-            scheduleFilesBackup()\n-        }\n-        onStoragePropertiesChanged()\n-    }\n-\n     private suspend fun onBackupRunningStateChanged() = withContext(Dispatchers.IO) {\n         val backupAllowed = !isBackupRunning.value && !isCheckOrPruneRunning.value\n         if (backupAllowed) {\n@@ -210,7 +192,7 @@ internal class SettingsViewModel(\n         }\n     }\n \n-    private fun onStoragePropertiesChanged() {\n+    override fun onBackendPropertiesChanged() {\n         val properties = backendManager.backendProperties ?: return\n \n         Log.d(TAG, \"onStoragePropertiesChanged\")\n@@ -325,6 +307,8 @@ internal class SettingsViewModel(\n     fun scheduleFilesBackup() {\n         if (!backendManager.isOnRemovableDrive && settingsManager.isStorageBackupEnabled()) {\n             val requiresNetwork = backendManager.backendProperties?.requiresNetwork == true\n+            // FIXME this runs a backup right away (if constraints fulfilled)\n+            //  and JobScheduler doesn't offer initial delay\n             BackupJobService.scheduleJob(\n                 context = app,\n                 jobServiceClass = StorageBackupJobService::class.java,\n@@ -375,6 +359,8 @@ internal class SettingsViewModel(\n         try {\n             app.contentResolver.openOutputStream(uri, \"wt\")?.use { outputStream ->\n                 getRuntime().exec(command).inputStream.use { inputStream ->\n+                    // first log command, so we see if it is correct, e.g. has our own uid\n+                    outputStream.write(\"$command\\n\\n\".toByteArray())\n                     inputStream.copyTo(outputStream)\n                 }\n             } ?: throw IOException(\"OutputStream was null\")\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/storage/Services.kt b/app/src/main/java/com/stevesoltys/seedvault/storage/Services.kt\nindex aa5799f6f..8f554596c 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/storage/Services.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/storage/Services.kt\n@@ -6,6 +6,7 @@\n package com.stevesoltys.seedvault.storage\n \n import android.content.Intent\n+import android.util.Log\n import com.stevesoltys.seedvault.backend.BackendManager\n import com.stevesoltys.seedvault.worker.AppBackupWorker\n import kotlinx.coroutines.flow.MutableStateFlow\n@@ -64,6 +65,8 @@ internal class StorageBackupService : BackupService() {\n     override fun onBackupFinished(intent: Intent, success: Boolean) {\n         if (intent.getBooleanExtra(EXTRA_START_APP_BACKUP, false)) {\n             val isUsb = backendManager.backendProperties?.isUsb ?: false\n+            Log.i(\"StorageBackupService\", \"backup finished (success: $success)\")\n+            Log.i(\"StorageBackupService\", \"  starting AppBackupWorker...\")\n             AppBackupWorker.scheduleNow(applicationContext, reschedule = !isUsb)\n         }\n     }\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/ui/RequireProvisioningActivity.kt b/app/src/main/java/com/stevesoltys/seedvault/ui/RequireProvisioningActivity.kt\nindex b02e874d2..7fd1d0573 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/ui/RequireProvisioningActivity.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/ui/RequireProvisioningActivity.kt\n@@ -44,7 +44,7 @@ abstract class RequireProvisioningActivity : BackupActivity() {\n                 if (!getViewModel().validLocationIsSet()) {\n                     finishAfterTransition()\n                 }\n-            } else getViewModel().onStorageLocationChanged()\n+            } else getViewModel().onBackendPropertiesChanged()\n         }\n \n     protected val isSetupWizard: Boolean\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/ui/RequireProvisioningViewModel.kt b/app/src/main/java/com/stevesoltys/seedvault/ui/RequireProvisioningViewModel.kt\nindex e64ef3977..92958b4c3 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/ui/RequireProvisioningViewModel.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/ui/RequireProvisioningViewModel.kt\n@@ -29,7 +29,7 @@ abstract class RequireProvisioningViewModel(\n \n     internal fun recoveryCodeIsSet() = permitDiskReads { keyManager.hasBackupKey() }\n \n-    open fun onStorageLocationChanged() {\n+    open fun onBackendPropertiesChanged() {\n         // noop can be overwritten by sub-classes\n     }\n \ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/ui/notification/BackupNotificationManager.kt b/app/src/main/java/com/stevesoltys/seedvault/ui/notification/BackupNotificationManager.kt\nindex 255a75b8e..0995ae587 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/ui/notification/BackupNotificationManager.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/ui/notification/BackupNotificationManager.kt\n@@ -27,6 +27,7 @@ import android.util.Log\n import androidx.core.app.NotificationCompat.Action\n import androidx.core.app.NotificationCompat.Builder\n import androidx.core.app.NotificationCompat.CATEGORY_ERROR\n+import androidx.core.app.NotificationCompat.FOREGROUND_SERVICE_DEFERRED\n import androidx.core.app.NotificationCompat.FOREGROUND_SERVICE_IMMEDIATE\n import androidx.core.app.NotificationCompat.PRIORITY_DEFAULT\n import androidx.core.app.NotificationCompat.PRIORITY_HIGH\n@@ -59,7 +60,8 @@ private const val NOTIFICATION_ID_RESTORE_ERROR = 6\n internal const val NOTIFICATION_ID_PRUNING = 7\n internal const val NOTIFICATION_ID_CHECKING = 8\n internal const val NOTIFICATION_ID_CHECK_FINISHED = 9\n-private const val NOTIFICATION_ID_NO_MAIN_KEY_ERROR = 10\n+internal const val NOTIFICATION_ID_USB_MONITOR = 10\n+private const val NOTIFICATION_ID_NO_MAIN_KEY_ERROR = 11\n \n private val TAG = BackupNotificationManager::class.java.simpleName\n \n@@ -340,6 +342,22 @@ internal class BackupNotificationManager(private val context: Context) {\n         }.build()\n     }\n \n+    /**\n+     * Due to [FOREGROUND_SERVICE_DEFERRED], the user is unlikely to see this.\n+     */\n+    fun getUsbMonitorNotification(): Notification {\n+        return Builder(context, CHANNEL_ID_ERROR).apply {\n+            setSmallIcon(R.drawable.ic_usb)\n+            setContentTitle(context.getString(R.string.notification_usb_monitor_title))\n+            setContentText(context.getString(R.string.notification_usb_monitor_text))\n+            setOngoing(true)\n+            priority = PRIORITY_LOW\n+            foregroundServiceBehavior = FOREGROUND_SERVICE_DEFERRED\n+        }.build()\n+    }\n+\n+    fun cancelUsbMonitorNotification() = nm.cancel(NOTIFICATION_ID_USB_MONITOR)\n+\n     fun getCheckNotification() = Builder(context, CHANNEL_ID_CHECKING).apply {\n         setSmallIcon(R.drawable.ic_cloud_search)\n         setContentTitle(context.getString(R.string.notification_checking_title))\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/ui/notification/NotificationBackupObserver.kt b/app/src/main/java/com/stevesoltys/seedvault/ui/notification/NotificationBackupObserver.kt\nindex ac0fa195a..b738d890e 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/ui/notification/NotificationBackupObserver.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/ui/notification/NotificationBackupObserver.kt\n@@ -148,6 +148,12 @@ internal class NotificationBackupObserver(\n                 settingsManager.disableBackup(packageName)\n             }\n         }\n+        // FIXME we should consider not requesting backup of more chunks of packages,\n+        //  if the backup has already failed for this chunk,\n+        //  because it will result in incomplete snapshots\n+        //  since the rest of packages from the failed chunk won't get backed up.\n+        //  So we either re-include those packages somehow (may fail again in a loop!)\n+        //  or we simply fail the entire backup which may cause more failures for users :(\n         if (backupRequester.requestNext()) {\n             if (isLoggable(TAG, INFO)) {\n                 Log.i(TAG, \"Backup finished $numPackages/$requestedPackages. Status: $status\")\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/ui/storage/BackupStorageViewModel.kt b/app/src/main/java/com/stevesoltys/seedvault/ui/storage/BackupStorageViewModel.kt\nindex fd39b6b24..f2d6a6f65 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/ui/storage/BackupStorageViewModel.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/ui/storage/BackupStorageViewModel.kt\n@@ -50,6 +50,7 @@ internal class BackupStorageViewModel(\n \n     @UiThread\n     override fun onSafUriSet(safProperties: SafProperties) {\n+        Log.i(TAG, \"onSafUriSet(${safProperties.uri})\")\n         safHandler.save(safProperties)\n         viewModelScope.launch {\n             withContext(Dispatchers.IO) {\n@@ -58,13 +59,14 @@ internal class BackupStorageViewModel(\n             withContext(Dispatchers.Main) { // UiThread\n                 if (safProperties.isUsb) {\n                     // disable storage backup if new storage is on USB\n+                    Log.i(TAG, \"Cancel backup workers, because we are on USB.\")\n                     cancelBackupWorkers()\n                 } else {\n                     // enable it, just in case the previous storage was on USB,\n                     // also to update the network requirement of the new storage\n                     scheduleBackupWorkers()\n                 }\n-                onStorageLocationSet(safProperties.isUsb)\n+                onNewBackendSet(safProperties.isUsb)\n             }\n         }\n     }\n@@ -77,12 +79,12 @@ internal class BackupStorageViewModel(\n             }\n             withContext(Dispatchers.Main) {\n                 scheduleBackupWorkers()\n-                onStorageLocationSet(isUsb = false)\n+                onNewBackendSet(isUsb = false)\n             }\n         }\n     }\n \n-    private fun onStorageLocationSet(isUsb: Boolean) {\n+    private fun onNewBackendSet(isUsb: Boolean) {\n         viewModelScope.launch(Dispatchers.IO) {\n             try {\n                 // remove old storage snapshots and clear cache\n@@ -114,18 +116,20 @@ internal class BackupStorageViewModel(\n     }\n \n     private fun scheduleBackupWorkers() {\n-        val storage = backendManager.backendProperties ?: error(\"no storage available\")\n+        val backendProperties = backendManager.backendProperties ?: error(\"no storage available\")\n         // disable framework scheduling, because another transport may have enabled it\n         backupManager.setFrameworkSchedulingEnabledForUser(UserHandle.myUserId(), false)\n-        if (!storage.isUsb) {\n+        if (!backendProperties.isUsb) {\n             if (backupManager.isBackupEnabled) {\n                 AppBackupWorker.schedule(app, settingsManager, CANCEL_AND_REENQUEUE)\n             }\n+            // FIXME this runs a backup right away (if constraints fulfilled)\n+            //  and JobScheduler doesn't offer initial delay\n             if (settingsManager.isStorageBackupEnabled()) BackupJobService.scheduleJob(\n                 context = app,\n                 jobServiceClass = StorageBackupJobService::class.java,\n                 periodMillis = TimeUnit.HOURS.toMillis(24),\n-                networkType = if (storage.requiresNetwork) JobInfo.NETWORK_TYPE_UNMETERED\n+                networkType = if (backendProperties.requiresNetwork) JobInfo.NETWORK_TYPE_UNMETERED\n                 else JobInfo.NETWORK_TYPE_NONE,\n                 deviceIdle = false,\n                 charging = true\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/ui/storage/StorageViewModel.kt b/app/src/main/java/com/stevesoltys/seedvault/ui/storage/StorageViewModel.kt\nindex ed85bdde7..198741a94 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/ui/storage/StorageViewModel.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/ui/storage/StorageViewModel.kt\n@@ -8,6 +8,7 @@ package com.stevesoltys.seedvault.ui.storage\n import android.annotation.UiThread\n import android.app.Application\n import android.net.Uri\n+import android.util.Log\n import androidx.lifecycle.AndroidViewModel\n import androidx.lifecycle.LiveData\n import androidx.lifecycle.MutableLiveData\n@@ -27,6 +28,8 @@ import org.calyxos.seedvault.core.backends.saf.SafProperties\n import org.calyxos.seedvault.core.backends.webdav.WebDavConfig\n import org.calyxos.seedvault.core.backends.webdav.WebDavProperties\n \n+private const val TAG = \"StorageViewModel\"\n+\n internal abstract class StorageViewModel(\n     private val app: Application,\n     protected val safHandler: SafHandler,\n@@ -70,6 +73,7 @@ internal abstract class StorageViewModel(\n     }\n \n     internal fun onUriPermissionResultReceived(uri: Uri?) {\n+        Log.i(TAG, \"onUriPermissionResultReceived($uri)\")\n         if (uri == null) {\n             val msg = app.getString(R.string.storage_check_fragment_permission_error)\n             mLocationChecked.setEvent(LocationResult(msg))\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/worker/BackupRequester.kt b/app/src/main/java/com/stevesoltys/seedvault/worker/BackupRequester.kt\nindex 6413c183c..da7a3b94e 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/worker/BackupRequester.kt\n+++ b/app/src/main/java/com/stevesoltys/seedvault/worker/BackupRequester.kt\n@@ -56,8 +56,11 @@ internal class BackupRequester(\n                 val i = Intent(context, StorageBackupService::class.java)\n                 // this starts an app backup afterwards\n                 i.putExtra(EXTRA_START_APP_BACKUP, appBackupEnabled)\n+                Log.i(TAG, \"Starting foreground service for file backup...\")\n+                Log.i(TAG, \"  appBackupEnabled = $appBackupEnabled\")\n                 startForegroundService(context, i)\n             } else if (appBackupEnabled) {\n+                Log.i(TAG, \"File backup disabled, starting only AppBackupWorker...\")\n                 AppBackupWorker.scheduleNow(context, reschedule)\n             } else {\n                 Log.d(TAG, \"Neither files nor app backup enabled, do nothing.\")\ndiff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml\nindex c0d3d9f77..c7e1799d4 100644\n--- a/app/src/main/res/values/strings.xml\n+++ b/app/src/main/res/values/strings.xml\n@@ -200,6 +200,9 @@\n     <string name=\"notification_checking_error_text\">Tap for details. We checked %1$s at an average speed of %2$s.</string>\n     <string name=\"notification_checking_action\">Details</string>\n \n+    <string name=\"notification_usb_monitor_title\">Waiting for USB drive</string>\n+    <string name=\"notification_usb_monitor_text\">Once your USB drive becomes available, we will start a backup.</string>\n+\n     <string name=\"backup_app_check_success_intro\">%1$d snapshots were found and %2$d%% of their data (%3$s) successfully verified:</string>\n     <string name=\"backup_app_check_success_disclaimer\">Note: we cannot verify whether individual apps include all of their user data in the backup.</string>\n     <string name=\"backup_app_check_error_title\" translatable=\"false\">@string/notification_checking_error_title</string>\ndiff --git a/app/src/test/java/com/stevesoltys/seedvault/repo/AppBackupManagerTest.kt b/app/src/test/java/com/stevesoltys/seedvault/repo/AppBackupManagerTest.kt\nindex 60aca142b..06c7d74b4 100644\n--- a/app/src/test/java/com/stevesoltys/seedvault/repo/AppBackupManagerTest.kt\n+++ b/app/src/test/java/com/stevesoltys/seedvault/repo/AppBackupManagerTest.kt\n@@ -9,7 +9,6 @@ import com.stevesoltys.seedvault.backend.BackendManager\n import com.stevesoltys.seedvault.getRandomByteArray\n import com.stevesoltys.seedvault.transport.TransportTest\n import io.mockk.Runs\n-import io.mockk.andThenJust\n import io.mockk.coEvery\n import io.mockk.coVerify\n import io.mockk.every\n@@ -22,7 +21,6 @@ import org.calyxos.seedvault.core.backends.Backend\n import org.calyxos.seedvault.core.backends.FileInfo\n import org.calyxos.seedvault.core.backends.TopLevelFolder\n import org.calyxos.seedvault.core.toHexString\n-import org.junit.jupiter.api.Assertions.assertEquals\n import org.junit.jupiter.api.Assertions.assertNull\n import org.junit.jupiter.api.Test\n import org.junit.jupiter.api.assertThrows\n@@ -109,22 +107,6 @@ internal class AppBackupManagerTest : TransportTest() {\n         assertNull(appBackupManager.afterBackupFinished(true))\n     }\n \n-    @Test\n-    fun `afterBackupFinished retries saving snapshot`() = runBlocking {\n-        // need to run beforeBackup to get a snapshotCreator\n-        minimalBeforeBackup()\n-\n-        every { blobCache.clear() } just Runs\n-        every { snapshotCreator.finalizeSnapshot() } returns snapshot\n-        coEvery {\n-            snapshotManager.saveSnapshot(snapshot) // works only at third attempt\n-        } throws IOException() andThenThrows IOException() andThenJust Runs\n-        every { settingsManager.onSuccessfulBackupCompleted(snapshot.token) } just Runs\n-        every { blobCache.clearLocalCache() } just Runs\n-\n-        assertEquals(snapshot, appBackupManager.afterBackupFinished(true))\n-    }\n-\n     @Test\n     fun `recycleBackupRepo doesn't do anything if repoId is current`() = runBlocking {\n         every { crypto.repoId } returns repoId\ndiff --git a/app/src/test/java/com/stevesoltys/seedvault/repo/BlobCreatorTest.kt b/app/src/test/java/com/stevesoltys/seedvault/repo/BlobCreatorTest.kt\nindex 86ad63347..a55b492e5 100644\n--- a/app/src/test/java/com/stevesoltys/seedvault/repo/BlobCreatorTest.kt\n+++ b/app/src/test/java/com/stevesoltys/seedvault/repo/BlobCreatorTest.kt\n@@ -16,6 +16,7 @@ import kotlinx.coroutines.runBlocking\n import org.calyxos.seedvault.chunker.Chunk\n import org.calyxos.seedvault.core.backends.AppBackupFileType\n import org.calyxos.seedvault.core.backends.Backend\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.toHexString\n import org.junit.jupiter.api.Assertions.assertArrayEquals\n import org.junit.jupiter.api.Assertions.assertEquals\n@@ -60,7 +61,10 @@ internal class BlobCreatorTest : TransportTest() {\n         every { backendManager.backend } returns backend\n \n         // create first blob\n-        coEvery { backend.save(capture(blobHandle)) } returns outputStream1\n+        val saverSlot = slot<BackendSaver>()\n+        coEvery { backend.save(capture(blobHandle), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(outputStream1)\n+        }\n         val blob1 = blobCreator.createNewBlob(chunk1)\n         // check that file content hash matches snapshot hash\n         val messageDigest = MessageDigest.getInstance(\"SHA-256\")\n@@ -74,7 +78,9 @@ internal class BlobCreatorTest : TransportTest() {\n \n         // use same BlobCreator to create another blob, because we re-use a single buffer\n         // and need to check clearing that does work as expected\n-        coEvery { backend.save(capture(blobHandle)) } returns outputStream2\n+        coEvery { backend.save(capture(blobHandle), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(outputStream2)\n+        }\n         val blob2 = blobCreator.createNewBlob(chunk2)\n         // check that file content hash matches snapshot hash\n         val hash2 = messageDigest.digest(outputStream2.toByteArray()).toHexString()\n@@ -107,7 +113,10 @@ internal class BlobCreatorTest : TransportTest() {\n         every { backendManager.backend } returns backend\n \n         // create blob\n-        coEvery { backend.save(capture(blobHandle)) } returns outputStream\n+        val saverSlot = slot<BackendSaver>()\n+        coEvery { backend.save(capture(blobHandle), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(outputStream)\n+        }\n         val blob = blobCreator.createNewBlob(chunk)\n         // check that file content hash matches snapshot hash\n         val messageDigest = MessageDigest.getInstance(\"SHA-256\")\n@@ -140,4 +149,50 @@ internal class BlobCreatorTest : TransportTest() {\n             assertArrayEquals(data, inputStream.readAllBytes())\n         }\n     }\n+\n+    @Test\n+    fun `test blob saver gets reused by RetryBackend`() = runBlocking {\n+        val data = getRandomByteArray(Random.nextInt(16 * 1024 * 1024))\n+        val chunk = Chunk(0L, data.size, data, \"doesn't matter here\")\n+        val outputStream1 = ByteArrayOutputStream()\n+        val outputStream2 = ByteArrayOutputStream()\n+        val outputStream3 = ByteArrayOutputStream()\n+        val paddingNum = slot<Int>()\n+\n+        every { crypto.getAdForVersion() } returns ad\n+        every { crypto.newEncryptingStream(capture(passThroughOutputStream), ad) } answers {\n+            passThroughOutputStream.captured // not really encrypting here\n+        }\n+        every { crypto.getRandomBytes(capture(paddingNum)) } answers {\n+            getRandomByteArray(paddingNum.captured)\n+        }\n+        every { crypto.repoId } returns repoId\n+        every { backendManager.backend } returns backend\n+\n+        // create blob\n+        val saverSlot = slot<BackendSaver>()\n+        var size1 = -1L\n+        var size2 = -1L\n+        coEvery { backend.save(capture(blobHandle), capture(saverSlot)) } answers {\n+            // saver saves 3 times\n+            size1 = saverSlot.captured.save(outputStream1)\n+            size2 = saverSlot.captured.save(outputStream2)\n+            saverSlot.captured.save(outputStream3)\n+        }\n+        val blob = blobCreator.createNewBlob(chunk)\n+        // check that file content hash matches snapshot hash\n+        val messageDigest = MessageDigest.getInstance(\"SHA-256\")\n+        val hash1 = messageDigest.digest(outputStream1.toByteArray()).toHexString()\n+        val hash2 = messageDigest.digest(outputStream2.toByteArray()).toHexString()\n+        val hash3 = messageDigest.digest(outputStream3.toByteArray()).toHexString()\n+        assertEquals(hash1, blobHandle.captured.name)\n+        assertEquals(hash2, blobHandle.captured.name)\n+        assertEquals(hash3, blobHandle.captured.name)\n+\n+        // check blob metadata\n+        assertEquals(hash1, blob.id.hexFromProto())\n+        assertEquals(outputStream1.size(), blob.length)\n+        assertEquals(blob.length.toLong(), size1)\n+        assertEquals(blob.length.toLong(), size2)\n+    }\n }\ndiff --git a/app/src/test/java/com/stevesoltys/seedvault/repo/SnapshotManagerTest.kt b/app/src/test/java/com/stevesoltys/seedvault/repo/SnapshotManagerTest.kt\nindex 6142cf914..b4cd01947 100644\n--- a/app/src/test/java/com/stevesoltys/seedvault/repo/SnapshotManagerTest.kt\n+++ b/app/src/test/java/com/stevesoltys/seedvault/repo/SnapshotManagerTest.kt\n@@ -18,6 +18,7 @@ import io.mockk.slot\n import kotlinx.coroutines.runBlocking\n import org.calyxos.seedvault.core.backends.AppBackupFileType\n import org.calyxos.seedvault.core.backends.Backend\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.toByteArrayFromHex\n import org.calyxos.seedvault.core.toHexString\n import org.junit.jupiter.api.Assertions.assertArrayEquals\n@@ -95,7 +96,10 @@ internal class SnapshotManagerTest : TransportTest() {\n         }\n         every { crypto.sha256(any()) } returns chunkId1.toByteArrayFromHex()\n         every { crypto.repoId } returns repoId\n-        coEvery { backend.save(snapshotHandle) } returns outputStream\n+        val saverSlot = slot<BackendSaver>()\n+        coEvery { backend.save(snapshotHandle, capture(saverSlot)) } answers {\n+            saverSlot.captured.save(outputStream)\n+        }\n \n         snapshotManager.saveSnapshot(snapshot)\n \n@@ -188,7 +192,10 @@ internal class SnapshotManagerTest : TransportTest() {\n         every { crypto.sha256(capture(bytes)) } answers {\n             messageDigest.digest(bytes.captured)\n         }\n-        coEvery { backend.save(capture(snapshotHandle)) } returns outputStream\n+        val saverSlot = slot<BackendSaver>()\n+        coEvery { backend.save(capture(snapshotHandle), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(outputStream)\n+        }\n \n         snapshotManager.saveSnapshot(snapshot)\n \n@@ -214,6 +221,59 @@ internal class SnapshotManagerTest : TransportTest() {\n         }\n     }\n \n+    @Test\n+    fun `test that saving can be re-tried`(@TempDir tmpDir: Path) = runBlocking {\n+        val loader = Loader(crypto, backendManager) // need a real loader\n+        val snapshotManager = getSnapshotManager(File(tmpDir.toString()), loader)\n+\n+        val bytes = slot<ByteArray>()\n+        val outputStream1 = ByteArrayOutputStream()\n+        val outputStream2 = ByteArrayOutputStream()\n+        val outputStream3 = ByteArrayOutputStream()\n+\n+        every { crypto.getAdForVersion() } returns ad\n+        every { crypto.newEncryptingStream(capture(passThroughOutputStream), ad) } answers {\n+            passThroughOutputStream.captured // not really encrypting here\n+        }\n+        every { crypto.repoId } returns repoId\n+        every { crypto.sha256(capture(bytes)) } answers {\n+            messageDigest.digest(bytes.captured)\n+        }\n+        val saverSlot = slot<BackendSaver>()\n+        var size1 = -1L\n+        var size2 = -1L\n+        coEvery { backend.save(capture(snapshotHandle), capture(saverSlot)) } answers {\n+            // saver saves 3 times\n+            size1 = saverSlot.captured.save(outputStream1)\n+            size2 = saverSlot.captured.save(outputStream2)\n+            saverSlot.captured.save(outputStream3)\n+        }\n+\n+        snapshotManager.saveSnapshot(snapshot)\n+\n+        // check that data was saved to all streams\n+        assertTrue(outputStream1.size() > 0)\n+        assertTrue(outputStream2.size() > 0)\n+        assertTrue(outputStream3.size() > 0)\n+\n+        assertEquals(size1, outputStream1.size().toLong())\n+        assertEquals(size2, outputStream2.size().toLong())\n+\n+        // check that file content hash matches snapshot hash for each write\n+        assertEquals(\n+            messageDigest.digest(outputStream1.toByteArray()).toHexString(),\n+            snapshotHandle.captured.hash,\n+        )\n+        assertEquals(\n+            messageDigest.digest(outputStream2.toByteArray()).toHexString(),\n+            snapshotHandle.captured.hash,\n+        )\n+        assertEquals(\n+            messageDigest.digest(outputStream3.toByteArray()).toHexString(),\n+            snapshotHandle.captured.hash,\n+        )\n+    }\n+\n     @Test\n     fun `remove snapshot removes from backend and cache`(@TempDir tmpDir: Path) = runBlocking {\n         val snapshotManager = getSnapshotManager(File(tmpDir.toString()))\ndiff --git a/app/src/test/java/com/stevesoltys/seedvault/transport/backup/BackupCreationTest.kt b/app/src/test/java/com/stevesoltys/seedvault/transport/backup/BackupCreationTest.kt\nindex 36900de79..d04c64a47 100644\n--- a/app/src/test/java/com/stevesoltys/seedvault/transport/backup/BackupCreationTest.kt\n+++ b/app/src/test/java/com/stevesoltys/seedvault/transport/backup/BackupCreationTest.kt\n@@ -31,6 +31,7 @@ import io.mockk.slot\n import kotlinx.coroutines.runBlocking\n import org.calyxos.seedvault.core.backends.AppBackupFileType\n import org.calyxos.seedvault.core.backends.Backend\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.toHexString\n import org.junit.Assert.assertEquals\n import org.junit.Test\n@@ -126,7 +127,10 @@ internal class BackupCreationTest : BackupTest() {\n \n         val handleSlot = slot<AppBackupFileType.Blob>()\n         val outputStream = ByteArrayOutputStream()\n-        coEvery { backend.save(capture(handleSlot)) } returns outputStream\n+        val saverSlot = slot<BackendSaver>()\n+        coEvery { backend.save(capture(handleSlot), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(outputStream)\n+        }\n \n         assertEquals(TRANSPORT_OK, backup.finishBackup())\n         assertEquals(newRepoId, handleSlot.captured.repoId)\n@@ -149,7 +153,10 @@ internal class BackupCreationTest : BackupTest() {\n \n         val handleSlot = slot<AppBackupFileType.Blob>()\n         val outputStream = ByteArrayOutputStream()\n-        coEvery { backend.save(capture(handleSlot)) } returns outputStream\n+        val saverSlot = slot<BackendSaver>()\n+        coEvery { backend.save(capture(handleSlot), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(outputStream)\n+        }\n \n         assertEquals(TRANSPORT_OK, backup.finishBackup())\n         assertEquals(newRepoId, handleSlot.captured.repoId)\ndiff --git a/core/build.gradle.kts b/core/build.gradle.kts\nindex 2c5b94006..f57fc81e0 100644\n--- a/core/build.gradle.kts\n+++ b/core/build.gradle.kts\n@@ -48,6 +48,8 @@ dependencies {\n     implementation(libs.slf4j.api)\n \n     testImplementation(kotlin(\"test\"))\n+    testImplementation(\"org.jetbrains.kotlinx:kotlinx-coroutines-test:${libs.versions.coroutines}\")\n+    testImplementation(\"io.mockk:mockk:${libs.versions.mockk.get()}\")\n     testImplementation(\"org.ogce:xpp3:1.1.6\")\n     testImplementation(\"org.slf4j:slf4j-simple:2.0.3\")\n }\ndiff --git a/app/src/main/java/com/stevesoltys/seedvault/MemoryLogger.kt b/core/src/main/java/org/calyxos/seedvault/core/MemoryLogger.kt\nsimilarity index 78%\nrename from app/src/main/java/com/stevesoltys/seedvault/MemoryLogger.kt\nrename to core/src/main/java/org/calyxos/seedvault/core/MemoryLogger.kt\nindex 7adfd6761..065e7fba7 100644\n--- a/app/src/main/java/com/stevesoltys/seedvault/MemoryLogger.kt\n+++ b/core/src/main/java/org/calyxos/seedvault/core/MemoryLogger.kt\n@@ -3,17 +3,17 @@\n  * SPDX-License-Identifier: Apache-2.0\n  */\n \n-package com.stevesoltys.seedvault\n+package org.calyxos.seedvault.core\n \n import android.util.Log\n \n-object MemoryLogger {\n+public object MemoryLogger {\n \n-    fun log() {\n+    public fun log() {\n         Log.d(\"MemoryLogger\", getMemStr())\n     }\n \n-    fun getMemStr(): String {\n+    public fun getMemStr(): String {\n         val r = Runtime.getRuntime()\n         val total = r.totalMemory() / 1024 / 1024\n         val free = r.freeMemory() / 1024 / 1024\ndiff --git a/core/src/main/java/org/calyxos/seedvault/core/backends/Backend.kt b/core/src/main/java/org/calyxos/seedvault/core/backends/Backend.kt\nindex 9d6d99fc6..488872275 100644\n--- a/core/src/main/java/org/calyxos/seedvault/core/backends/Backend.kt\n+++ b/core/src/main/java/org/calyxos/seedvault/core/backends/Backend.kt\n@@ -7,11 +7,15 @@ package org.calyxos.seedvault.core.backends\n \n import androidx.annotation.VisibleForTesting\n import java.io.InputStream\n-import java.io.OutputStream\n import kotlin.reflect.KClass\n \n public interface Backend {\n \n+    /**\n+     * Returns the [BackendId] identifying this [Backend].\n+     */\n+    public val id: BackendId\n+\n     /**\n      * Returns true if the plugin is working, or false if it isn't.\n      * @throws Exception any kind of exception to provide more info on the error\n@@ -25,7 +29,7 @@ public interface Backend {\n      */\n     public suspend fun getFreeSpace(): Long?\n \n-    public suspend fun save(handle: FileHandle): OutputStream\n+    public suspend fun save(handle: FileHandle, saver: BackendSaver): Long\n \n     public suspend fun load(handle: FileHandle): InputStream\n \n@@ -42,6 +46,12 @@ public interface Backend {\n     @VisibleForTesting\n     public suspend fun removeAll()\n \n+    /**\n+     * Returns true if the given exception is only transient\n+     * and the operation where it threw should be retried.\n+     */\n+    public fun isTransientException(e: Exception): Boolean\n+\n     /**\n      * Returns the package name of the app that provides the storage backend\n      * which is used for the current backup location.\ndiff --git a/core/src/main/java/org/calyxos/seedvault/core/backends/BackendFactory.kt b/core/src/main/java/org/calyxos/seedvault/core/backends/BackendFactory.kt\nindex af7cc8ecf..5fd9b8fc8 100644\n--- a/core/src/main/java/org/calyxos/seedvault/core/backends/BackendFactory.kt\n+++ b/core/src/main/java/org/calyxos/seedvault/core/backends/BackendFactory.kt\n@@ -13,7 +13,8 @@ import org.calyxos.seedvault.core.backends.webdav.WebDavConfig\n \n public class BackendFactory {\n     public fun createSafBackend(context: Context, config: SafProperties): Backend =\n-        SafBackend(context, config)\n+        RetryBackend(SafBackend(context, config))\n \n-    public fun createWebDavBackend(config: WebDavConfig): Backend = WebDavBackend(config)\n+    public fun createWebDavBackend(config: WebDavConfig): Backend =\n+        RetryBackend(WebDavBackend(config))\n }\ndiff --git a/core/src/main/java/org/calyxos/seedvault/core/backends/BackendSaver.kt b/core/src/main/java/org/calyxos/seedvault/core/backends/BackendSaver.kt\nnew file mode 100644\nindex 000000000..aa19cb9ca\n--- /dev/null\n+++ b/core/src/main/java/org/calyxos/seedvault/core/backends/BackendSaver.kt\n@@ -0,0 +1,34 @@\n+/*\n+ * SPDX-FileCopyrightText: 2024 The Calyx Institute\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package org.calyxos.seedvault.core.backends\n+\n+import java.io.OutputStream\n+\n+/**\n+ * Used to save data with [Backend]s.\n+ *\n+ * Attention: Ensure that [save] can safely called more than once and still saves the same data.\n+ */\n+public interface BackendSaver {\n+    /**\n+     * The number of bytes that will be saved or `null` if unknown.\n+     */\n+    public val size: Long\n+\n+    /**\n+     * The SHA256 hash (in lower-case hex string representation) the bytes to be saved have,\n+     * or `null` if it isn't known.\n+     */\n+    public val sha256: String?\n+\n+    /**\n+     * Called by the backend when it wants to save the data to the provided [outputStream].\n+     * Can be called more than once, in case the backend encountered an error saving.\n+     *\n+     * @return the number of bytes saved. Should be equal to [size].\n+     */\n+    public fun save(outputStream: OutputStream): Long\n+}\ndiff --git a/core/src/main/java/org/calyxos/seedvault/core/backends/BackendTest.kt b/core/src/main/java/org/calyxos/seedvault/core/backends/BackendTest.kt\nindex c98fe923a..b1b660fc0 100644\n--- a/core/src/main/java/org/calyxos/seedvault/core/backends/BackendTest.kt\n+++ b/core/src/main/java/org/calyxos/seedvault/core/backends/BackendTest.kt\n@@ -7,6 +7,7 @@ package org.calyxos.seedvault.core.backends\n \n import androidx.annotation.VisibleForTesting\n import org.calyxos.seedvault.core.toHexString\n+import java.io.OutputStream\n import kotlin.random.Random\n import kotlin.test.assertContentEquals\n import kotlin.test.assertEquals\n@@ -15,6 +16,7 @@ import kotlin.test.assertNotNull\n import kotlin.test.assertTrue\n \n @VisibleForTesting\n+@Suppress(\"BlockingMethodInNonBlockingContext\")\n public abstract class BackendTest {\n \n     public abstract val backend: Backend\n@@ -26,13 +28,8 @@ public abstract class BackendTest {\n         val now = System.currentTimeMillis()\n         val bytes1 = Random.nextBytes(1337)\n         val bytes2 = Random.nextBytes(1337 * 8)\n-        backend.save(LegacyAppBackupFile.Metadata(now)).use {\n-            it.write(bytes1)\n-        }\n-\n-        backend.save(FileBackupFileType.Snapshot(androidId, now)).use {\n-            it.write(bytes2)\n-        }\n+        backend.save(LegacyAppBackupFile.Metadata(now), getSaver(bytes1))\n+        backend.save(FileBackupFileType.Snapshot(androidId, now), getSaver(bytes2))\n \n         var metadata: LegacyAppBackupFile.Metadata? = null\n         var fileSnapshot: FileBackupFileType.Snapshot? = null\n@@ -58,9 +55,7 @@ public abstract class BackendTest {\n         val blobName = Random.nextBytes(32).toHexString()\n         var blob: FileBackupFileType.Blob? = null\n         val bytes3 = Random.nextBytes(1337 * 16)\n-        backend.save(FileBackupFileType.Blob(androidId, blobName)).use {\n-            it.write(bytes3)\n-        }\n+        backend.save(FileBackupFileType.Blob(androidId, blobName), getSaver(bytes3))\n         backend.list(\n             null,\n             FileBackupFileType.Snapshot::class,\n@@ -91,9 +86,7 @@ public abstract class BackendTest {\n \n         val bytes4 = Random.nextBytes(1337)\n         val bytes5 = Random.nextBytes(1337 * 8)\n-        backend.save(AppBackupFileType.Snapshot(repoId, snapshotId)).use {\n-            it.write(bytes4)\n-        }\n+        backend.save(AppBackupFileType.Snapshot(repoId, snapshotId), getSaver(bytes4))\n \n         var appSnapshot: AppBackupFileType.Snapshot? = null\n         backend.list(\n@@ -108,9 +101,7 @@ public abstract class BackendTest {\n         assertNotNull(appSnapshot)\n         assertContentEquals(bytes4, backend.load(appSnapshot as FileHandle).readAllBytes())\n \n-        backend.save(AppBackupFileType.Blob(repoId, blobId)).use {\n-            it.write(bytes5)\n-        }\n+        backend.save(AppBackupFileType.Blob(repoId, blobId), getSaver(bytes5))\n \n         var blobHandle: AppBackupFileType.Blob? = null\n         backend.list(\n@@ -151,9 +142,7 @@ public abstract class BackendTest {\n \n         backend.remove(blob)\n         try {\n-            backend.save(blob).use {\n-                it.write(bytes)\n-            }\n+            backend.save(blob, getSaver(bytes))\n             assertContentEquals(bytes, backend.load(blob as FileHandle).readAllBytes())\n         } finally {\n             backend.remove(blob)\n@@ -170,13 +159,21 @@ public abstract class BackendTest {\n         val blob = AppBackupFileType.Blob(repoId, Random.nextBytes(32).toHexString())\n         val bytes = Random.nextBytes(2342)\n         try {\n-            backend.save(blob).use {\n-                it.write(bytes)\n-            }\n+            backend.save(blob, getSaver(bytes))\n             assertContentEquals(bytes, backend.load(blob as FileHandle).readAllBytes())\n         } finally {\n             backend.remove(blob)\n         }\n     }\n \n+    private fun getSaver(bytes: ByteArray) = object : BackendSaver {\n+        override val size: Long = bytes.size.toLong()\n+        override val sha256: String? = null\n+\n+        override fun save(outputStream: OutputStream): Long {\n+            outputStream.write(bytes)\n+            return size\n+        }\n+    }\n+\n }\ndiff --git a/core/src/main/java/org/calyxos/seedvault/core/backends/IBackendManager.kt b/core/src/main/java/org/calyxos/seedvault/core/backends/IBackendManager.kt\nindex 7b4feb4b0..785f309e6 100644\n--- a/core/src/main/java/org/calyxos/seedvault/core/backends/IBackendManager.kt\n+++ b/core/src/main/java/org/calyxos/seedvault/core/backends/IBackendManager.kt\n@@ -10,3 +10,8 @@ public interface IBackendManager {\n     public val isOnRemovableDrive: Boolean\n     public val requiresNetwork: Boolean\n }\n+\n+public enum class BackendId {\n+    SAF,\n+    WEBDAV,\n+}\ndiff --git a/core/src/main/java/org/calyxos/seedvault/core/backends/RetryBackend.kt b/core/src/main/java/org/calyxos/seedvault/core/backends/RetryBackend.kt\nnew file mode 100644\nindex 000000000..1cfdf9904\n--- /dev/null\n+++ b/core/src/main/java/org/calyxos/seedvault/core/backends/RetryBackend.kt\n@@ -0,0 +1,87 @@\n+/*\n+ * SPDX-FileCopyrightText: 2025 The Calyx Institute\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package org.calyxos.seedvault.core.backends\n+\n+import androidx.annotation.VisibleForTesting\n+import io.github.oshai.kotlinlogging.KotlinLogging\n+import kotlinx.coroutines.delay\n+import java.io.InputStream\n+import kotlin.reflect.KClass\n+\n+@VisibleForTesting\n+internal const val MAX_RETRIES = 5\n+private const val LINEAR_DELAY_MS = 2500L\n+\n+internal class RetryBackend(private val delegate: Backend) : Backend {\n+\n+    private val log = KotlinLogging.logger { }\n+\n+    override val id: BackendId = delegate.id\n+\n+    override suspend fun test(): Boolean = retry {\n+        delegate.test()\n+    }\n+\n+    override suspend fun getFreeSpace(): Long? = retry {\n+        delegate.getFreeSpace()\n+    }\n+\n+    override suspend fun save(handle: FileHandle, saver: BackendSaver): Long = retry {\n+        // TODO need to delete failed file?\n+        delegate.save(handle, saver)\n+    }\n+\n+    override suspend fun load(handle: FileHandle): InputStream = retry {\n+        delegate.load(handle)\n+    }\n+\n+    override suspend fun list(\n+        topLevelFolder: TopLevelFolder?,\n+        vararg fileTypes: KClass<out FileHandle>,\n+        callback: (FileInfo) -> Unit\n+    ) = retry {\n+        delegate.list(topLevelFolder, *fileTypes, callback = callback)\n+    }\n+\n+    override suspend fun remove(handle: FileHandle) = retry {\n+        delegate.remove(handle)\n+    }\n+\n+    override suspend fun rename(from: TopLevelFolder, to: TopLevelFolder) = retry {\n+        delegate.rename(from, to)\n+    }\n+\n+    @VisibleForTesting\n+    override suspend fun removeAll() = retry {\n+        delegate.removeAll()\n+    }\n+\n+    override fun isTransientException(e: Exception): Boolean = delegate.isTransientException(e)\n+\n+    private suspend fun <T> retry(block: suspend () -> T): T {\n+        return retry(0, 0, block)\n+    }\n+\n+    private suspend fun <T> retry(retries: Int, delayMs: Long, block: suspend () -> T): T {\n+        try {\n+            return block()\n+        } catch (e: Exception) {\n+            val newRetries = retries + 1\n+            // We are not using exponential backoff,\n+            // because the system backup API has some strict timeouts and running into them is bad.\n+            val newDelayMs = delayMs + LINEAR_DELAY_MS\n+            if (newRetries < MAX_RETRIES && isTransientException(e)) {\n+                log.warn(e) { \"Retrying #$newRetries after error and delay ${newDelayMs}ms: \" }\n+                delay(newDelayMs)\n+                return retry(newRetries, newDelayMs, block)\n+            } else {\n+                throw e\n+            }\n+        }\n+    }\n+\n+    override val providerPackageName: String? get() = delegate.providerPackageName\n+}\ndiff --git a/core/src/main/java/org/calyxos/seedvault/core/backends/saf/DocumentFileCache.kt b/core/src/main/java/org/calyxos/seedvault/core/backends/saf/DocumentFileCache.kt\nindex eb8459952..8db103af6 100644\n--- a/core/src/main/java/org/calyxos/seedvault/core/backends/saf/DocumentFileCache.kt\n+++ b/core/src/main/java/org/calyxos/seedvault/core/backends/saf/DocumentFileCache.kt\n@@ -28,36 +28,43 @@ internal class DocumentFileCache(\n         }\n     }\n \n-    internal suspend fun getOrCreateFile(fh: FileHandle): DocumentFile = when (fh) {\n-        is TopLevelFolder -> cache.getOrPut(\"$root/${fh.relativePath}\") {\n-            getRootFile().getOrCreateDirectory(context, fh.name)\n-        }\n-\n-        is AppBackupFileType.Blob -> {\n-            val subFolderName = fh.name.substring(0, 2)\n-            cache.getOrPut(\"$root/${fh.topLevelFolder.name}/$subFolderName\") {\n-                getOrCreateFile(fh.topLevelFolder).getOrCreateDirectory(context, subFolderName)\n-            }.getOrCreateFile(context, fh.name)\n-        }\n-\n-        is AppBackupFileType.Snapshot -> {\n-            getOrCreateFile(fh.topLevelFolder).getOrCreateFile(context, fh.name)\n-        }\n-\n-        is FileBackupFileType.Blob -> {\n-            val subFolderName = fh.name.substring(0, 2)\n-            cache.getOrPut(\"$root/${fh.topLevelFolder.name}/$subFolderName\") {\n-                getOrCreateFile(fh.topLevelFolder).getOrCreateDirectory(context, subFolderName)\n-            }.getOrCreateFile(context, fh.name)\n-        }\n-\n-        is FileBackupFileType.Snapshot -> {\n-            getOrCreateFile(fh.topLevelFolder).getOrCreateFile(context, fh.name)\n-        }\n-\n-        is LegacyAppBackupFile -> cache.getOrPut(\"$root/${fh.relativePath}\") {\n-            getOrCreateFile(fh.topLevelFolder).getOrCreateFile(context, fh.name)\n+    internal suspend fun getOrCreateFile(fh: FileHandle): DocumentFile = try {\n+        when (fh) {\n+            is TopLevelFolder -> cache.getOrPut(\"$root/${fh.relativePath}\") {\n+                getRootFile().getOrCreateDirectory(context, fh.name)\n+            }\n+\n+            is AppBackupFileType.Blob -> {\n+                val subFolderName = fh.name.substring(0, 2)\n+                cache.getOrPut(\"$root/${fh.topLevelFolder.name}/$subFolderName\") {\n+                    getOrCreateFile(fh.topLevelFolder).getOrCreateDirectory(context, subFolderName)\n+                }.getOrCreateFile(context, fh.name)\n+            }\n+\n+            is AppBackupFileType.Snapshot -> {\n+                getOrCreateFile(fh.topLevelFolder).getOrCreateFile(context, fh.name)\n+            }\n+\n+            is FileBackupFileType.Blob -> {\n+                val subFolderName = fh.name.substring(0, 2)\n+                cache.getOrPut(\"$root/${fh.topLevelFolder.name}/$subFolderName\") {\n+                    getOrCreateFile(fh.topLevelFolder).getOrCreateDirectory(context, subFolderName)\n+                }.getOrCreateFile(context, fh.name)\n+            }\n+\n+            is FileBackupFileType.Snapshot -> {\n+                getOrCreateFile(fh.topLevelFolder).getOrCreateFile(context, fh.name)\n+            }\n+\n+            is LegacyAppBackupFile -> cache.getOrPut(\"$root/${fh.relativePath}\") {\n+                getOrCreateFile(fh.topLevelFolder).getOrCreateFile(context, fh.name)\n+            }\n         }\n+    } catch (e: IllegalArgumentException) {\n+        if (e.message?.contains(\"Missing file for\") == true) {\n+            clearAll() // clear cache as files may have been messed with, need re-caching\n+            throw SafRetryException(e)\n+        } else throw e\n     }\n \n     internal suspend fun getFile(fh: FileHandle): DocumentFile? = when (fh) {\ndiff --git a/core/src/main/java/org/calyxos/seedvault/core/backends/saf/SafBackend.kt b/core/src/main/java/org/calyxos/seedvault/core/backends/saf/SafBackend.kt\nindex d23121f41..37c656420 100644\n--- a/core/src/main/java/org/calyxos/seedvault/core/backends/saf/SafBackend.kt\n+++ b/core/src/main/java/org/calyxos/seedvault/core/backends/saf/SafBackend.kt\n@@ -6,6 +6,7 @@\n package org.calyxos.seedvault.core.backends.saf\n \n import android.content.Context\n+import android.database.StaleDataException\n import android.os.Environment\n import android.os.StatFs\n import android.provider.DocumentsContract\n@@ -18,6 +19,8 @@ import io.github.oshai.kotlinlogging.KLogger\n import io.github.oshai.kotlinlogging.KotlinLogging\n import org.calyxos.seedvault.core.backends.AppBackupFileType\n import org.calyxos.seedvault.core.backends.Backend\n+import org.calyxos.seedvault.core.backends.BackendId\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.backends.Constants.DIRECTORY_ROOT\n import org.calyxos.seedvault.core.backends.Constants.FILE_BACKUP_METADATA\n import org.calyxos.seedvault.core.backends.Constants.appSnapshotRegex\n@@ -36,7 +39,6 @@ import org.calyxos.seedvault.core.backends.LegacyAppBackupFile\n import org.calyxos.seedvault.core.backends.TopLevelFolder\n import java.io.IOException\n import java.io.InputStream\n-import java.io.OutputStream\n import kotlin.reflect.KClass\n \n internal const val AUTHORITY_STORAGE = \"com.android.externalstorage.documents\"\n@@ -54,6 +56,8 @@ public class SafBackend(\n \n     private val cache = DocumentFileCache(context, safProperties.getDocumentFile(context), root)\n \n+    override val id: BackendId = BackendId.SAF\n+\n     override suspend fun test(): Boolean {\n         log.debugLog { \"test()\" }\n         return cache.getRootFile().isDirectory\n@@ -86,10 +90,10 @@ public class SafBackend(\n         } else bytesAvailable\n     }\n \n-    override suspend fun save(handle: FileHandle): OutputStream {\n+    override suspend fun save(handle: FileHandle, saver: BackendSaver): Long {\n         log.debugLog { \"save($handle)\" }\n         val file = cache.getOrCreateFile(handle)\n-        return file.getOutputStream(context.contentResolver)\n+        return file.getOutputStream(context.contentResolver).use { saver.save(it) }\n     }\n \n     override suspend fun load(handle: FileHandle): InputStream {\n@@ -233,6 +237,15 @@ public class SafBackend(\n         }\n     }\n \n+    override fun isTransientException(e: Exception): Boolean {\n+        if (e is SafRetryException) return true\n+        if (e is StaleDataException && e.message?.contains(\"closed\") == true) return true\n+        if (e.cause is StaleDataException &&\n+            (e.cause as StaleDataException).message?.contains(\"closed\") == true\n+        ) return true\n+        return false\n+    }\n+\n     override val providerPackageName: String? by lazy {\n         log.debugLog { \"providerPackageName\" }\n         val authority = safProperties.uri.authority ?: return@lazy null\ndiff --git a/core/src/main/java/org/calyxos/seedvault/core/backends/saf/SafHelper.kt b/core/src/main/java/org/calyxos/seedvault/core/backends/saf/SafHelper.kt\nindex 46682e45e..e99a87529 100644\n--- a/core/src/main/java/org/calyxos/seedvault/core/backends/saf/SafHelper.kt\n+++ b/core/src/main/java/org/calyxos/seedvault/core/backends/saf/SafHelper.kt\n@@ -10,6 +10,7 @@ import android.content.ContentResolver\n import android.content.Context\n import android.database.ContentObserver\n import android.database.Cursor\n+import android.database.StaleDataException\n import android.net.Uri\n import android.provider.DocumentsContract.Document.COLUMN_DOCUMENT_ID\n import android.provider.DocumentsContract.EXTRA_LOADING\n@@ -64,7 +65,8 @@ internal fun DocumentFile.createFileOrThrow(\n     name: String,\n     mimeType: String = MIME_TYPE,\n ): DocumentFile {\n-    val file = createFile(mimeType, name) ?: throw IOException(\"Unable to create file: $name\")\n+    val file = createFile(mimeType, name)\n+        ?: throw SafRetryException(IOException(\"Unable to create file: $name\"))\n     if (file.name != name) {\n         file.delete()\n         if (file.name == null) { // this happens when file existed already\n@@ -72,7 +74,8 @@ internal fun DocumentFile.createFileOrThrow(\n             val foundFile = findFile(name)\n             if (foundFile?.name == name) return foundFile\n         }\n-        throw IOException(\"Wanted to create $name, but got ${file.name}\")\n+        val e = IOException(\"Wanted to create $name, but got ${file.name}\")\n+        throw SafRetryException(e)\n     }\n     return file\n }\n@@ -88,10 +91,11 @@ public suspend fun DocumentFile.getOrCreateDirectory(context: Context, name: Str\n @Throws(IOException::class)\n public fun DocumentFile.createDirectoryOrThrow(name: String): DocumentFile {\n     val directory = createDirectory(name)\n-        ?: throw IOException(\"Unable to create directory: $name\")\n+        ?: throw SafRetryException(IOException(\"Unable to create directory: $name\"))\n     if (directory.name != name) {\n         directory.delete()\n-        throw IOException(\"Wanted to directory $name, but got ${directory.name}\")\n+        val e = IOException(\"Wanted to create directory $name, but got ${directory.name}\")\n+        throw SafRetryException(e)\n     }\n     return directory\n }\n@@ -114,6 +118,8 @@ public suspend fun DocumentFile.listFilesBlocking(context: Context): List<Docume\n         }\n     } catch (e: TimeoutCancellationException) {\n         throw IOException(e)\n+    } catch (e: StaleDataException) {\n+        throw IOException(e)\n     }.use { cursor ->\n         while (cursor.moveToNext()) {\n             val documentId = cursor.getString(0)\n@@ -164,6 +170,7 @@ public suspend fun DocumentFile.findFileBlocking(\n         listFilesBlocking(context)\n     } catch (e: IOException) {\n         Log.e(TAG, \"Error finding file blocking\", e)\n+        if (e is SafRetryException) throw e\n         return null\n     }\n     for (doc in files) {\n@@ -194,8 +201,11 @@ public suspend fun DocumentFile.findFileBlocking(\n public suspend fun getLoadedCursor(timeout: Long = 15_000, query: () -> Cursor?): Cursor =\n     withTimeout(timeout) {\n         suspendCancellableCoroutine { cont ->\n-            val cursor = query() ?: throw IOException()\n-            cont.invokeOnCancellation { cursor.close() }\n+            val cursor = query() ?: throw SafRetryException(IOException(\"null cursor\"))\n+            cont.invokeOnCancellation {\n+                Log.i(TAG, \"Closing cursor after getLoadedCursor() got cancelled\")\n+                cursor.close()\n+            }\n             val loading = cursor.extras.getBoolean(EXTRA_LOADING, false)\n             if (loading) {\n                 Log.d(TAG, \"Wait for children to get loaded...\")\n@@ -215,3 +225,5 @@ public suspend fun getLoadedCursor(timeout: Long = 15_000, query: () -> Cursor?)\n             }\n         }\n     }\n+\n+internal class SafRetryException(e: Exception) : IOException(e)\ndiff --git a/core/src/main/java/org/calyxos/seedvault/core/backends/webdav/PipedCloseActionOutputStream.kt b/core/src/main/java/org/calyxos/seedvault/core/backends/webdav/PipedCloseActionOutputStream.kt\ndeleted file mode 100644\nindex 377a8c3ea..000000000\n--- a/core/src/main/java/org/calyxos/seedvault/core/backends/webdav/PipedCloseActionOutputStream.kt\n+++ /dev/null\n@@ -1,58 +0,0 @@\n-/*\n- * SPDX-FileCopyrightText: 2024 The Calyx Institute\n- * SPDX-License-Identifier: Apache-2.0\n- */\n-\n-package org.calyxos.seedvault.core.backends.webdav\n-\n-import java.io.IOException\n-import java.io.PipedInputStream\n-import java.io.PipedOutputStream\n-\n-internal class PipedCloseActionOutputStream(\n-    inputStream: PipedInputStream,\n-) : PipedOutputStream(inputStream) {\n-\n-    private var onClose: (() -> Unit)? = null\n-\n-    override fun write(b: Int) {\n-        try {\n-            super.write(b)\n-        } catch (e: Exception) {\n-            try {\n-                onClose?.invoke()\n-            } catch (closeException: Exception) {\n-                e.addSuppressed(closeException)\n-            }\n-            throw e\n-        }\n-    }\n-\n-    override fun write(b: ByteArray, off: Int, len: Int) {\n-        try {\n-            super.write(b, off, len)\n-        } catch (e: Exception) {\n-            try {\n-                onClose?.invoke()\n-            } catch (closeException: Exception) {\n-                e.addSuppressed(closeException)\n-            }\n-            throw e\n-        }\n-    }\n-\n-    @Throws(IOException::class)\n-    override fun close() {\n-        super.close()\n-        try {\n-            onClose?.invoke()\n-        } catch (e: Exception) {\n-            if (e is IOException) throw e\n-            else throw IOException(e)\n-        }\n-    }\n-\n-    fun doOnClose(function: () -> Unit) {\n-        this.onClose = function\n-    }\n-}\ndiff --git a/core/src/main/java/org/calyxos/seedvault/core/backends/webdav/WebDavBackend.kt b/core/src/main/java/org/calyxos/seedvault/core/backends/webdav/WebDavBackend.kt\nindex d42fb9b7f..0ad397795 100644\n--- a/core/src/main/java/org/calyxos/seedvault/core/backends/webdav/WebDavBackend.kt\n+++ b/core/src/main/java/org/calyxos/seedvault/core/backends/webdav/WebDavBackend.kt\n@@ -13,20 +13,18 @@ import at.bitfire.dav4jvm.exception.NotFoundException\n import at.bitfire.dav4jvm.property.webdav.QuotaAvailableBytes\n import io.github.oshai.kotlinlogging.KLogger\n import io.github.oshai.kotlinlogging.KotlinLogging\n-import kotlinx.coroutines.DelicateCoroutinesApi\n-import kotlinx.coroutines.Dispatchers\n-import kotlinx.coroutines.GlobalScope\n-import kotlinx.coroutines.async\n-import kotlinx.coroutines.runBlocking\n import okhttp3.ConnectionSpec\n import okhttp3.HttpUrl\n import okhttp3.HttpUrl.Companion.toHttpUrl\n import okhttp3.MediaType.Companion.toMediaType\n import okhttp3.OkHttpClient\n import okhttp3.RequestBody\n+import okhttp3.internal.http2.StreamResetException\n import okio.BufferedSink\n import org.calyxos.seedvault.core.backends.AppBackupFileType\n import org.calyxos.seedvault.core.backends.Backend\n+import org.calyxos.seedvault.core.backends.BackendId\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.backends.Constants.DIRECTORY_ROOT\n import org.calyxos.seedvault.core.backends.Constants.FILE_BACKUP_METADATA\n import org.calyxos.seedvault.core.backends.Constants.appSnapshotRegex\n@@ -42,10 +40,11 @@ import org.calyxos.seedvault.core.backends.FileHandle\n import org.calyxos.seedvault.core.backends.FileInfo\n import org.calyxos.seedvault.core.backends.LegacyAppBackupFile\n import org.calyxos.seedvault.core.backends.TopLevelFolder\n+import java.io.EOFException\n import java.io.IOException\n import java.io.InputStream\n-import java.io.OutputStream\n-import java.io.PipedInputStream\n+import java.net.SocketTimeoutException\n+import java.net.UnknownHostException\n import java.util.concurrent.TimeUnit\n import kotlin.coroutines.resume\n import kotlin.coroutines.suspendCoroutine\n@@ -53,7 +52,6 @@ import kotlin.reflect.KClass\n \n private const val DEBUG_LOG = true\n \n-@OptIn(DelicateCoroutinesApi::class)\n public class WebDavBackend(\n     webDavConfig: WebDavConfig,\n     root: String = DIRECTORY_ROOT,\n@@ -61,6 +59,8 @@ public class WebDavBackend(\n \n     private val log = KotlinLogging.logger {}\n \n+    override val id: BackendId = BackendId.WEBDAV\n+\n     private val authHandler = BasicDigestAuthHandler(\n         domain = null, // Optional, to only authenticate against hosts with this domain.\n         username = webDavConfig.username,\n@@ -121,36 +121,25 @@ public class WebDavBackend(\n         return availableBytes\n     }\n \n-    override suspend fun save(handle: FileHandle): OutputStream {\n+    override suspend fun save(handle: FileHandle, saver: BackendSaver): Long {\n         val location = handle.toHttpUrl()\n         val davCollection = DavCollection(okHttpClient, location)\n         davCollection.ensureFoldersExist(log, folders)\n \n-        val pipedInputStream = PipedInputStream()\n-        val pipedOutputStream = PipedCloseActionOutputStream(pipedInputStream)\n-\n         val body = object : RequestBody() {\n             override fun isOneShot(): Boolean = true\n             override fun contentType() = \"application/octet-stream\".toMediaType()\n+            override fun contentLength(): Long = saver.size\n             override fun writeTo(sink: BufferedSink) {\n-                pipedInputStream.use { inputStream ->\n-                    sink.outputStream().use { outputStream ->\n-                        inputStream.copyTo(outputStream)\n-                    }\n-                }\n+                saver.save(sink.outputStream())\n             }\n         }\n-        val deferred = GlobalScope.async(Dispatchers.IO) {\n+        return suspendCoroutine { cont ->\n             davCollection.put(body) { response ->\n                 log.debugLog { \"save($location) = $response\" }\n+                cont.resume(saver.size)\n             }\n         }\n-        pipedOutputStream.doOnClose {\n-            runBlocking { // blocking i/o wait\n-                deferred.await()\n-            }\n-        }\n-        return pipedOutputStream\n     }\n \n     override suspend fun load(handle: FileHandle): InputStream {\n@@ -361,6 +350,20 @@ public class WebDavBackend(\n         }\n     }\n \n+    override fun isTransientException(e: Exception): Boolean {\n+        if (e is SocketTimeoutException) {\n+            return true\n+        } else if (e is UnknownHostException) {\n+            return true // gets thrown when phone leaves WiFi range\n+        } else if (e is StreamResetException) {\n+            // https://github.com/seedvault-app/seedvault/pull/835#issuecomment-2591170084\n+            return true\n+        } else if (e is EOFException && e.message?.contains(\"\\\\n not found\") == true) {\n+            return true\n+        }\n+        return false\n+    }\n+\n     override val providerPackageName: String? = null // 100% built-in plugin\n \n     private fun FileHandle.toHttpUrl(): HttpUrl = when (this) {\ndiff --git a/core/src/test/java/org/calyxos/seedvault/core/backends/RetryBackendTest.kt b/core/src/test/java/org/calyxos/seedvault/core/backends/RetryBackendTest.kt\nnew file mode 100644\nindex 000000000..6c747be9f\n--- /dev/null\n+++ b/core/src/test/java/org/calyxos/seedvault/core/backends/RetryBackendTest.kt\n@@ -0,0 +1,66 @@\n+/*\n+ * SPDX-FileCopyrightText: 2025 The Calyx Institute\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package org.calyxos.seedvault.core.backends\n+\n+import io.mockk.coEvery\n+import io.mockk.coVerify\n+import io.mockk.every\n+import io.mockk.mockk\n+import io.mockk.verify\n+import kotlinx.coroutines.test.runTest\n+import java.io.IOException\n+import kotlin.test.Test\n+import kotlin.test.assertFailsWith\n+import kotlin.test.assertTrue\n+\n+internal class RetryBackendTest {\n+\n+    private val delegate: Backend = mockk()\n+\n+    init {\n+        every { delegate.id } returns BackendId.WEBDAV\n+    }\n+\n+    private val backend = RetryBackend(delegate)\n+\n+    @Test\n+    fun `test retry works at last attempt`() = runTest {\n+        val e = IOException()\n+        coEvery {\n+            delegate.test()\n+        } throws e andThenThrows e andThenThrows e andThenThrows e andThen true\n+        every { delegate.isTransientException(e) } returns true\n+\n+        assertTrue(backend.test())\n+        verify(exactly = MAX_RETRIES - 1) {\n+            delegate.isTransientException(e)\n+        }\n+    }\n+\n+    @Test\n+    fun `test retry fails after max attempts reached`() = runTest {\n+        val e = IOException()\n+        coEvery { delegate.test() } throws e\n+        every { delegate.isTransientException(e) } returns true\n+\n+        assertFailsWith<IOException> {\n+            backend.test()\n+        }\n+        coVerify(exactly = MAX_RETRIES) { delegate.test() }\n+    }\n+\n+    @Test\n+    fun `test no retry because non-transient exception`() = runTest {\n+        val e = IOException()\n+        coEvery { delegate.test() } throws e\n+        every { delegate.isTransientException(e) } returns false\n+\n+        assertFailsWith<IOException> {\n+            backend.test()\n+        }\n+        coVerify(exactly = 1) { delegate.test() } // no retries\n+    }\n+}\ndiff --git a/storage/demo/src/main/java/de/grobox/storagebackuptester/plugin/TestSafBackend.kt b/storage/demo/src/main/java/de/grobox/storagebackuptester/plugin/TestSafBackend.kt\nindex 514c58db8..a416424c6 100644\n--- a/storage/demo/src/main/java/de/grobox/storagebackuptester/plugin/TestSafBackend.kt\n+++ b/storage/demo/src/main/java/de/grobox/storagebackuptester/plugin/TestSafBackend.kt\n@@ -8,6 +8,8 @@ package de.grobox.storagebackuptester.plugin\n import android.content.Context\n import android.net.Uri\n import org.calyxos.seedvault.core.backends.Backend\n+import org.calyxos.seedvault.core.backends.BackendId\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.backends.FileHandle\n import org.calyxos.seedvault.core.backends.FileInfo\n import org.calyxos.seedvault.core.backends.TopLevelFolder\n@@ -37,14 +39,15 @@ class TestSafBackend(\n             // oops\n         }\n     }\n+    override val id: BackendId get() = delegate.id\n \n     override suspend fun test(): Boolean = delegate.test()\n \n     override suspend fun getFreeSpace(): Long? = delegate.getFreeSpace()\n \n-    override suspend fun save(handle: FileHandle): OutputStream {\n-        if (getLocationUri() == null) return nullStream\n-        return delegate.save(handle)\n+    override suspend fun save(handle: FileHandle, saver: BackendSaver): Long {\n+        if (getLocationUri() == null) return 0\n+        return delegate.save(handle, saver)\n     }\n \n     override suspend fun load(handle: FileHandle): InputStream {\n@@ -65,6 +68,8 @@ class TestSafBackend(\n \n     override suspend fun removeAll() = delegate.removeAll()\n \n+    override fun isTransientException(e: Exception): Boolean = false\n+\n     override val providerPackageName: String? get() = delegate.providerPackageName\n \n }\ndiff --git a/storage/lib/Android.bp b/storage/lib/Android.bp\nindex 6a49cbe22..6d4c4212f 100644\n--- a/storage/lib/Android.bp\n+++ b/storage/lib/Android.bp\n@@ -32,6 +32,7 @@ android_library {\n         \"com.google.android.material_material\",\n         \"kotlinx-coroutines-android\",\n         \"kotlinx-coroutines-core\",\n+        \"okio-lib\",\n     ],\n     plugins: [\n         \"androidx.room_room-compiler-plugin\",\ndiff --git a/storage/lib/build.gradle.kts b/storage/lib/build.gradle.kts\nindex 0f714c16b..174e2fd75 100644\n--- a/storage/lib/build.gradle.kts\n+++ b/storage/lib/build.gradle.kts\n@@ -103,6 +103,7 @@ dependencies {\n     implementation(libs.google.material)\n     implementation(libs.androidx.room.runtime)\n     implementation(libs.google.protobuf.javalite)\n+    implementation(libs.squareup.okio)\n \n     ksp(group = \"androidx.room\", name = \"room-compiler\", version = libs.versions.room.get())\n     lintChecks(libs.thirdegg.lint.rules)\ndiff --git a/storage/lib/src/main/java/org/calyxos/backup/storage/api/StorageBackup.kt b/storage/lib/src/main/java/org/calyxos/backup/storage/api/StorageBackup.kt\nindex 8ed06019b..3ac6d8f4a 100644\n--- a/storage/lib/src/main/java/org/calyxos/backup/storage/api/StorageBackup.kt\n+++ b/storage/lib/src/main/java/org/calyxos/backup/storage/api/StorageBackup.kt\n@@ -166,6 +166,8 @@ public class StorageBackup(\n             backend.getCurrentBackupSnapshots(androidId).forEach {\n                 val handle = FileBackupFileType.Snapshot(androidId, it.timestamp)\n                 try {\n+                    // TODO could we not only delete snapshots that we cannot decrypt here?\n+                    //  ChunksCacheRepopulater should be able to restore refCounts\n                     backend.remove(handle)\n                 } catch (e: IOException) {\n                     Log.e(TAG, \"Error deleting snapshot $it\", e)\ndiff --git a/storage/lib/src/main/java/org/calyxos/backup/storage/backup/Backup.kt b/storage/lib/src/main/java/org/calyxos/backup/storage/backup/Backup.kt\nindex 3b52c419a..669d95589 100644\n--- a/storage/lib/src/main/java/org/calyxos/backup/storage/backup/Backup.kt\n+++ b/storage/lib/src/main/java/org/calyxos/backup/storage/backup/Backup.kt\n@@ -11,6 +11,7 @@ import android.content.pm.PackageManager.PERMISSION_GRANTED\n import android.os.Build\n import android.text.format.Formatter\n import android.util.Log\n+import okio.Buffer\n import org.calyxos.backup.storage.api.BackupObserver\n import org.calyxos.backup.storage.crypto.ChunkCrypto\n import org.calyxos.backup.storage.crypto.StreamCrypto\n@@ -18,11 +19,14 @@ import org.calyxos.backup.storage.db.Db\n import org.calyxos.backup.storage.measure\n import org.calyxos.backup.storage.scanner.FileScanner\n import org.calyxos.backup.storage.scanner.FileScannerResult\n+import org.calyxos.seedvault.core.MemoryLogger\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.backends.FileBackupFileType\n import org.calyxos.seedvault.core.backends.IBackendManager\n import org.calyxos.seedvault.core.backends.TopLevelFolder\n import org.calyxos.seedvault.core.crypto.KeyManager\n import java.io.IOException\n+import java.io.OutputStream\n import java.security.GeneralSecurityException\n import kotlin.time.Duration\n \n@@ -143,15 +147,18 @@ internal class Backup(\n         val smallResult = measure(\"Backing up $numSmallFiles small files\") {\n             smallFileBackup.backupFiles(filesResult.smallFiles, availableChunkIds, backupObserver)\n         }\n+        MemoryLogger.log()\n         val numLargeFiles = filesResult.files.size\n         val largeResult = measure(\"Backing up $numLargeFiles files\") {\n             fileBackup.backupFiles(filesResult.files, availableChunkIds, backupObserver)\n         }\n+        MemoryLogger.log()\n         val result = largeResult + smallResult\n         if (result.isEmpty) return // TODO maybe warn user that nothing could get backed up?\n         val backupSize = result.backupMediaFiles.sumOf { it.size } +\n             result.backupDocumentFiles.sumOf { it.size }\n         val endTime = System.currentTimeMillis()\n+        MemoryLogger.log()\n \n         val backupSnapshot: BackupSnapshot\n         val snapshotWriteTime = measure {\n@@ -164,15 +171,25 @@ internal class Backup(\n                 .setTimeStart(startTime)\n                 .setTimeEnd(endTime)\n                 .build()\n+            val buffer = Buffer()\n+            buffer.writeByte(VERSION.toInt())\n+            val ad = streamCrypto.getAssociatedDataForSnapshot(startTime)\n+            streamCrypto.newEncryptingStream(streamKey, buffer.outputStream(), ad).use { stream ->\n+                backupSnapshot.writeTo(stream)\n+            }\n+            MemoryLogger.log()\n             val fileHandle = FileBackupFileType.Snapshot(androidId, startTime)\n-            backend.save(fileHandle).use { outputStream ->\n-                outputStream.write(VERSION.toInt())\n-                val ad = streamCrypto.getAssociatedDataForSnapshot(startTime)\n-                streamCrypto.newEncryptingStream(streamKey, outputStream, ad)\n-                    .use { encryptingStream ->\n-                        backupSnapshot.writeTo(encryptingStream)\n-                    }\n+            val saver = object : BackendSaver {\n+                override val size: Long = buffer.size\n+                override val sha256: String? = null\n+                override fun save(outputStream: OutputStream): Long {\n+                    buffer.copyTo(outputStream)\n+                    return size\n+                }\n             }\n+            backend.save(fileHandle, saver)\n+            buffer.clear()\n+            MemoryLogger.log()\n         }\n         val snapshotSize = backupSnapshot.serializedSize.toLong()\n         val snapshotSizeStr = Formatter.formatShortFileSize(context, snapshotSize)\ndiff --git a/storage/lib/src/main/java/org/calyxos/backup/storage/backup/BackupJobService.kt b/storage/lib/src/main/java/org/calyxos/backup/storage/backup/BackupJobService.kt\nindex a84cb33fa..33329cc7e 100644\n--- a/storage/lib/src/main/java/org/calyxos/backup/storage/backup/BackupJobService.kt\n+++ b/storage/lib/src/main/java/org/calyxos/backup/storage/backup/BackupJobService.kt\n@@ -42,7 +42,11 @@ public abstract class BackupJobService(private val serviceClass: Class<out Servi\n                 .setPersisted(true)\n             if (networkType != null) jobInfoBuilder.setRequiredNetworkType(networkType)\n             val jobScheduler: JobScheduler = context.getSystemService(JobScheduler::class.java)\n-            jobScheduler.schedule(jobInfoBuilder.build())\n+            val result = jobScheduler.schedule(jobInfoBuilder.build())\n+\n+            val hours = periodMillis / 1000 / 60 / 60\n+            Log.i(TAG, \"Scheduled file backup every $hours hours: $result\")\n+            Log.i(TAG, \"   (idle=$deviceIdle, charging=$charging, networkType=$networkType\")\n         }\n \n         public fun isScheduled(context: Context): Boolean {\ndiff --git a/storage/lib/src/main/java/org/calyxos/backup/storage/backup/BackupService.kt b/storage/lib/src/main/java/org/calyxos/backup/storage/backup/BackupService.kt\nindex 4013392d1..6227e0f1f 100644\n--- a/storage/lib/src/main/java/org/calyxos/backup/storage/backup/BackupService.kt\n+++ b/storage/lib/src/main/java/org/calyxos/backup/storage/backup/BackupService.kt\n@@ -46,9 +46,10 @@ public abstract class BackupService : Service() {\n                 storageBackup.pruneOldBackups(backupObserver)\n             }\n             onBackupFinished(intent, success)\n+            Log.d(TAG, \"stopSelf($startId)\")\n             stopSelf(startId)\n         }\n-        return super.onStartCommand(intent, flags, startId)\n+        return START_NOT_STICKY\n     }\n \n     protected open fun onBackupFinished(intent: Intent, success: Boolean) {\ndiff --git a/storage/lib/src/main/java/org/calyxos/backup/storage/backup/ChunkWriter.kt b/storage/lib/src/main/java/org/calyxos/backup/storage/backup/ChunkWriter.kt\nindex 0e8b78d68..fbd5e0d0a 100644\n--- a/storage/lib/src/main/java/org/calyxos/backup/storage/backup/ChunkWriter.kt\n+++ b/storage/lib/src/main/java/org/calyxos/backup/storage/backup/ChunkWriter.kt\n@@ -6,9 +6,13 @@\n package org.calyxos.backup.storage.backup\n \n import android.util.Log\n+import kotlinx.coroutines.sync.Semaphore\n+import kotlinx.coroutines.sync.withPermit\n+import okio.Buffer\n import org.calyxos.backup.storage.backup.Backup.Companion.VERSION\n import org.calyxos.backup.storage.crypto.StreamCrypto\n import org.calyxos.backup.storage.db.ChunksCache\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.backends.FileBackupFileType\n import org.calyxos.seedvault.core.backends.IBackendManager\n import java.io.ByteArrayOutputStream\n@@ -37,7 +41,9 @@ internal class ChunkWriter(\n ) {\n \n     private val backend get() = backendManager.backend\n-    private val buffer = ByteArray(bufferSize)\n+    private val semaphore = Semaphore(1)\n+    private val byteBuffer = ByteArray(bufferSize)\n+    private val buffer = Buffer()\n \n     @Throws(IOException::class, GeneralSecurityException::class)\n     suspend fun writeChunk(\n@@ -54,12 +60,12 @@ internal class ChunkWriter(\n             val notCached = cachedChunk == null\n             if (isMissing) Log.w(TAG, \"Chunk ${chunk.id} is missing (cached: ${!notCached})\")\n             if (notCached || isMissing) { // chunk not in storage\n-                writeChunkData(chunk.id) { encryptingStream ->\n+                val size = writeChunkData(chunk.id) { encryptingStream ->\n                     copyChunkFromInputStream(inputStream, chunk, encryptingStream)\n                 }\n-                if (notCached) chunksCache.insert(chunk.toCachedChunk())\n+                if (notCached) chunksCache.insert(chunk.toCachedChunk(size))\n                 writtenChunks++\n-                writtenBytes += chunk.plaintextSize\n+                writtenBytes += size\n             } else { // chunk already uploaded\n                 val skipped = inputStream.skip(chunk.plaintextSize)\n                 check(chunk.plaintextSize == skipped) { \"skipping error\" }\n@@ -67,19 +73,30 @@ internal class ChunkWriter(\n         }\n         val endByte = inputStream.read()\n         check(endByte == -1) { \"Stream did continue with $endByte\" }\n-        // FIXME the writtenBytes are based on plaintext size, not ciphertext size\n-        //  However, they don't seem to be really used for anything at the moment.\n         return ChunkWriterResult(writtenChunks, writtenBytes)\n     }\n \n     @Throws(IOException::class, GeneralSecurityException::class)\n-    private suspend fun writeChunkData(chunkId: String, writer: (OutputStream) -> Unit) {\n+    private suspend fun writeChunkData(chunkId: String, writer: (OutputStream) -> Unit): Long {\n         val handle = FileBackupFileType.Blob(androidId, chunkId)\n-        backend.save(handle).use { chunkStream ->\n-            chunkStream.write(VERSION.toInt())\n+        semaphore.withPermit { // only allow one writer using the buffer at a time\n+            buffer.clear()\n+            buffer.writeByte(VERSION.toInt())\n             val ad = streamCrypto.getAssociatedDataForChunk(chunkId)\n-            streamCrypto.newEncryptingStream(streamKey, chunkStream, ad).use { encryptingStream ->\n-                writer(encryptingStream)\n+            streamCrypto.newEncryptingStream(streamKey, buffer.outputStream(), ad).use { stream ->\n+                writer(stream)\n+            }\n+            val saver = object : BackendSaver {\n+                override val size: Long = buffer.size\n+                override val sha256: String = buffer.sha256().hex()\n+                override fun save(outputStream: OutputStream): Long {\n+                    return buffer.copyTo(outputStream).size\n+                }\n+            }\n+            return try {\n+                backend.save(handle, saver)\n+            } finally {\n+                buffer.clear()\n             }\n         }\n     }\n@@ -93,9 +110,9 @@ internal class ChunkWriter(\n         var totalBytesRead = 0L\n         do {\n             val sizeLeft = (chunk.plaintextSize - totalBytesRead).toInt()\n-            val bytesRead = inputStream.read(buffer, 0, min(bufferSize, sizeLeft))\n+            val bytesRead = inputStream.read(byteBuffer, 0, min(bufferSize, sizeLeft))\n             if (bytesRead == -1) throw IOException(\"unexpected end of stream for ${chunk.id}\")\n-            outputStream.write(buffer, 0, bytesRead)\n+            outputStream.write(byteBuffer, 0, bytesRead)\n             totalBytesRead += bytesRead\n         } while (bytesRead >= 0 && totalBytesRead < chunk.plaintextSize)\n         check(totalBytesRead == chunk.plaintextSize) {\n@@ -119,10 +136,10 @@ internal class ChunkWriter(\n         if (isMissing) Log.w(TAG, \"Chunk ${chunk.id} is missing (cached: ${cachedChunk != null})\")\n         if (cachedChunk != null && !isMissing) return false\n         // chunk not yet uploaded\n-        writeChunkData(chunk.id) { encryptingStream ->\n+        val size = writeChunkData(chunk.id) { encryptingStream ->\n             zip.writeTo(encryptingStream)\n         }\n-        if (cachedChunk == null) chunksCache.insert(chunk.toCachedChunk())\n+        if (cachedChunk == null) chunksCache.insert(chunk.toCachedChunk(size))\n         return true\n     }\n \ndiff --git a/storage/lib/src/main/java/org/calyxos/backup/storage/backup/Chunker.kt b/storage/lib/src/main/java/org/calyxos/backup/storage/backup/Chunker.kt\nindex dd812eb7c..fc26b9eb4 100644\n--- a/storage/lib/src/main/java/org/calyxos/backup/storage/backup/Chunker.kt\n+++ b/storage/lib/src/main/java/org/calyxos/backup/storage/backup/Chunker.kt\n@@ -6,7 +6,6 @@\n package org.calyxos.backup.storage.backup\n \n import org.calyxos.backup.storage.db.CachedChunk\n-import org.calyxos.seedvault.core.crypto.CoreCrypto\n import org.calyxos.seedvault.core.toHexString\n import java.io.IOException\n import java.io.InputStream\n@@ -18,11 +17,10 @@ internal data class Chunk(\n     val offset: Long,\n     val plaintextSize: Long,\n ) {\n-    fun toCachedChunk() = CachedChunk(\n+    fun toCachedChunk(size: Long) = CachedChunk(\n         id = id,\n         refCount = 0,\n-        // FIXME sometimes, the ciphertext size is not as expected\n-        size = 1 + CoreCrypto.expectedCiphertextSize(plaintextSize),\n+        size = size,\n     )\n }\n \ndiff --git a/storage/lib/src/main/java/org/calyxos/backup/storage/backup/ZipChunker.kt b/storage/lib/src/main/java/org/calyxos/backup/storage/backup/ZipChunker.kt\nindex 295ac82e2..42ff42741 100644\n--- a/storage/lib/src/main/java/org/calyxos/backup/storage/backup/ZipChunker.kt\n+++ b/storage/lib/src/main/java/org/calyxos/backup/storage/backup/ZipChunker.kt\n@@ -25,7 +25,7 @@ internal data class ZipChunk(\n     val size: Long,\n     var wasUploaded: Boolean = false,\n ) {\n-    fun toCachedChunk() = CachedChunk(id, 0, size)\n+    fun toCachedChunk(size: Long) = CachedChunk(id, 0, size)\n }\n \n @Suppress(\"BlockingMethodInNonBlockingContext\")\ndiff --git a/storage/lib/src/test/java/org/calyxos/backup/storage/BackupRestoreTest.kt b/storage/lib/src/test/java/org/calyxos/backup/storage/BackupRestoreTest.kt\nindex a6f4b27f0..c98059bc4 100644\n--- a/storage/lib/src/test/java/org/calyxos/backup/storage/BackupRestoreTest.kt\n+++ b/storage/lib/src/test/java/org/calyxos/backup/storage/BackupRestoreTest.kt\n@@ -44,6 +44,7 @@ import org.calyxos.backup.storage.restore.Restore\n import org.calyxos.backup.storage.scanner.FileScanner\n import org.calyxos.backup.storage.scanner.FileScannerResult\n import org.calyxos.seedvault.core.backends.Backend\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.backends.FileBackupFileType.Blob\n import org.calyxos.seedvault.core.backends.FileBackupFileType.Snapshot\n import org.calyxos.seedvault.core.backends.IBackendManager\n@@ -164,15 +165,22 @@ internal class BackupRestoreTest {\n         } returns ByteArrayInputStream(fileDBytes) andThen ByteArrayInputStream(fileDBytes)\n \n         // output streams and caching\n-        coEvery { backend.save(any<Blob>()) } returnsMany listOf(\n-            zipChunkOutputStream, mOutputStream, dOutputStream\n-        )\n+        val saverSlot = slot<BackendSaver>()\n+        coEvery { backend.save(any<Blob>(), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(zipChunkOutputStream)\n+        } andThenAnswer {\n+            saverSlot.captured.save(mOutputStream)\n+        } andThenAnswer {\n+            saverSlot.captured.save(dOutputStream)\n+        }\n         every { chunksCache.hasCorruptedChunks(any()) } returns false\n         every { chunksCache.insert(any<CachedChunk>()) } just Runs\n         every { filesCache.upsert(capture(cachedFiles)) } just Runs\n \n         // snapshot writing\n-        coEvery { backend.save(capture(snapshotHandle)) } returns snapshotOutputStream\n+        coEvery { backend.save(capture(snapshotHandle), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(snapshotOutputStream)\n+        }\n         every { db.applyInParts<String>(any(), any()) } just Runs\n \n         backup.runBackup(null)\n@@ -317,49 +325,64 @@ internal class BackupRestoreTest {\n         every { context.cacheDir } returns tmpDir\n \n         // output streams for deterministic chunks\n+        val saverSlot = slot<BackendSaver>()\n         val id040f32 = ByteArrayOutputStream()\n         coEvery {\n             backend.save(\n                 Blob(\n                     androidId = androidId,\n                     name = \"040f3204869543c4015d92c04bf875b25ebde55f9645380f4172aa439b2825d3\",\n-                )\n+                ),\n+                capture(saverSlot),\n             )\n-        } returns id040f32\n+        } answers {\n+            saverSlot.captured.save(id040f32)\n+        }\n         val id901fbc = ByteArrayOutputStream()\n         coEvery {\n             backend.save(\n                 Blob(\n                     androidId = androidId,\n                     name = \"901fbcf9a94271fc0455d0052522cab994f9392d0bb85187860282b4beadfb29\",\n-                )\n+                ),\n+                capture(saverSlot),\n             )\n-        } returns id901fbc\n+        } answers {\n+            saverSlot.captured.save(id901fbc)\n+        }\n         val id5adea3 = ByteArrayOutputStream()\n         coEvery {\n             backend.save(\n                 Blob(\n                     androidId = androidId,\n                     name = \"5adea3149fe6cf9c6e3270a52ee2c31bc9dfcef5f2080b583a4dd3b779c9182d\",\n-                )\n+                ),\n+                capture(saverSlot),\n             )\n-        } returns id5adea3\n+        } answers {\n+            saverSlot.captured.save(id5adea3)\n+        }\n         val id40d00c = ByteArrayOutputStream()\n         coEvery {\n             backend.save(\n                 Blob(\n                     androidId = androidId,\n                     name = \"40d00c1be4b0f89e8b12d47f3658aa42f568a8d02b978260da6d0050e7007e67\",\n-                )\n+                ),\n+                capture(saverSlot),\n             )\n-        } returns id40d00c\n+        } answers {\n+            saverSlot.captured.save(id40d00c)\n+        }\n \n         every { chunksCache.hasCorruptedChunks(any()) } returns false\n         every { chunksCache.insert(any<CachedChunk>()) } just Runs\n         every { filesCache.upsert(capture(cachedFiles)) } just Runs\n \n         // snapshot writing\n-        coEvery { backend.save(capture(snapshotHandle)) } returns snapshotOutputStream\n+        coEvery { backend.save(capture(snapshotHandle), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(snapshotOutputStream)\n+        }\n         every { db.applyInParts<String>(any(), any()) } just Runs\n \n         backup.runBackup(null)\n@@ -370,25 +393,29 @@ internal class BackupRestoreTest {\n                 Blob(\n                     androidId = androidId,\n                     name = \"040f3204869543c4015d92c04bf875b25ebde55f9645380f4172aa439b2825d3\",\n-                )\n+                ),\n+                any(),\n             )\n             backend.save(\n                 Blob(\n                     androidId = androidId,\n                     name = \"901fbcf9a94271fc0455d0052522cab994f9392d0bb85187860282b4beadfb29\",\n-                )\n+                ),\n+                any(),\n             )\n             backend.save(\n                 Blob(\n                     androidId = androidId,\n                     name = \"5adea3149fe6cf9c6e3270a52ee2c31bc9dfcef5f2080b583a4dd3b779c9182d\",\n-                )\n+                ),\n+                any(),\n             )\n             backend.save(\n                 Blob(\n                     androidId = androidId,\n                     name = \"40d00c1be4b0f89e8b12d47f3658aa42f568a8d02b978260da6d0050e7007e67\",\n-                )\n+                ),\n+                any(),\n             )\n         }\n \n@@ -530,15 +557,6 @@ internal class BackupRestoreTest {\n         volume = MediaStore.VOLUME_EXTERNAL_PRIMARY,\n     )\n \n-    private fun getRandomDocFile(size: Int) = DocFile(\n-        uri = mockk(),\n-        dirPath = getRandomString(),\n-        fileName = getRandomString(),\n-        lastModified = Random.nextLong(),\n-        size = size.toLong(),\n-        volume = MediaStore.VOLUME_EXTERNAL_PRIMARY,\n-    )\n-\n     private fun getRestorableFileM(file: ContentFile, snapshot: BackupSnapshot): RestorableFile {\n         return RestorableFile(snapshot.mediaFilesList.find {\n             file.size == it.size\n@@ -568,3 +586,12 @@ internal class BackupRestoreTest {\n     }\n \n }\n+\n+internal fun getRandomDocFile(size: Int) = DocFile(\n+    uri = mockk(),\n+    dirPath = getRandomString(),\n+    fileName = getRandomString(),\n+    lastModified = Random.nextLong(),\n+    size = size.toLong(),\n+    volume = MediaStore.VOLUME_EXTERNAL_PRIMARY,\n+)\ndiff --git a/storage/lib/src/test/java/org/calyxos/backup/storage/backup/BackupTest.kt b/storage/lib/src/test/java/org/calyxos/backup/storage/backup/BackupTest.kt\nnew file mode 100644\nindex 000000000..dd68c3d7f\n--- /dev/null\n+++ b/storage/lib/src/test/java/org/calyxos/backup/storage/backup/BackupTest.kt\n@@ -0,0 +1,146 @@\n+/*\n+ * SPDX-FileCopyrightText: 2021 The Calyx Institute\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package org.calyxos.backup.storage.backup\n+\n+import android.Manifest.permission.ACCESS_MEDIA_LOCATION\n+import android.content.ContentResolver\n+import android.content.Context\n+import android.content.pm.PackageManager.PERMISSION_DENIED\n+import android.text.format.Formatter\n+import io.mockk.Runs\n+import io.mockk.coEvery\n+import io.mockk.every\n+import io.mockk.just\n+import io.mockk.mockk\n+import io.mockk.mockkStatic\n+import io.mockk.slot\n+import kotlinx.coroutines.runBlocking\n+import org.calyxos.backup.storage.backup.Backup.Companion.CHUNK_SIZE_MAX\n+import org.calyxos.backup.storage.db.CachedChunk\n+import org.calyxos.backup.storage.db.ChunksCache\n+import org.calyxos.backup.storage.db.Db\n+import org.calyxos.backup.storage.db.FilesCache\n+import org.calyxos.backup.storage.getRandomDocFile\n+import org.calyxos.backup.storage.getRandomString\n+import org.calyxos.backup.storage.mockLog\n+import org.calyxos.backup.storage.scanner.FileScanner\n+import org.calyxos.backup.storage.scanner.FileScannerResult\n+import org.calyxos.seedvault.core.backends.Backend\n+import org.calyxos.seedvault.core.backends.BackendSaver\n+import org.calyxos.seedvault.core.backends.FileBackupFileType.Blob\n+import org.calyxos.seedvault.core.backends.FileBackupFileType.Snapshot\n+import org.calyxos.seedvault.core.backends.IBackendManager\n+import org.calyxos.seedvault.core.crypto.CoreCrypto.ALGORITHM_HMAC\n+import org.calyxos.seedvault.core.crypto.CoreCrypto.KEY_SIZE_BYTES\n+import org.calyxos.seedvault.core.crypto.KeyManager\n+import org.junit.Assert.assertArrayEquals\n+import org.junit.Assert.assertTrue\n+import org.junit.Test\n+import java.io.ByteArrayInputStream\n+import java.io.ByteArrayOutputStream\n+import javax.crypto.spec.SecretKeySpec\n+import kotlin.random.Random\n+import kotlin.test.assertEquals\n+\n+internal class BackupTest {\n+\n+    private val context: Context = mockk()\n+    private val db: Db = mockk()\n+\n+    private val fileScanner: FileScanner = mockk()\n+    private val backendManager: IBackendManager = mockk()\n+    private val androidId: String = getRandomString()\n+    private val keyManager: KeyManager = mockk()\n+    private val cacheRepopulater: ChunksCacheRepopulater = mockk()\n+    private val backend: Backend = mockk()\n+    private val contentResolver: ContentResolver = mockk()\n+    private val filesCache: FilesCache = mockk()\n+    private val chunksCache: ChunksCache = mockk()\n+\n+    init {\n+        mockLog()\n+        mockkStatic(Formatter::class)\n+        every { Formatter.formatShortFileSize(any(), any()) } returns \"\"\n+\n+        every { context.contentResolver } returns contentResolver\n+        every { db.getFilesCache() } returns filesCache\n+        every { db.getChunksCache() } returns chunksCache\n+        every { keyManager.getMainKey() } returns SecretKeySpec(\n+            \"This is a backup key for testing\".toByteArray(),\n+            0, KEY_SIZE_BYTES, ALGORITHM_HMAC\n+        )\n+        every { context.checkSelfPermission(ACCESS_MEDIA_LOCATION) } returns PERMISSION_DENIED\n+        every { backendManager.backend } returns backend\n+    }\n+\n+    private val backup = Backup(\n+        context = context,\n+        db = db,\n+        fileScanner = fileScanner,\n+        backendManager = backendManager,\n+        androidId = androidId,\n+        keyManager = keyManager,\n+        cacheRepopulater = cacheRepopulater,\n+    )\n+\n+    @Test\n+    fun testRunBackupRetriesSaving() {\n+        // define one file in backup\n+        val fileMBytes = Random.nextBytes(Random.nextInt(1, CHUNK_SIZE_MAX))\n+        val fileM = getRandomDocFile(fileMBytes.size)\n+        val scannedFiles = FileScannerResult(\n+            smallFiles = emptyList(),\n+            files = listOf(fileM),\n+        )\n+\n+        // preliminaries find the file above\n+        coEvery { backend.list(any(), Blob::class, callback = any()) } just Runs\n+        every { chunksCache.areAllAvailableChunksCached(emptySet()) } returns true\n+        every { fileScanner.getFiles() } returns scannedFiles\n+        every { filesCache.getByUri(any()) } returns null // nothing is cached, all is new\n+        every { chunksCache.get(any()) } returns null // no chunks are cached, all are new\n+        every { chunksCache.hasCorruptedChunks(any()) } returns false // no chunks corrupted\n+\n+        // backup file and save its blob\n+        every {\n+            contentResolver.openInputStream(fileM.uri)\n+        } returns ByteArrayInputStream(fileMBytes) andThen ByteArrayInputStream(fileMBytes)\n+        coEvery { backend.save(match { it is Blob }, any()) } returns 42L\n+\n+        // save snapshot (the interesting part!)\n+        val saverSlot = slot<BackendSaver>()\n+        val outputStream1 = ByteArrayOutputStream()\n+        val outputStream2 = ByteArrayOutputStream()\n+        val outputStream3 = ByteArrayOutputStream()\n+        var size1 = -1L\n+        var size2 = -1L\n+        coEvery { backend.save(match { it is Snapshot }, capture(saverSlot)) } answers {\n+            // saver saves 3 times\n+            size1 = saverSlot.captured.save(outputStream1)\n+            size2 = saverSlot.captured.save(outputStream2)\n+            saverSlot.captured.save(outputStream3)\n+        }\n+\n+        // post snapshot work\n+        every { chunksCache.insert(any<CachedChunk>()) } just Runs\n+        every { filesCache.upsert(any()) } just Runs\n+        every { db.applyInParts<String>(any(), any()) } just Runs\n+\n+        runBlocking {\n+            backup.runBackup(null)\n+        }\n+\n+        // output is always the same, no matter how much often we save\n+        val bytes = outputStream1.toByteArray()\n+        assertTrue(bytes.isNotEmpty())\n+        assertArrayEquals(bytes, outputStream2.toByteArray())\n+        assertArrayEquals(bytes, outputStream3.toByteArray())\n+\n+        assertEquals(size1, outputStream1.size().toLong())\n+        assertEquals(size2, outputStream2.size().toLong())\n+    }\n+\n+}\ndiff --git a/storage/lib/src/test/java/org/calyxos/backup/storage/backup/ChunkWriterTest.kt b/storage/lib/src/test/java/org/calyxos/backup/storage/backup/ChunkWriterTest.kt\nindex fe7585a81..e7580d0ac 100644\n--- a/storage/lib/src/test/java/org/calyxos/backup/storage/backup/ChunkWriterTest.kt\n+++ b/storage/lib/src/test/java/org/calyxos/backup/storage/backup/ChunkWriterTest.kt\n@@ -11,6 +11,7 @@ import io.mockk.coEvery\n import io.mockk.every\n import io.mockk.just\n import io.mockk.mockk\n+import io.mockk.slot\n import kotlinx.coroutines.runBlocking\n import org.calyxos.backup.storage.backup.Backup.Companion.VERSION\n import org.calyxos.backup.storage.crypto.StreamCrypto\n@@ -18,6 +19,7 @@ import org.calyxos.backup.storage.db.ChunksCache\n import org.calyxos.backup.storage.getRandomString\n import org.calyxos.backup.storage.mockLog\n import org.calyxos.seedvault.core.backends.Backend\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.backends.FileBackupFileType.Blob\n import org.calyxos.seedvault.core.backends.IBackendManager\n import org.calyxos.seedvault.core.crypto.CoreCrypto.KEY_SIZE_BYTES\n@@ -27,6 +29,7 @@ import org.junit.Assert.assertEquals\n import org.junit.Test\n import java.io.ByteArrayInputStream\n import java.io.ByteArrayOutputStream\n+import java.io.OutputStream\n import kotlin.random.Random\n \n internal class ChunkWriterTest {\n@@ -77,31 +80,41 @@ internal class ChunkWriterTest {\n         every { chunksCache.get(chunkId2) } returns null\n         every { chunksCache.get(chunkId3) } returns null\n \n-        // get the output streams for the chunks\n-        coEvery { backend.save(Blob(androidId, chunkId1)) } returns chunk1Output\n-        coEvery { backend.save(Blob(androidId, chunkId2)) } returns chunk2Output\n-        coEvery { backend.save(Blob(androidId, chunkId3)) } returns chunk3Output\n-\n         // get AD\n         every { streamCrypto.getAssociatedDataForChunk(chunkId1) } returns ad1\n         every { streamCrypto.getAssociatedDataForChunk(chunkId2) } returns ad2\n         every { streamCrypto.getAssociatedDataForChunk(chunkId3) } returns ad3\n \n         // wrap output stream in crypto stream\n-        every {\n-            streamCrypto.newEncryptingStream(streamKey, chunk1Output, ad1)\n-        } returns chunk1Output\n-        every {\n-            streamCrypto.newEncryptingStream(streamKey, chunk2Output, ad2)\n-        } returns chunk2Output\n-        every {\n-            streamCrypto.newEncryptingStream(streamKey, chunk3Output, ad3)\n-        } returns chunk3Output\n+        val streamSlot = slot<OutputStream>()\n+        every { streamCrypto.newEncryptingStream(streamKey, capture(streamSlot), ad1) } answers {\n+            streamSlot.captured\n+        }\n+        every { streamCrypto.newEncryptingStream(streamKey, capture(streamSlot), ad2) } answers {\n+            streamSlot.captured\n+        }\n+        every { streamCrypto.newEncryptingStream(streamKey, capture(streamSlot), ad3) } answers {\n+            streamSlot.captured\n+        }\n+\n+        // save the chunks\n+        val saverSlot = slot<BackendSaver>()\n+        coEvery {\n+            backend.save(Blob(androidId, chunkId1), capture(saverSlot))\n+        } answers {\n+            saverSlot.captured.save(chunk1Output)\n+        }\n+        coEvery { backend.save(Blob(androidId, chunkId2), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(chunk2Output)\n+        }\n+        coEvery { backend.save(Blob(androidId, chunkId3), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(chunk3Output)\n+        }\n \n         // insert chunks into cache after upload\n-        every { chunksCache.insert(chunks[0].toCachedChunk()) } just Runs\n-        every { chunksCache.insert(chunks[1].toCachedChunk()) } just Runs\n-        every { chunksCache.insert(chunks[2].toCachedChunk()) } just Runs\n+        every { chunksCache.insert(chunks[0].toCachedChunk(3)) } just Runs\n+        every { chunksCache.insert(chunks[1].toCachedChunk(3)) } just Runs\n+        every { chunksCache.insert(chunks[2].toCachedChunk(3)) } just Runs\n \n         chunkWriter.writeChunk(inputStream, chunks, emptyList())\n \n@@ -129,29 +142,34 @@ internal class ChunkWriterTest {\n         val chunk3Output = ByteArrayOutputStream()\n \n         // only first two chunks are cached (first chunk is missing from storage)\n-        every { chunksCache.get(chunkId1) } returns chunks[0].toCachedChunk()\n-        every { chunksCache.get(chunkId2) } returns chunks[1].toCachedChunk()\n+        every { chunksCache.get(chunkId1) } returns chunks[0].toCachedChunk(1)\n+        every { chunksCache.get(chunkId2) } returns chunks[1].toCachedChunk(2)\n         every { chunksCache.get(chunkId3) } returns null\n \n         // get and wrap the output stream for chunk that is missing\n-        coEvery { backend.save(Blob(androidId, chunkId1)) } returns chunk1Output\n+        val saverSlot = slot<BackendSaver>()\n+        coEvery { backend.save(Blob(androidId, chunkId1), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(chunk1Output)\n+        }\n         every { streamCrypto.getAssociatedDataForChunk(chunkId1) } returns ad1\n+        val streamSlot = slot<OutputStream>()\n         every {\n-            streamCrypto.newEncryptingStream(streamKey, chunk1Output, bytes(34))\n-        } returns chunk1Output\n+            streamCrypto.newEncryptingStream(streamKey, capture(streamSlot), bytes(34))\n+        } answers {\n+            streamSlot.captured\n+        }\n \n         // insert missing cached chunk into cache after upload\n-        every { chunksCache.insert(chunks[0].toCachedChunk()) } just Runs\n+        every { chunksCache.insert(chunks[0].toCachedChunk(3)) } just Runs\n \n         // get and wrap the output stream for chunk that isn't cached\n-        coEvery { backend.save(Blob(androidId, chunkId3)) } returns chunk3Output\n+        coEvery { backend.save(Blob(androidId, chunkId3), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(chunk3Output)\n+        }\n         every { streamCrypto.getAssociatedDataForChunk(chunkId3) } returns ad3\n-        every {\n-            streamCrypto.newEncryptingStream(streamKey, chunk3Output, bytes(34))\n-        } returns chunk3Output\n \n         // insert last not cached chunk into cache after upload\n-        every { chunksCache.insert(chunks[2].toCachedChunk()) } just Runs\n+        every { chunksCache.insert(chunks[2].toCachedChunk(3)) } just Runs\n \n         chunkWriter.writeChunk(inputStream, chunks, listOf(chunkId1))\n \n@@ -183,28 +201,38 @@ internal class ChunkWriterTest {\n \n         // first and last chunk are not cached\n         every { chunksCache.get(chunkId1) } returns null\n-        every { chunksCache.get(chunkId2) } returns chunks[1].toCachedChunk()\n+        every { chunksCache.get(chunkId2) } returns chunks[1].toCachedChunk(1)\n         every { chunksCache.get(chunkId3) } returns null\n \n         // get the output streams for the chunks\n-        coEvery { backend.save(Blob(androidId, chunkId1)) } returns chunk1Output\n-        coEvery { backend.save(Blob(androidId, chunkId3)) } returns chunk3Output\n+        val saverSlot = slot<BackendSaver>()\n+        coEvery { backend.save(Blob(androidId, chunkId1), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(chunk1Output)\n+        }\n+        coEvery { backend.save(Blob(androidId, chunkId3), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(chunk3Output)\n+        }\n \n         // get AD\n         every { streamCrypto.getAssociatedDataForChunk(chunkId1) } returns ad1\n         every { streamCrypto.getAssociatedDataForChunk(chunkId3) } returns ad3\n \n         // wrap output streams in crypto streams\n-        every {\n-            streamCrypto.newEncryptingStream(streamKey, chunk1Output, ad1)\n-        } returns chunk1Output\n-        every {\n-            streamCrypto.newEncryptingStream(streamKey, chunk3Output, ad3)\n-        } returns chunk3Output\n+        val streamSlot = slot<OutputStream>()\n+        every { streamCrypto.newEncryptingStream(streamKey, capture(streamSlot), ad1) } answers {\n+            streamSlot.captured\n+        }\n+        every { streamCrypto.newEncryptingStream(streamKey, capture(streamSlot), ad3) } answers {\n+            streamSlot.captured\n+        }\n \n         // insert chunks into cache after upload\n-        every { chunksCache.insert(chunks[0].toCachedChunk()) } just Runs\n-        every { chunksCache.insert(chunks[2].toCachedChunk()) } just Runs\n+        every {\n+            chunksCache.insert(chunks[0].toCachedChunk(chunk1Bytes.size.toLong() + 1))\n+        } just Runs\n+        every {\n+            chunksCache.insert(chunks[2].toCachedChunk(chunk3Bytes.size.toLong() + 1))\n+        } just Runs\n \n         chunkWriter.writeChunk(inputStream, chunks, emptyList())\n \n@@ -226,6 +254,65 @@ internal class ChunkWriterTest {\n         )\n     }\n \n+    @Test\n+    fun testChunkSavingCanBeRetried() = runBlocking {\n+        val chunkBytes = Random.nextBytes(16 * 1024 * 1024)\n+        val inputStream = ByteArrayInputStream(chunkBytes)\n+        val chunks = listOf(\n+            Chunk(chunkId1, 0, chunkBytes.size.toLong()),\n+        )\n+        val chunkOutput1 = ByteArrayOutputStream()\n+        val chunkOutput2 = ByteArrayOutputStream()\n+        val chunkOutput3 = ByteArrayOutputStream()\n+\n+        // chunk is not cached\n+        every { chunksCache.get(chunkId1) } returns null\n+\n+        // get the output streams for the chunks\n+        val saverSlot = slot<BackendSaver>()\n+        var size1 = -1L\n+        var size2 = -1L\n+        coEvery { backend.save(Blob(androidId, chunkId1), capture(saverSlot)) } answers {\n+            // saver saves 3 times\n+            size1 = saverSlot.captured.save(chunkOutput1)\n+            size2 = saverSlot.captured.save(chunkOutput2)\n+            saverSlot.captured.save(chunkOutput3)\n+        }\n+\n+        // wrap output streams in crypto streams\n+        val streamSlot = slot<OutputStream>()\n+        every { streamCrypto.getAssociatedDataForChunk(chunkId1) } returns ad1\n+        every { streamCrypto.newEncryptingStream(streamKey, capture(streamSlot), ad1) } answers {\n+            streamSlot.captured\n+        }\n+\n+        // insert chunks into cache after upload\n+        every {\n+            chunksCache.insert(chunks[0].toCachedChunk(chunkBytes.size.toLong() + 1))\n+        } just Runs\n+\n+        chunkWriter.writeChunk(inputStream, chunks, emptyList())\n+\n+        // check that output matches chunk data\n+        assertEquals(1 + chunks[0].plaintextSize.toInt(), chunkOutput1.size())\n+        assertEquals(1 + chunks[0].plaintextSize.toInt(), chunkOutput2.size())\n+        assertEquals(1 + chunks[0].plaintextSize.toInt(), chunkOutput3.size())\n+        assertArrayEquals(\n+            chunkBytes,\n+            chunkOutput1.toByteArray().copyOfRange(1, 1 + chunks[0].plaintextSize.toInt())\n+        )\n+        assertArrayEquals(\n+            chunkBytes,\n+            chunkOutput2.toByteArray().copyOfRange(1, 1 + chunks[0].plaintextSize.toInt())\n+        )\n+        assertArrayEquals(\n+            chunkBytes,\n+            chunkOutput3.toByteArray().copyOfRange(1, 1 + chunks[0].plaintextSize.toInt())\n+        )\n+        assertEquals(chunkOutput3.size().toLong(), size1)\n+        assertEquals(chunkOutput3.size().toLong(), size2)\n+    }\n+\n     private fun MockKMatcherScope.bytes(size: Int) = match<ByteArray> {\n         it.size == size\n     }\ndiff --git a/storage/lib/src/test/java/org/calyxos/backup/storage/backup/SmallFileBackupIntegrationTest.kt b/storage/lib/src/test/java/org/calyxos/backup/storage/backup/SmallFileBackupIntegrationTest.kt\nindex 9e47cf3ca..f3152b997 100644\n--- a/storage/lib/src/test/java/org/calyxos/backup/storage/backup/SmallFileBackupIntegrationTest.kt\n+++ b/storage/lib/src/test/java/org/calyxos/backup/storage/backup/SmallFileBackupIntegrationTest.kt\n@@ -12,6 +12,7 @@ import io.mockk.coVerify\n import io.mockk.every\n import io.mockk.just\n import io.mockk.mockk\n+import io.mockk.slot\n import kotlinx.coroutines.runBlocking\n import org.calyxos.backup.storage.api.BackupObserver\n import org.calyxos.backup.storage.crypto.StreamCrypto\n@@ -22,6 +23,7 @@ import org.calyxos.backup.storage.getRandomDocFile\n import org.calyxos.backup.storage.getRandomString\n import org.calyxos.backup.storage.mockLog\n import org.calyxos.seedvault.core.backends.Backend\n+import org.calyxos.seedvault.core.backends.BackendSaver\n import org.calyxos.seedvault.core.backends.IBackendManager\n import org.calyxos.seedvault.core.crypto.CoreCrypto.KEY_SIZE_BYTES\n import org.calyxos.seedvault.core.toHexString\n@@ -98,7 +100,10 @@ internal class SmallFileBackupIntegrationTest {\n         every { mac.doFinal(any<ByteArray>()) } returns chunkId\n         every { chunksCache.get(any()) } returns null\n         every { chunksCache.hasCorruptedChunks(any()) } returns false\n-        coEvery { backend.save(any()) } returns outputStream2\n+        val saverSlot = slot<BackendSaver>()\n+        coEvery { backend.save(any(), capture(saverSlot)) } answers {\n+            saverSlot.captured.save(outputStream2)\n+        }\n         every {\n             chunksCache.insert(match<CachedChunk> { cachedChunk ->\n                 cachedChunk.id == chunkId.toHexString() &&\n", "changes": [{"file": "app/src/main/java/com/stevesoltys/seedvault/UsbIntentReceiver.kt", "module": "com.stevesoltys.seedvault.UsbIntentReceiver", "range": [{"start": 8, "end": 8}, {"start": 12, "end": 12}, {"start": 18, "end": 20}, {"start": 26, "end": 26}, {"start": 32, "end": 33}, {"start": 36, "end": 36}, {"start": 38, "end": 39}, {"start": 40, "end": 41}, {"start": 44, "end": 45}, {"start": 57, "end": 58}, {"start": 61, "end": 102}]}, {"file": "app/src/main/java/com/stevesoltys/seedvault/UsbMonitorService.kt", "module": "com.stevesoltys.seedvault.UsbMonitorService", "range": [{"start": 0, "end": 0}]}, {"file": "core/src/main/java/org/calyxos/seedvault/core/backends/Backend.kt", "module": "org.calyxos.seedvault.core.backends.Backend", "range": [{"start": 10, "end": 10}, {"start": 15, "end": 15}, {"start": 28, "end": 29}, {"start": 45, "end": 45}]}, {"file": "core/src/main/java/org/calyxos/seedvault/core/backends/BackendSaver.kt", "module": "org.calyxos.seedvault.core.backends.BackendSaver", "range": [{"start": 0, "end": 0}]}, {"file": "core/src/main/java/org/calyxos/seedvault/core/backends/RetryBackend.kt", "module": "org.calyxos.seedvault.core.backends.RetryBackend", "range": [{"start": 0, "end": 0}]}, {"file": "core/src/main/java/org/calyxos/seedvault/core/backends/saf/DocumentFileCache.kt", "module": "org.calyxos.seedvault.core.backends.saf.DocumentFileCache", "range": [{"start": 31, "end": 60}, {"start": 61, "end": 61}]}, {"file": "core/src/main/java/org/calyxos/seedvault/core/backends/saf/SafBackend.kt", "module": "org.calyxos.seedvault.core.backends.saf.SafBackend", "range": [{"start": 9, "end": 9}, {"start": 21, "end": 21}, {"start": 39, "end": 39}, {"start": 57, "end": 57}, {"start": 89, "end": 90}, {"start": 92, "end": 93}, {"start": 236, "end": 236}]}, {"file": "core/src/main/java/org/calyxos/seedvault/core/backends/saf/SafHelper.kt", "module": "org.calyxos.seedvault.core.backends.saf.SafHelper", "range": [{"start": 13, "end": 13}, {"start": 67, "end": 68}, {"start": 75, "end": 76}, {"start": 91, "end": 92}, {"start": 94, "end": 95}, {"start": 117, "end": 117}, {"start": 167, "end": 167}, {"start": 197, "end": 199}, {"start": 218, "end": 218}]}, {"file": "core/src/main/java/org/calyxos/seedvault/core/backends/webdav/WebDavBackend.kt", "module": "org.calyxos.seedvault.core.backends.webdav.WebDavBackend", "range": [{"start": 16, "end": 20}, {"start": 27, "end": 27}, {"start": 30, "end": 30}, {"start": 45, "end": 45}, {"start": 47, "end": 49}, {"start": 56, "end": 56}, {"start": 64, "end": 64}, {"start": 124, "end": 125}, {"start": 129, "end": 131}, {"start": 135, "end": 135}, {"start": 136, "end": 141}, {"start": 143, "end": 144}, {"start": 146, "end": 146}, {"start": 148, "end": 153}, {"start": 364, "end": 364}]}, {"file": "core/src/main/java/org/calyxos/seedvault/core/backends/BackendFactory.kt", "module": "org.calyxos.seedvault.core.backends.BackendFactory", "range": [{"start": 16, "end": 17}, {"start": 18, "end": 19}]}]}]}
{"url": "https://github.com/meshtastic/Meshtastic-Android/issues/4", "repo": {"url": "https://github.com/meshtastic/Meshtastic-Android", "name": "Meshtastic-Android", "owner": "meshtastic", "modules": ["com.geeksville.mesh", "com.geeksville.mesh.android", "com.geeksville.mesh.buildlogic", "com.geeksville.mesh.concurrent", "com.geeksville.mesh.model", "com.geeksville.mesh.navigation", "com.geeksville.mesh.repository", "com.geeksville.mesh.service", "com.geeksville.mesh.ui", "com.geeksville.mesh.util", "com.meshtastic.android.meshserviceexample", "org.meshtastic.core.analytics", "org.meshtastic.core.common", "org.meshtastic.core.data", "org.meshtastic.core.database", "org.meshtastic.core.datastore", "org.meshtastic.core.di", "org.meshtastic.core.model", "org.meshtastic.core.navigation", "org.meshtastic.core.network", "org.meshtastic.core.prefs", "org.meshtastic.core.proto", "org.meshtastic.core.service", "org.meshtastic.core.ui", "org.meshtastic.feature.intro", "org.meshtastic.feature.map", "org.meshtastic.feature.messaging", "org.meshtastic.feature.node", "org.meshtastic.feature.settings"]}, "issue": {"number": 4, "url": "https://github.com/meshtastic/Meshtastic-Android/issues/4", "state": "closed", "title": "While device is in NB state, app should say \"battery saver mode\" and it should properly queue outbound packets", "body": "Just leaving the phone connected to the t-beam results in it loosing connection.\r\n\r\nThe app is ver 0.1.2\r\nboard is running 0.1.0\r\n\r\nClose to the end of the logfile there is\r\n\r\n\r\n03-08 16:12:57.329  4236  4236 W com.geeksville.mesh.service.MeshService: Abandoning reconnect attempt, due to errors during init: Bluetooth status=1 while doing readC ea9f3f82-8dc4-4733-9452-1f6da28892a2\r\n\r\nlogcat logfile is attached.\r\n\r\n[2020-03-08_16:04:21.txt](https://github.com/meshtastic/Meshtastic-Android/files/4303428/2020-03-08_16.04.21.txt)\r\n\r\n", "logs": [{"name": "2020-03-08_16:04:21.txt", "url": "https://github.com/meshtastic/Meshtastic-Android/files/4303428/2020-03-08_16.04.21.txt"}]}, "pull_request": [{"number": 3384, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/3384", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3384.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3384.patch", "title": "chore(deps): update ruby to v3.4.7", "content": "This PR contains the following updates:\n\n| Package | Update | Change |\n|---|---|---|\n| [ruby](https://www.ruby-lang.org) ([source](https://redirect.github.com/ruby/ruby)) | patch | `3.4.6` -> `3.4.7` |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS4xMzEuOSIsInVwZGF0ZWRJblZlciI6IjQxLjEzMS45IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiXX0=-->\n", "diff": "diff --git a/.ruby-version b/.ruby-version\nindex 1cf8253024..2aa5131992 100644\n--- a/.ruby-version\n+++ b/.ruby-version\n@@ -1 +1 @@\n-3.4.6\n+3.4.7\n", "changes": []}, {"number": 3288, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/3288", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3288.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3288.patch", "title": "chore(deps): update plugin com.gradle.develocity to v4.2.1", "content": "> [!NOTE]\n> Mend has cancelled [the proposed renaming](https://redirect.github.com/renovatebot/renovate/discussions/37842) of the Renovate GitHub app being renamed to `mend[bot]`.\n> \n> This notice will be removed on 2025-10-07.\n\n<hr>\n\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| com.gradle.develocity | `4.2` -> `4.2.1` | [![age](https://developer.mend.io/api/mc/badges/age/maven/com.gradle.develocity:com.gradle.develocity.gradle.plugin/4.2.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/com.gradle.develocity:com.gradle.develocity.gradle.plugin/4.2.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/com.gradle.develocity:com.gradle.develocity.gradle.plugin/4.2/4.2.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/com.gradle.develocity:com.gradle.develocity.gradle.plugin/4.2/4.2.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS4xMzEuOSIsInVwZGF0ZWRJblZlciI6IjQxLjEzMS45IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiXX0=-->\n", "diff": "diff --git a/settings.gradle.kts b/settings.gradle.kts\nindex a0d13eca57..6184df9e90 100644\n--- a/settings.gradle.kts\n+++ b/settings.gradle.kts\n@@ -61,7 +61,7 @@ dependencyResolutionManagement {\n \n plugins {\n     id(\"org.gradle.toolchains.foojay-resolver\") version \"1.0.0\"\n-    id(\"com.gradle.develocity\") version(\"4.2\")\n+    id(\"com.gradle.develocity\") version(\"4.2.1\")\n     id(\"com.gradle.common-custom-user-data-gradle-plugin\") version \"2.4.0\"\n }\n \n", "changes": [{"file": "settings.gradle.kts", "module": "settings.gradle.kts", "range": [{"start": 64, "end": 65}]}]}, {"number": 3130, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/3130", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3130.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3130.patch", "title": "chore(deps): update androidx lifecycle to v2.9.4", "content": "Coming soon: The Renovate bot (GitHub App) will be renamed to Mend. PRs from Renovate will soon appear from 'Mend'. Learn more [here](https://redirect.github.com/renovatebot/renovate/discussions/37842).\n\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [androidx.lifecycle:lifecycle-viewmodel-ktx](https://developer.android.com/jetpack/androidx/releases/lifecycle#2.9.4) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `2.9.3` -> `2.9.4` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.lifecycle:lifecycle-viewmodel-ktx/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.lifecycle:lifecycle-viewmodel-ktx/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.lifecycle:lifecycle-viewmodel-ktx/2.9.3/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.lifecycle:lifecycle-viewmodel-ktx/2.9.3/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n| [androidx.lifecycle:lifecycle-viewmodel-compose](https://developer.android.com/jetpack/androidx/releases/lifecycle#2.9.4) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `2.9.3` -> `2.9.4` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.lifecycle:lifecycle-viewmodel-compose/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.lifecycle:lifecycle-viewmodel-compose/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.lifecycle:lifecycle-viewmodel-compose/2.9.3/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.lifecycle:lifecycle-viewmodel-compose/2.9.3/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n| [androidx.lifecycle:lifecycle-runtime-compose](https://developer.android.com/jetpack/androidx/releases/lifecycle#2.9.4) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `2.9.3` -> `2.9.4` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.lifecycle:lifecycle-runtime-compose/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.lifecycle:lifecycle-runtime-compose/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.lifecycle:lifecycle-runtime-compose/2.9.3/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.lifecycle:lifecycle-runtime-compose/2.9.3/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n| [androidx.lifecycle:lifecycle-process](https://developer.android.com/jetpack/androidx/releases/lifecycle#2.9.4) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `2.9.3` -> `2.9.4` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.lifecycle:lifecycle-process/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.lifecycle:lifecycle-process/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.lifecycle:lifecycle-process/2.9.3/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.lifecycle:lifecycle-process/2.9.3/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n| [androidx.lifecycle:lifecycle-livedata-ktx](https://developer.android.com/jetpack/androidx/releases/lifecycle#2.9.4) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `2.9.3` -> `2.9.4` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.lifecycle:lifecycle-livedata-ktx/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.lifecycle:lifecycle-livedata-ktx/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.lifecycle:lifecycle-livedata-ktx/2.9.3/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.lifecycle:lifecycle-livedata-ktx/2.9.3/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n| [androidx.lifecycle:lifecycle-common-java8](https://developer.android.com/jetpack/androidx/releases/lifecycle#2.9.4) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `2.9.3` -> `2.9.4` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.lifecycle:lifecycle-common-java8/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.lifecycle:lifecycle-common-java8/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.lifecycle:lifecycle-common-java8/2.9.3/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.lifecycle:lifecycle-common-java8/2.9.3/2.9.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about these updates again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS45Ny4xMCIsInVwZGF0ZWRJblZlciI6IjQxLjk3LjEwIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiXX0=-->\n", "diff": "diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml\nindex bb5a52a520..ad4b1722ad 100644\n--- a/gradle/libs.versions.toml\n+++ b/gradle/libs.versions.toml\n@@ -8,7 +8,7 @@ accompanist = \"0.37.3\"\n androidxComposeMaterial3Adaptive = \"1.2.0-beta02\"\n androidxTracing = \"1.9.1\"\n datastore = \"1.1.7\"\n-lifecycle = \"2.9.3\"\n+lifecycle = \"2.9.4\"\n navigation = \"2.9.4\"\n navigation3 = \"1.0.0-alpha09\"\n room = \"2.8.0\"\n", "changes": [{"file": "gradle/libs.versions.toml", "module": "gradle.libs.versions.toml", "range": [{"start": 11, "end": 12}]}]}, {"number": 3414, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/3414", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3414.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3414.patch", "title": "chore(deps): update ruby to v3.4.7", "content": "This PR contains the following updates:\n\n| Package | Type | Update | Change |\n|---|---|---|---|\n| [ruby](https://www.ruby-lang.org) ([source](https://redirect.github.com/ruby/ruby)) | uses-with | minor | `3.2` -> `3.4.7` |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Disabled because a matching PR was automerged previously.\n\n **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS4xNDMuMSIsInVwZGF0ZWRJblZlciI6IjQxLjE0My4xIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiXX0=-->\n", "diff": "diff --git a/.github/workflows/release.yml b/.github/workflows/release.yml\nindex 58764210ea..70ab0cbf3a 100644\n--- a/.github/workflows/release.yml\n+++ b/.github/workflows/release.yml\n@@ -137,7 +137,7 @@ jobs:\n       - name: Setup Fastlane\n         uses: ruby/setup-ruby@v1\n         with:\n-          ruby-version: '3.2'\n+          ruby-version: '3.4.7'\n           bundler-cache: true\n \n       - name: Build and Deploy Google Play to Internal Track with Fastlane\n@@ -203,7 +203,7 @@ jobs:\n       - name: Setup Fastlane\n         uses: ruby/setup-ruby@v1\n         with:\n-          ruby-version: '3.2'\n+          ruby-version: '3.4.7'\n           bundler-cache: true\n \n       - name: Build F-Droid with Fastlane\n", "changes": [{"file": ".github/workflows/release.yml", "module": "github.workflows.release", "range": [{"start": 140, "end": 141}, {"start": 206, "end": 207}]}]}, {"number": 3078, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/3078", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3078.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3078.patch", "title": "chore(deps): update protobuf runtime to v4.32.1", "content": "This PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [com.google.protobuf:protoc](https://developers.google.com/protocol-buffers/) ([source](https://redirect.github.com/protocolbuffers/protobuf)) | `4.32.0` -> `4.32.1` | [![age](https://developer.mend.io/api/mc/badges/age/maven/com.google.protobuf:protoc/4.32.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/com.google.protobuf:protoc/4.32.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/com.google.protobuf:protoc/4.32.0/4.32.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/com.google.protobuf:protoc/4.32.0/4.32.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n| [com.google.protobuf:protobuf-kotlin](https://developers.google.com/protocol-buffers/) ([source](https://redirect.github.com/protocolbuffers/protobuf)) | `4.32.0` -> `4.32.1` | [![age](https://developer.mend.io/api/mc/badges/age/maven/com.google.protobuf:protobuf-kotlin/4.32.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/com.google.protobuf:protobuf-kotlin/4.32.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/com.google.protobuf:protobuf-kotlin/4.32.0/4.32.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/com.google.protobuf:protobuf-kotlin/4.32.0/4.32.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about these updates again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS45Ny4xMCIsInVwZGF0ZWRJblZlciI6IjQxLjk3LjEwIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiXX0=-->\n", "diff": "diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml\nindex c2637a4d8f..79ea151161 100644\n--- a/gradle/libs.versions.toml\n+++ b/gradle/libs.versions.toml\n@@ -46,7 +46,7 @@ org-eclipse-paho-client-mqttv3 = \"1.2.5\"\n osmbonuspack = \"6.9.0\"\n osmdroid-android = \"6.1.20\"\n protobuf-gradle-plugin = \"0.9.5\"\n-protobuf-kotlin = \"4.32.0\"\n+protobuf-kotlin = \"4.32.1\"\n retrofit = \"3.0.0\"\n room = \"2.8.0\"\n secrets-gradle-plugin = \"2.0.1\"\n", "changes": [{"file": "gradle/libs.versions.toml", "module": "gradle.libs.versions.toml", "range": [{"start": 49, "end": 50}]}]}, {"number": 3188, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/3188", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3188.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3188.patch", "title": "chore(deps): update androidx navigation", "content": "Coming soon: The Renovate bot (GitHub App) will be renamed to Mend. PRs from Renovate will soon appear from 'Mend'. Learn more [here](https://redirect.github.com/renovatebot/renovate/discussions/37842).\n\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [androidx.navigation3:navigation3-ui](https://developer.android.com/jetpack/androidx/releases/navigation3#1.0.0-alpha10) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `1.0.0-alpha09` -> `1.0.0-alpha10` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.navigation3:navigation3-ui/1.0.0-alpha10?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.navigation3:navigation3-ui/1.0.0-alpha10?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.navigation3:navigation3-ui/1.0.0-alpha09/1.0.0-alpha10?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.navigation3:navigation3-ui/1.0.0-alpha09/1.0.0-alpha10?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n| [androidx.navigation3:navigation3-runtime](https://developer.android.com/jetpack/androidx/releases/navigation3#1.0.0-alpha10) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `1.0.0-alpha09` -> `1.0.0-alpha10` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.navigation3:navigation3-runtime/1.0.0-alpha10?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.navigation3:navigation3-runtime/1.0.0-alpha10?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.navigation3:navigation3-runtime/1.0.0-alpha09/1.0.0-alpha10?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.navigation3:navigation3-runtime/1.0.0-alpha09/1.0.0-alpha10?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n| [androidx.navigation:navigation-testing](https://developer.android.com/jetpack/androidx/releases/navigation#2.9.5) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `2.9.4` -> `2.9.5` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.navigation:navigation-testing/2.9.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.navigation:navigation-testing/2.9.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.navigation:navigation-testing/2.9.4/2.9.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.navigation:navigation-testing/2.9.4/2.9.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n| [androidx.navigation:navigation-compose](https://developer.android.com/jetpack/androidx/releases/navigation#2.9.5) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `2.9.4` -> `2.9.5` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.navigation:navigation-compose/2.9.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.navigation:navigation-compose/2.9.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.navigation:navigation-compose/2.9.4/2.9.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.navigation:navigation-compose/2.9.4/2.9.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Immortal**: This PR will be recreated if closed unmerged. Get [config help](https://redirect.github.com/renovatebot/renovate/discussions) if that's undesired.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS45Ny4xMCIsInVwZGF0ZWRJblZlciI6IjQxLjk3LjEwIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiXX0=-->\n", "diff": "diff --git a/app/src/main/java/com/geeksville/mesh/ui/intro/AppIntroductionScreen.kt b/app/src/main/java/com/geeksville/mesh/ui/intro/AppIntroductionScreen.kt\nindex b7eea81f8d..7c05a5d40c 100644\n--- a/app/src/main/java/com/geeksville/mesh/ui/intro/AppIntroductionScreen.kt\n+++ b/app/src/main/java/com/geeksville/mesh/ui/intro/AppIntroductionScreen.kt\n@@ -24,7 +24,6 @@ import android.provider.Settings\n import androidx.compose.runtime.Composable\n import androidx.compose.ui.platform.LocalContext\n import androidx.navigation3.runtime.NavKey\n-import androidx.navigation3.runtime.entry\n import androidx.navigation3.runtime.entryProvider\n import androidx.navigation3.runtime.rememberNavBackStack\n import androidx.navigation3.ui.NavDisplay\ndiff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml\nindex 9a767165b5..6d98f44f7a 100644\n--- a/gradle/libs.versions.toml\n+++ b/gradle/libs.versions.toml\n@@ -9,8 +9,8 @@ androidxComposeMaterial3Adaptive = \"1.2.0-beta03\"\n androidxTracing = \"1.9.2\"\n datastore = \"1.1.7\"\n lifecycle = \"2.9.4\"\n-navigation = \"2.9.4\"\n-navigation3 = \"1.0.0-alpha09\"\n+navigation = \"2.9.5\"\n+navigation3 = \"1.0.0-alpha10\"\n room = \"2.8.1\"\n \n # Kotlin\n", "changes": [{"file": "app/src/main/java/com/geeksville/mesh/ui/intro/AppIntroductionScreen.kt", "module": "com.geeksville.mesh.ui.intro.AppIntroductionScreen", "range": [{"start": 27, "end": 27}]}]}, {"number": 3408, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/3408", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3408.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3408.patch", "title": "chore(deps): update plugin dependency-analysis to v3.1.0", "content": "This PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [com.autonomousapps.dependency-analysis](https://redirect.github.com/autonomousapps/dependency-analysis-android-gradle-plugin) | `3.0.4` -> `3.1.0` | [![age](https://developer.mend.io/api/mc/badges/age/maven/com.autonomousapps.dependency-analysis:com.autonomousapps.dependency-analysis.gradle.plugin/3.1.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/com.autonomousapps.dependency-analysis:com.autonomousapps.dependency-analysis.gradle.plugin/3.1.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/com.autonomousapps.dependency-analysis:com.autonomousapps.dependency-analysis.gradle.plugin/3.0.4/3.1.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/com.autonomousapps.dependency-analysis:com.autonomousapps.dependency-analysis.gradle.plugin/3.0.4/3.1.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>autonomousapps/dependency-analysis-android-gradle-plugin (com.autonomousapps.dependency-analysis)</summary>\n\n### [`v3.1.0`](https://redirect.github.com/autonomousapps/dependency-analysis-android-gradle-plugin/blob/HEAD/CHANGELOG.md#Version-310)\n\n- \\[Fix] Updated asm to 9.9 (and use latest asm-relocated) for Java 25 support.\n- \\[Fix]: Test fixtures in a Spring Boot project are allowed to have testFixturesApi dependencies.\n- \\[Test]: run tests against Gradle 9.1.0.\n\n</details>\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS4xMzEuOSIsInVwZGF0ZWRJblZlciI6IjQxLjEzMS45IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiXX0=-->\n", "diff": "diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml\nindex 779467b2c7..78fbf822ef 100644\n--- a/gradle/libs.versions.toml\n+++ b/gradle/libs.versions.toml\n@@ -191,7 +191,7 @@ firebase-perf = { id = \"com.google.firebase.firebase-perf\", version = \"2.0.1\" }\n \n # Other\n datadog = { id = \"com.datadoghq.dd-sdk-android-gradle-plugin\", version = \"1.21.0\" }\n-dependency-analysis = { id = \"com.autonomousapps.dependency-analysis\", version = \"3.0.4\" }\n+dependency-analysis = { id = \"com.autonomousapps.dependency-analysis\", version = \"3.1.0\" }\n detekt = { id = \"io.gitlab.arturbosch.detekt\", version.ref = \"detekt\" }\n dokka = { id = \"org.jetbrains.dokka\", version = \"2.0.0\" }\n protobuf = { id = \"com.google.protobuf\", version = \"0.9.5\" }\n", "changes": [{"file": "gradle/libs.versions.toml", "module": "gradle.libs.versions.toml", "range": [{"start": 194, "end": 195}]}]}, {"number": 3121, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/3121", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3121.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3121.patch", "title": "chore(deps): update plugin com.gradle.develocity to v4.2", "content": "Coming soon: The Renovate bot (GitHub App) will be renamed to Mend. PRs from Renovate will soon appear from 'Mend'. Learn more [here](https://redirect.github.com/renovatebot/renovate/discussions/37842).\n\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| com.gradle.develocity | `4.1.1` -> `4.2` | [![age](https://developer.mend.io/api/mc/badges/age/maven/com.gradle.develocity:com.gradle.develocity.gradle.plugin/4.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/com.gradle.develocity:com.gradle.develocity.gradle.plugin/4.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/com.gradle.develocity:com.gradle.develocity.gradle.plugin/4.1.1/4.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/com.gradle.develocity:com.gradle.develocity.gradle.plugin/4.1.1/4.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS45Ny4xMCIsInVwZGF0ZWRJblZlciI6IjQxLjk3LjEwIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiXX0=-->\n", "diff": "diff --git a/settings.gradle.kts b/settings.gradle.kts\nindex 7686153ea6..7b427770dc 100644\n--- a/settings.gradle.kts\n+++ b/settings.gradle.kts\n@@ -42,7 +42,7 @@ dependencyResolutionManagement {\n \n plugins {\n     id(\"org.gradle.toolchains.foojay-resolver\") version \"1.0.0\"\n-    id(\"com.gradle.develocity\") version(\"4.1.1\")\n+    id(\"com.gradle.develocity\") version(\"4.2\")\n     id(\"com.gradle.common-custom-user-data-gradle-plugin\") version \"2.4.0\"\n }\n \n", "changes": [{"file": "settings.gradle.kts", "module": "settings.gradle.kts", "range": [{"start": 45, "end": 46}]}]}, {"number": 3120, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/3120", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3120.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3120.patch", "title": "chore(deps): update ruby to v3.4.6", "content": "Coming soon: The Renovate bot (GitHub App) will be renamed to Mend. PRs from Renovate will soon appear from 'Mend'. Learn more [here](https://redirect.github.com/renovatebot/renovate/discussions/37842).\n\nThis PR contains the following updates:\n\n| Package | Update | Change |\n|---|---|---|\n| [ruby](https://www.ruby-lang.org) ([source](https://redirect.github.com/ruby/ruby)) | patch | `3.4.5` -> `3.4.6` |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS45Ny4xMCIsInVwZGF0ZWRJblZlciI6IjQxLjk3LjEwIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiXX0=-->\n", "diff": "diff --git a/.ruby-version b/.ruby-version\nindex 4f5e69734c..1cf8253024 100644\n--- a/.ruby-version\n+++ b/.ruby-version\n@@ -1 +1 @@\n-3.4.5\n+3.4.6\n", "changes": []}, {"number": 3131, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/3131", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3131.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3131.patch", "title": "chore(deps): update plugin dependency-analysis to v3.0.4", "content": "Coming soon: The Renovate bot (GitHub App) will be renamed to Mend. PRs from Renovate will soon appear from 'Mend'. Learn more [here](https://redirect.github.com/renovatebot/renovate/discussions/37842).\n\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [com.autonomousapps.dependency-analysis](https://redirect.github.com/autonomousapps/dependency-analysis-android-gradle-plugin) | `3.0.3` -> `3.0.4` | [![age](https://developer.mend.io/api/mc/badges/age/maven/com.autonomousapps.dependency-analysis:com.autonomousapps.dependency-analysis.gradle.plugin/3.0.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/com.autonomousapps.dependency-analysis:com.autonomousapps.dependency-analysis.gradle.plugin/3.0.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/com.autonomousapps.dependency-analysis:com.autonomousapps.dependency-analysis.gradle.plugin/3.0.3/3.0.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/com.autonomousapps.dependency-analysis:com.autonomousapps.dependency-analysis.gradle.plugin/3.0.3/3.0.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>autonomousapps/dependency-analysis-android-gradle-plugin (com.autonomousapps.dependency-analysis)</summary>\n\n### [`v3.0.4`](https://redirect.github.com/autonomousapps/dependency-analysis-android-gradle-plugin/blob/HEAD/CHANGELOG.md#Version-304)\n\n- \\[Fix] Remove auto-applied kotlin-stdlib for Gradle 8.11 support.\n\n</details>\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS45Ny4xMCIsInVwZGF0ZWRJblZlciI6IjQxLjk3LjEwIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiXX0=-->\n", "diff": "diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml\nindex bb5a52a520..dcdede2b47 100644\n--- a/gradle/libs.versions.toml\n+++ b/gradle/libs.versions.toml\n@@ -241,7 +241,7 @@ firebase-perf = { id = \"com.google.firebase.firebase-perf\", version = \"2.0.1\" }\n \n # Other\n datadog = { id = \"com.datadoghq.dd-sdk-android-gradle-plugin\", version = \"1.20.0\" }\n-dependency-analysis = { id = \"com.autonomousapps.dependency-analysis\", version = \"3.0.3\" }\n+dependency-analysis = { id = \"com.autonomousapps.dependency-analysis\", version = \"3.0.4\" }\n detekt = { id = \"io.gitlab.arturbosch.detekt\", version.ref = \"detekt\" }\n dokka = { id = \"org.jetbrains.dokka\", version = \"2.0.0\" }\n protobuf = { id = \"com.google.protobuf\", version = \"0.9.5\" }\n", "changes": [{"file": "gradle/libs.versions.toml", "module": "gradle.libs.versions.toml", "range": [{"start": 244, "end": 245}]}]}, {"number": 3045, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/3045", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3045.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3045.patch", "title": "chore(deps): update ruby to v3.4.5", "content": "This PR contains the following updates:\n\n| Package | Update | Change |\n|---|---|---|\n| [ruby](https://www.ruby-lang.org) ([source](https://redirect.github.com/ruby/ruby)) | minor | `3.2` -> `3.4.5` |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS45Ny4xMCIsInVwZGF0ZWRJblZlciI6IjQxLjk3LjEwIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiXX0=-->\n", "diff": "diff --git a/.ruby-version b/.ruby-version\nindex a3ec5a4bd3..4f5e69734c 100644\n--- a/.ruby-version\n+++ b/.ruby-version\n@@ -1 +1 @@\n-3.2\n+3.4.5\n", "changes": []}, {"number": 3113, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/3113", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3113.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/3113.patch", "title": "chore(deps): update plugin com.gradle.common-custom-user-data-gradle-plugin to v2.4.0", "content": "Coming soon: The Renovate bot (GitHub App) will be renamed to Mend. PRs from Renovate will soon appear from 'Mend'. Learn more [here](https://redirect.github.com/renovatebot/renovate/discussions/37842).\n\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| com.gradle.common-custom-user-data-gradle-plugin | `2.3` -> `2.4.0` | [![age](https://developer.mend.io/api/mc/badges/age/maven/com.gradle.common-custom-user-data-gradle-plugin:com.gradle.common-custom-user-data-gradle-plugin.gradle.plugin/2.4.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/com.gradle.common-custom-user-data-gradle-plugin:com.gradle.common-custom-user-data-gradle-plugin.gradle.plugin/2.4.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/com.gradle.common-custom-user-data-gradle-plugin:com.gradle.common-custom-user-data-gradle-plugin.gradle.plugin/2.3/2.4.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/com.gradle.common-custom-user-data-gradle-plugin:com.gradle.common-custom-user-data-gradle-plugin.gradle.plugin/2.3/2.4.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS45Ny4xMCIsInVwZGF0ZWRJblZlciI6IjQxLjk3LjEwIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiXX0=-->\n", "diff": "diff --git a/settings.gradle.kts b/settings.gradle.kts\nindex f42133e53b..7686153ea6 100644\n--- a/settings.gradle.kts\n+++ b/settings.gradle.kts\n@@ -43,7 +43,7 @@ dependencyResolutionManagement {\n plugins {\n     id(\"org.gradle.toolchains.foojay-resolver\") version \"1.0.0\"\n     id(\"com.gradle.develocity\") version(\"4.1.1\")\n-    id(\"com.gradle.common-custom-user-data-gradle-plugin\") version \"2.3\"\n+    id(\"com.gradle.common-custom-user-data-gradle-plugin\") version \"2.4.0\"\n }\n \n develocity {\n", "changes": [{"file": "settings.gradle.kts", "module": "settings.gradle.kts", "range": [{"start": 46, "end": 47}]}]}, {"number": 2580, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/2580", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/2580.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/2580.patch", "title": "chore(deps): update androidx.compose.material3:material3 to v1.4.0-beta01", "content": "This PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [androidx.compose.material3:material3](https://developer.android.com/jetpack/androidx/releases/compose-material3#1.3.2) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `1.4.0-alpha18` -> `1.4.0-beta01` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.compose.material3:material3/1.4.0-beta01?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.compose.material3:material3/1.4.0-beta01?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.compose.material3:material3/1.4.0-alpha18/1.4.0-beta01?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.compose.material3:material3/1.4.0-alpha18/1.4.0-beta01?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS40My41IiwidXBkYXRlZEluVmVyIjoiNDEuNDMuNSIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIl19-->\n", "diff": "diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml\nindex 528df1499e..b5efcf96a6 100644\n--- a/gradle/libs.versions.toml\n+++ b/gradle/libs.versions.toml\n@@ -32,7 +32,7 @@ kotlinx-serialization-json = \"1.9.0\"\n lifecycle = \"2.9.2\"\n markdownRenderer = \"0.35.0\"\n material = \"1.12.0\"\n-material3 = \"1.4.0-alpha18\"\n+material3 = \"1.5.0-alpha01\"\n mgrs = \"2.1.3\"\n navigation = \"2.9.2\"\n okhttp = \"5.1.0\"\n", "changes": [{"file": "gradle/libs.versions.toml", "module": "gradle.libs.versions.toml", "range": [{"start": 35, "end": 36}]}]}, {"number": 2439, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/2439", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/2439.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/2439.patch", "title": "chore(deps): update androidx.compose.material3:material3 to v1.4.0-alpha18", "content": "This PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [androidx.compose.material3:material3](https://developer.android.com/jetpack/androidx/releases/compose-material3#1.3.2) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `1.4.0-alpha17` -> `1.4.0-alpha18` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.compose.material3:material3/1.4.0-alpha18?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.compose.material3:material3/1.4.0-alpha18?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.compose.material3:material3/1.4.0-alpha17/1.4.0-alpha18?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.compose.material3:material3/1.4.0-alpha17/1.4.0-alpha18?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS4yMy4yIiwidXBkYXRlZEluVmVyIjoiNDEuMjMuMiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIl19-->\n", "diff": "diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml\nindex 974f7e984b..0038dbbbbb 100644\n--- a/gradle/libs.versions.toml\n+++ b/gradle/libs.versions.toml\n@@ -30,7 +30,7 @@ kotlinx-coroutines-android = \"1.10.2\"\n kotlinx-serialization-json = \"1.9.0\"\n lifecycle = \"2.9.1\"\n material = \"1.12.0\"\n-material3 = \"1.4.0-alpha17\"\n+material3 = \"1.4.0-alpha18\"\n mgrs = \"2.1.3\"\n navigation = \"2.9.1\"\n okhttp = \"5.1.0\"\n", "changes": [{"file": "gradle/libs.versions.toml", "module": "gradle.libs.versions.toml", "range": [{"start": 33, "end": 34}]}]}, {"number": 2326, "url": "https://github.com/meshtastic/Meshtastic-Android/pull/2326", "diff_url": "https://github.com/meshtastic/Meshtastic-Android/pull/2326.diff", "patch_url": "https://github.com/meshtastic/Meshtastic-Android/pull/2326.patch", "title": "chore(deps): update androidx.compose.material3:material3 to v1.4.0-alpha17", "content": "This PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [androidx.compose.material3:material3](https://developer.android.com/jetpack/androidx/releases/compose-material3#1.3.2) ([source](https://cs.android.com/androidx/platform/frameworks/support)) | `1.4.0-alpha16` -> `1.4.0-alpha17` | [![age](https://developer.mend.io/api/mc/badges/age/maven/androidx.compose.material3:material3/1.4.0-alpha17?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/maven/androidx.compose.material3:material3/1.4.0-alpha17?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/maven/androidx.compose.material3:material3/1.4.0-alpha16/1.4.0-alpha17?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/maven/androidx.compose.material3:material3/1.4.0-alpha16/1.4.0-alpha17?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n **Automerge**: Enabled.\n\n **Rebasing**: Whenever PR is behind base branch, or you tick the rebase/retry checkbox.\n\n **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/meshtastic/Meshtastic-Android).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MS4xNy4yIiwidXBkYXRlZEluVmVyIjoiNDEuMTcuMiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIl19-->\n", "diff": "diff --git a/gradle/libs.versions.toml b/gradle/libs.versions.toml\nindex 085a1a0a78..80c952876c 100644\n--- a/gradle/libs.versions.toml\n+++ b/gradle/libs.versions.toml\n@@ -31,7 +31,7 @@ kotlinx-coroutines-android = \"1.10.2\"\n kotlinx-serialization-json = \"1.9.0\"\n lifecycle = \"2.9.1\"\n material = \"1.12.0\"\n-material3 = \"1.4.0-alpha16\"\n+material3 = \"1.4.0-alpha17\"\n mgrs = \"2.1.3\"\n navigation = \"2.9.0\"\n okhttp = \"4.12.0\"\n", "changes": []}]}
{"url": "https://github.com/AntennaPod/AntennaPod/issues/7866", "repo": {"url": "https://github.com/AntennaPod/AntennaPod", "name": "AntennaPod", "owner": "AntennaPod", "modules": ["com.google.android.material", "de.danoeh.antennapod", "de.danoeh.antennapod.actionbutton", "de.danoeh.antennapod.activity", "de.danoeh.antennapod.event", "de.danoeh.antennapod.model", "de.danoeh.antennapod.net", "de.danoeh.antennapod.parser", "de.danoeh.antennapod.playback", "de.danoeh.antennapod.storage", "de.danoeh.antennapod.ui", "de.test.antennapod", "de.test.antennapod.dialogs", "de.test.antennapod.playback", "de.test.antennapod.service", "de.test.antennapod.ui", "de.test.antennapod.util"]}, "issue": {"number": 7866, "url": "https://github.com/AntennaPod/AntennaPod/issues/7866", "state": "closed", "title": "IllegalArgumentException when searching fyyd", "body": "### Checklist\n\n- [x] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [x] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [x] I will describe the problem with as much detail as possible.\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.8.0f (f68387199)\n\n### Android version\n\n11 \n\n### Device model\n\nOnePlus 7 Pro\n\n### First occurred\n\nToday\n\n### Steps to reproduce\n\n1. Go to \"Add podcast\"\n2. Tap \"Search fyyd\"\n3. Enter text to search for (e.g. \"Future Knowledge\" or \"Serious Trouble\")\n4. Press Enter\n\n### Expected behaviour\n\nI expected AntennaPod to either display podcasts to pick from or say no results were found\n\n### Current behaviour\n\nI get\n```\njava.lang.IllegalArgumentException: Unable to create call adapter for class io.reactivex.Single\n    for method FyydService.searchPodcasts\n```\n\n![Image](https://github.com/user-attachments/assets/e2c3cf7a-78da-4248-a553-c5839c5cb150)\n\n### Logs\n\n[full-logs.txt](https://github.com/user-attachments/files/21084257/full-logs.txt)\n\nEdit: fix autocorrected text", "logs": [{"name": "full-logs.txt", "url": "https://github.com/user-attachments/files/21084257/full-logs.txt"}]}, "pull_request": [{"number": 7880, "url": "https://github.com/AntennaPod/AntennaPod/pull/7880", "diff_url": "https://github.com/AntennaPod/AntennaPod/pull/7880.diff", "patch_url": "https://github.com/AntennaPod/AntennaPod/pull/7880.patch", "title": "Let proguard keep needed RxJava and fyydlin files for Fyyd search ", "content": "### Description\r\n\r\nProguard removed some classes the app needed for the Fyyd search.\r\n\r\nCloses #7866\r\n\r\n### Checklist\r\n<!-- \r\n  To help us keep the issue tracker clean and work as efficient as possible,\r\n  please make sure that you have done all of the following.\r\n  You can tick the boxes below by placing an x inside the brackets like this: [x]\r\n-->\r\n- [X] I have read the contribution guidelines: https://github.com/AntennaPod/AntennaPod/blob/develop/CONTRIBUTING.md#submit-a-pull-request\r\n- [X] I have performed a self-review of my code\r\n- [X] I have run the automated code checks using `./gradlew checkstyle spotbugsPlayDebug spotbugsDebug :app:lintPlayDebug`\r\n- [X] My code follows the style guidelines of the AntennaPod project: https://github.com/AntennaPod/AntennaPod/wiki/Code-style\r\n- [X] I have mentioned the corresponding issue and the relevant keyword (e.g., \"Closes: #xy\") in the description (see https://docs.github.com/en/issues/tracking-your-work-with-issues/linking-a-pull-request-to-an-issue)\r\n- [X] If it is a core feature, I have added automated tests\r\n", "diff": "diff --git a/app/proguard.cfg b/app/proguard.cfg\nindex 1fd4cc5013..135640340a 100644\n--- a/app/proguard.cfg\n+++ b/app/proguard.cfg\n@@ -31,7 +31,11 @@\n # android-iconify\n -keep class com.joanzapata.** { *; }\n \n+# RxJava\n+-keep class io.reactivex.Single\n+\n #### Proguard rules for fyyd client\n+-keep class de.mfietz.fyydlin.** { *; }\n # Retrofit 2.0\n -dontwarn retrofit2.**\n -keep class retrofit2.** { *; }\n", "changes": [{"file": "app/proguard.cfg", "module": "io.reactivex.Single, de.mfietz.fyydlin", "range": [{"start": 34, "end": 34}, {"start": 35, "end": 35}]}]}]}
{"url": "https://github.com/AntennaPod/AntennaPod/issues/7313", "repo": {"url": "https://github.com/AntennaPod/AntennaPod", "name": "AntennaPod", "owner": "AntennaPod", "modules": ["com.google.android.material", "de.danoeh.antennapod", "de.danoeh.antennapod.actionbutton", "de.danoeh.antennapod.activity", "de.danoeh.antennapod.event", "de.danoeh.antennapod.model", "de.danoeh.antennapod.net", "de.danoeh.antennapod.parser", "de.danoeh.antennapod.playback", "de.danoeh.antennapod.storage", "de.danoeh.antennapod.ui", "de.test.antennapod", "de.test.antennapod.dialogs", "de.test.antennapod.playback", "de.test.antennapod.service", "de.test.antennapod.ui", "de.test.antennapod.util"]}, "issue": {"number": 7313, "url": "https://github.com/AntennaPod/AntennaPod/issues/7313", "state": "closed", "title": "database export fails with blank screen ", "body": "### Checklist\n\n- [X] I have used the search function for [**OPEN**](https://github.com/AntennaPod/AntennaPod/issues) issues to see if someone else has already submitted the same bug report.\n- [X] I have **also** used the search function for [**CLOSED**](https://github.com/AntennaPod/AntennaPod/issues?q=is%3Aissue+is%3Aclosed) issues to see if the problem is already solved and just waiting to be released.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n3.4.1\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n 4.14.180-perf+\n\n### Device model\n\nOnePlus 7T HD1900\n\n### First occurred\n\n3 months ago \n\n### Steps to reproduce\n\n## Environment\r\nAndroid version: 12\r\nI want to export my database to move to a new device.\r\n\r\nWhen selecting export database the screen turns white for some seconds and the I get thrown back to the app settings screen.\r\n\r\nThere is no file save dialogue or file picker dialogue.\r\n\r\n\r\nOS version: 4.14.180-perf+\r\nAntennaPod version: 3.4.1\r\nModel: HD1900\r\nDevice: OnePlus7T\r\nProduct: OnePlus7T\n\n### Expected behaviour\n\nAfter database export is selected a file save selection dialogue should show to enter a file name.\n\n### Current behaviour\n\nNo file save or file picker screen is showing after I select database export \n\n### Logs\n\n[antenna full-logs.txt](https://github.com/user-attachments/files/16450992/antenna.full-logs.txt)\r\n", "logs": [{"name": "antenna full-logs.txt", "url": "https://github.com/user-attachments/files/16450992/antenna.full-logs.txt"}]}, "pull_request": [{"number": 7319, "url": "https://github.com/AntennaPod/AntennaPod/pull/7319", "diff_url": "https://github.com/AntennaPod/AntennaPod/pull/7319.diff", "patch_url": "https://github.com/AntennaPod/AntennaPod/pull/7319.patch", "title": "Catch people disabling system file manager", "content": "### Description\r\n\r\nCatch people disabling system file manager\r\nCloses #7313 \r\n\r\n### Checklist\r\n<!-- \r\n  To help us keep the issue tracker clean and work as efficient as possible,\r\n  please make sure that you have done all of the following.\r\n  You can tick the boxes below by placing an x inside the brackets like this: [x]\r\n-->\r\n- [x] I have read the contribution guidelines: https://github.com/AntennaPod/AntennaPod/blob/develop/CONTRIBUTING.md#submit-a-pull-request\r\n- [x] I have performed a self-review of my code\r\n- [x] I have run the automated code checks using `./gradlew checkstyle spotbugsPlayDebug spotbugsDebug :app:lintPlayDebug`\r\n- [x] My code follows the style guidelines of the AntennaPod project: https://github.com/AntennaPod/AntennaPod/wiki/Code-style\r\n- [x] I have mentioned the corresponding issue and the relevant keyword (e.g., \"Closes: #xy\") in the description (see https://docs.github.com/en/issues/tracking-your-work-with-issues/linking-a-pull-request-to-an-issue)\r\n- [x] If it is a core feature, I have added automated tests\r\n", "diff": "diff --git a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ImportExportPreferencesFragment.java b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ImportExportPreferencesFragment.java\nindex 5ffa7e57a1a..81da9c1ae47 100644\n--- a/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ImportExportPreferencesFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ImportExportPreferencesFragment.java\n@@ -137,7 +137,8 @@ private void setupStorageScreen() {\n                     try {\n                         chooseOpmlImportPathLauncher.launch(\"*/*\");\n                     } catch (ActivityNotFoundException e) {\n-                        Log.e(TAG, \"No activity found. Should never happen...\");\n+                        Snackbar.make(getView(), R.string.unable_to_start_system_file_manager, Snackbar.LENGTH_LONG)\n+                                .show();\n                     }\n                     return true;\n                 });\n@@ -148,7 +149,12 @@ private void setupStorageScreen() {\n                 });\n         findPreference(PREF_DATABASE_EXPORT).setOnPreferenceClickListener(\n                 preference -> {\n-                    backupDatabaseLauncher.launch(dateStampFilename(DATABASE_EXPORT_FILENAME));\n+                    try {\n+                        backupDatabaseLauncher.launch(dateStampFilename(DATABASE_EXPORT_FILENAME));\n+                    } catch (ActivityNotFoundException e) {\n+                        Snackbar.make(getView(), R.string.unable_to_start_system_file_manager, Snackbar.LENGTH_LONG)\n+                                .show();\n+                    }\n                     return true;\n                 });\n         ((SwitchPreferenceCompat) findPreference(PREF_AUTOMATIC_DATABASE_EXPORT))\n@@ -159,7 +165,6 @@ private void setupStorageScreen() {\n                         try {\n                             automaticBackupLauncher.launch(null);\n                         } catch (ActivityNotFoundException e) {\n-                            e.printStackTrace();\n                             Snackbar.make(getView(), R.string.unable_to_start_system_file_manager, Snackbar.LENGTH_LONG)\n                                     .show();\n                         }\n@@ -192,7 +197,12 @@ private void importDatabase() {\n         builder.setPositiveButton(R.string.confirm_label, (dialog, which) -> {\n             Intent intent = new Intent(Intent.ACTION_OPEN_DOCUMENT);\n             intent.setType(\"*/*\");\n-            restoreDatabaseLauncher.launch(intent);\n+            try {\n+                restoreDatabaseLauncher.launch(intent);\n+            } catch (ActivityNotFoundException e) {\n+                Snackbar.make(getView(), R.string.unable_to_start_system_file_manager, Snackbar.LENGTH_LONG)\n+                        .show();\n+            }\n         });\n \n         // create and show the alert dialog\n@@ -271,7 +281,8 @@ private void openExportPathPicker(Export exportType, ActivityResultLauncher<Inte\n             result.launch(intentPickAction);\n             return;\n         } catch (ActivityNotFoundException e) {\n-            Log.e(TAG, \"No activity found. Should never happen...\");\n+            Snackbar.make(getView(), R.string.unable_to_start_system_file_manager, Snackbar.LENGTH_LONG)\n+                    .show();\n         }\n \n         // If we are using a SDK lower than API 21 or the implicit intent failed\n", "changes": [{"file": "app/src/main/java/de/danoeh/antennapod/ui/screen/preferences/ImportExportPreferencesFragment.java", "module": "de.danoeh.antennapod.ui.screen.preferences.ImportExportPreferencesFragment", "range": [{"start": 140, "end": 141}, {"start": 151, "end": 152}, {"start": 162, "end": 162}, {"start": 195, "end": 196}, {"start": 274, "end": 275}]}]}]}
{"url": "https://github.com/AntennaPod/AntennaPod/issues/5723", "repo": {"url": "https://github.com/AntennaPod/AntennaPod", "name": "AntennaPod", "owner": "AntennaPod", "modules": ["com.google.android.material", "de.danoeh.antennapod", "de.danoeh.antennapod.actionbutton", "de.danoeh.antennapod.activity", "de.danoeh.antennapod.event", "de.danoeh.antennapod.model", "de.danoeh.antennapod.net", "de.danoeh.antennapod.parser", "de.danoeh.antennapod.playback", "de.danoeh.antennapod.storage", "de.danoeh.antennapod.ui", "de.test.antennapod", "de.test.antennapod.dialogs", "de.test.antennapod.playback", "de.test.antennapod.service", "de.test.antennapod.ui", "de.test.antennapod.util"]}, "issue": {"number": 5723, "url": "https://github.com/AntennaPod/AntennaPod/issues/5723", "state": "closed", "title": "Local file: do not play from drawer", "body": "### Checklist\n\n- [X] I have used the search function to see if someone else has already submitted the same bug report.\n- [X] I will describe the problem with as much detail as possible.\n- [X] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\n\n### App version\n\n2.4.2\n\n### Where did you get the app from\n\nGoogle Play\n\n### Android version\n\n11\n\n### Device model\n\nPoco X3 Pro\n\n### First occurred\n\n_No response_\n\n### Steps to reproduce\n\n1. Add local folder\r\n2. Play audio\r\n3. Tap from drawer to play next\n\n### Expected behaviour\n\nPlaying of next local file.\n\n### Current behaviour\n\nNo playing, recorded video about this issue: https://www.youtube.com/watch?v=LmHuUP-_VDk\n\n### Logs\n\n[full-logs.txt](https://github.com/AntennaPod/AntennaPod/files/8075417/full-logs.txt)\r\n", "logs": [{"name": "full-logs.txt", "url": "https://github.com/AntennaPod/AntennaPod/files/8075417/full-logs.txt"}]}, "pull_request": [{"number": 5726, "url": "https://github.com/AntennaPod/AntennaPod/pull/5726", "diff_url": "https://github.com/AntennaPod/AntennaPod/pull/5726.diff", "patch_url": "https://github.com/AntennaPod/AntennaPod/pull/5726.patch", "title": "Decide whether or not to stream on demand", "content": "Fixes a bug where local folders sometimes did not start because AntennaPod\r\nthought it needed to play locally. Also avoids situations in which it\r\nstreams even though a local file is available. Simplifies the\r\nPlaybackService slightly.\r\n\r\nCloses #5723\r\n", "diff": "diff --git a/app/src/androidTest/java/de/test/antennapod/storage/AutoDownloadTest.java b/app/src/androidTest/java/de/test/antennapod/storage/AutoDownloadTest.java\nindex 23c129cb197..c9b8ef37141 100644\n--- a/app/src/androidTest/java/de/test/antennapod/storage/AutoDownloadTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/storage/AutoDownloadTest.java\n@@ -100,7 +100,6 @@ private void playEpisode(@NonNull FeedItem item) {\n         new PlaybackServiceStarter(context, media)\n                 .callEvenIfRunning(true)\n                 .startWhenPrepared(true)\n-                .shouldStream(true)\n                 .start();\n         Awaitility.await(\"episode is playing\")\n                 .atMost(2000, MILLISECONDS)\ndiff --git a/app/src/main/java/de/danoeh/antennapod/adapter/FeedItemlistDescriptionAdapter.java b/app/src/main/java/de/danoeh/antennapod/adapter/FeedItemlistDescriptionAdapter.java\nindex 5ddb6407cff..6073e97be72 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/FeedItemlistDescriptionAdapter.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/FeedItemlistDescriptionAdapter.java\n@@ -80,7 +80,6 @@ public View getView(int position, @Nullable View convertView, @NonNull ViewGroup\n             }\n \n             new PlaybackServiceStarter(getContext(), playable)\n-                    .shouldStream(true)\n                     .startWhenPrepared(true)\n                     .callEvenIfRunning(true)\n                     .start();\ndiff --git a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/PlayActionButton.java b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/PlayActionButton.java\nindex 974b12babd0..528f38ba738 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/PlayActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/PlayActionButton.java\n@@ -42,7 +42,6 @@ public void onClick(Context context) {\n         new PlaybackServiceStarter(context, media)\n                 .callEvenIfRunning(true)\n                 .startWhenPrepared(true)\n-                .shouldStream(false)\n                 .start();\n \n         if (media.getMediaType() == MediaType.VIDEO) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/PlayLocalActionButton.java b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/PlayLocalActionButton.java\nindex ab2122b1235..47cd4d66b78 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/PlayLocalActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/PlayLocalActionButton.java\n@@ -38,7 +38,6 @@ public void onClick(Context context) {\n         new PlaybackServiceStarter(context, media)\n                 .callEvenIfRunning(true)\n                 .startWhenPrepared(true)\n-                .shouldStream(true)\n                 .start();\n \n         if (media.getMediaType() == MediaType.VIDEO) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/StreamActionButton.java b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/StreamActionButton.java\nindex 94c446f506e..244022c1c10 100644\n--- a/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/StreamActionButton.java\n+++ b/app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/StreamActionButton.java\n@@ -48,7 +48,6 @@ public void onClick(Context context) {\n         new PlaybackServiceStarter(context, media)\n                 .callEvenIfRunning(true)\n                 .startWhenPrepared(true)\n-                .shouldStream(true)\n                 .start();\n \n         if (media.getMediaType() == MediaType.VIDEO) {\ndiff --git a/app/src/main/java/de/danoeh/antennapod/dialog/StreamingConfirmationDialog.java b/app/src/main/java/de/danoeh/antennapod/dialog/StreamingConfirmationDialog.java\nindex 22f62d410dd..e0bd596250e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/dialog/StreamingConfirmationDialog.java\n+++ b/app/src/main/java/de/danoeh/antennapod/dialog/StreamingConfirmationDialog.java\n@@ -33,7 +33,6 @@ private void stream() {\n         new PlaybackServiceStarter(context, playable)\n                 .callEvenIfRunning(true)\n                 .startWhenPrepared(true)\n-                .shouldStream(true)\n                 .shouldStreamThisTime(true)\n                 .start();\n     }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/preferences/PlaybackPreferences.java b/core/src/main/java/de/danoeh/antennapod/core/preferences/PlaybackPreferences.java\nindex f0c61403f60..b0321bff644 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/preferences/PlaybackPreferences.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/preferences/PlaybackPreferences.java\n@@ -44,11 +44,6 @@ public class PlaybackPreferences implements SharedPreferences.OnSharedPreference\n     private static final String PREF_CURRENTLY_PLAYING_MEDIA_TYPE\n             = \"de.danoeh.antennapod.preferences.currentlyPlayingMedia\";\n \n-    /**\n-     * True if last played media was streamed.\n-     */\n-    private static final String PREF_CURRENT_EPISODE_IS_STREAM = \"de.danoeh.antennapod.preferences.lastIsStream\";\n-\n     /**\n      * True if last played media was a video.\n      */\n@@ -113,10 +108,6 @@ public static long getCurrentlyPlayingFeedMediaId() {\n         return prefs.getLong(PREF_CURRENTLY_PLAYING_FEEDMEDIA_ID, NO_MEDIA_PLAYING);\n     }\n \n-    public static boolean getCurrentEpisodeIsStream() {\n-        return prefs.getBoolean(PREF_CURRENT_EPISODE_IS_STREAM, true);\n-    }\n-\n     public static boolean getCurrentEpisodeIsVideo() {\n         return prefs.getBoolean(PREF_CURRENT_EPISODE_IS_VIDEO, false);\n     }\n@@ -138,7 +129,7 @@ public static void writeNoMediaPlaying() {\n         editor.apply();\n     }\n \n-    public static void writeMediaPlaying(Playable playable, PlayerStatus playerStatus, boolean stream) {\n+    public static void writeMediaPlaying(Playable playable, PlayerStatus playerStatus) {\n         Log.d(TAG, \"Writing playback preferences\");\n         SharedPreferences.Editor editor = prefs.edit();\n \n@@ -146,7 +137,6 @@ public static void writeMediaPlaying(Playable playable, PlayerStatus playerStatu\n             writeNoMediaPlaying();\n         } else {\n             editor.putLong(PREF_CURRENTLY_PLAYING_MEDIA_TYPE, playable.getPlayableType());\n-            editor.putBoolean(PREF_CURRENT_EPISODE_IS_STREAM, stream);\n             editor.putBoolean(PREF_CURRENT_EPISODE_IS_VIDEO, playable.getMediaType() == MediaType.VIDEO);\n             if (playable instanceof FeedMedia) {\n                 FeedMedia feedMedia = (FeedMedia) playable;\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java\nindex db6088d8df2..1ef06c51160 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java\n@@ -868,7 +868,6 @@ public void onAudioFocusChange(final int focusChange) {\n                     pausedBecauseOfTransientAudiofocusLoss = false;\n                     new PlaybackServiceStarter(context, getPlayable())\n                             .startWhenPrepared(true)\n-                            .streamIfLastWasStream()\n                             .callEvenIfRunning(false)\n                             .start();\n                 }\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\nindex 76fdc104047..c6cff1bd3ab 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java\n@@ -108,7 +108,6 @@ public class PlaybackService extends MediaBrowserServiceCompat {\n     private static final String TAG = \"PlaybackService\";\n \n     public static final String EXTRA_PLAYABLE = \"PlaybackService.PlayableExtra\";\n-    public static final String EXTRA_SHOULD_STREAM = \"extra.de.danoeh.antennapod.core.service.shouldStream\";\n     public static final String EXTRA_ALLOW_STREAM_THIS_TIME = \"extra.de.danoeh.antennapod.core.service.allowStream\";\n     public static final String EXTRA_ALLOW_STREAM_ALWAYS = \"extra.de.danoeh.antennapod.core.service.allowStreamAlways\";\n     public static final String EXTRA_START_WHEN_PREPARED = \"extra.de.danoeh.antennapod.core.service.startWhenPrepared\";\n@@ -522,7 +521,6 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n                 }\n             } else {\n                 stateManager.validStartCommandWasReceived();\n-                boolean stream = intent.getBooleanExtra(EXTRA_SHOULD_STREAM, true);\n                 boolean allowStreamThisTime = intent.getBooleanExtra(EXTRA_ALLOW_STREAM_THIS_TIME, false);\n                 boolean allowStreamAlways = intent.getBooleanExtra(EXTRA_ALLOW_STREAM_ALWAYS, false);\n                 boolean startWhenPrepared = intent.getBooleanExtra(EXTRA_START_WHEN_PREPARED, false);\n@@ -531,14 +529,6 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n                 if (allowStreamAlways) {\n                     UserPreferences.setAllowMobileStreaming(true);\n                 }\n-                boolean localFeed = URLUtil.isContentUrl(playable.getStreamUrl());\n-                if (stream && !NetworkUtils.isStreamingAllowed() && !allowStreamThisTime && !localFeed) {\n-                    displayStreamingNotAllowedNotification(intent);\n-                    PlaybackPreferences.writeNoMediaPlaying();\n-                    stateManager.stopService();\n-                    return Service.START_NOT_STICKY;\n-                }\n-\n                 Observable.fromCallable(\n                         () -> {\n                             if (playable instanceof FeedMedia) {\n@@ -550,15 +540,9 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n                         .subscribeOn(Schedulers.io())\n                         .observeOn(AndroidSchedulers.mainThread())\n                         .subscribe(\n-                                playableLoaded -> {\n-                                    if (!playable.getIdentifier().equals(\n-                                            PlaybackPreferences.getCurrentlyPlayingFeedMediaId())) {\n-                                        PlaybackPreferences.clearCurrentlyPlayingTemporaryPlaybackSpeed();\n-                                    }\n-                                    mediaPlayer.playMediaObject(playableLoaded, stream, startWhenPrepared,\n-                                            prepareImmediately);\n-                                    addPlayableToQueue(playableLoaded);\n-                                }, error -> {\n+                                loadedPlayable -> startPlaying(loadedPlayable, allowStreamThisTime,\n+                                        startWhenPrepared, prepareImmediately),\n+                                error -> {\n                                     Log.d(TAG, \"Playable was not found. Stopping service.\");\n                                     error.printStackTrace();\n                                     stateManager.stopService();\n@@ -741,32 +725,39 @@ private void startPlayingFromPreferences() {\n                 .subscribeOn(Schedulers.io())\n                 .observeOn(AndroidSchedulers.mainThread())\n                 .subscribe(\n-                        playable -> {\n-                            boolean localFeed = URLUtil.isContentUrl(playable.getStreamUrl());\n-                            if (PlaybackPreferences.getCurrentEpisodeIsStream()\n-                                    && !NetworkUtils.isStreamingAllowed() && !localFeed) {\n-                                displayStreamingNotAllowedNotification(\n-                                        new PlaybackServiceStarter(this, playable)\n-                                                .prepareImmediately(true)\n-                                                .startWhenPrepared(true)\n-                                                .shouldStream(true)\n-                                                .getIntent());\n-                                PlaybackPreferences.writeNoMediaPlaying();\n-                                stateManager.stopService();\n-                                return;\n-                            }\n-                            mediaPlayer.playMediaObject(playable, PlaybackPreferences.getCurrentEpisodeIsStream(),\n-                                    true, true);\n-                            stateManager.validStartCommandWasReceived();\n-                            updateNotificationAndMediaSession(playable);\n-                            addPlayableToQueue(playable);\n-                        }, error -> {\n+                        playable -> startPlaying(playable, false, true, true),\n+                        error -> {\n                             Log.d(TAG, \"Playable was not loaded from preferences. Stopping service.\");\n                             error.printStackTrace();\n                             stateManager.stopService();\n                         });\n     }\n \n+    private void startPlaying(Playable playable, boolean allowStreamThisTime,\n+                              boolean startWhenPrepared, boolean prepareImmediately) {\n+        boolean localFeed = URLUtil.isContentUrl(playable.getStreamUrl());\n+        boolean stream = !playable.localFileAvailable() || localFeed;\n+        if (stream && !localFeed && !NetworkUtils.isStreamingAllowed() && !allowStreamThisTime) {\n+            displayStreamingNotAllowedNotification(\n+                    new PlaybackServiceStarter(this, playable)\n+                            .prepareImmediately(true)\n+                            .startWhenPrepared(true)\n+                            .getIntent());\n+            PlaybackPreferences.writeNoMediaPlaying();\n+            stateManager.stopService();\n+            return;\n+        }\n+\n+        if (!playable.getIdentifier().equals(PlaybackPreferences.getCurrentlyPlayingFeedMediaId())) {\n+            PlaybackPreferences.clearCurrentlyPlayingTemporaryPlaybackSpeed();\n+        }\n+\n+        mediaPlayer.playMediaObject(playable, stream, startWhenPrepared, prepareImmediately);\n+        stateManager.validStartCommandWasReceived();\n+        updateNotificationAndMediaSession(playable);\n+        addPlayableToQueue(playable);\n+    }\n+\n     /**\n      * Called by a mediaplayer Activity as soon as it has prepared its\n      * mediaplayer.\n@@ -792,7 +783,7 @@ public void positionSaverTick() {\n         @Override\n         public WidgetUpdater.WidgetState requestWidgetState() {\n             return new WidgetUpdater.WidgetState(getPlayable(), getStatus(),\n-                    getCurrentPosition(), getDuration(), getCurrentPlaybackSpeed(), isCasting());\n+                    getCurrentPosition(), getDuration(), getCurrentPlaybackSpeed());\n         }\n \n         @Override\n@@ -814,7 +805,7 @@ public void statusChanged(PlaybackServiceMediaPlayer.PSMPInfo newInfo) {\n             switch (newInfo.playerStatus) {\n                 case INITIALIZED:\n                     PlaybackPreferences.writeMediaPlaying(mediaPlayer.getPSMPInfo().playable,\n-                            mediaPlayer.getPSMPInfo().playerStatus, mediaPlayer.isStreaming());\n+                            mediaPlayer.getPSMPInfo().playerStatus);\n                     updateNotificationAndMediaSession(newInfo.playable);\n                     break;\n                 case PREPARED:\n@@ -1005,7 +996,7 @@ private Playable getNextInQueue(final Playable currentMedia) {\n \n         if (!UserPreferences.isFollowQueue()) {\n             Log.d(TAG, \"getNextInQueue(), but follow queue is not enabled.\");\n-            PlaybackPreferences.writeMediaPlaying(nextItem.getMedia(), PlayerStatus.STOPPED, false);\n+            PlaybackPreferences.writeMediaPlaying(nextItem.getMedia(), PlayerStatus.STOPPED);\n             updateNotificationAndMediaSession(nextItem.getMedia());\n             return null;\n         }\n@@ -1016,7 +1007,6 @@ private Playable getNextInQueue(final Playable currentMedia) {\n                     new PlaybackServiceStarter(this, nextItem.getMedia())\n                             .prepareImmediately(true)\n                             .startWhenPrepared(true)\n-                            .shouldStream(true)\n                             .getIntent());\n             PlaybackPreferences.writeNoMediaPlaying();\n             stateManager.stopService();\n@@ -1805,8 +1795,7 @@ public void onPlayFromMediaId(String mediaId, Bundle extras) {\n             Log.d(TAG, \"onPlayFromMediaId: mediaId: \" + mediaId + \" extras: \" + extras.toString());\n             FeedMedia p = DBReader.getFeedMedia(Long.parseLong(mediaId));\n             if (p != null) {\n-                mediaPlayer.playMediaObject(p, !p.localFileAvailable(), true, true);\n-                addPlayableToQueue(p);\n+                startPlaying(p, false, true, true);\n             }\n         }\n \n@@ -1817,8 +1806,7 @@ public void onPlayFromSearch(String query, Bundle extras) {\n             List<FeedItem> results = FeedSearcher.searchFeedItems(getBaseContext(), query, 0);\n             if (results.size() > 0 && results.get(0).getMedia() != null) {\n                 FeedMedia media = results.get(0).getMedia();\n-                mediaPlayer.playMediaObject(media, !media.localFileAvailable(), true, true);\n-                addPlayableToQueue(media);\n+                startPlaying(media, false, true, true);\n                 return;\n             }\n             onPlay();\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackController.java b/core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackController.java\nindex 549171c765a..687a0d80a9e 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackController.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackController.java\n@@ -331,7 +331,6 @@ public void playPause() {\n         if (playbackService == null) {\n             new PlaybackServiceStarter(activity, media)\n                     .startWhenPrepared(true)\n-                    .streamIfLastWasStream()\n                     .start();\n             Log.w(TAG, \"Play/Pause button was pressed, but playbackservice was null!\");\n             return;\n@@ -354,7 +353,6 @@ public void playPause() {\n             default:\n                 new PlaybackServiceStarter(activity, media)\n                         .startWhenPrepared(true)\n-                        .streamIfLastWasStream()\n                         .callEvenIfRunning(true)\n                         .start();\n                 Log.w(TAG, \"Play/Pause button was pressed and PlaybackService state was unknown\");\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackServiceStarter.java b/core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackServiceStarter.java\nindex 3efded9ed0a..7cf6b9adbca 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackServiceStarter.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackServiceStarter.java\n@@ -5,7 +5,6 @@\n import android.os.Parcelable;\n import androidx.core.content.ContextCompat;\n \n-import de.danoeh.antennapod.core.preferences.PlaybackPreferences;\n import de.danoeh.antennapod.core.service.playback.PlaybackService;\n import de.danoeh.antennapod.model.playback.Playable;\n \n@@ -13,7 +12,6 @@ public class PlaybackServiceStarter {\n     private final Context context;\n     private final Playable media;\n     private boolean startWhenPrepared = false;\n-    private boolean shouldStream = false;\n     private boolean shouldStreamThisTime = false;\n     private boolean callEvenIfRunning = false;\n     private boolean prepareImmediately = true;\n@@ -23,19 +21,6 @@ public PlaybackServiceStarter(Context context, Playable media) {\n         this.media = media;\n     }\n \n-    /**\n-     * Default value: false\n-     */\n-    public PlaybackServiceStarter shouldStream(boolean shouldStream) {\n-        this.shouldStream = shouldStream;\n-        return this;\n-    }\n-\n-    public PlaybackServiceStarter streamIfLastWasStream() {\n-        boolean lastIsStream = PlaybackPreferences.getCurrentEpisodeIsStream();\n-        return shouldStream(lastIsStream);\n-    }\n-\n     /**\n      * Default value: false\n      */\n@@ -69,7 +54,6 @@ public Intent getIntent() {\n         Intent launchIntent = new Intent(context, PlaybackService.class);\n         launchIntent.putExtra(PlaybackService.EXTRA_PLAYABLE, (Parcelable) media);\n         launchIntent.putExtra(PlaybackService.EXTRA_START_WHEN_PREPARED, startWhenPrepared);\n-        launchIntent.putExtra(PlaybackService.EXTRA_SHOULD_STREAM, shouldStream);\n         launchIntent.putExtra(PlaybackService.EXTRA_PREPARE_IMMEDIATELY, prepareImmediately);\n         launchIntent.putExtra(PlaybackService.EXTRA_ALLOW_STREAM_THIS_TIME, shouldStreamThisTime);\n \ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/widget/WidgetUpdater.java b/core/src/main/java/de/danoeh/antennapod/core/widget/WidgetUpdater.java\nindex 2762fb9fe86..1253c747b21 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/widget/WidgetUpdater.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/widget/WidgetUpdater.java\n@@ -45,20 +45,17 @@ public static class WidgetState {\n         final int position;\n         final int duration;\n         final float playbackSpeed;\n-        final boolean isCasting;\n \n-        public WidgetState(Playable media, PlayerStatus status, int position, int duration,\n-                           float playbackSpeed, boolean isCasting) {\n+        public WidgetState(Playable media, PlayerStatus status, int position, int duration, float playbackSpeed) {\n             this.media = media;\n             this.status = status;\n             this.position = position;\n             this.duration = duration;\n             this.playbackSpeed = playbackSpeed;\n-            this.isCasting = isCasting;\n         }\n \n         public WidgetState(PlayerStatus status) {\n-            this(null, status, Playable.INVALID_TIME, Playable.INVALID_TIME, 1.0f, false);\n+            this(null, status, Playable.INVALID_TIME, Playable.INVALID_TIME, 1.0f);\n         }\n     }\n \n@@ -71,8 +68,7 @@ public static void updateWidget(Context context, WidgetState widgetState) {\n         }\n \n         PendingIntent startMediaPlayer;\n-        if (widgetState.media != null && widgetState.media.getMediaType() == MediaType.VIDEO\n-                && !widgetState.isCasting) {\n+        if (widgetState.media != null && widgetState.media.getMediaType() == MediaType.VIDEO) {\n             startMediaPlayer = new VideoPlayerActivityStarter(context).getPendingIntent();\n         } else {\n             startMediaPlayer = new MainActivityStarter(context).withOpenPlayer().getPendingIntent();\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/widget/WidgetUpdaterJobService.java b/core/src/main/java/de/danoeh/antennapod/core/widget/WidgetUpdaterJobService.java\nindex 325c508c5f1..598544a0c52 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/widget/WidgetUpdaterJobService.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/widget/WidgetUpdaterJobService.java\n@@ -5,7 +5,6 @@\n import androidx.annotation.NonNull;\n import androidx.core.app.SafeJobIntentService;\n import de.danoeh.antennapod.core.feed.util.PlaybackSpeedUtils;\n-import de.danoeh.antennapod.core.preferences.PlaybackPreferences;\n import de.danoeh.antennapod.model.playback.Playable;\n import de.danoeh.antennapod.core.util.playback.PlayableUtils;\n import de.danoeh.antennapod.playback.base.PlayerStatus;\n@@ -26,8 +25,7 @@ protected void onHandleWork(@NonNull Intent intent) {\n         Playable media = PlayableUtils.createInstanceFromPreferences(getApplicationContext());\n         if (media != null) {\n             WidgetUpdater.updateWidget(this, new WidgetUpdater.WidgetState(media, PlayerStatus.STOPPED,\n-                    media.getPosition(), media.getDuration(), PlaybackSpeedUtils.getCurrentPlaybackSpeed(media),\n-                    PlaybackPreferences.getCurrentEpisodeIsStream()));\n+                    media.getPosition(), media.getDuration(), PlaybackSpeedUtils.getCurrentPlaybackSpeed(media)));\n         } else {\n             WidgetUpdater.updateWidget(this, new WidgetUpdater.WidgetState(PlayerStatus.STOPPED));\n         }\n", "changes": [{"file": "app/src/androidTest/java/de/test/antennapod/storage/AutoDownloadTest.java", "module": "de.test.antennapod.storage.AutoDownloadTest", "range": [{"start": 103, "end": 103}]}, {"file": "app/src/main/java/de/danoeh/antennapod/adapter/FeedItemlistDescriptionAdapter.java", "module": "de.danoeh.antennapod.adapter.FeedItemlistDescriptionAdapter", "range": [{"start": 83, "end": 83}]}, {"file": "app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/PlayActionButton.java", "module": "de.danoeh.antennapod.adapter.actionbutton.PlayActionButton", "range": [{"start": 45, "end": 45}]}, {"file": "app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/PlayLocalActionButton.java", "module": "de.danoeh.antennapod.adapter.actionbutton.PlayLocalActionButton", "range": [{"start": 41, "end": 41}]}, {"file": "app/src/main/java/de/danoeh/antennapod/adapter/actionbutton/StreamActionButton.java", "module": "de.danoeh.antennapod.adapter.actionbutton.StreamActionButton", "range": [{"start": 51, "end": 51}]}, {"file": "app/src/main/java/de/danoeh/antennapod/dialog/StreamingConfirmationDialog.java", "module": "de.danoeh.antennapod.dialog.StreamingConfirmationDialog", "range": [{"start": 36, "end": 36}]}, {"file": "core/src/main/java/de/danoeh/antennapod/core/preferences/PlaybackPreferences.java", "module": "de.danoeh.antennapod.core.preferences.PlaybackPreferences", "range": [{"start": 47, "end": 51}, {"start": 116, "end": 119}, {"start": 141, "end": 142}, {"start": 149, "end": 149}]}, {"file": "core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java", "module": "de.danoeh.antennapod.core.service.playback.LocalPSMP", "range": [{"start": 871, "end": 871}]}, {"file": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "module": "de.danoeh.antennapod.core.service.playback.PlaybackService", "range": [{"start": 111, "end": 111}, {"start": 525, "end": 525}, {"start": 534, "end": 541}, {"start": 553, "end": 562}, {"start": 744, "end": 764}, {"start": 770, "end": 770}, {"start": 795, "end": 796}, {"start": 817, "end": 818}, {"start": 1008, "end": 1009}, {"start": 1019, "end": 1019}, {"start": 1808, "end": 1810}, {"start": 1820, "end": 1822}]}, {"file": "core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackController.java", "module": "de.danoeh.antennapod.core.util.playback.PlaybackController", "range": [{"start": 334, "end": 334}, {"start": 357, "end": 357}]}, {"file": "core/src/main/java/de/danoeh/antennapod/core/util/playback/PlaybackServiceStarter.java", "module": "de.danoeh.antennapod.core.util.playback.PlaybackServiceStarter", "range": [{"start": 8, "end": 8}, {"start": 16, "end": 16}, {"start": 26, "end": 38}, {"start": 72, "end": 72}]}, {"file": "core/src/main/java/de/danoeh/antennapod/core/widget/WidgetUpdater.java", "module": "de.danoeh.antennapod.core.widget.WidgetUpdater", "range": [{"start": 48, "end": 48}, {"start": 50, "end": 52}, {"start": 57, "end": 57}, {"start": 61, "end": 62}, {"start": 74, "end": 76}]}, {"file": "core/src/main/java/de/danoeh/antennapod/core/widget/WidgetUpdaterJobService.java", "module": "de.danoeh.antennapod.core.widget.WidgetUpdaterJobService", "range": [{"start": 8, "end": 8}, {"start": 29, "end": 31}]}]}]}
{"url": "https://github.com/AntennaPod/AntennaPod/issues/5500", "repo": {"url": "https://github.com/AntennaPod/AntennaPod", "name": "AntennaPod", "owner": "AntennaPod", "modules": ["com.google.android.material", "de.danoeh.antennapod", "de.danoeh.antennapod.actionbutton", "de.danoeh.antennapod.activity", "de.danoeh.antennapod.event", "de.danoeh.antennapod.model", "de.danoeh.antennapod.net", "de.danoeh.antennapod.parser", "de.danoeh.antennapod.playback", "de.danoeh.antennapod.storage", "de.danoeh.antennapod.ui", "de.test.antennapod", "de.test.antennapod.dialogs", "de.test.antennapod.playback", "de.test.antennapod.service", "de.test.antennapod.ui", "de.test.antennapod.util"]}, "issue": {"number": 5500, "url": "https://github.com/AntennaPod/AntennaPod/issues/5500", "state": "closed", "title": "Can't subscribe to new podcasts: Read only filesystem", "body": "# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same bug report.\r\n- [x] I will describe the problem with as much detail as possible.\r\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n# System info\r\n\r\n## Environment\r\nAndroid version: 11\r\nOS version: 5.4.61-qgki-g8108ef8ac542\r\nAntennaPod version: 2.4.0\r\nModel: LE2123\r\nDevice: OnePlus9Pro\r\nProduct: OnePlus9Pro_EEA\r\n\r\n**App source**: Google Play / F-Droid / ...\r\nBoth sources have the same behaviour\r\n\r\n**Android version**: 5.x (Please mention if you are using a custom rom!)\r\nlineage \"nightly\" currently 19/10/21\r\n# Bug description\r\n\r\n**Steps to reproduce**:\r\nmenu > add podcast > tap thumbnail\r\n\r\n**Current behaviour**:\r\nerror message. see attached log\r\n\r\n**First occurred**: (e.g. about x days/weeks ago)\r\nSorry. Unsure. Possibly forever? I imported my subscriptions from my last device.\r\n\r\n**Environment**:\r\nNothing special comes to mind, but I note that :\r\n\r\n- all permissions are granted and\r\n- there is only one \"data folder\" available to be selected\r\n\r\n[full-logs.txt](https://github.com/AntennaPod/AntennaPod/files/7437459/full-logs.txt)\r\n![Screenshot_20211021-142220_AntennaPod](https://user-images.githubusercontent.com/1776123/139340343-32576a3f-4abf-437b-994a-dbcfe16da576.png)\r\n![data_folder-2021-10-29-104239](https://user-images.githubusercontent.com/1776123/139340599-41c6bcd9-91bd-4077-945e-3bcefd8513a1.png)\r\n", "logs": [{"name": "full-logs.txt", "url": "https://github.com/AntennaPod/AntennaPod/files/7437459/full-logs.txt"}]}, "pull_request": [{"number": 5502, "url": "https://github.com/AntennaPod/AntennaPod/pull/5502", "diff_url": "https://github.com/AntennaPod/AntennaPod/pull/5502.diff", "patch_url": "https://github.com/AntennaPod/AntennaPod/pull/5502.patch", "title": "Use data folder for initial subscriptions", "content": "Closes #5500", "diff": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\nindex ec9e20deaf6..4dca1fda7d5 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n@@ -46,10 +46,10 @@\n import de.danoeh.antennapod.core.storage.DBWriter;\n import de.danoeh.antennapod.core.storage.DownloadRequestException;\n import de.danoeh.antennapod.core.storage.DownloadRequester;\n+import de.danoeh.antennapod.core.util.FileNameGenerator;\n import de.danoeh.antennapod.parser.feed.FeedHandler;\n import de.danoeh.antennapod.parser.feed.FeedHandlerResult;\n import de.danoeh.antennapod.core.util.DownloadError;\n-import de.danoeh.antennapod.core.util.FileNameGenerator;\n import de.danoeh.antennapod.core.util.IntentUtils;\n import de.danoeh.antennapod.core.util.StorageUtils;\n import de.danoeh.antennapod.core.util.URLChecker;\n@@ -261,8 +261,13 @@ private void startFeedDownload(String url, String username, String password) {\n             feed.setPreferences(new FeedPreferences(0, false, FeedPreferences.AutoDeleteAction.GLOBAL,\n                     VolumeAdaptionSetting.OFF, username, password));\n         }\n-        String fileUrl = new File(getExternalCacheDir(),\n-                FileNameGenerator.generateFileName(feed.getDownload_url())).toString();\n+        String fileUrl;\n+        try {\n+            fileUrl = DownloadRequester.getInstance().getDownloadPathForFeed(feed).getAbsolutePath();\n+        } catch (DownloadRequestException e) {\n+            e.printStackTrace();\n+            fileUrl = new File(getCacheDir(), FileNameGenerator.generateFileName(feed.getDownload_url())).toString();\n+        }\n         feed.setFile_url(fileUrl);\n         final DownloadRequest request = new DownloadRequest(feed.getFile_url(),\n                 feed.getDownload_url(), \"OnlineFeed\", 0, Feed.FEEDFILETYPE_FEED, username, password,\ndiff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/DownloadRequester.java b/core/src/main/java/de/danoeh/antennapod/core/storage/DownloadRequester.java\nindex f45cb2b66b2..6192edf7cfc 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/DownloadRequester.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/DownloadRequester.java\n@@ -218,7 +218,7 @@ public synchronized void downloadFeeds(Context context, List<Feed> feeds, boolea\n             args.putInt(REQUEST_ARG_PAGE_NR, feed.getPageNr());\n             args.putBoolean(REQUEST_ARG_LOAD_ALL_PAGES, loadAllPages);\n \n-            DownloadRequest request = createRequest(feed, null, new File(getFeedfilePath(), getFeedfileName(feed)),\n+            DownloadRequest request = createRequest(feed, null, getDownloadPathForFeed(feed),\n                     true, username, password, lastModified, true, args, initiatedByUser\n             );\n             if (request != null) {\n@@ -230,6 +230,10 @@ public synchronized void downloadFeeds(Context context, List<Feed> feeds, boolea\n         }\n     }\n \n+    public File getDownloadPathForFeed(Feed feed) throws DownloadRequestException {\n+        return new File(getFeedfilePath(), getFeedfileName(feed));\n+    }\n+\n     public synchronized void downloadFeed(Context context, Feed feed) throws DownloadRequestException {\n         downloadFeed(context, feed, false, false, true);\n     }\n", "changes": [{"file": "app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java", "module": "de.danoeh.antennapod.activity.OnlineFeedViewActivity", "range": [{"start": 49, "end": 49}, {"start": 52, "end": 52}, {"start": 264, "end": 266}]}, {"file": "core/src/main/java/de/danoeh/antennapod/core/storage/DownloadRequester.java", "module": "de.danoeh.antennapod.core.storage.DownloadRequester", "range": [{"start": 221, "end": 222}, {"start": 233, "end": 233}]}]}]}
{"url": "https://github.com/AntennaPod/AntennaPod/issues/4765", "repo": {"url": "https://github.com/AntennaPod/AntennaPod", "name": "AntennaPod", "owner": "AntennaPod", "modules": ["com.google.android.material", "de.danoeh.antennapod", "de.danoeh.antennapod.actionbutton", "de.danoeh.antennapod.activity", "de.danoeh.antennapod.event", "de.danoeh.antennapod.model", "de.danoeh.antennapod.net", "de.danoeh.antennapod.parser", "de.danoeh.antennapod.playback", "de.danoeh.antennapod.storage", "de.danoeh.antennapod.ui", "de.test.antennapod", "de.test.antennapod.dialogs", "de.test.antennapod.playback", "de.test.antennapod.service", "de.test.antennapod.ui", "de.test.antennapod.util"]}, "issue": {"number": 4765, "url": "https://github.com/AntennaPod/AntennaPod/issues/4765", "state": "closed", "title": "Automatic download feature needs to be disabled for local podcasts, stuck in infinite loop.", "body": "# Checklist\r\n<!-- Place an x in the boxes to tick them: [x] -->\r\n\r\n- [x] I have used the search function to see if someone else has already submitted the same bug report.\r\n- [x] I will describe the problem with as much detail as possible.\r\n- [x] If the bug only to occurs with a certain podcast, I will include the URL of that podcast.\r\n\r\n# System info\r\n\r\n**App version**: x.y.z\r\n<!-- The latest version may be different depending on your device. You can find the version in AntennaPod's settings. -->\r\n\r\n**App source**: Google Play /\r\n\r\n**Android version**: 11, custom rom\r\n\r\n**Device model**:\r\nnokia 8\r\n# Bug description\r\n\r\n**Steps to reproduce**:\r\n1. add local odcasts\r\n2. enable automatic download feature\r\n3. trigger automatic download\r\n4. check download log\r\n[full-logs.txt](https://github.com/AntennaPod/AntennaPod/files/5702226/full-logs.txt)\r\n\r\n\r\n**Expected behaviour**:\r\n<!-- After following the steps, what did you think AntennaPod would do? -->\r\nlocal files should be excluded from automatic download.\r\n\r\n**Current behaviour**:\r\n<!-- What did AntennaPod do instead? Screenshots might help. Usually, you can take a screenshot of your smartphone by pressing *Power* + *Volume down* for a few seconds. -->\r\napp will endlessly try and fail to download local podcasts until i disable automatic downloads.\r\nerror: unknown host: unable to resolve host \"content\": no address associated with hostname.\r\n\r\n\r\n\r\n**First occurred**: (e.g. about x days/weeks ago)\r\n\r\n**Environment**:\r\n<!-- Settings you have changed (e.g. Auto Download, changed media player). \"Unusual\" devices you use (e.g. Bluetooth headphones). -->\r\n\r\n**Stacktrace/Logcat**:\r\n<!-- If you are experiencing a crash, including the stacktrace will likely get it fixed sooner. AntennaPod has an `export logs` feature for this. -->\r\n```\r\n[if available]\r\n```\r\n", "logs": [{"name": "full-logs.txt", "url": "https://github.com/AntennaPod/AntennaPod/files/5702226/full-logs.txt"}]}, "pull_request": [{"number": 4780, "url": "https://github.com/AntennaPod/AntennaPod/pull/4780", "diff_url": "https://github.com/AntennaPod/AntennaPod/pull/4780.diff", "patch_url": "https://github.com/AntennaPod/AntennaPod/pull/4780.patch", "title": "Fix #4765: Disable autoDownload for local feeds (master branch)", "content": "Fixes #4765: Automatic download feature needs to be disabled for local podcasts\r\n\r\nProvides a careful fix for the master branch as suggested in #4777.", "diff": "diff --git a/core/src/main/java/de/danoeh/antennapod/core/storage/APDownloadAlgorithm.java b/core/src/main/java/de/danoeh/antennapod/core/storage/APDownloadAlgorithm.java\nindex 7ec4db5dd9d..061d6cf3f20 100644\n--- a/core/src/main/java/de/danoeh/antennapod/core/storage/APDownloadAlgorithm.java\n+++ b/core/src/main/java/de/danoeh/antennapod/core/storage/APDownloadAlgorithm.java\n@@ -65,7 +65,7 @@ public Runnable autoDownloadUndownloadedItems(final Context context) {\n                 Iterator<FeedItem> it = candidates.iterator();\n                 while (it.hasNext()) {\n                     FeedItem item = it.next();\n-                    if (!item.isAutoDownloadable()) {\n+                    if (!item.isAutoDownloadable() || item.getFeed().isLocalFeed()) {\n                         it.remove();\n                     }\n                 }\n", "changes": [{"file": "core/src/main/java/de/danoeh/antennapod/core/storage/APDownloadAlgorithm.java", "module": "de.danoeh.antennapod.core.storage.APDownloadAlgorithm", "range": [{"start": 68, "end": 69}]}]}]}
{"url": "https://github.com/osmandapp/OsmAnd/issues/21453", "repo": {"url": "https://github.com/osmandapp/OsmAnd", "name": "OsmAnd", "owner": "osmandapp", "modules": ["com.corwin.testtrx", "com.google.protobuf", "com.jwetherell.openmap.common", "com.wdtinc.mapbox_vector_tile.adapt", "com.wdtinc.mapbox_vector_tile.builder", "com.wdtinc.mapbox_vector_tile.encoding", "com.wdtinc.mapbox_vector_tile.util", "io.github.cosinekitty.astronomy", "net.osmand", "net.osmand.ais.simulate", "net.osmand.binary", "net.osmand.data", "net.osmand.gpx", "net.osmand.gpx.clickable", "net.osmand.map", "net.osmand.osm", "net.osmand.osm.edit", "net.osmand.osm.io", "net.osmand.osm.oauth", "net.osmand.render", "net.osmand.rendering", "net.osmand.router", "net.osmand.router.network", "net.osmand.search", "net.osmand.search.core", "net.osmand.shared", "net.osmand.shared.api", "net.osmand.shared.ble", "net.osmand.shared.data", "net.osmand.shared.extensions", "net.osmand.shared.gpx", "net.osmand.shared.grid", "net.osmand.shared.io", "net.osmand.shared.obd", "net.osmand.shared.routing", "net.osmand.shared.settings", "net.osmand.shared.util", "net.osmand.shared.wiki", "net.osmand.shared.xml", "net.osmand.test.common", "net.osmand.test.junit", "net.osmand.test.ui", "net.osmand.util", "net.osmand.wiki"]}, "issue": {"number": 21453, "url": "https://github.com/osmandapp/OsmAnd/issues/21453", "state": "closed", "title": "Map goes to the ocean", "body": "### Description\n\nDuring changing the screen orientation after downloading online maps, the map moves to the ocean\r\n\r\n[logcat (94).log](https://github.com/user-attachments/files/17921175/logcat.94.log)\r\n\n\n### Steps to reproduce\n\n1. Activate Overlay map > Select Microsoft Earth\r\n2. Long press on the map > Actions > Download map > Download > Rotate device > Cancel > Back\n\n### Actual result\n\n\r\nhttps://github.com/user-attachments/assets/82b7a9d4-7268-42af-87c2-1762be4832ad\r\n\r\n\n\n### Expected result\n\nMap remains in the same place where it was start downloaded\n\n### Your Environment (required)\n\n**WARNING** Crash-Logs **MAY** contain information you deem sensitive.\r\nReview this **CAREFULLY** before posting your issue!\r\n\r\n```\r\nOsmAnd Version: OsmAnd~ 5.0.0#3806m, Released: 2024-11-26\r\nAndroid/iOS version: Android 14\r\n\r\n", "logs": [{"name": "logcat (94).log", "url": "https://github.com/user-attachments/files/17921175/logcat.94.log"}]}, "pull_request": [{"number": 21587, "url": "https://github.com/osmandapp/OsmAnd/pull/21587", "diff_url": "https://github.com/osmandapp/OsmAnd/pull/21587.diff", "patch_url": "https://github.com/osmandapp/OsmAnd/pull/21587.patch", "title": "Fix #21453 Map goes to the ocean", "content": null, "diff": "diff --git a/OsmAnd/src/net/osmand/plus/plugins/rastermaps/DownloadTilesFragment.java b/OsmAnd/src/net/osmand/plus/plugins/rastermaps/DownloadTilesFragment.java\nindex 7ab21551547..fb9b7200c2f 100644\n--- a/OsmAnd/src/net/osmand/plus/plugins/rastermaps/DownloadTilesFragment.java\n+++ b/OsmAnd/src/net/osmand/plus/plugins/rastermaps/DownloadTilesFragment.java\n@@ -110,8 +110,8 @@ public class DownloadTilesFragment extends BaseOsmAndFragment implements IMapLoc\n \tprivate LockableScrollView scrollView;\n \tprivate IMapLocationListener mapLocationListener;\n \tprivate TouchListener touchListener;\n-\tprivate double lat;\n-\tprivate double lon;\n+\tprivate Double lat = null;\n+\tprivate Double lon = null;\n \tprivate boolean portraitMode;\n \n \t@Override\n@@ -183,6 +183,9 @@ public void onGlobalLayout() {\n \t\t\t\tupdateTileSourceContent();\n \t\t\t}\n \t\t});\n+\t\tif (lat == null || lon == null) {\n+\t\t\tupdateLatLon();\n+\t\t}\n \t\tsetupDownloadButton();\n \t\tshowHideMapControls(false);\n \t\tsetupScrollableMapView();\n@@ -222,12 +225,14 @@ private void setupScrollableMapView() {\n \n \t@NonNull\n \tprivate IMapLocationListener getMapLocationListener() {\n-\t\treturn (v, v1, o) -> {\n-\t\t\tQuadRect rect = getLatLonRectOfMapWindow();\n-\t\t\tLatLon mapWindowCenter = new LatLon(rect.centerY(), rect.centerX());\n-\t\t\tlat = mapWindowCenter.getLatitude();\n-\t\t\tlon = mapWindowCenter.getLongitude();\n-\t\t};\n+\t\treturn (v, v1, o) -> updateLatLon();\n+\t}\n+\n+\tprivate void updateLatLon(){\n+\t\tQuadRect rect = getLatLonRectOfMapWindow();\n+\t\tLatLon mapWindowCenter = new LatLon(rect.centerY(), rect.centerX());\n+\t\tlat = mapWindowCenter.getLatitude();\n+\t\tlon = mapWindowCenter.getLongitude();\n \t}\n \n \t@NonNull\n", "changes": [{"file": "OsmAnd/src/net/osmand/plus/plugins/rastermaps/DownloadTilesFragment.java", "module": "net.osmand.plus.plugins.rastermaps.DownloadTilesFragment", "range": [{"start": 113, "end": 115}, {"start": 186, "end": 186}, {"start": 225, "end": 231}]}]}]}
{"url": "https://github.com/osmandapp/OsmAnd/issues/21408", "repo": {"url": "https://github.com/osmandapp/OsmAnd", "name": "OsmAnd", "owner": "osmandapp", "modules": ["com.corwin.testtrx", "com.google.protobuf", "com.jwetherell.openmap.common", "com.wdtinc.mapbox_vector_tile.adapt", "com.wdtinc.mapbox_vector_tile.builder", "com.wdtinc.mapbox_vector_tile.encoding", "com.wdtinc.mapbox_vector_tile.util", "io.github.cosinekitty.astronomy", "net.osmand", "net.osmand.ais.simulate", "net.osmand.binary", "net.osmand.data", "net.osmand.gpx", "net.osmand.gpx.clickable", "net.osmand.map", "net.osmand.osm", "net.osmand.osm.edit", "net.osmand.osm.io", "net.osmand.osm.oauth", "net.osmand.render", "net.osmand.rendering", "net.osmand.router", "net.osmand.router.network", "net.osmand.search", "net.osmand.search.core", "net.osmand.shared", "net.osmand.shared.api", "net.osmand.shared.ble", "net.osmand.shared.data", "net.osmand.shared.extensions", "net.osmand.shared.gpx", "net.osmand.shared.grid", "net.osmand.shared.io", "net.osmand.shared.obd", "net.osmand.shared.routing", "net.osmand.shared.settings", "net.osmand.shared.util", "net.osmand.shared.wiki", "net.osmand.shared.xml", "net.osmand.test.common", "net.osmand.test.junit", "net.osmand.test.ui", "net.osmand.util", "net.osmand.wiki"]}, "issue": {"number": 21408, "url": "https://github.com/osmandapp/OsmAnd/issues/21408", "state": "closed", "title": "Could not backup -> delete local -> restore empty button ", "body": "## Description\r\n\r\n### How to reproduce\r\n* Login to OsmAnd Cloud\r\n* Tap on Sync now\r\n\r\n\r\n### Actual result\r\nError: read from `quick_actions,quick_actions_172891397499...`\r\n\r\n<table style=\"width:100%\">\r\n  <tr>\r\n    <td><img src=\"https://github.com/user-attachments/assets/8124965e-ab92-49f0-870a-22953a70e40a\"  width=\"200\" height=\"auto\"/> </td>\r\n    <td><img src=\"https://github.com/user-attachments/assets/956694e1-2fd6-4ff2-9ec0-2bc22611dea2\"  width=\"200\" height=\"auto\"/> </td>\r\n    <td width=\"240\" ><video src=\"https://github.com/user-attachments/assets/b77e6145-08c8-40e2-b907-ca25e9784655\r\n\"  height=\"auto\"/> </td>\r\n  </tr>\r\n  </tr>\r\n</table>   \r\n\r\n\r\n\r\n* Toast with error \r\n* Log file [logcat (2) (1).log](https://github.com/user-attachments/files/17842840/logcat.2.1.log)\r\n* Affected files?  [QuickActions.zip](https://github.com/user-attachments/files/17842843/QuickActions.zip)\r\n\r\n### Expected result\r\n\r\n**Environment**\r\nOsmAnd Version: 5.0.0#3746m 5000\r\nAndroid: 15\r\nDevice model: Google Pixel 6A \r\n ", "logs": [{"name": "logcat (2) (1).log", "url": "https://github.com/user-attachments/files/17842840/logcat.2.1.log"}]}, "pull_request": [{"number": 21918, "url": "https://github.com/osmandapp/OsmAnd/pull/21918", "diff_url": "https://github.com/osmandapp/OsmAnd/pull/21918.diff", "patch_url": "https://github.com/osmandapp/OsmAnd/pull/21918.patch", "title": "Fix #21408", "content": null, "diff": "diff --git a/OsmAnd/src/net/osmand/plus/backup/ImportBackupTask.java b/OsmAnd/src/net/osmand/plus/backup/ImportBackupTask.java\nindex b89d2db7391..94abdc30f8f 100644\n--- a/OsmAnd/src/net/osmand/plus/backup/ImportBackupTask.java\n+++ b/OsmAnd/src/net/osmand/plus/backup/ImportBackupTask.java\n@@ -283,7 +283,7 @@ private List<Object> getDuplicatesData(List<SettingsItem> items) {\n \t\t\t\t}\n \t\t\t} else if (item instanceof QuickActionsSettingsItem) {\n \t\t\t\tif (item.exists()) {\n-\t\t\t\t\tduplicateItems.add(((QuickActionsSettingsItem) item).getButtonState());\n+\t\t\t\t\tduplicateItems.add(((QuickActionsSettingsItem) item).getStateBean());\n \t\t\t\t}\n \t\t\t}\n \t\t}\ndiff --git a/OsmAnd/src/net/osmand/plus/backup/ui/BackupUiUtils.java b/OsmAnd/src/net/osmand/plus/backup/ui/BackupUiUtils.java\nindex e6718a13b8f..cd5a71667b1 100644\n--- a/OsmAnd/src/net/osmand/plus/backup/ui/BackupUiUtils.java\n+++ b/OsmAnd/src/net/osmand/plus/backup/ui/BackupUiUtils.java\n@@ -22,7 +22,7 @@\n import net.osmand.plus.settings.backend.backup.items.QuickActionsSettingsItem;\n import net.osmand.plus.settings.backend.backup.items.SettingsItem;\n import net.osmand.plus.utils.AndroidUtils;\n-import net.osmand.plus.views.mapwidgets.configure.buttons.ButtonStateBean;\n+import net.osmand.plus.views.mapwidgets.configure.buttons.QuickActionButtonState;\n import net.osmand.util.Algorithms;\n \n import java.text.DateFormat;\n@@ -61,16 +61,10 @@ public static int getIconId(@NonNull Context context, @NonNull SettingsItem item\n \t\tif (item instanceof ProfileSettingsItem) {\n \t\t\treturn ((ProfileSettingsItem) item).getAppMode().getIconRes();\n \t\t}\n-\t\tif (item instanceof QuickActionsSettingsItem) {\n-\t\t\tButtonStateBean stateBean = ((QuickActionsSettingsItem) item).getStateBean();\n-\t\t\tif (!Algorithms.isEmpty(stateBean.icon)) {\n-\t\t\t\tint iconId = AndroidUtils.getDrawableId(context, stateBean.icon);\n-\t\t\t\tif (iconId == 0) {\n-\t\t\t\t\ticonId = RenderingIcons.getBigIconResourceId(stateBean.icon);\n-\t\t\t\t}\n-\t\t\t\tif (iconId > 0) {\n-\t\t\t\t\treturn iconId;\n-\t\t\t\t}\n+\t\tif (item instanceof QuickActionsSettingsItem actionsItem) {\n+\t\t\tint iconId = actionsItem.getStateBean().getIconId(context);\n+\t\t\tif (iconId > 0) {\n+\t\t\t\treturn iconId;\n \t\t\t}\n \t\t}\n \t\tExportType exportType = ExportType.findBy(item);\ndiff --git a/OsmAnd/src/net/osmand/plus/plugins/custom/CustomOsmandPlugin.java b/OsmAnd/src/net/osmand/plus/plugins/custom/CustomOsmandPlugin.java\nindex 38a1631f47b..58bdc8187a7 100644\n--- a/OsmAnd/src/net/osmand/plus/plugins/custom/CustomOsmandPlugin.java\n+++ b/OsmAnd/src/net/osmand/plus/plugins/custom/CustomOsmandPlugin.java\n@@ -42,6 +42,7 @@\n import net.osmand.plus.utils.AndroidUtils;\n import net.osmand.plus.utils.FileUtils;\n import net.osmand.plus.utils.JsonUtils;\n+import net.osmand.plus.views.mapwidgets.configure.buttons.ButtonStateBean;\n import net.osmand.plus.views.mapwidgets.configure.buttons.QuickActionButtonState;\n import net.osmand.util.Algorithms;\n \n@@ -283,10 +284,10 @@ private void removePluginItemsFromFile(File file, PluginItemsListener itemsListe\n \t\t\t\t\t\tQuickActionsSettingsItem settingsItem = (QuickActionsSettingsItem) item;\n \n \t\t\t\t\t\tMapButtonsHelper mapButtonsHelper = app.getMapButtonsHelper();\n-\t\t\t\t\t\tQuickActionButtonState buttonState = settingsItem.getButtonState();\n-\t\t\t\t\t\tQuickActionButtonState state = mapButtonsHelper.getActionButtonStateById(buttonState.getId());\n+\t\t\t\t\t\tButtonStateBean stateBean = settingsItem.getStateBean();\n+\t\t\t\t\t\tQuickActionButtonState state = mapButtonsHelper.getActionButtonStateById(stateBean.id);\n \t\t\t\t\t\tif (state != null) {\n-\t\t\t\t\t\t\tfor (QuickAction action : buttonState.getQuickActions()) {\n+\t\t\t\t\t\t\tfor (QuickAction action : stateBean.quickActions) {\n \t\t\t\t\t\t\t\tQuickAction savedAction = state.getQuickAction(action.getType(), action.getName(app), action.getParams());\n \t\t\t\t\t\t\t\tif (savedAction != null) {\n \t\t\t\t\t\t\t\t\tmapButtonsHelper.deleteQuickAction(state, savedAction);\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/ImportFileTask.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/ImportFileTask.java\nindex b3de86008c7..ff4a051f93d 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/ImportFileTask.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/ImportFileTask.java\n@@ -197,7 +197,7 @@ private List<Object> getDuplicatesData(List<SettingsItem> items) {\n \t\t\t\t}\n \t\t\t} else if (item instanceof QuickActionsSettingsItem) {\n \t\t\t\tif (item.exists()) {\n-\t\t\t\t\tduplicateItems.add(((QuickActionsSettingsItem) item).getButtonState());\n+\t\t\t\t\tduplicateItems.add(((QuickActionsSettingsItem) item).getStateBean());\n \t\t\t\t}\n \t\t\t}\n \t\t}\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/SettingsHelper.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/SettingsHelper.java\nindex 83c03b91fb1..fe8b841e9e5 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/SettingsHelper.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/SettingsHelper.java\n@@ -27,6 +27,7 @@\n import net.osmand.plus.settings.backend.backup.items.*;\n import net.osmand.plus.settings.enums.HistorySource;\n import net.osmand.plus.settings.fragments.SettingsCategoryItems;\n+import net.osmand.plus.views.mapwidgets.configure.buttons.ButtonStateBean;\n import net.osmand.plus.views.mapwidgets.configure.buttons.QuickActionButtonState;\n import net.osmand.util.Algorithms;\n \n@@ -161,7 +162,7 @@ private Map<ExportType, List<?>> collectExportData(@NonNull ExportCategory expor\n \n \tpublic List<SettingsItem> prepareSettingsItems(List<?> data, List<SettingsItem> settingsItems, boolean export) {\n \t\tList<SettingsItem> result = new ArrayList<>();\n-\t\tList<QuickActionButtonState> quickActionButtons = new ArrayList<>();\n+\t\tList<ButtonStateBean> buttonStateBeans = new ArrayList<>();\n \t\tList<PoiUIFilter> poiUIFilters = new ArrayList<>();\n \t\tList<ITileSource> tileSourceTemplates = new ArrayList<>();\n \t\tList<AvoidRoadInfo> avoidRoads = new ArrayList<>();\n@@ -177,8 +178,8 @@ public List<SettingsItem> prepareSettingsItems(List<?> data, List<SettingsItem>\n \t\tList<MapMarkersGroup> itineraryGroups = new ArrayList<>();\n \n \t\tfor (Object object : data) {\n-\t\t\tif (object instanceof QuickActionButtonState) {\n-\t\t\t\tquickActionButtons.add((QuickActionButtonState) object);\n+\t\t\tif (object instanceof ButtonStateBean) {\n+\t\t\t\tbuttonStateBeans.add((ButtonStateBean) object);\n \t\t\t} else if (object instanceof PoiUIFilter) {\n \t\t\t\tpoiUIFilters.add((PoiUIFilter) object);\n \t\t\t} else if (object instanceof TileSourceTemplate || object instanceof SQLiteTileSource) {\n@@ -228,10 +229,10 @@ public List<SettingsItem> prepareSettingsItems(List<?> data, List<SettingsItem>\n \t\t\t\tonlineRoutingEngines.add((OnlineRoutingEngine) object);\n \t\t\t}\n \t\t}\n-\t\tif (!quickActionButtons.isEmpty()) {\n-\t\t\tfor (QuickActionButtonState buttonState : quickActionButtons) {\n-\t\t\t\tQuickActionsSettingsItem baseItem = getBaseQuickActionsSettingsItem(buttonState, settingsItems);\n-\t\t\t\tresult.add(new QuickActionsSettingsItem(app, baseItem, buttonState));\n+\t\tif (!buttonStateBeans.isEmpty()) {\n+\t\t\tfor (ButtonStateBean stateBean : buttonStateBeans) {\n+\t\t\t\tQuickActionsSettingsItem baseItem = getBaseQuickActionsSettingsItem(stateBean, settingsItems);\n+\t\t\t\tresult.add(new QuickActionsSettingsItem(app, baseItem, stateBean));\n \t\t\t}\n \t\t}\n \t\tif (!poiUIFilters.isEmpty()) {\n@@ -344,12 +345,14 @@ private ProfileSettingsItem getBaseProfileSettingsItem(ApplicationModeBean modeB\n \t}\n \n \t@Nullable\n-\tprivate QuickActionsSettingsItem getBaseQuickActionsSettingsItem(QuickActionButtonState buttonState, List<SettingsItem> settingsItems) {\n-\t\tfor (SettingsItem settingsItem : settingsItems) {\n+\tprivate QuickActionsSettingsItem getBaseQuickActionsSettingsItem(\n+\t\t\t@NonNull ButtonStateBean stateBean, @NonNull List<SettingsItem> items) {\n+\t\tfor (SettingsItem settingsItem : items) {\n \t\t\tif (settingsItem.getType() == QUICK_ACTIONS) {\n \t\t\t\tQuickActionsSettingsItem item = (QuickActionsSettingsItem) settingsItem;\n-\t\t\t\tQuickActionButtonState state = item.getButtonState();\n-\t\t\t\tif (Algorithms.objectEquals(state.getId(), buttonState.getId()) && Algorithms.objectEquals(state.getName(), buttonState.getName())) {\n+\t\t\t\tButtonStateBean bean = item.getStateBean();\n+\t\t\t\tif (Algorithms.objectEquals(bean.id, stateBean.id)\n+\t\t\t\t\t\t&& Algorithms.objectEquals(bean.name, stateBean.name)) {\n \t\t\t\t\treturn item;\n \t\t\t\t}\n \t\t\t}\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/exporttype/QuickActionsExportType.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/exporttype/QuickActionsExportType.java\nindex b3e446faf34..d298230e945 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/exporttype/QuickActionsExportType.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/exporttype/QuickActionsExportType.java\n@@ -13,6 +13,7 @@\n import net.osmand.plus.settings.backend.backup.items.FileSettingsItem.FileSubtype;\n import net.osmand.plus.settings.backend.backup.items.QuickActionsSettingsItem;\n import net.osmand.plus.settings.backend.backup.items.SettingsItem;\n+import net.osmand.plus.views.mapwidgets.configure.buttons.ButtonStateBean;\n import net.osmand.plus.views.mapwidgets.configure.buttons.QuickActionButtonState;\n import net.osmand.util.Algorithms;\n \n@@ -35,27 +36,32 @@ public int getIconId() {\n \t@NonNull\n \t@Override\n \tpublic List<?> fetchExportData(@NonNull OsmandApplication app, boolean offlineBackup) {\n+\t\tList<ButtonStateBean> stateBeans = new ArrayList<>();\n \t\tMapButtonsHelper buttonsHelper = app.getMapButtonsHelper();\n-\t\tList<QuickActionButtonState> buttonStates = new ArrayList<>(buttonsHelper.getQuickActionButtonsStates());\n+\t\tList<QuickActionButtonState> buttonStates = buttonsHelper.getQuickActionButtonsStates();\n+\n \t\tif (buttonStates.size() == 1) {\n \t\t\tQuickActionButtonState state = buttonStates.get(0);\n \t\t\tif (state.isDefaultButton() && Algorithms.isEmpty(state.getQuickActions())) {\n \t\t\t\treturn Collections.emptyList();\n \t\t\t}\n \t\t}\n-\t\treturn buttonStates;\n+\t\tfor (QuickActionButtonState buttonState : buttonStates) {\n+\t\t\tstateBeans.add(ButtonStateBean.toStateBean(buttonState));\n+\t\t}\n+\t\treturn stateBeans;\n \t}\n \n \t@NonNull\n \t@Override\n \tpublic List<?> fetchImportData(@NonNull SettingsItem settingsItem, boolean importCompleted) {\n \t\tQuickActionsSettingsItem item = (QuickActionsSettingsItem) settingsItem;\n-\t\treturn Collections.singletonList(item.getButtonState());\n+\t\treturn Collections.singletonList(item.getStateBean());\n \t}\n \n \t@Override\n \tpublic boolean isRelatedObject(@NonNull OsmandApplication app, @NonNull Object object) {\n-\t\treturn object instanceof QuickActionButtonState;\n+\t\treturn object instanceof ButtonStateBean;\n \t}\n \n \t@NonNull\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java\nindex e784e4d4083..1db1e6af131 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java\n@@ -42,13 +42,19 @@ public class QuickActionsSettingsItem extends SettingsItem {\n \tprivate QuickActionButtonState buttonState;\n \n \tpublic QuickActionsSettingsItem(@NonNull OsmandApplication app,\n-\t\t\t@Nullable QuickActionsSettingsItem baseItem,\n \t\t\t@NonNull QuickActionButtonState buttonState) {\n-\t\tsuper(app, baseItem);\n+\t\tsuper(app);\n \t\tthis.buttonState = buttonState;\n \t\tthis.stateBean = ButtonStateBean.toStateBean(buttonState);\n \t}\n \n+\tpublic QuickActionsSettingsItem(@NonNull OsmandApplication app,\n+\t\t\t@Nullable QuickActionsSettingsItem baseItem, @NonNull ButtonStateBean stateBean) {\n+\t\tsuper(app, baseItem);\n+\t\tthis.stateBean = stateBean;\n+\t\tthis.buttonState = new QuickActionButtonState(app, stateBean.id);\n+\t}\n+\n \tpublic QuickActionsSettingsItem(@NonNull OsmandApplication app,\n \t\t\t@NonNull JSONObject json) throws JSONException {\n \t\tsuper(app, json);\n@@ -88,12 +94,12 @@ public void setLocalModifiedTime(long lastModifiedTime) {\n \n \t@Override\n \tpublic boolean exists() {\n-\t\treturn mapButtonsHelper.getActionButtonStateById(buttonState.getId()) != null;\n+\t\treturn mapButtonsHelper.getActionButtonStateById(stateBean.id) != null;\n \t}\n \n \t@Override\n \tpublic long getEstimatedSize() {\n-\t\treturn (long) buttonState.getQuickActions().size() * APPROXIMATE_QUICK_ACTION_SIZE_BYTES;\n+\t\treturn (long) stateBean.quickActions.size() * APPROXIMATE_QUICK_ACTION_SIZE_BYTES;\n \t}\n \n \t@Override\n@@ -121,13 +127,13 @@ private void renameButton() {\n \t@NonNull\n \t@Override\n \tpublic String getName() {\n-\t\treturn buttonState.getId();\n+\t\treturn stateBean.id;\n \t}\n \n \t@NonNull\n \t@Override\n \tpublic String getPublicName(@NonNull Context ctx) {\n-\t\treturn Algorithms.isEmpty(stateBean.name) ? ctx.getString(R.string.shared_string_quick_actions) : stateBean.name;\n+\t\treturn stateBean.getName(ctx);\n \t}\n \n \t@Override\n@@ -177,21 +183,24 @@ void writeToJson(@NonNull JSONObject json) throws JSONException {\n \t\tsuper.writeToJson(json);\n \t\ttry {\n \t\t\tJSONObject jsonObject = new JSONObject();\n-\t\t\tjsonObject.put(\"id\", buttonState.getId());\n-\t\t\tjsonObject.put(\"name\", buttonState.hasCustomName() ? buttonState.getName() : \"\");\n-\t\t\tjsonObject.put(\"enabled\", buttonState.isEnabled());\n+\t\t\tjsonObject.put(\"id\", stateBean.id);\n+\n+\t\t\tif (!Algorithms.isEmpty(stateBean.name)) {\n+\t\t\t\tjsonObject.put(\"name\", stateBean.name);\n+\t\t\t}\n+\t\t\tjsonObject.put(\"enabled\", stateBean.enabled);\n \n-\t\t\tif (buttonState.getIconPref().isSet()) {\n-\t\t\t\tjsonObject.put(\"icon\", buttonState.getIconPref().get());\n+\t\t\tif (!Algorithms.isEmpty(stateBean.icon)) {\n+\t\t\t\tjsonObject.put(\"icon\", stateBean.icon);\n \t\t\t}\n-\t\t\tif (buttonState.getSizePref().isSet()) {\n-\t\t\t\tjsonObject.put(\"size\", buttonState.getSizePref().get());\n+\t\t\tif (stateBean.size > 0) {\n+\t\t\t\tjsonObject.put(\"size\", stateBean.size);\n \t\t\t}\n-\t\t\tif (buttonState.getCornerRadiusPref().isSet()) {\n-\t\t\t\tjsonObject.put(\"corner_radius\", buttonState.getCornerRadiusPref().get());\n+\t\t\tif (stateBean.cornerRadius >= 0) {\n+\t\t\t\tjsonObject.put(\"corner_radius\", stateBean.cornerRadius);\n \t\t\t}\n-\t\t\tif (buttonState.getOpacityPref().isSet()) {\n-\t\t\t\tjsonObject.put(\"opacity\", buttonState.getOpacityPref().get());\n+\t\t\tif (stateBean.opacity >= 0) {\n+\t\t\t\tjsonObject.put(\"opacity\", stateBean.opacity);\n \t\t\t}\n \t\t\tjson.put(\"buttonState\", jsonObject);\n \t\t} catch (JSONException e) {\n@@ -209,33 +218,31 @@ void readItemsFromJson(@NonNull JSONObject json) throws IllegalArgumentException\n \t\t\tGson gson = new Gson();\n \t\t\tType type = new TypeToken<HashMap<String, String>>() {}.getType();\n \n-\t\t\tList<QuickAction> quickActions = new ArrayList<>();\n-\t\t\tMapButtonsHelper mapButtonsHelper = app.getMapButtonsHelper();\n+\t\t\tList<QuickAction> actions = new ArrayList<>();\n \t\t\tJSONArray itemsJson = json.getJSONArray(\"items\");\n \t\t\tfor (int i = 0; i < itemsJson.length(); i++) {\n \t\t\t\tJSONObject object = itemsJson.getJSONObject(i);\n \t\t\t\tString name = object.getString(\"name\");\n-\t\t\t\tQuickAction quickAction = null;\n+\t\t\t\tQuickAction action = null;\n \t\t\t\tif (object.has(\"actionType\")) {\n-\t\t\t\t\tquickAction = mapButtonsHelper.newActionByStringType(object.getString(\"actionType\"));\n+\t\t\t\t\taction = mapButtonsHelper.newActionByStringType(object.getString(\"actionType\"));\n \t\t\t\t} else if (object.has(\"type\")) {\n-\t\t\t\t\tquickAction = mapButtonsHelper.newActionByType(object.getInt(\"type\"));\n+\t\t\t\t\taction = mapButtonsHelper.newActionByType(object.getInt(\"type\"));\n \t\t\t\t}\n-\t\t\t\tif (quickAction != null) {\n+\t\t\t\tif (action != null) {\n \t\t\t\t\tString paramsString = object.getString(\"params\");\n \t\t\t\t\tHashMap<String, String> params = gson.fromJson(paramsString, type);\n \n \t\t\t\t\tif (!name.isEmpty()) {\n-\t\t\t\t\t\tquickAction.setName(name);\n+\t\t\t\t\t\taction.setName(name);\n \t\t\t\t\t}\n-\t\t\t\t\tquickAction.setParams(params);\n-\t\t\t\t\tquickActions.add(quickAction);\n+\t\t\t\t\taction.setParams(params);\n+\t\t\t\t\tactions.add(action);\n \t\t\t\t} else {\n \t\t\t\t\twarnings.add(app.getString(R.string.settings_item_read_error, name));\n \t\t\t\t}\n \t\t\t}\n-\t\t\tmapButtonsHelper.updateQuickActions(buttonState, quickActions);\n-\t\t\tmapButtonsHelper.updateActiveActions();\n+\t\t\tstateBean.quickActions = actions;\n \t\t} catch (JSONException e) {\n \t\t\twarnings.add(app.getString(R.string.settings_item_read_error, String.valueOf(getType())));\n \t\t\tthrow new IllegalArgumentException(\"Json parse error\", e);\n@@ -249,25 +256,27 @@ JSONObject writeItemsToJson(@NonNull JSONObject json) {\n \t\tJSONArray jsonArray = new JSONArray();\n \t\tType type = new TypeToken<HashMap<String, String>>() {}.getType();\n \n-\t\tList<QuickAction> quickActions = buttonState.getQuickActions();\n-\t\tif (!Algorithms.isEmpty(quickActions)) {\n-\t\t\ttry {\n-\t\t\t\tfor (QuickAction action : quickActions) {\n-\t\t\t\t\tJSONObject jsonObject = new JSONObject();\n-\t\t\t\t\tjsonObject.put(\"name\", action.hasCustomName(app) ? action.getName(app) : \"\");\n-\t\t\t\t\tjsonObject.put(\"actionType\", action.getActionType().getStringId());\n-\t\t\t\t\tjsonObject.put(\"params\", gson.toJson(action.getParams(), type));\n-\t\t\t\t\tjsonArray.put(jsonObject);\n-\t\t\t\t}\n-\t\t\t\tjson.put(\"items\", jsonArray);\n-\t\t\t} catch (JSONException e) {\n-\t\t\t\twarnings.add(app.getString(R.string.settings_item_write_error, String.valueOf(getType())));\n-\t\t\t\tSettingsHelper.LOG.error(\"Failed write to json\", e);\n+\t\ttry {\n+\t\t\tfor (QuickAction action : stateBean.quickActions) {\n+\t\t\t\tJSONObject jsonObject = new JSONObject();\n+\t\t\t\tjsonObject.put(\"name\", action.hasCustomName(app) ? action.getName(app) : \"\");\n+\t\t\t\tjsonObject.put(\"actionType\", action.getActionType().getStringId());\n+\t\t\t\tjsonObject.put(\"params\", gson.toJson(action.getParams(), type));\n+\t\t\t\tjsonArray.put(jsonObject);\n \t\t\t}\n+\t\t\tjson.put(\"items\", jsonArray);\n+\t\t} catch (JSONException e) {\n+\t\t\twarnings.add(app.getString(R.string.settings_item_write_error, String.valueOf(getType())));\n+\t\t\tSettingsHelper.LOG.error(\"Failed write to json\", e);\n \t\t}\n \t\treturn json;\n \t}\n \n+\t@Override\n+\tpublic boolean shouldReadOnCollecting() {\n+\t\treturn true;\n+\t}\n+\n \t@Nullable\n \t@Override\n \tpublic SettingsItemReader<? extends SettingsItem> getReader() {\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/SettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/SettingsItem.java\nindex 35492f74500..5e453edc111 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/SettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/SettingsItem.java\n@@ -50,7 +50,7 @@ public SettingsItem(@NonNull OsmandApplication app, @Nullable SettingsItem baseI\n \t\tinit();\n \t}\n \n-\tpublic SettingsItem(OsmandApplication app, @NonNull JSONObject json) throws JSONException {\n+\tpublic SettingsItem(@NonNull OsmandApplication app, @NonNull JSONObject json) throws JSONException {\n \t\tthis.app = app;\n \t\tthis.fromJson = true;\n \t\tinit();\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java b/OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java\nindex f2618c457fb..03a003eb301 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java\n@@ -37,6 +37,7 @@\n import net.osmand.plus.utils.AndroidUtils;\n import net.osmand.plus.utils.ColorUtilities;\n import net.osmand.plus.utils.UiUtilities;\n+import net.osmand.plus.views.mapwidgets.configure.buttons.ButtonStateBean;\n import net.osmand.plus.views.mapwidgets.configure.buttons.QuickActionButtonState;\n import net.osmand.shared.gpx.GpxHelper;\n import net.osmand.util.Algorithms;\n@@ -130,10 +131,10 @@ public void onBindViewHolder(@NonNull RecyclerView.ViewHolder holder, int positi\n \t\t\t\tint actualIconColor = customIconColor != null ?\n \t\t\t\t\t\tcustomIconColor : ContextCompat.getColor(app, iconColor.getColor(nightMode));\n \t\t\t\titemHolder.icon.setImageDrawable(uiUtilities.getPaintedIcon(profileIconRes, actualIconColor));\n-\t\t\t} else if (currentItem instanceof QuickActionButtonState) {\n-\t\t\t\tQuickActionButtonState buttonState = (QuickActionButtonState) currentItem;\n-\t\t\t\titemHolder.title.setText(buttonState.getName());\n-\t\t\t\titemHolder.icon.setImageDrawable(buttonState.getIcon(ColorUtilities.getColor(app, activeColorRes), nightMode, false));\n+\t\t\t} else if (currentItem instanceof ButtonStateBean) {\n+\t\t\t\tButtonStateBean stateBean = (ButtonStateBean) currentItem;\n+\t\t\t\titemHolder.title.setText(stateBean.getName(app));\n+\t\t\t\titemHolder.icon.setImageDrawable(uiUtilities.getIcon(stateBean.getIconId(app), activeColorRes));\n \t\t\t} else if (currentItem instanceof PoiUIFilter) {\n \t\t\t\tPoiUIFilter filter = (PoiUIFilter) currentItem;\n \t\t\t\titemHolder.title.setText(filter.getName());\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/ExportItemsBottomSheet.java b/OsmAnd/src/net/osmand/plus/settings/fragments/ExportItemsBottomSheet.java\nindex 7ea6c0dbbc4..b75d2fab05a 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/fragments/ExportItemsBottomSheet.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/ExportItemsBottomSheet.java\n@@ -63,6 +63,7 @@\n import net.osmand.plus.utils.ColorUtilities;\n import net.osmand.plus.utils.OsmAndFormatter;\n import net.osmand.plus.utils.UiUtilities;\n+import net.osmand.plus.views.mapwidgets.configure.buttons.ButtonStateBean;\n import net.osmand.plus.views.mapwidgets.configure.buttons.QuickActionButtonState;\n import net.osmand.shared.gpx.GpxDataItem;\n import net.osmand.shared.gpx.GpxDbHelper.GpxDataItemCallback;\n@@ -324,10 +325,10 @@ private void setupBottomSheetItem(BottomSheetItemWithCompoundButton item, Object\n \t\t\t}\n \t\t\tint iconRes = profileIconRes != 0 ? profileIconRes : R.drawable.ic_world_globe_dark;\n \t\t\titem.setIcon(uiUtilities.getPaintedIcon(iconRes, actualIconColor));\n-\t\t} else if (object instanceof QuickActionButtonState) {\n-\t\t\tQuickActionButtonState buttonState = (QuickActionButtonState) object;\n-\t\t\titem.setTitle(buttonState.getName());\n-\t\t\titem.setIcon(buttonState.getIcon(ColorUtilities.getColor(app, getItemIconColor(object)), nightMode, false));\n+\t\t} else if (object instanceof ButtonStateBean) {\n+\t\t\tButtonStateBean stateBean = (ButtonStateBean) object;\n+\t\t\titem.setTitle(stateBean.getName(app));\n+\t\t\titem.setIcon(uiUtilities.getIcon(stateBean.getIconId(app), getItemIconColor(object)));\n \t\t} else if (object instanceof PoiUIFilter) {\n \t\t\tPoiUIFilter poiUIFilter = (PoiUIFilter) object;\n \t\t\titem.setTitle(poiUIFilter.getName());\ndiff --git a/OsmAnd/src/net/osmand/plus/utils/AndroidUtils.java b/OsmAnd/src/net/osmand/plus/utils/AndroidUtils.java\nindex 8c313341d27..db3e7af9200 100644\n--- a/OsmAnd/src/net/osmand/plus/utils/AndroidUtils.java\n+++ b/OsmAnd/src/net/osmand/plus/utils/AndroidUtils.java\n@@ -686,31 +686,31 @@ public static int getColorFromAttr(@NonNull Context ctx, @AttrRes int colorAttri\n \t\treturn typedValue.data;\n \t}\n \n-\tpublic static int resolveAttribute(Context ctx, int attribute) {\n+\tpublic static int resolveAttribute(@NonNull Context ctx, int attribute) {\n \t\tTypedValue outValue = new TypedValue();\n \t\tctx.getTheme().resolveAttribute(attribute, outValue, true);\n \t\treturn outValue.resourceId;\n \t}\n \n-\tpublic static float getFloatValueFromRes(Context ctx, int resId) {\n+\tpublic static float getFloatValueFromRes(@NonNull Context ctx, int resId) {\n \t\tTypedValue outValue = new TypedValue();\n \t\tctx.getResources().getValue(resId, outValue, true);\n \t\treturn outValue.getFloat();\n \t}\n \n \t@DrawableRes\n-\tpublic static int getActivityIconId(@NonNull OsmandApplication app, @Nullable RouteActivity activity) {\n+\tpublic static int getActivityIconId(@NonNull Context app, @Nullable RouteActivity activity) {\n \t\treturn activity != null\n \t\t\t\t? getDrawableId(app, activity.getIconName(), R.drawable.ic_action_info_dark)\n \t\t\t\t: R.drawable.ic_action_activity;\n \t}\n \n-\tpublic static boolean hasDrawableId(@NonNull OsmandApplication app, @NonNull String iconName) {\n+\tpublic static boolean hasDrawableId(@NonNull Context app, @NonNull String iconName) {\n \t\treturn getDrawableId(app, iconName, 0) != 0;\n \t}\n \n \t@DrawableRes\n-\tpublic static int getDrawableId(@NonNull OsmandApplication app, @NonNull String iconName, @DrawableRes int defRes) {\n+\tpublic static int getDrawableId(@NonNull Context app, @NonNull String iconName, @DrawableRes int defRes) {\n \t\tint iconId = getDrawableId(app, iconName);\n \t\tif (iconId <= 0) {\n \t\t\ticonId = RenderingIcons.getBigIconResourceId(iconName);\n@@ -725,7 +725,7 @@ public static int getDrawableId(@NonNull Context context, String id) {\n \t\treturn 0;\n \t}\n \n-\tpublic static int getStatusBarHeight(Context ctx) {\n+\tpublic static int getStatusBarHeight(@NonNull Context ctx) {\n \t\tint result = 0;\n \t\tint resourceId = ctx.getResources().getIdentifier(\"status_bar_height\", \"dimen\", \"android\");\n \t\tif (resourceId > 0) {\n@@ -734,7 +734,7 @@ public static int getStatusBarHeight(Context ctx) {\n \t\treturn result;\n \t}\n \n-\tpublic static int getCutoutHeight(Activity activity) {\n+\tpublic static int getCutoutHeight(@NonNull Activity activity) {\n \t\tint cutoutHeight = 0;\n \n \t\tif (activity != null && android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.Q) {\n@@ -748,7 +748,7 @@ public static int getCutoutHeight(Activity activity) {\n \t\treturn cutoutHeight;\n \t}\n \n-\tpublic static void addStatusBarPadding21v(@NonNull Activity activity, View view) {\n+\tpublic static void addStatusBarPadding21v(@NonNull Activity activity, @NonNull View view) {\n \t\tif (isInFullScreenMode(activity)) {\n \t\t\tint paddingLeft = view.getPaddingLeft();\n \t\t\tint paddingTop = view.getPaddingTop();\ndiff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java\nindex 71fc45f1503..4ad69250b78 100644\n--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java\n+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java\n@@ -1,30 +1,60 @@\n package net.osmand.plus.views.mapwidgets.configure.buttons;\n \n+import static net.osmand.plus.quickaction.ButtonAppearanceParams.ORIGINAL_VALUE;\n+\n+import android.content.Context;\n+\n+import androidx.annotation.DrawableRes;\n import androidx.annotation.NonNull;\n \n import net.osmand.plus.OsmandApplication;\n+import net.osmand.plus.R;\n+import net.osmand.plus.quickaction.MapButtonsHelper;\n+import net.osmand.plus.quickaction.QuickAction;\n import net.osmand.plus.settings.backend.ApplicationMode;\n import net.osmand.plus.settings.backend.OsmandSettings;\n+import net.osmand.plus.utils.AndroidUtils;\n import net.osmand.util.Algorithms;\n \n+import java.util.ArrayList;\n+import java.util.List;\n+\n public class ButtonStateBean {\n \n \tpublic String id;\n \tpublic String name = null;\n \tpublic String icon;\n-\tpublic int size = -1;\n-\tpublic int cornerRadius = -1;\n-\tpublic float opacity = -1;\n+\tpublic int size = ORIGINAL_VALUE;\n+\tpublic int cornerRadius = ORIGINAL_VALUE;\n+\tpublic float opacity = ORIGINAL_VALUE;\n \tpublic boolean enabled;\n+\tpublic List<QuickAction> quickActions = new ArrayList<>();\n \n \tpublic ButtonStateBean(@NonNull String id) {\n \t\tthis.id = id;\n \t}\n \n+\t@NonNull\n+\tpublic String getName(@NonNull Context app) {\n+\t\treturn Algorithms.isEmpty(name) ? app.getString(R.string.shared_string_quick_actions) : name;\n+\t}\n+\n+\t@DrawableRes\n+\tpublic int getIconId(@NonNull Context app) {\n+\t\tif (Algorithms.isEmpty(icon) && quickActions.size() == 1) {\n+\t\t\tint iconId = quickActions.get(0).getIconRes(app);\n+\t\t\tif (iconId > 0) {\n+\t\t\t\treturn iconId;\n+\t\t\t}\n+\t\t}\n+\t\treturn AndroidUtils.getDrawableId(app, icon, R.drawable.ic_quick_action);\n+\t}\n+\n \tpublic void setupButtonState(@NonNull OsmandApplication app,\n \t\t\t@NonNull QuickActionButtonState buttonState) {\n \t\tOsmandSettings settings = app.getSettings();\n \t\tApplicationMode appMode = settings.getApplicationMode();\n+\t\tMapButtonsHelper buttonsHelper = app.getMapButtonsHelper();\n \t\tlong time = settings.getLastModePreferencesEditTime(appMode);\n \n \t\tbuttonState.setName(name);\n@@ -42,6 +72,8 @@ public void setupButtonState(@NonNull OsmandApplication app,\n \t\tif (opacity >= 0) {\n \t\t\tbuttonState.getOpacityPref().set(opacity);\n \t\t}\n+\t\tbuttonsHelper.updateQuickActions(buttonState, quickActions);\n+\t\tbuttonsHelper.updateActiveActions();\n \t\tsettings.setLastModePreferencesEditTime(appMode, time);\n \t}\n \n@@ -64,6 +96,7 @@ public static ButtonStateBean toStateBean(@NonNull QuickActionButtonState state)\n \t\tif (state.getOpacityPref().isSet()) {\n \t\t\tbean.opacity = state.getOpacityPref().get();\n \t\t}\n+\t\tbean.quickActions = state.getQuickActions();\n \t\treturn bean;\n \t}\n }\ndiff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonState.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonState.java\nindex 6cb8e34bba5..eb83bd3894b 100644\n--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonState.java\n+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonState.java\n@@ -231,12 +231,15 @@ private void updatePosition(@NonNull ButtonPositionSize position) {\n \n \t@Nullable\n \tpublic Drawable getIcon(@ColorInt int color, boolean nightMode, boolean mapIcon) {\n+\t\tint iconId = getIconId();\n+\t\treturn iconId != 0 ? getIcon(iconId, color, nightMode, mapIcon) : null;\n+\t}\n+\n+\t@DrawableRes\n+\tpublic int getIconId() {\n \t\tString iconName = createAppearanceParams().getIconName();\n \t\tint iconId = AndroidUtils.getDrawableId(app, iconName);\n-\t\tif (iconId == 0) {\n-\t\t\ticonId = RenderingIcons.getBigIconResourceId(iconName);\n-\t\t}\n-\t\treturn iconId != 0 ? getIcon(iconId, color, nightMode, mapIcon) : null;\n+\t\treturn iconId != 0 ? iconId : RenderingIcons.getBigIconResourceId(iconName);\n \t}\n \n \t@Nullable\n", "changes": [{"file": "OsmAnd/src/net/osmand/plus/backup/ImportBackupTask.java", "module": "net.osmand.plus.backup.ImportBackupTask", "range": [{"start": 286, "end": 287}]}, {"file": "OsmAnd/src/net/osmand/plus/backup/ui/BackupUiUtils.java", "module": "net.osmand.plus.backup.ui.BackupUiUtils", "range": [{"start": 25, "end": 26}, {"start": 64, "end": 74}]}, {"file": "OsmAnd/src/net/osmand/plus/plugins/custom/CustomOsmandPlugin.java", "module": "net.osmand.plus.plugins.custom.CustomOsmandPlugin", "range": [{"start": 45, "end": 45}, {"start": 286, "end": 288}, {"start": 289, "end": 290}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/ImportFileTask.java", "module": "net.osmand.plus.settings.backend.backup.ImportFileTask", "range": [{"start": 200, "end": 201}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/SettingsHelper.java", "module": "net.osmand.plus.settings.backend.backup.SettingsHelper", "range": [{"start": 30, "end": 30}, {"start": 164, "end": 165}, {"start": 180, "end": 182}, {"start": 231, "end": 235}, {"start": 347, "end": 349}, {"start": 351, "end": 353}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/exporttype/QuickActionsExportType.java", "module": "net.osmand.plus.settings.backend.backup.exporttype.QuickActionsExportType", "range": [{"start": 16, "end": 16}, {"start": 38, "end": 38}, {"start": 39, "end": 40}, {"start": 46, "end": 47}, {"start": 53, "end": 54}, {"start": 58, "end": 59}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.QuickActionsSettingsItem", "range": [{"start": 45, "end": 45}, {"start": 47, "end": 48}, {"start": 52, "end": 52}, {"start": 91, "end": 92}, {"start": 96, "end": 97}, {"start": 124, "end": 125}, {"start": 130, "end": 131}, {"start": 180, "end": 183}, {"start": 184, "end": 186}, {"start": 187, "end": 189}, {"start": 190, "end": 192}, {"start": 193, "end": 195}, {"start": 212, "end": 214}, {"start": 218, "end": 219}, {"start": 220, "end": 221}, {"start": 222, "end": 223}, {"start": 224, "end": 225}, {"start": 229, "end": 230}, {"start": 231, "end": 233}, {"start": 237, "end": 239}, {"start": 252, "end": 266}, {"start": 267, "end": 267}, {"start": 271, "end": 271}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/SettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.SettingsItem", "range": [{"start": 53, "end": 54}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/fragments/DuplicatesSettingsAdapter.java", "module": "net.osmand.plus.settings.fragments.DuplicatesSettingsAdapter", "range": [{"start": 40, "end": 40}, {"start": 133, "end": 137}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/fragments/ExportItemsBottomSheet.java", "module": "net.osmand.plus.settings.fragments.ExportItemsBottomSheet", "range": [{"start": 66, "end": 66}, {"start": 327, "end": 331}]}, {"file": "OsmAnd/src/net/osmand/plus/utils/AndroidUtils.java", "module": "net.osmand.plus.utils.AndroidUtils", "range": [{"start": 689, "end": 690}, {"start": 695, "end": 696}, {"start": 702, "end": 703}, {"start": 708, "end": 709}, {"start": 713, "end": 714}, {"start": 728, "end": 729}, {"start": 737, "end": 738}, {"start": 751, "end": 752}]}, {"file": "OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java", "module": "net.osmand.plus.views.mapwidgets.configure.buttons.ButtonStateBean", "range": [{"start": 3, "end": 3}, {"start": 6, "end": 6}, {"start": 8, "end": 8}, {"start": 10, "end": 10}, {"start": 15, "end": 18}, {"start": 19, "end": 19}, {"start": 24, "end": 24}, {"start": 28, "end": 28}, {"start": 45, "end": 45}, {"start": 67, "end": 67}]}, {"file": "OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/MapButtonState.java", "module": "net.osmand.plus.views.mapwidgets.configure.buttons.MapButtonState", "range": [{"start": 234, "end": 234}, {"start": 236, "end": 240}]}]}, {"number": 21686, "url": "https://github.com/osmandapp/OsmAnd/pull/21686", "diff_url": "https://github.com/osmandapp/OsmAnd/pull/21686.diff", "patch_url": "https://github.com/osmandapp/OsmAnd/pull/21686.patch", "title": "Fix #21408", "content": null, "diff": "diff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java\nindex f7c57255649..e784e4d4083 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java\n@@ -108,7 +108,7 @@ public void apply() {\n \t\t\t\trenameButton();\n \t\t\t}\n \t\t}\n-\t\tstateBean.setupButtonState(buttonState);\n+\t\tstateBean.setupButtonState(app, buttonState);\n \t\tmapButtonsHelper.addQuickActionButtonState(buttonState);\n \t}\n \n@@ -144,6 +144,7 @@ private void readButtonState(@NonNull JSONObject json) {\n \t\t\t\tbuttonState = new QuickActionButtonState(app, id);\n \t\t\t\tstateBean = new ButtonStateBean(id);\n \t\t\t\tstateBean.name = object.optString(\"name\");\n+\t\t\t\tstateBean.enabled = object.optBoolean(\"enabled\");\n \n \t\t\t\tString iconName = object.optString(\"icon\");\n \t\t\t\tif (!Algorithms.isEmpty(iconName)) {\n@@ -178,6 +179,7 @@ void writeToJson(@NonNull JSONObject json) throws JSONException {\n \t\t\tJSONObject jsonObject = new JSONObject();\n \t\t\tjsonObject.put(\"id\", buttonState.getId());\n \t\t\tjsonObject.put(\"name\", buttonState.hasCustomName() ? buttonState.getName() : \"\");\n+\t\t\tjsonObject.put(\"enabled\", buttonState.isEnabled());\n \n \t\t\tif (buttonState.getIconPref().isSet()) {\n \t\t\t\tjsonObject.put(\"icon\", buttonState.getIconPref().get());\ndiff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java\nindex 3813d1725cd..71fc45f1503 100644\n--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java\n+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java\n@@ -2,6 +2,9 @@\n \n import androidx.annotation.NonNull;\n \n+import net.osmand.plus.OsmandApplication;\n+import net.osmand.plus.settings.backend.ApplicationMode;\n+import net.osmand.plus.settings.backend.OsmandSettings;\n import net.osmand.util.Algorithms;\n \n public class ButtonStateBean {\n@@ -12,13 +15,20 @@ public class ButtonStateBean {\n \tpublic int size = -1;\n \tpublic int cornerRadius = -1;\n \tpublic float opacity = -1;\n+\tpublic boolean enabled;\n \n \tpublic ButtonStateBean(@NonNull String id) {\n \t\tthis.id = id;\n \t}\n \n-\tpublic void setupButtonState(@NonNull QuickActionButtonState buttonState) {\n+\tpublic void setupButtonState(@NonNull OsmandApplication app,\n+\t\t\t@NonNull QuickActionButtonState buttonState) {\n+\t\tOsmandSettings settings = app.getSettings();\n+\t\tApplicationMode appMode = settings.getApplicationMode();\n+\t\tlong time = settings.getLastModePreferencesEditTime(appMode);\n+\n \t\tbuttonState.setName(name);\n+\t\tbuttonState.setEnabled(enabled);\n \n \t\tif (!Algorithms.isEmpty(icon)) {\n \t\t\tbuttonState.getIconPref().set(icon);\n@@ -32,11 +42,13 @@ public void setupButtonState(@NonNull QuickActionButtonState buttonState) {\n \t\tif (opacity >= 0) {\n \t\t\tbuttonState.getOpacityPref().set(opacity);\n \t\t}\n+\t\tsettings.setLastModePreferencesEditTime(appMode, time);\n \t}\n \n \t@NonNull\n \tpublic static ButtonStateBean toStateBean(@NonNull QuickActionButtonState state) {\n \t\tButtonStateBean bean = new ButtonStateBean(state.getId());\n+\t\tbean.enabled = state.isEnabled();\n \t\tif (state.hasCustomName()) {\n \t\t\tbean.name = state.getName();\n \t\t}\n", "changes": [{"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.QuickActionsSettingsItem", "range": [{"start": 111, "end": 112}, {"start": 147, "end": 147}, {"start": 181, "end": 181}]}, {"file": "OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java", "module": "net.osmand.plus.views.mapwidgets.configure.buttons.ButtonStateBean", "range": [{"start": 5, "end": 5}, {"start": 15, "end": 15}, {"start": 20, "end": 21}, {"start": 22, "end": 22}, {"start": 35, "end": 35}, {"start": 40, "end": 40}]}]}, {"number": 21677, "url": "https://github.com/osmandapp/OsmAnd/pull/21677", "diff_url": "https://github.com/osmandapp/OsmAnd/pull/21677.diff", "patch_url": "https://github.com/osmandapp/OsmAnd/pull/21677.patch", "title": "Fix #21408", "content": null, "diff": "diff --git a/OsmAnd/src/net/osmand/plus/backup/ui/BackupUiUtils.java b/OsmAnd/src/net/osmand/plus/backup/ui/BackupUiUtils.java\nindex 36df953eb01..e6718a13b8f 100644\n--- a/OsmAnd/src/net/osmand/plus/backup/ui/BackupUiUtils.java\n+++ b/OsmAnd/src/net/osmand/plus/backup/ui/BackupUiUtils.java\n@@ -14,11 +14,15 @@\n \n import net.osmand.plus.OsmandApplication;\n import net.osmand.plus.R;\n+import net.osmand.plus.render.RenderingIcons;\n import net.osmand.plus.settings.backend.backup.exporttype.ExportType;\n import net.osmand.plus.settings.backend.backup.items.FileSettingsItem;\n import net.osmand.plus.settings.backend.backup.items.FileSettingsItem.FileSubtype;\n import net.osmand.plus.settings.backend.backup.items.ProfileSettingsItem;\n+import net.osmand.plus.settings.backend.backup.items.QuickActionsSettingsItem;\n import net.osmand.plus.settings.backend.backup.items.SettingsItem;\n+import net.osmand.plus.utils.AndroidUtils;\n+import net.osmand.plus.views.mapwidgets.configure.buttons.ButtonStateBean;\n import net.osmand.util.Algorithms;\n \n import java.text.DateFormat;\n@@ -53,10 +57,22 @@ public static String getItemName(@NonNull Context context, @NonNull SettingsItem\n \t}\n \n \t@DrawableRes\n-\tpublic static int getIconId(@NonNull SettingsItem item) {\n+\tpublic static int getIconId(@NonNull Context context, @NonNull SettingsItem item) {\n \t\tif (item instanceof ProfileSettingsItem) {\n \t\t\treturn ((ProfileSettingsItem) item).getAppMode().getIconRes();\n \t\t}\n+\t\tif (item instanceof QuickActionsSettingsItem) {\n+\t\t\tButtonStateBean stateBean = ((QuickActionsSettingsItem) item).getStateBean();\n+\t\t\tif (!Algorithms.isEmpty(stateBean.icon)) {\n+\t\t\t\tint iconId = AndroidUtils.getDrawableId(context, stateBean.icon);\n+\t\t\t\tif (iconId == 0) {\n+\t\t\t\t\ticonId = RenderingIcons.getBigIconResourceId(stateBean.icon);\n+\t\t\t\t}\n+\t\t\t\tif (iconId > 0) {\n+\t\t\t\t\treturn iconId;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n \t\tExportType exportType = ExportType.findBy(item);\n \t\treturn exportType != null ? exportType.getIconId() : -1;\n \t}\ndiff --git a/OsmAnd/src/net/osmand/plus/backup/ui/ChangesTabFragment.java b/OsmAnd/src/net/osmand/plus/backup/ui/ChangesTabFragment.java\nindex ef8c43e99fc..0b7b83b0669 100644\n--- a/OsmAnd/src/net/osmand/plus/backup/ui/ChangesTabFragment.java\n+++ b/OsmAnd/src/net/osmand/plus/backup/ui/ChangesTabFragment.java\n@@ -208,7 +208,7 @@ protected CloudChangeItem createChangeItem(@NonNull SyncOperationType operationT\n \t\t\titem.summary = localizedSummaryForOperation(operationType, localFile, remoteFile);\n \t\t\titem.time = getTime(operationType, localFile, remoteFile);\n \t\t\titem.description = BackupUiUtils.generateTimeString(app, item.summary, item.time);\n-\t\t\titem.iconId = BackupUiUtils.getIconId(settingsItem);\n+\t\t\titem.iconId = BackupUiUtils.getIconId(app, settingsItem);\n \t\t\titem.settingsItem = settingsItem;\n \t\t\titem.operation = operationType;\n \t\t\titem.localFile = localFile;\ndiff --git a/OsmAnd/src/net/osmand/plus/backup/ui/trash/CloudTrashItemMenuController.java b/OsmAnd/src/net/osmand/plus/backup/ui/trash/CloudTrashItemMenuController.java\nindex 4f1983f977c..33027e72858 100644\n--- a/OsmAnd/src/net/osmand/plus/backup/ui/trash/CloudTrashItemMenuController.java\n+++ b/OsmAnd/src/net/osmand/plus/backup/ui/trash/CloudTrashItemMenuController.java\n@@ -58,7 +58,7 @@ public DisplayData getDisplayData(@NonNull String processId) {\n \t\tDisplayData displayData = new DisplayData();\n \t\tdisplayData.putExtra(BACKGROUND_COLOR, ColorUtilities.getColorWithAlpha(ColorUtilities.getColor(app, activeColorId), 0.3f));\n \n-\t\tint iconId = item.getIconId();\n+\t\tint iconId = item.getIconId(app);\n \t\tdisplayData.addDisplayItem(new DisplayItem()\n \t\t\t\t.setClickable(false)\n \t\t\t\t.setTitle(item.getName(app))\ndiff --git a/OsmAnd/src/net/osmand/plus/backup/ui/trash/TrashItem.java b/OsmAnd/src/net/osmand/plus/backup/ui/trash/TrashItem.java\nindex beb94e839dc..c164cba9398 100644\n--- a/OsmAnd/src/net/osmand/plus/backup/ui/trash/TrashItem.java\n+++ b/OsmAnd/src/net/osmand/plus/backup/ui/trash/TrashItem.java\n@@ -46,9 +46,9 @@ public String getDescription(@NonNull OsmandApplication app) {\n \t}\n \n \t@DrawableRes\n-\tpublic int getIconId() {\n+\tpublic int getIconId(@NonNull Context context) {\n \t\tSettingsItem item = getSettingsItem();\n-\t\treturn item != null ? BackupUiUtils.getIconId(item) : -1;\n+\t\treturn item != null ? BackupUiUtils.getIconId(context, item) : -1;\n \t}\n \n \t@Nullable\ndiff --git a/OsmAnd/src/net/osmand/plus/backup/ui/trash/viewholder/ItemViewHolder.java b/OsmAnd/src/net/osmand/plus/backup/ui/trash/viewholder/ItemViewHolder.java\nindex 3d2934a409c..2654d87e026 100644\n--- a/OsmAnd/src/net/osmand/plus/backup/ui/trash/viewholder/ItemViewHolder.java\n+++ b/OsmAnd/src/net/osmand/plus/backup/ui/trash/viewholder/ItemViewHolder.java\n@@ -66,7 +66,7 @@ public void bindView(@NonNull TrashItem item, boolean lastItem, boolean hideDivi\n \t\ttitle.setText(item.getName(app));\n \t\tdescription.setText(item.getDescription(app));\n \n-\t\tint iconId = item.getIconId();\n+\t\tint iconId = item.getIconId(app);\n \t\ticon.setImageDrawable(iconId != -1 ? uiUtilities.getIcon(iconId) : null);\n \n \t\tsetupProgress(item);\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java b/OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java\nindex d13a93f903a..1e900bd6b53 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java\n@@ -108,7 +108,6 @@ public static List<ApplicationMode> values(@NonNull OsmandApplication app) {\n \t\t\tapp.getAppCustomization().addListener(customizationListener);\n \t\t}\n \t\tif (cachedFilteredValues.isEmpty()) {\n-\n \t\t\tOsmandSettings settings = app.getSettings();\n \t\t\tif (listener == null) {\n \t\t\t\tlistener = change -> cachedFilteredValues = new ArrayList<>();\n@@ -656,23 +655,24 @@ public static void deleteCustomModes(List<ApplicationMode> modes, OsmandApplicat\n \t\tsaveCustomAppModesToSettings(app);\n \t}\n \n-\tpublic static boolean changeProfileAvailability(ApplicationMode mode, boolean isSelected, OsmandApplication app) {\n-\t\tSet<ApplicationMode> selectedModes = new LinkedHashSet<>(values(app));\n-\t\tStringBuilder vls = new StringBuilder(DEFAULT.getStringKey() + \",\");\n-\t\tif (allPossibleValues().contains(mode)) {\n+\tpublic static boolean changeProfileAvailability(ApplicationMode appMode, boolean selected, OsmandApplication app) {\n+\t\tif (allPossibleValues().contains(appMode) && appMode != DEFAULT) {\n \t\t\tOsmandSettings settings = app.getSettings();\n-\t\t\tif (isSelected) {\n-\t\t\t\tselectedModes.add(mode);\n+\t\t\tSet<ApplicationMode> selectedModes = new LinkedHashSet<>(values(app));\n+\n+\t\t\tStringBuilder builder = new StringBuilder(DEFAULT.getStringKey() + \",\");\n+\t\t\tif (selected) {\n+\t\t\t\tselectedModes.add(appMode);\n \t\t\t} else {\n-\t\t\t\tselectedModes.remove(mode);\n-\t\t\t\tif (settings.APPLICATION_MODE.get() == mode) {\n+\t\t\t\tselectedModes.remove(appMode);\n+\t\t\t\tif (settings.APPLICATION_MODE.get() == appMode) {\n \t\t\t\t\tsettings.APPLICATION_MODE.resetToDefault();\n \t\t\t\t}\n \t\t\t}\n-\t\t\tfor (ApplicationMode m : selectedModes) {\n-\t\t\t\tvls.append(m.getStringKey()).append(\",\");\n+\t\t\tfor (ApplicationMode mode : selectedModes) {\n+\t\t\t\tbuilder.append(mode.getStringKey()).append(\",\");\n \t\t\t}\n-\t\t\tsettings.AVAILABLE_APP_MODES.set(vls.toString());\n+\t\t\tsettings.AVAILABLE_APP_MODES.set(builder.toString());\n \t\t\treturn true;\n \t\t}\n \t\treturn false;\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java\nindex 81f74f6e347..f7c57255649 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java\n@@ -71,6 +71,11 @@ public QuickActionButtonState getButtonState() {\n \t\treturn buttonState;\n \t}\n \n+\t@NonNull\n+\tpublic ButtonStateBean getStateBean() {\n+\t\treturn stateBean;\n+\t}\n+\n \t@Override\n \tpublic long getLocalModifiedTime() {\n \t\treturn buttonState.getLastModifiedTime();\n@@ -139,7 +144,6 @@ private void readButtonState(@NonNull JSONObject json) {\n \t\t\t\tbuttonState = new QuickActionButtonState(app, id);\n \t\t\t\tstateBean = new ButtonStateBean(id);\n \t\t\t\tstateBean.name = object.optString(\"name\");\n-\t\t\t\tstateBean.enabled = object.getBoolean(\"enabled\");\n \n \t\t\t\tString iconName = object.optString(\"icon\");\n \t\t\t\tif (!Algorithms.isEmpty(iconName)) {\n@@ -174,7 +178,6 @@ void writeToJson(@NonNull JSONObject json) throws JSONException {\n \t\t\tJSONObject jsonObject = new JSONObject();\n \t\t\tjsonObject.put(\"id\", buttonState.getId());\n \t\t\tjsonObject.put(\"name\", buttonState.hasCustomName() ? buttonState.getName() : \"\");\n-\t\t\tjsonObject.put(\"enabled\", buttonState.isEnabled());\n \n \t\t\tif (buttonState.getIconPref().isSet()) {\n \t\t\t\tjsonObject.put(\"icon\", buttonState.getIconPref().get());\ndiff --git a/OsmAnd/src/net/osmand/plus/utils/AndroidUtils.java b/OsmAnd/src/net/osmand/plus/utils/AndroidUtils.java\nindex 067c30884d9..236185a8425 100644\n--- a/OsmAnd/src/net/osmand/plus/utils/AndroidUtils.java\n+++ b/OsmAnd/src/net/osmand/plus/utils/AndroidUtils.java\n@@ -718,9 +718,9 @@ public static int getDrawableId(@NonNull OsmandApplication app, @NonNull String\n \t\treturn iconId > 0 ? iconId : defRes;\n \t}\n \n-\tpublic static int getDrawableId(OsmandApplication app, String id) {\n+\tpublic static int getDrawableId(@NonNull Context context, String id) {\n \t\tif (!Algorithms.isEmpty(id)) {\n-\t\t\treturn app.getResources().getIdentifier(id, \"drawable\", app.getPackageName());\n+\t\t\treturn context.getResources().getIdentifier(id, \"drawable\", context.getPackageName());\n \t\t}\n \t\treturn 0;\n \t}\ndiff --git a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java\nindex 09e9788144c..3813d1725cd 100644\n--- a/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java\n+++ b/OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java\n@@ -7,12 +7,11 @@\n public class ButtonStateBean {\n \n \tpublic String id;\n-\tpublic String name = \"\";\n+\tpublic String name = null;\n \tpublic String icon;\n \tpublic int size = -1;\n \tpublic int cornerRadius = -1;\n \tpublic float opacity = -1;\n-\tpublic boolean enabled;\n \n \tpublic ButtonStateBean(@NonNull String id) {\n \t\tthis.id = id;\n@@ -20,7 +19,6 @@ public ButtonStateBean(@NonNull String id) {\n \n \tpublic void setupButtonState(@NonNull QuickActionButtonState buttonState) {\n \t\tbuttonState.setName(name);\n-\t\tbuttonState.setEnabled(enabled);\n \n \t\tif (!Algorithms.isEmpty(icon)) {\n \t\t\tbuttonState.getIconPref().set(icon);\n@@ -39,7 +37,6 @@ public void setupButtonState(@NonNull QuickActionButtonState buttonState) {\n \t@NonNull\n \tpublic static ButtonStateBean toStateBean(@NonNull QuickActionButtonState state) {\n \t\tButtonStateBean bean = new ButtonStateBean(state.getId());\n-\t\tbean.enabled = state.isEnabled();\n \t\tif (state.hasCustomName()) {\n \t\t\tbean.name = state.getName();\n \t\t}\n", "changes": [{"file": "OsmAnd/src/net/osmand/plus/backup/ui/BackupUiUtils.java", "module": "net.osmand.plus.backup.ui.BackupUiUtils", "range": [{"start": 17, "end": 17}, {"start": 21, "end": 21}, {"start": 22, "end": 22}, {"start": 56, "end": 57}, {"start": 60, "end": 60}]}, {"file": "OsmAnd/src/net/osmand/plus/backup/ui/ChangesTabFragment.java", "module": "net.osmand.plus.backup.ui.ChangesTabFragment", "range": [{"start": 211, "end": 212}]}, {"file": "OsmAnd/src/net/osmand/plus/backup/ui/trash/CloudTrashItemMenuController.java", "module": "net.osmand.plus.backup.ui.trash.CloudTrashItemMenuController", "range": [{"start": 61, "end": 62}]}, {"file": "OsmAnd/src/net/osmand/plus/backup/ui/trash/TrashItem.java", "module": "net.osmand.plus.backup.ui.trash.TrashItem", "range": [{"start": 49, "end": 50}, {"start": 51, "end": 52}]}, {"file": "OsmAnd/src/net/osmand/plus/backup/ui/trash/viewholder/ItemViewHolder.java", "module": "net.osmand.plus.backup.ui.trash.viewholder.ItemViewHolder", "range": [{"start": 69, "end": 70}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/ApplicationMode.java", "module": "net.osmand.plus.settings.backend.ApplicationMode", "range": [{"start": 111, "end": 111}, {"start": 659, "end": 663}, {"start": 664, "end": 666}, {"start": 667, "end": 669}, {"start": 672, "end": 674}, {"start": 675, "end": 676}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.QuickActionsSettingsItem", "range": [{"start": 74, "end": 74}, {"start": 142, "end": 142}, {"start": 177, "end": 177}]}, {"file": "OsmAnd/src/net/osmand/plus/utils/AndroidUtils.java", "module": "net.osmand.plus.utils.AndroidUtils", "range": [{"start": 721, "end": 722}, {"start": 723, "end": 724}]}, {"file": "OsmAnd/src/net/osmand/plus/views/mapwidgets/configure/buttons/ButtonStateBean.java", "module": "net.osmand.plus.views.mapwidgets.configure.buttons.ButtonStateBean", "range": [{"start": 10, "end": 11}, {"start": 15, "end": 15}, {"start": 23, "end": 23}, {"start": 42, "end": 42}]}]}, {"number": 21482, "url": "https://github.com/osmandapp/OsmAnd/pull/21482", "diff_url": "https://github.com/osmandapp/OsmAnd/pull/21482.diff", "patch_url": "https://github.com/osmandapp/OsmAnd/pull/21482.patch", "title": "Fix #21408", "content": null, "diff": "diff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/AvoidRoadsSettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/AvoidRoadsSettingsItem.java\nindex 42463650227..08ce1ef9a67 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/AvoidRoadsSettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/AvoidRoadsSettingsItem.java\n@@ -186,7 +186,7 @@ JSONObject writeItemsToJson(@NonNull JSONObject json) {\n \t@Nullable\n \t@Override\n \tpublic SettingsItemReader<? extends SettingsItem> getReader() {\n-\t\treturn getJsonReader();\n+\t\treturn getJsonReader(false);\n \t}\n \n \t@Nullable\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/HistorySettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/HistorySettingsItem.java\nindex 3cfc98cbefb..0a2286fc08a 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/HistorySettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/HistorySettingsItem.java\n@@ -185,7 +185,7 @@ public long getEstimatedItemSize(@NonNull HistoryEntry item) {\n \t@Nullable\n \t@Override\n \tpublic SettingsItemReader<? extends SettingsItem> getReader() {\n-\t\treturn getJsonReader();\n+\t\treturn getJsonReader(false);\n \t}\n \n \t@Nullable\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/MapSourcesSettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/MapSourcesSettingsItem.java\nindex 6d9ba04d56f..7a368a34c09 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/MapSourcesSettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/MapSourcesSettingsItem.java\n@@ -278,7 +278,7 @@ JSONObject writeItemsToJson(@NonNull JSONObject json) {\n \t@Nullable\n \t@Override\n \tpublic SettingsItemReader<? extends SettingsItem> getReader() {\n-\t\treturn getJsonReader();\n+\t\treturn getJsonReader(false);\n \t}\n \n \t@Nullable\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OnlineRoutingSettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OnlineRoutingSettingsItem.java\nindex bc17382ef41..5043cf8cc1d 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OnlineRoutingSettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OnlineRoutingSettingsItem.java\n@@ -160,7 +160,7 @@ JSONObject writeItemsToJson(@NonNull JSONObject json) {\n \t@Nullable\n \t@Override\n \tpublic SettingsItemReader<? extends SettingsItem> getReader() {\n-\t\treturn getJsonReader();\n+\t\treturn getJsonReader(false);\n \t}\n \n \t@Nullable\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OsmEditsSettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OsmEditsSettingsItem.java\nindex 6799f58aad4..b9e524e7775 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OsmEditsSettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OsmEditsSettingsItem.java\n@@ -224,7 +224,7 @@ JSONObject writeItemsToJson(@NonNull JSONObject json) {\n \t@Nullable\n \t@Override\n \tpublic SettingsItemReader<? extends SettingsItem> getReader() {\n-\t\treturn getJsonReader();\n+\t\treturn getJsonReader(false);\n \t}\n \n \t@Nullable\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OsmNotesSettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OsmNotesSettingsItem.java\nindex 8bc429459ec..d722c94c176 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OsmNotesSettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OsmNotesSettingsItem.java\n@@ -205,7 +205,7 @@ JSONObject writeItemsToJson(@NonNull JSONObject json) {\n \t@Nullable\n \t@Override\n \tpublic SettingsItemReader<? extends SettingsItem> getReader() {\n-\t\treturn getJsonReader();\n+\t\treturn getJsonReader(false);\n \t}\n \n \t@Nullable\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/PoiUiFiltersSettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/PoiUiFiltersSettingsItem.java\nindex 69dc427c8e2..7b91a7897e0 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/PoiUiFiltersSettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/PoiUiFiltersSettingsItem.java\n@@ -210,7 +210,7 @@ JSONObject writeItemsToJson(@NonNull JSONObject json) {\n \t@Nullable\n \t@Override\n \tpublic SettingsItemReader<? extends SettingsItem> getReader() {\n-\t\treturn getJsonReader();\n+\t\treturn getJsonReader(false);\n \t}\n \n \t@Nullable\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java\nindex cdf4433b666..81f74f6e347 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java\n@@ -266,7 +266,7 @@ JSONObject writeItemsToJson(@NonNull JSONObject json) {\n \t@Nullable\n \t@Override\n \tpublic SettingsItemReader<? extends SettingsItem> getReader() {\n-\t\treturn getJsonReader();\n+\t\treturn getJsonReader(true);\n \t}\n \n \t@Nullable\ndiff --git a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/SettingsItem.java b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/SettingsItem.java\nindex 3464e5354ff..35492f74500 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/SettingsItem.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/backend/backup/items/SettingsItem.java\n@@ -5,8 +5,6 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n \n-import net.osmand.plus.shared.SharedUtil;\n-import net.osmand.shared.gpx.GpxFile;\n import net.osmand.IProgress;\n import net.osmand.plus.OsmandApplication;\n import net.osmand.plus.R;\n@@ -14,18 +12,14 @@\n import net.osmand.plus.settings.backend.backup.SettingsItemReader;\n import net.osmand.plus.settings.backend.backup.SettingsItemType;\n import net.osmand.plus.settings.backend.backup.SettingsItemWriter;\n+import net.osmand.plus.shared.SharedUtil;\n+import net.osmand.shared.gpx.GpxFile;\n import net.osmand.util.Algorithms;\n \n import org.json.JSONException;\n import org.json.JSONObject;\n \n-import java.io.BufferedReader;\n-import java.io.ByteArrayInputStream;\n-import java.io.File;\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.InputStreamReader;\n-import java.io.OutputStream;\n+import java.io.*;\n import java.util.ArrayList;\n import java.util.List;\n \n@@ -212,11 +206,11 @@ JSONObject writeItemsToJson(@NonNull JSONObject json) {\n \tpublic abstract SettingsItemWriter<? extends SettingsItem> getWriter();\n \n \t@NonNull\n-\tprotected SettingsItemReader<? extends SettingsItem> getJsonReader() {\n-\t\treturn new SettingsItemReader<SettingsItem>(this) {\n+\tprotected SettingsItemReader<? extends SettingsItem> getJsonReader(boolean allowEmptyJson) {\n+\t\treturn new SettingsItemReader<>(this) {\n \t\t\t@Override\n \t\t\tpublic void readFromStream(@NonNull InputStream inputStream, @Nullable File inputFile,\n-\t\t\t                           @Nullable String entryName) throws IOException, IllegalArgumentException {\n+\t\t\t\t\t@Nullable String entryName) throws IOException, IllegalArgumentException {\n \t\t\t\tStringBuilder buf = new StringBuilder();\n \t\t\t\ttry {\n \t\t\t\t\tBufferedReader in = new BufferedReader(new InputStreamReader(inputStream, \"UTF-8\"));\n@@ -228,8 +222,12 @@ public void readFromStream(@NonNull InputStream inputStream, @Nullable File inpu\n \t\t\t\t\tthrow new IOException(\"Cannot read json body\", e);\n \t\t\t\t}\n \t\t\t\tString json = buf.toString();\n-\t\t\t\tif (json.length() == 0) {\n-\t\t\t\t\tthrow new IllegalArgumentException(\"Json body is empty\");\n+\t\t\t\tif (json.isEmpty()) {\n+\t\t\t\t\tif (allowEmptyJson) {\n+\t\t\t\t\t\treturn;\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\tthrow new IllegalArgumentException(\"Json body is empty\");\n+\t\t\t\t\t}\n \t\t\t\t}\n \t\t\t\ttry {\n \t\t\t\t\treadItemsFromJson(new JSONObject(json));\n@@ -242,7 +240,7 @@ public void readFromStream(@NonNull InputStream inputStream, @Nullable File inpu\n \n \t@NonNull\n \tprotected SettingsItemWriter<? extends SettingsItem> getJsonWriter() {\n-\t\treturn new SettingsItemWriter<SettingsItem>(this) {\n+\t\treturn new SettingsItemWriter<>(this) {\n \t\t\t@Override\n \t\t\tpublic void writeToStream(@NonNull OutputStream outputStream, @Nullable IProgress progress) throws IOException {\n \t\t\t\tJSONObject json = writeItemsToJson(new JSONObject());\n", "changes": [{"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/AvoidRoadsSettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.AvoidRoadsSettingsItem", "range": [{"start": 189, "end": 190}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/HistorySettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.HistorySettingsItem", "range": [{"start": 188, "end": 189}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/MapSourcesSettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.MapSourcesSettingsItem", "range": [{"start": 281, "end": 282}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OnlineRoutingSettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.OnlineRoutingSettingsItem", "range": [{"start": 163, "end": 164}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OsmEditsSettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.OsmEditsSettingsItem", "range": [{"start": 227, "end": 228}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/OsmNotesSettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.OsmNotesSettingsItem", "range": [{"start": 208, "end": 209}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/PoiUiFiltersSettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.PoiUiFiltersSettingsItem", "range": [{"start": 213, "end": 214}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/QuickActionsSettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.QuickActionsSettingsItem", "range": [{"start": 269, "end": 270}]}, {"file": "OsmAnd/src/net/osmand/plus/settings/backend/backup/items/SettingsItem.java", "module": "net.osmand.plus.settings.backend.backup.items.SettingsItem", "range": [{"start": 8, "end": 9}, {"start": 17, "end": 17}, {"start": 22, "end": 29}, {"start": 215, "end": 217}, {"start": 219, "end": 220}, {"start": 231, "end": 233}, {"start": 245, "end": 246}]}]}]}
{"url": "https://github.com/osmandapp/OsmAnd/issues/19151", "repo": {"url": "https://github.com/osmandapp/OsmAnd", "name": "OsmAnd", "owner": "osmandapp", "modules": ["com.corwin.testtrx", "com.google.protobuf", "com.jwetherell.openmap.common", "com.wdtinc.mapbox_vector_tile.adapt", "com.wdtinc.mapbox_vector_tile.builder", "com.wdtinc.mapbox_vector_tile.encoding", "com.wdtinc.mapbox_vector_tile.util", "io.github.cosinekitty.astronomy", "net.osmand", "net.osmand.ais.simulate", "net.osmand.binary", "net.osmand.data", "net.osmand.gpx", "net.osmand.gpx.clickable", "net.osmand.map", "net.osmand.osm", "net.osmand.osm.edit", "net.osmand.osm.io", "net.osmand.osm.oauth", "net.osmand.render", "net.osmand.rendering", "net.osmand.router", "net.osmand.router.network", "net.osmand.search", "net.osmand.search.core", "net.osmand.shared", "net.osmand.shared.api", "net.osmand.shared.ble", "net.osmand.shared.data", "net.osmand.shared.extensions", "net.osmand.shared.gpx", "net.osmand.shared.grid", "net.osmand.shared.io", "net.osmand.shared.obd", "net.osmand.shared.routing", "net.osmand.shared.settings", "net.osmand.shared.util", "net.osmand.shared.wiki", "net.osmand.shared.xml", "net.osmand.test.common", "net.osmand.test.junit", "net.osmand.test.ui", "net.osmand.util", "net.osmand.wiki"]}, "issue": {"number": 19151, "url": "https://github.com/osmandapp/OsmAnd/issues/19151", "state": "closed", "title": "Tracks info it seems to reindexing after each Force stop?", "body": "## Description\r\n\r\n### How to reproduce\r\n* Import few track to OsmAnd\r\n* Restart OsmAnd with Force stop \r\n\r\n### Actual result\r\n<details>\r\n    <summary>Screenshot</summary>\r\n    <table style=\"width:100%\">\r\n      <tr>\r\n        <th>Before Restart</th>\r\n        <th>After restart</th>\r\n      </tr>\r\n      <tr>\r\n        <td><img src=\"https://github.com/osmandapp/OsmAnd/assets/9365308/d37a6793-5b77-4478-a152-c51621dd3794\"  width=\"300\" height=\"auto\"/> </td>\r\n        <td><img src=\"https://github.com/osmandapp/OsmAnd/assets/9365308/9d8ee6ce-d8e7-413b-90b5-e9201397bb7f\"  width=\"300\" height=\"auto\"/> </td>\r\n        <td><video src=\"https://github.com/osmandapp/OsmAnd/assets/9365308/c39f7a10-2bf9-4ec1-83b3-e58f73af3e05\"  width=\"300\" height=\"auto\"/> </td>\r\n      </tr>\r\n    </table>   \r\n</details>   \r\n\r\n* All **stats data**, **appearance**, **visible track**  is missed for some time\r\n* Log file  [logcat (1) (2).log](https://github.com/osmandapp/OsmAnd/files/14342795/logcat.1.2.log)\r\n* Tracks https://t.me/c/1193274712/8479\r\n\r\n### Expected result\r\n* All data should be available after restart for previously imported tracks\r\n\r\n**Environment**\r\nOsmAnd Version: 4.7.0#1631m 4700\r\nAndroid: 14\r\nDevice model: Pixel 6A\r\n \r\n", "logs": [{"name": "logcat (1) (2).log", "url": "https://github.com/osmandapp/OsmAnd/files/14342795/logcat.1.2.log"}]}, "pull_request": [{"number": 19531, "url": "https://github.com/osmandapp/OsmAnd/pull/19531", "diff_url": "https://github.com/osmandapp/OsmAnd/pull/19531.diff", "patch_url": "https://github.com/osmandapp/OsmAnd/pull/19531.patch", "title": "#19151: Fixed saving track data version", "content": null, "diff": "diff --git a/OsmAnd-java/src/main/java/net/osmand/gpx/GpxParameter.java b/OsmAnd-java/src/main/java/net/osmand/gpx/GpxParameter.java\nindex 5ffad05ef60..4afb2c04bd9 100644\n--- a/OsmAnd-java/src/main/java/net/osmand/gpx/GpxParameter.java\n+++ b/OsmAnd-java/src/main/java/net/osmand/gpx/GpxParameter.java\n@@ -62,7 +62,7 @@ public enum GpxParameter {\n \tAVG_SENSOR_CADENCE(\"avgSensorCadence\", \"double\", Double.class, 0d, true),\n \tMAX_SENSOR_HEART_RATE(\"maxSensorHr\", \"int\", Integer.class, 0, true),\n \tAVG_SENSOR_HEART_RATE(\"avgSensorHr\", \"double\", Double.class, 0d, true),\n-\tDATA_VERSION(\"dataVersion\", \"int\", Integer.class, 0, true);\n+\tDATA_VERSION(\"dataVersion\", \"int\", Integer.class, 0, false);\n \n \n \tprivate final String columnName;\n", "changes": [{"file": "OsmAnd-java/src/main/java/net/osmand/gpx/GpxParameter.java", "module": "net.osmand.gpx.GpxParameter", "range": [{"start": 65, "end": 66}]}]}]}
{"url": "https://github.com/osmandapp/OsmAnd/issues/17672", "repo": {"url": "https://github.com/osmandapp/OsmAnd", "name": "OsmAnd", "owner": "osmandapp", "modules": ["com.corwin.testtrx", "com.google.protobuf", "com.jwetherell.openmap.common", "com.wdtinc.mapbox_vector_tile.adapt", "com.wdtinc.mapbox_vector_tile.builder", "com.wdtinc.mapbox_vector_tile.encoding", "com.wdtinc.mapbox_vector_tile.util", "io.github.cosinekitty.astronomy", "net.osmand", "net.osmand.ais.simulate", "net.osmand.binary", "net.osmand.data", "net.osmand.gpx", "net.osmand.gpx.clickable", "net.osmand.map", "net.osmand.osm", "net.osmand.osm.edit", "net.osmand.osm.io", "net.osmand.osm.oauth", "net.osmand.render", "net.osmand.rendering", "net.osmand.router", "net.osmand.router.network", "net.osmand.search", "net.osmand.search.core", "net.osmand.shared", "net.osmand.shared.api", "net.osmand.shared.ble", "net.osmand.shared.data", "net.osmand.shared.extensions", "net.osmand.shared.gpx", "net.osmand.shared.grid", "net.osmand.shared.io", "net.osmand.shared.obd", "net.osmand.shared.routing", "net.osmand.shared.settings", "net.osmand.shared.util", "net.osmand.shared.wiki", "net.osmand.shared.xml", "net.osmand.test.common", "net.osmand.test.junit", "net.osmand.test.ui", "net.osmand.util", "net.osmand.wiki"]}, "issue": {"number": 17672, "url": "https://github.com/osmandapp/OsmAnd/issues/17672", "state": "closed", "title": "\"Import from file\" doesn't work ", "body": "## Description\r\n\r\n\r\n\r\n\r\n* File [Export_2023-06-29.osf.zip](https://github.com/osmandapp/OsmAnd/files/11904250/Export_2023-06-29.osf.zip)\r\n* Tested on today latest builds\r\n\r\n### How to reproduce\r\n* Save file to device\r\n* Open OsmAnd  Settings  Scroll down\r\n* Tap on Import from file\r\n* Select file in file manager\r\n\r\n### Actual result\r\n* Nothing happens\r\n* Log file  [logcat (1) (1).log](https://github.com/osmandapp/OsmAnd/files/12105207/logcat.1.1.log)\r\n\r\n```\r\nnet.osmand: SettingsHelper Failed to collect items from: Export_2023-06-29.osf\r\n java.lang.IllegalArgumentException: No items\r\n \tat net.osmand.plus.settings.backend.backup.SettingsImporter.processItems(SettingsImporter.java:109)\r\n \tat net.osmand.plus.settings.backend.backup.SettingsImporter.collectItems(SettingsImporter.java:37)\r\n \tat net.osmand.plus.settings.backend.backup.ImportFileTask.doInBackground(ImportFileTask.java:102)\r\n \tat net.osmand.plus.settings.backend.backup.ImportFileTask.doInBackground(ImportFileTask.java:23)\r\n \tat android.os.AsyncTask$3.call(AsyncTask.java:394)\r\n \tat java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\r\n \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:644)\r\n \tat java.lang.Thread.run(Thread.java:1012)\r\n```\r\n### Expected result\r\n* Import UI will be shown. Import the same file from File manager work as expected\r\n\r\n**Environment**\r\nOsmAnd~ 4.5.0#436m 4500\r\nAndroid version: 14\r\nDevice model: Pixel 6A\r\n", "logs": [{"name": "logcat (1) (1).log", "url": "https://github.com/osmandapp/OsmAnd/files/12105207/logcat.1.1.log"}]}, "pull_request": [{"number": 17761, "url": "https://github.com/osmandapp/OsmAnd/pull/17761", "diff_url": "https://github.com/osmandapp/OsmAnd/pull/17761.diff", "patch_url": "https://github.com/osmandapp/OsmAnd/pull/17761.patch", "title": "Fix #17672", "content": null, "diff": "diff --git a/OsmAnd/src/net/osmand/plus/myplaces/MyPlacesActivity.java b/OsmAnd/src/net/osmand/plus/myplaces/MyPlacesActivity.java\nindex 897bb5a9d2d..785d34cdb6b 100644\n--- a/OsmAnd/src/net/osmand/plus/myplaces/MyPlacesActivity.java\n+++ b/OsmAnd/src/net/osmand/plus/myplaces/MyPlacesActivity.java\n@@ -1,6 +1,5 @@\n package net.osmand.plus.myplaces;\n \n-import android.app.Activity;\n import android.content.Intent;\n import android.os.Bundle;\n import android.view.MenuItem;\n@@ -12,14 +11,12 @@\n import androidx.viewpager.widget.ViewPager;\n import androidx.viewpager.widget.ViewPager.SimpleOnPageChangeListener;\n \n-import net.osmand.PlatformUtil;\n import net.osmand.data.PointDescription;\n import net.osmand.plus.OsmandApplication;\n import net.osmand.plus.R;\n import net.osmand.plus.activities.MapActivity;\n import net.osmand.plus.activities.TabActivity;\n import net.osmand.plus.backup.ui.BackupAuthorizationFragment;\n-import net.osmand.plus.importfiles.ImportHelper;\n import net.osmand.plus.myplaces.favorites.dialogs.FavoritesTreeFragment;\n import net.osmand.plus.myplaces.favorites.dialogs.FragmentStateHolder;\n import net.osmand.plus.myplaces.tracks.dialogs.AvailableTracksFragment;\n@@ -27,8 +24,6 @@\n import net.osmand.plus.settings.backend.OsmandSettings;\n import net.osmand.plus.views.controls.PagerSlidingTabStrip;\n \n-import org.apache.commons.logging.Log;\n-\n import java.lang.ref.WeakReference;\n import java.util.ArrayList;\n import java.util.List;\n@@ -38,10 +33,6 @@\n  */\n public class MyPlacesActivity extends TabActivity {\n \n-\tprivate static final Log LOG = PlatformUtil.getLog(MyPlacesActivity.class);\n-\n-\tpublic static final int OPEN_GPX_DOCUMENT_REQUEST = 1006;\n-\tpublic static final int IMPORT_FAVOURITES_REQUEST = 1007;\n \n \tpublic static final String TAB_ID = \"selected_tab_id\";\n \n@@ -49,7 +40,6 @@ public class MyPlacesActivity extends TabActivity {\n \tpublic static final int FAV_TAB = R.string.shared_string_my_favorites;\n \n \tprivate OsmandSettings settings;\n-\tprivate ImportHelper importHelper;\n \n \tprivate ViewPager viewPager;\n \tprivate List<WeakReference<FragmentStateHolder>> fragmentsStateList = new ArrayList<>();\n@@ -61,7 +51,6 @@ public class MyPlacesActivity extends TabActivity {\n \tpublic void onCreate(@Nullable Bundle savedInstanceState) {\n \t\tOsmandApplication app = getMyApplication();\n \t\tsettings = app.getSettings();\n-\t\timportHelper = new ImportHelper(this);\n \t\tapp.applyTheme(this);\n \t\tsuper.onCreate(savedInstanceState);\n \n@@ -95,17 +84,6 @@ public void onCreate(@Nullable Bundle savedInstanceState) {\n \t\t}\n \t}\n \n-\t@Override\n-\tprotected void onActivityResult(int requestCode, int resultCode, Intent data) {\n-\t\tif (requestCode == IMPORT_FAVOURITES_REQUEST && resultCode == Activity.RESULT_OK) {\n-\t\t\tif (data != null && data.getData() != null) {\n-\t\t\t\timportHelper.handleFavouritesImport(data.getData());\n-\t\t\t}\n-\t\t} else {\n-\t\t\tsuper.onActivityResult(requestCode, resultCode, data);\n-\t\t}\n-\t}\n-\n \tprivate void setTabs(@NonNull List<TabItem> tabItems) {\n \t\tPagerSlidingTabStrip mSlidingTabLayout = findViewById(R.id.sliding_tabs);\n \t\tInteger tabId = settings.FAVORITES_TAB.get();\ndiff --git a/OsmAnd/src/net/osmand/plus/myplaces/favorites/dialogs/FavoritesTreeFragment.java b/OsmAnd/src/net/osmand/plus/myplaces/favorites/dialogs/FavoritesTreeFragment.java\nindex b511798b3f2..ea31a511c7c 100644\n--- a/OsmAnd/src/net/osmand/plus/myplaces/favorites/dialogs/FavoritesTreeFragment.java\n+++ b/OsmAnd/src/net/osmand/plus/myplaces/favorites/dialogs/FavoritesTreeFragment.java\n@@ -4,10 +4,9 @@\n import static net.osmand.plus.OsmAndLocationProvider.OsmAndCompassListener;\n import static net.osmand.plus.OsmAndLocationProvider.OsmAndLocationListener;\n import static net.osmand.plus.myplaces.MyPlacesActivity.FAV_TAB;\n-import static net.osmand.plus.myplaces.MyPlacesActivity.IMPORT_FAVOURITES_REQUEST;\n import static net.osmand.plus.myplaces.MyPlacesActivity.TAB_ID;\n-import static net.osmand.plus.widgets.dialogbutton.DialogButtonType.SECONDARY;\n \n+import android.app.Activity;\n import android.content.Intent;\n import android.graphics.PorterDuff;\n import android.graphics.Typeface;\n@@ -81,17 +80,19 @@\n public class FavoritesTreeFragment extends OsmandExpandableListFragment implements FragmentStateHolder,\n \t\tOsmAndCompassListener, OsmAndLocationListener, ShareFavoritesListener {\n \n-\tpublic static final int SEARCH_ID = -1;\n-\tpublic static final int DELETE_ID = 2;\n-\tpublic static final int DELETE_ACTION_ID = 3;\n-\tpublic static final int SHARE_ID = 4;\n-\tpublic static final int SELECT_MAP_MARKERS_ID = 5;\n-\tpublic static final int SELECT_MAP_MARKERS_ACTION_MODE_ID = 6;\n-\tpublic static final int IMPORT_FAVOURITES_ID = 7;\n-\tpublic static final String GROUP_EXPANDED_POSTFIX = \"_group_expanded\";\n+\tprivate static final int IMPORT_FAVOURITES_REQUEST = 1007;\n+\tprivate static final int SEARCH_ID = -1;\n+\tprivate static final int DELETE_ID = 2;\n+\tprivate static final int DELETE_ACTION_ID = 3;\n+\tprivate static final int SHARE_ID = 4;\n+\tprivate static final int SELECT_MAP_MARKERS_ID = 5;\n+\tprivate static final int SELECT_MAP_MARKERS_ACTION_MODE_ID = 6;\n+\tprivate static final int IMPORT_FAVOURITES_ID = 7;\n+\tprivate static final String GROUP_EXPANDED_POSTFIX = \"_group_expanded\";\n \n \tprivate FavouritesHelper helper;\n \tprivate FavouritesAdapter favouritesAdapter;\n+\tprivate ImportHelper importHelper;\n \n \tprivate boolean selectionMode;\n \tprivate final LinkedHashMap<String, Set<FavouritePoint>> favoritesSelected = new LinkedHashMap<>();\n@@ -119,6 +120,7 @@ public class FavoritesTreeFragment extends OsmandExpandableListFragment implemen\n \tpublic void onCreate(@Nullable Bundle savedInstanceState) {\n \t\tsuper.onCreate(savedInstanceState);\n \t\tfavouritesAdapter = new FavouritesAdapter();\n+\t\timportHelper = new ImportHelper(requireActivity());\n \n \t\thelper = app.getFavoritesHelper();\n \t\tif (helper.isFavoritesLoaded()) {\n@@ -179,10 +181,11 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n \t\t\tboolean nightMode = !app.getSettings().isLightContent();\n \t\t\tView searchView = inflater.inflate(R.layout.search_fav_list_item, listView, false);\n \t\t\tsearchView.setBackgroundResource(ColorUtilities.getListBgColorId(nightMode));\n+\n \t\t\tTextView title = searchView.findViewById(R.id.title);\n-\t\t\tDrawable searchIcon = app.getUIUtilities().getThemedIcon(R.drawable.ic_action_search_dark);\n+\t\t\tDrawable searchIcon = getContentIcon(R.drawable.ic_action_search_dark);\n \t\t\tAndroidUtils.setCompoundDrawablesWithIntrinsicBounds(title, searchIcon, null, null, null);\n-\t\t\tsearchView.setOnClickListener(v -> FavoritesSearchFragment.showInstance(getActivity(), \"\"));\n+\t\t\tsearchView.setOnClickListener(v -> FavoritesSearchFragment.showInstance(requireActivity(), \"\"));\n \t\t\tlistView.addHeaderView(searchView);\n \t\t\tView dividerView = inflater.inflate(R.layout.list_item_divider, null, false);\n \t\t\tboolean proAvailable = InAppPurchaseHelper.isOsmAndProAvailable(app);\n@@ -594,6 +597,17 @@ private void importFavourites() {\n \t\tAndroidUtils.startActivityForResultIfSafe(this, intent, IMPORT_FAVOURITES_REQUEST);\n \t}\n \n+\t@Override\n+\tpublic void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {\n+\t\tif (requestCode == IMPORT_FAVOURITES_REQUEST && resultCode == Activity.RESULT_OK) {\n+\t\t\tif (data != null && data.getData() != null) {\n+\t\t\t\timportHelper.handleFavouritesImport(data.getData());\n+\t\t\t}\n+\t\t} else {\n+\t\t\tsuper.onActivityResult(requestCode, resultCode, data);\n+\t\t}\n+\t}\n+\n \tpublic void shareFavorites(@Nullable FavoriteGroup group) {\n \t\tShareFavoritesAsyncTask shareFavoritesTask = new ShareFavoritesAsyncTask(app, group, this);\n \t\tshareFavoritesTask.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR);\n", "changes": [{"file": "OsmAnd/src/net/osmand/plus/myplaces/MyPlacesActivity.java", "module": "net.osmand.plus.myplaces.MyPlacesActivity", "range": [{"start": 3, "end": 3}, {"start": 15, "end": 15}, {"start": 22, "end": 22}, {"start": 30, "end": 31}, {"start": 41, "end": 44}, {"start": 52, "end": 52}, {"start": 64, "end": 64}, {"start": 98, "end": 108}]}, {"file": "OsmAnd/src/net/osmand/plus/myplaces/favorites/dialogs/FavoritesTreeFragment.java", "module": "net.osmand.plus.myplaces.favorites.dialogs.FavoritesTreeFragment", "range": [{"start": 7, "end": 7}, {"start": 9, "end": 9}, {"start": 11, "end": 11}, {"start": 84, "end": 92}, {"start": 95, "end": 95}, {"start": 122, "end": 122}, {"start": 182, "end": 182}, {"start": 183, "end": 184}, {"start": 185, "end": 186}, {"start": 597, "end": 597}]}]}]}
{"url": "https://github.com/osmandapp/OsmAnd/issues/17527", "repo": {"url": "https://github.com/osmandapp/OsmAnd", "name": "OsmAnd", "owner": "osmandapp", "modules": ["com.corwin.testtrx", "com.google.protobuf", "com.jwetherell.openmap.common", "com.wdtinc.mapbox_vector_tile.adapt", "com.wdtinc.mapbox_vector_tile.builder", "com.wdtinc.mapbox_vector_tile.encoding", "com.wdtinc.mapbox_vector_tile.util", "io.github.cosinekitty.astronomy", "net.osmand", "net.osmand.ais.simulate", "net.osmand.binary", "net.osmand.data", "net.osmand.gpx", "net.osmand.gpx.clickable", "net.osmand.map", "net.osmand.osm", "net.osmand.osm.edit", "net.osmand.osm.io", "net.osmand.osm.oauth", "net.osmand.render", "net.osmand.rendering", "net.osmand.router", "net.osmand.router.network", "net.osmand.search", "net.osmand.search.core", "net.osmand.shared", "net.osmand.shared.api", "net.osmand.shared.ble", "net.osmand.shared.data", "net.osmand.shared.extensions", "net.osmand.shared.gpx", "net.osmand.shared.grid", "net.osmand.shared.io", "net.osmand.shared.obd", "net.osmand.shared.routing", "net.osmand.shared.settings", "net.osmand.shared.util", "net.osmand.shared.wiki", "net.osmand.shared.xml", "net.osmand.test.common", "net.osmand.test.junit", "net.osmand.test.ui", "net.osmand.util", "net.osmand.wiki"]}, "issue": {"number": 17527, "url": "https://github.com/osmandapp/OsmAnd/issues/17527", "state": "closed", "title": "Wrong widgets order and placement after import without restart", "body": "## Description\r\nAfter import OSF file with profile settings, widgets that should be on left panel, visible on the right panel, widget duplicates is missing too, it change back to proper order and quantity after app restart.\r\n\r\n> Tested on `OsmAnd~ 4.5.0#306m, released: 2023-06-29`\r\n\r\nLogcat after import (without restart)  [logcat (7).log](https://github.com/osmandapp/OsmAnd/files/11904348/logcat.7.log)\r\n\r\n## How to reproduce\r\n* **Reset to default** Browser map profile\r\n* **Left panel** in **Configure Screen** should be empty\r\n* Import the file [Export_2023-06-29.osf.zip](https://github.com/osmandapp/OsmAnd/files/11904250/Export_2023-06-29.osf.zip)\r\n\r\n## Actual result\r\n* Widgets shows up on wrong panel (right instead of left)\r\n* Duplicates is missing\r\n* Manual app restart fix the issue\r\n\r\n\r\n<table style=\"width:100%\">\r\n  <tr>\r\n    <th>State before Export (right order and panel)</th>\r\n    <th>State after import (without restart)</th>\r\n  </tr>\r\n  <tr>\r\n    <td><img src=\"https://github.com/osmandapp/OsmAnd/assets/9365308/e9ff0b71-19a9-440a-8585-1ef4397da4da\"  width=\"300\" height=\"auto\"/> </td>\r\n    <td><img src=\"https://github.com/osmandapp/OsmAnd/assets/9365308/b2543448-c529-4c2d-8abb-76d8bee81226\"  width=\"300\" height=\"auto\"/> </td>\r\n    <td><video source src=\"https://github.com/osmandapp/OsmAnd/assets/9365308/c963e023-8d53-45c7-9000-d4cf8ac4f07f\"  width=\"300\" height=\"auto\"/>   </td>\r\n  </tr>\r\n</table>   \r\n\r\n\r\n\r\n", "logs": [{"name": "logcat (7).log", "url": "https://github.com/osmandapp/OsmAnd/files/11904348/logcat.7.log"}]}, "pull_request": [{"number": 17612, "url": "https://github.com/osmandapp/OsmAnd/pull/17612", "diff_url": "https://github.com/osmandapp/OsmAnd/pull/17612.diff", "patch_url": "https://github.com/osmandapp/OsmAnd/pull/17612.patch", "title": "#17527: Fixed profile import with widgets", "content": null, "diff": "diff --git a/OsmAnd/src/net/osmand/plus/settings/fragments/ImportSettingsFragment.java b/OsmAnd/src/net/osmand/plus/settings/fragments/ImportSettingsFragment.java\nindex 689d76d37fb..c2e795268ef 100644\n--- a/OsmAnd/src/net/osmand/plus/settings/fragments/ImportSettingsFragment.java\n+++ b/OsmAnd/src/net/osmand/plus/settings/fragments/ImportSettingsFragment.java\n@@ -1,5 +1,8 @@\n package net.osmand.plus.settings.fragments;\n \n+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.AVAILABLE_MODE;\n+import static net.osmand.plus.views.mapwidgets.MapWidgetRegistry.ENABLED_MODE;\n+\n import android.os.Bundle;\n import android.view.LayoutInflater;\n import android.view.View;\n@@ -17,6 +20,7 @@\n import net.osmand.PlatformUtil;\n import net.osmand.plus.AppInitializer;\n import net.osmand.plus.R;\n+import net.osmand.plus.activities.MapActivity;\n import net.osmand.plus.plugins.PluginsHelper;\n import net.osmand.plus.plugins.audionotes.AudioVideoNotesPlugin;\n import net.osmand.plus.resources.ResourceManager.ReloadIndexesListener;\n@@ -25,9 +29,12 @@\n import net.osmand.plus.settings.backend.backup.SettingsHelper.ImportListener;\n import net.osmand.plus.settings.backend.backup.items.FileSettingsItem;\n import net.osmand.plus.settings.backend.backup.items.SettingsItem;\n+import net.osmand.plus.views.layers.MapInfoLayer;\n+import net.osmand.plus.views.mapwidgets.WidgetsPanel;\n \n import org.apache.commons.logging.Log;\n \n+import java.util.Collections;\n import java.util.List;\n \n public abstract class ImportSettingsFragment extends BaseSettingsListFragment {\n@@ -100,6 +107,13 @@ public void onImportFinished(boolean succeed, boolean needRestart, @NonNull List\n \t\t\t\t\tif (plugin != null) {\n \t\t\t\t\t\tplugin.indexingFiles(true, true);\n \t\t\t\t\t}\n+\t\t\t\t\tMapActivity activity = getMapActivity();\n+\t\t\t\t\tif (activity != null) {\n+\t\t\t\t\t\tMapInfoLayer mapInfoLayer = activity.getMapLayers().getMapInfoLayer();\n+\t\t\t\t\t\tif (mapInfoLayer != null) {\n+\t\t\t\t\t\t\tmapInfoLayer.recreateAllControls(activity);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n \t\t\t\t}\n \t\t\t\timportFinished(succeed, needRestart, items);\n \t\t\t}\n", "changes": [{"file": "OsmAnd/src/net/osmand/plus/settings/fragments/ImportSettingsFragment.java", "module": "net.osmand.plus.settings.fragments.ImportSettingsFragment", "range": [{"start": 3, "end": 3}, {"start": 20, "end": 20}, {"start": 28, "end": 28}, {"start": 31, "end": 31}, {"start": 103, "end": 103}]}]}]}
{"url": "https://github.com/osmandapp/OsmAnd/issues/16780", "repo": {"url": "https://github.com/osmandapp/OsmAnd", "name": "OsmAnd", "owner": "osmandapp", "modules": ["com.corwin.testtrx", "com.google.protobuf", "com.jwetherell.openmap.common", "com.wdtinc.mapbox_vector_tile.adapt", "com.wdtinc.mapbox_vector_tile.builder", "com.wdtinc.mapbox_vector_tile.encoding", "com.wdtinc.mapbox_vector_tile.util", "io.github.cosinekitty.astronomy", "net.osmand", "net.osmand.ais.simulate", "net.osmand.binary", "net.osmand.data", "net.osmand.gpx", "net.osmand.gpx.clickable", "net.osmand.map", "net.osmand.osm", "net.osmand.osm.edit", "net.osmand.osm.io", "net.osmand.osm.oauth", "net.osmand.render", "net.osmand.rendering", "net.osmand.router", "net.osmand.router.network", "net.osmand.search", "net.osmand.search.core", "net.osmand.shared", "net.osmand.shared.api", "net.osmand.shared.ble", "net.osmand.shared.data", "net.osmand.shared.extensions", "net.osmand.shared.gpx", "net.osmand.shared.grid", "net.osmand.shared.io", "net.osmand.shared.obd", "net.osmand.shared.routing", "net.osmand.shared.settings", "net.osmand.shared.util", "net.osmand.shared.wiki", "net.osmand.shared.xml", "net.osmand.test.common", "net.osmand.test.junit", "net.osmand.test.ui", "net.osmand.util", "net.osmand.wiki"]}, "issue": {"number": 16780, "url": "https://github.com/osmandapp/OsmAnd/issues/16780", "state": "closed", "title": "Crash when switching to V1", "body": "### Description\r\nCrash when switching to V1\r\n[logcat (84).log](https://github.com/osmandapp/OsmAnd/files/11049585/logcat.84.log)\r\n\r\n\r\n### Steps to reproduce\r\nMenu > Settings > OsmAnd settings > Map rendering engine > V1\r\n\r\n### Actual result\r\nCrash\r\n\r\nhttps://user-images.githubusercontent.com/104760013/227173136-94ea755c-688b-42ae-9892-1089ec8da2b8.mp4\r\n\r\n\r\n\r\n### Expected result\r\nSwitching to V1 takes place without a crash\r\n\r\n### Your Environment\r\nOsmAnd Version: OsmAnd~ 4.4.0#14261mqta, Released: 2023-03-23\r\nAndroid/iOS version: Android 12\r\nDevice model: Poco x3 nfc\r\n", "logs": [{"name": "logcat (84).log", "url": "https://github.com/osmandapp/OsmAnd/files/11049585/logcat.84.log"}]}, "pull_request": [{"number": 16924, "url": "https://github.com/osmandapp/OsmAnd/pull/16924", "diff_url": "https://github.com/osmandapp/OsmAnd/pull/16924.diff", "patch_url": "https://github.com/osmandapp/OsmAnd/pull/16924.patch", "title": "Fix #16780", "content": null, "diff": "diff --git a/OsmAnd/src/net/osmand/plus/dialogs/MapRenderingEngineDialog.java b/OsmAnd/src/net/osmand/plus/dialogs/MapRenderingEngineDialog.java\nindex b0e7e7cb83c..d440f74565a 100644\n--- a/OsmAnd/src/net/osmand/plus/dialogs/MapRenderingEngineDialog.java\n+++ b/OsmAnd/src/net/osmand/plus/dialogs/MapRenderingEngineDialog.java\n@@ -5,11 +5,14 @@\n import android.view.LayoutInflater;\n import android.view.View;\n \n+import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.appcompat.app.AlertDialog;\n import androidx.appcompat.widget.AppCompatRadioButton;\n import androidx.fragment.app.FragmentActivity;\n \n+import net.osmand.plus.AppInitializer;\n+import net.osmand.plus.AppInitializer.AppInitializeListener;\n import net.osmand.plus.OsmandApplication;\n import net.osmand.plus.R;\n import net.osmand.plus.Version;\n@@ -58,7 +61,7 @@ private AlertDialog createDialog(@Nullable OnRenderChangeListener renderChangeLi\n \t\treturn builder.create();\n \t}\n \n-\tprivate AppCompatRadioButton setupRadioItem(View view, String name){\n+\tprivate AppCompatRadioButton setupRadioItem(View view, String name) {\n \t\tAppCompatRadioButton radioButton = view.findViewById(R.id.radio);\n \t\tTextViewEx text = view.findViewById(R.id.text);\n \t\ttext.setText(name);\n@@ -67,10 +70,28 @@ private AppCompatRadioButton setupRadioItem(View view, String name){\n \t\treturn radioButton;\n \t}\n \n-\tprivate void updateRenderingEngineSetting(boolean openglEnabled,@Nullable OnRenderChangeListener renderChangeListener) {\n+\tprivate void updateRenderingEngineSetting(boolean openglEnabled, @Nullable OnRenderChangeListener listener) {\n \t\tupdateRadioButtons(openglEnabled);\n \t\tapp.getSettings().USE_OPENGL_RENDER.set(openglEnabled);\n \n+\t\tif (app.isApplicationInitializing()) {\n+\t\t\tString title = app.getString(R.string.loading_smth, \"\");\n+\t\t\tProgressDialog progress = ProgressDialog.show(fragmentActivity, title, app.getString(R.string.loading_data));\n+\t\t\tapp.getAppInitializer().addListener(new AppInitializeListener() {\n+\t\t\t\t@Override\n+\t\t\t\tpublic void onFinish(@NonNull AppInitializer init) {\n+\t\t\t\t\tif (AndroidUtils.isActivityNotDestroyed(fragmentActivity)) {\n+\t\t\t\t\t\tprogress.dismiss();\n+\t\t\t\t\t}\n+\t\t\t\t\tupdateRenderingEngine(openglEnabled, listener);\n+\t\t\t\t}\n+\t\t\t});\n+\t\t} else {\n+\t\t\tupdateRenderingEngine(openglEnabled, listener);\n+\t\t}\n+\t}\n+\n+\tprivate void updateRenderingEngine(boolean openglEnabled, @Nullable OnRenderChangeListener listener) {\n \t\tif (openglEnabled && !NativeCoreContext.isInit()) {\n \t\t\tString title = app.getString(R.string.loading_smth, \"\");\n \t\t\tProgressDialog progress = ProgressDialog.show(fragmentActivity, title, app.getString(R.string.loading_data));\n@@ -86,9 +107,8 @@ private void updateRenderingEngineSetting(boolean openglEnabled,@Nullable OnRend\n \t\t\t\tapp.getOsmandMap().getMapLayers().getMapVectorLayer().setAlpha(255);\n \t\t\t}\n \t\t}\n-\n-\t\tif (renderChangeListener != null) {\n-\t\t\trenderChangeListener.onRenderChange();\n+\t\tif (listener != null) {\n+\t\t\tlistener.onRenderChange();\n \t\t}\n \t}\n \n", "changes": [{"file": "OsmAnd/src/net/osmand/plus/dialogs/MapRenderingEngineDialog.java", "module": "net.osmand.plus.dialogs.MapRenderingEngineDialog", "range": [{"start": 8, "end": 8}, {"start": 13, "end": 13}, {"start": 61, "end": 62}, {"start": 70, "end": 71}, {"start": 74, "end": 74}, {"start": 89, "end": 92}]}]}]}
{"url": "https://github.com/Neamar/KISS/issues/1876", "repo": {"url": "https://github.com/Neamar/KISS", "name": "KISS", "owner": "Neamar", "modules": ["com.android.colorpicker", "fr.neamar.kiss", "fr.neamar.kiss.adapter", "fr.neamar.kiss.androidTest", "fr.neamar.kiss.broadcast", "fr.neamar.kiss.dataprovider", "fr.neamar.kiss.dataprovider.simpleprovider", "fr.neamar.kiss.db", "fr.neamar.kiss.forwarder", "fr.neamar.kiss.icons", "fr.neamar.kiss.kustomsupport", "fr.neamar.kiss.loader", "fr.neamar.kiss.normalizer", "fr.neamar.kiss.notification", "fr.neamar.kiss.pojo", "fr.neamar.kiss.preference", "fr.neamar.kiss.result", "fr.neamar.kiss.searcher", "fr.neamar.kiss.shortcut", "fr.neamar.kiss.ui", "fr.neamar.kiss.utils", "fr.neamar.kiss.utils.calculator", "fr.neamar.kiss.utils.fuzzy"]}, "issue": {"number": 1876, "url": "https://github.com/Neamar/KISS/issues/1876", "state": "closed", "title": "Crash when resizing Suntimes widget", "body": "**Describe the crash**\r\nWhen enlarging the suntimes widget, KISS launcher crashes\r\n\r\n**To Reproduce**\r\nSteps to reproduce the crash:\r\n1. Have KISS launcher in [Minimalistic UI](https://help.kisslauncher.com/widgets/add-a-widget/) mode\r\n2. Install [Suntimes](https://f-droid.org/en/packages/com.forrestguice.suntimeswidget/)\r\n3. From KISS menu, click _Add widget_ and select _Suntimes Widget_\r\n4. _Suntimes Widget_ will open a configuration dialog. Exit it using _back_ button or by clicking __\r\n5. Click and hold on the newly added _Suntimes Widget_\r\n6. KISS Launcher opens a menu on the widget\r\n7. Press _Enlarge_\r\n\r\n**Screenshots**\r\n![Screenshot_20220217-223800](https://user-images.githubusercontent.com/934401/154575633-c1c1c82b-93d8-4db1-be10-f530c256b6ab.png)\r\n![Screenshot_20220217-224006](https://user-images.githubusercontent.com/934401/154575645-c79d6f53-acfe-43c9-91f6-937a370b9148.png)\r\n\r\n**Stack trace**\r\n```\r\nE AndroidRuntime: FATAL EXCEPTION: main\r\nE AndroidRuntime: Process: fr.neamar.kiss, PID: 10053\r\nE AndroidRuntime: java.lang.NullPointerException: Attempt to read from field 'int android.appwidget.AppWidgetProviderInfo.minHeight' on a null object reference\r\nE AndroidRuntime: \tat fr.neamar.kiss.forwarder.Widgets.preventResizeWidget(Widgets.java:1)\r\nE AndroidRuntime: \tat fr.neamar.kiss.forwarder.Widgets.resizeWidget(Widgets.java:2)\r\nE AndroidRuntime: \tat fr.neamar.kiss.forwarder.Widgets$$ExternalSyntheticLambda1.onMenuItemClick(Unknown Source:17)\r\nE AndroidRuntime: \tat android.widget.PopupMenu$1.onMenuItemSelected(PopupMenu.java:108)\r\nE AndroidRuntime: \tat com.android.internal.view.menu.MenuBuilder.dispatchMenuItemSelected(MenuBuilder.java:787)\r\nE AndroidRuntime: \tat com.android.internal.view.menu.MenuItemImpl.invoke(MenuItemImpl.java:151)\r\nE AndroidRuntime: \tat com.android.internal.view.menu.MenuBuilder.performItemAction(MenuBuilder.java:934)\r\nE AndroidRuntime: \tat com.android.internal.view.menu.MenuBuilder.performItemAction(MenuBuilder.java:924)\r\nE AndroidRuntime: \tat com.android.internal.view.menu.MenuPopup.onItemClick(MenuPopup.java:128)\r\nE AndroidRuntime: \tat android.widget.AdapterView.performItemClick(AdapterView.java:330)\r\nE AndroidRuntime: \tat android.widget.AbsListView.performItemClick(AbsListView.java:1210)\r\nE AndroidRuntime: \tat android.widget.AbsListView$PerformClick.run(AbsListView.java:3202)\r\nE AndroidRuntime: \tat android.os.Handler.handleCallback(Handler.java:938)\r\nE AndroidRuntime: \tat android.os.Handler.dispatchMessage(Handler.java:99)\r\nE AndroidRuntime: \tat android.os.Looper.loop(Looper.java:223)\r\nE AndroidRuntime: \tat android.app.ActivityThread.main(ActivityThread.java:7715)\r\nE AndroidRuntime: \tat java.lang.reflect.Method.invoke(Native Method)\r\nE AndroidRuntime: \tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)\r\nE AndroidRuntime: \tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:952)\r\n```\r\nFull log: [kiss-crash_reduced.txt](https://github.com/Neamar/KISS/files/8092454/kiss-crash_reduced.txt)\r\n\r\n> * by clicking on \"Report\" or \"Send feedback\" in the crash dialog, then \"Details\" or \"More\", and look for an entry called \"Stack trace\" -- and send a screenshot of the content;\r\n\r\nHow can I enable that?\r\n\r\n**Additional information**\r\n - App version: 3.16.7\r\n - Did the crash start happening with this version? yes\r\n - App installed via: f-droid\r\n\r\n**Additional context**\r\n - operating system: Android 11\r\n - Suntimes Widget:\r\n   - Version 0.14.0\r\n   - from F-Droid\r\n   - Git repo: https://github.com/forrestguice/SuntimesWidget", "logs": [{"name": "kiss-crash_reduced.txt", "url": "https://github.com/Neamar/KISS/files/8092454/kiss-crash_reduced.txt"}]}, "pull_request": [{"number": 1880, "url": "https://github.com/Neamar/KISS/pull/1880", "diff_url": "https://github.com/Neamar/KISS/pull/1880.diff", "patch_url": "https://github.com/Neamar/KISS/pull/1880.patch", "title": "fix widget resize", "content": "- remove widget view if widget wasn't configured because appWidgetId is then deleted too\r\n- add null check\r\n- fixes #1876\r\n\r\n<!--\r\n\r\nThanks for taking the time to make KISS better by contributing code!\r\n\r\nBefore you open the pull request, please make sure that:\r\n\r\n* Your pull request title is clear enough -- ideally, reading the title should be enough to understand the content\r\n* Your description explains what you're trying to do (ideally referencing some existing issues)\r\n* If you made any tradeoffs, please mention them and explain why you think they were necessary\r\n* Include screenshots of your changes\r\n* If you add something slightly complex, feel free to create [a new documentation page](https://github.com/Neamar/KISS/tree/master/docs/_posts), users will thank you for that!\r\n\r\nYou might also want to have a look at the [\"Before contributing...\"](https://github.com/Neamar/KISS/blob/master/CONTRIBUTING.md#before-contributing) section ;)\r\n\r\nOnce again, thanks for your help! Feel free to remove all this text and start typing...\r\n\r\n-->\r\n", "diff": "diff --git a/app/src/main/java/fr/neamar/kiss/forwarder/Widgets.java b/app/src/main/java/fr/neamar/kiss/forwarder/Widgets.java\nindex 51044b4207..046d19a847 100644\n--- a/app/src/main/java/fr/neamar/kiss/forwarder/Widgets.java\n+++ b/app/src/main/java/fr/neamar/kiss/forwarder/Widgets.java\n@@ -22,14 +22,13 @@\n \n import java.util.ArrayList;\n import java.util.HashSet;\n+import java.util.List;\n import java.util.Set;\n \n import fr.neamar.kiss.MainActivity;\n import fr.neamar.kiss.R;\n import fr.neamar.kiss.ui.WidgetHost;\n \n-import static android.appwidget.AppWidgetProviderInfo.RESIZE_VERTICAL;\n-\n class Widgets extends Forwarder {\n     private static final int REQUEST_APPWIDGET_PICKED = 9;\n     private static final int REQUEST_APPWIDGET_CONFIGURED = 5;\n@@ -76,9 +75,22 @@ void onActivityResult(int requestCode, int resultCode, Intent data) {\n                     break;\n             }\n         } else if (resultCode == Activity.RESULT_CANCELED && data != null && (requestCode == REQUEST_APPWIDGET_CONFIGURED || requestCode == REQUEST_APPWIDGET_PICKED)) {\n-            // if widget was not selected, delete id\n+            // if widget was not selected, delete it\n             int appWidgetId = data.getIntExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, -1);\n             if (appWidgetId != -1) {\n+                // find widget views for appWidgetId\n+                List<View> viewsToRemove = new ArrayList<>();\n+                for (int i = 0; i < widgetArea.getChildCount(); i++) {\n+                    AppWidgetHostView view = (AppWidgetHostView) widgetArea.getChildAt(i);\n+                    if (view.getAppWidgetId() == appWidgetId) {\n+                        viewsToRemove.add(view);\n+                    }\n+                }\n+                // remove view\n+                for (View viewToRemove : viewsToRemove) {\n+                    widgetArea.removeView(viewToRemove);\n+                }\n+                // delete widget id\n                 mAppWidgetHost.deleteAppWidgetId(appWidgetId);\n             }\n         }\n@@ -111,7 +123,7 @@ void onDataSetChanged() {\n     }\n \n     private void serializeState() {\n-        ArrayList<String> builder = new ArrayList<>(widgetArea.getChildCount());\n+        List<String> builder = new ArrayList<>(widgetArea.getChildCount());\n         for (int i = 0; i < widgetArea.getChildCount(); i++) {\n             AppWidgetHostView view = (AppWidgetHostView) widgetArea.getChildAt(i);\n             int appWidgetId = view.getAppWidgetId();\n@@ -183,26 +195,27 @@ private void addWidget(int appWidgetId, int lineSize) {\n \n         hostView.setLongClickable(true);\n         hostView.setOnLongClickListener(v -> {\n-            final AppWidgetHostView widgetWithMenuCurrentlyDisplayed = hostView;\n+            final AppWidgetHostView widgetWithMenuCurrentlyDisplayed = (AppWidgetHostView) v;\n+            final AppWidgetProviderInfo currentAppWidgetInfo = mAppWidgetManager.getAppWidgetInfo(widgetWithMenuCurrentlyDisplayed.getAppWidgetId());\n \n             PopupMenu popup = new PopupMenu(mainActivity, v);\n             popup.inflate(R.menu.menu_widget);\n \n             Menu menu = popup.getMenu();\n             // Disable items that can't be triggered\n-            final ViewGroup parent = (ViewGroup) hostView.getParent();\n-            if (parent.indexOfChild(hostView) == 0) {\n+            final ViewGroup parent = (ViewGroup) widgetWithMenuCurrentlyDisplayed.getParent();\n+            if (parent.indexOfChild(widgetWithMenuCurrentlyDisplayed) == 0) {\n                 menu.findItem(R.id.move_up).setVisible(false);\n             }\n-            if (parent.indexOfChild(hostView) == parent.getChildCount() - 1) {\n+            if (parent.indexOfChild(widgetWithMenuCurrentlyDisplayed) == parent.getChildCount() - 1) {\n                 menu.findItem(R.id.move_down).setVisible(false);\n             }\n-            int decreasedLineHeight = getDecreasedLineHeight(hostView);\n-            if (preventResizeWidget(decreasedLineHeight, appWidgetInfo)) {\n+            int decreasedLineHeight = getDecreasedLineHeight(widgetWithMenuCurrentlyDisplayed);\n+            if (preventResizeWidget(decreasedLineHeight, currentAppWidgetInfo)) {\n                 menu.findItem(R.id.decrease_size).setVisible(false);\n             }\n-            int increasedLineHeight = getIncreasedLineHeight(hostView);\n-            if (preventResizeWidget(increasedLineHeight, appWidgetInfo)) {\n+            int increasedLineHeight = getIncreasedLineHeight(widgetWithMenuCurrentlyDisplayed);\n+            if (preventResizeWidget(increasedLineHeight, currentAppWidgetInfo)) {\n                 menu.findItem(R.id.increase_size).setVisible(false);\n             }\n \n@@ -215,13 +228,13 @@ private void addWidget(int appWidgetId, int lineSize) {\n                         serializeState();\n                         return true;\n                     case R.id.increase_size: {\n-                        int height1 = getIncreasedLineHeight(widgetWithMenuCurrentlyDisplayed);\n-                        resizeWidget(widgetWithMenuCurrentlyDisplayed, height1);\n+                        int newHeight = getIncreasedLineHeight(widgetWithMenuCurrentlyDisplayed);\n+                        resizeWidget(widgetWithMenuCurrentlyDisplayed, newHeight);\n                         return true;\n                     }\n                     case R.id.decrease_size: {\n-                        int height1 = getDecreasedLineHeight(widgetWithMenuCurrentlyDisplayed);\n-                        resizeWidget(widgetWithMenuCurrentlyDisplayed, height1);\n+                        int newHeight = getDecreasedLineHeight(widgetWithMenuCurrentlyDisplayed);\n+                        resizeWidget(widgetWithMenuCurrentlyDisplayed, newHeight);\n                         return true;\n                     }\n                     case R.id.move_up: {\n@@ -308,7 +321,7 @@ private void resizeWidget(AppWidgetHostView hostView, int height) {\n      * @return true, if widget cannot be resized to given height\n      */\n     private boolean preventResizeWidget(int height, AppWidgetProviderInfo appWidgetInfo) {\n-        return height <= 0 || height < Math.min(appWidgetInfo.minHeight, appWidgetInfo.minResizeHeight);\n+        return height <= 0 || appWidgetInfo == null || height < Math.min(appWidgetInfo.minHeight, appWidgetInfo.minResizeHeight);\n     }\n \n     /**\n", "changes": [{"file": "app/src/main/java/fr/neamar/kiss/forwarder/Widgets.java", "module": "fr.neamar.kiss.forwarder.Widgets", "range": [{"start": 25, "end": 25}, {"start": 31, "end": 32}, {"start": 79, "end": 80}, {"start": 82, "end": 82}, {"start": 114, "end": 115}, {"start": 186, "end": 187}, {"start": 193, "end": 195}, {"start": 197, "end": 198}, {"start": 200, "end": 202}, {"start": 204, "end": 206}, {"start": 218, "end": 220}, {"start": 223, "end": 225}, {"start": 311, "end": 312}]}]}]}
{"url": "https://github.com/cgeo/cgeo/issues/16234", "repo": {"url": "https://github.com/cgeo/cgeo", "name": "cgeo", "owner": "cgeo", "modules": ["app.organicmaps.api", "cgeo.geocaching", "cgeo.geocaching.about", "cgeo.geocaching.activity", "cgeo.geocaching.address", "cgeo.geocaching.apps", "cgeo.geocaching.backup", "cgeo.geocaching.brouter", "cgeo.geocaching.calendar", "cgeo.geocaching.command", "cgeo.geocaching.connector", "cgeo.geocaching.contacts", "cgeo.geocaching.downloader", "cgeo.geocaching.enumerations", "cgeo.geocaching.export", "cgeo.geocaching.files", "cgeo.geocaching.filters", "cgeo.geocaching.helper", "cgeo.geocaching.list", "cgeo.geocaching.loaders", "cgeo.geocaching.location", "cgeo.geocaching.log", "cgeo.geocaching.maps", "cgeo.geocaching.models", "cgeo.geocaching.network", "cgeo.geocaching.permission", "cgeo.geocaching.playservices", "cgeo.geocaching.search", "cgeo.geocaching.sensors", "cgeo.geocaching.service", "cgeo.geocaching.settings", "cgeo.geocaching.sorting", "cgeo.geocaching.speech", "cgeo.geocaching.storage", "cgeo.geocaching.test", "cgeo.geocaching.ui", "cgeo.geocaching.unifiedmap", "cgeo.geocaching.utils", "cgeo.geocaching.wherigo", "cgeo.test", "cgeo.watchdog"]}, "issue": {"number": 16234, "url": "https://github.com/cgeo/cgeo/issues/16234", "state": "closed", "title": "Wherigo Player: Delete cartridge with or without savegame crashes c:geo", "body": "### Describe your problem!\n\n1. Without savegame\r\nWhen deleting a cartridge c:geo crashes, or goes to the main page, but deletes the cartridge\r\n\r\n2. With savegame\r\nWhen deleting a cartridge c:geo crashes, or goes to the main page, deletes the cartridge, but dosen't delete the savegame\n\n### How to reproduce?\n\n1a. Download cartridge (I've tried 2 differents, got the same result)\r\n2a. Go to main page of c:geo\r\n3a. Open Wherigo Player, open cartridge\r\n4a. Select delete (oddly says \"including 1 savegame\" but it dosen't have any savegames)\r\n5a. c:geo crashes, 90% of the times close c:geo, 10% of the times goes to the mai page of c:geo when it shoud be on the main page of wherigo player\r\n6a. But delete the cartridge with success\r\n\r\n1b. Download cartridge (I've tried 2 differents, got the same result)\r\n2b. Go to main page of c:geo\r\n3b. Open Wherigo Player, open cartridge\r\n4b. Play Cartridge, and create a savegame\r\n5b. Stop running wherigo game\r\n6b. Select delete (oddly says \"including 2 savegames\" but it only have one savegame)\r\n7b. c:geo crashes, 90% of the times close c:geo, 10% of the times goes to the mai page of c:geo when it shoud be on the main page of wherigo player\r\n8b. But deletes the cartridge with success, but dosent delete the savegame\r\n\r\n\r\nhttps://github.com/user-attachments/assets/020975fc-3bf0-4004-90cc-bf68143f918a\r\n\r\n\r\nhttps://github.com/user-attachments/assets/cd0480d8-8ca1-4731-b05e-a38cddbfe147\r\n\r\n\n\n### Actual result after these steps?\n\nThe app crashes\n\n### Expected result after these steps?\n\nDeletion with success both cartridge and savegames. Keep beeing in the wherigo player\n\n### Reproducible\n\nYes\n\n### c:geo Version\n\n2024.10.18-NB-1db0219\n\n### System information\n\n```text\n## System information\r\n\r\nc:geo version: 2024.10.18-NB-1db0219\r\n\r\nDevice:\r\n-------\r\n- Device type: 21121210G (ingres_eea, POCO)\r\n- Available processors: 8\r\n- Android version: 14\r\n- Android build: UKQ1.230917.001 release-keys\r\n- Screen resolution: 1080x2186px (393x795dp)\r\n- Pixel density: 2.75\r\n- System font scale: 1.0 / used scale: 1.0\r\n- Sailfish OS detected: false\r\n- Google Play services: enabled - 24.41.34 (190400-685836814)\r\n- Memory: Available:3,3 GB, Total:10,9 GB, Threshold: 216,0 MB, low:false\r\n\r\nSensor and location:\r\n-------\r\n- Low power mode: inactive\r\n- Compass capabilities: yes\r\n- Rotation vector sensor: present\r\n- Orientation sensor: present\r\n- Magnetometer & Accelerometer sensor: present\r\n- Direction sensor used: rotation vector\r\n\r\nProgram settings:\r\n-------\r\n- Settings: v9, Count:204\r\n- Set language: pt_PT (system default)\r\n- System date format: dd/MM/yy\r\n- Time zone: GMT+01:00\r\n- Debug mode active: no\r\n- Log Settings: debug=false, minLevel=WARN, minAddCallerInfo=NONE, addCallerInfoMaxDepth=8, throwOnError=false, transactionSizes=false\r\n- Last manual backup: 3/10, 23:05\r\n- Last auto backup: 12/10, 09:10\r\n- Routing mode: Walk (shortest.brf / trekking.brf / car-eco.brf / (none) / (none))\r\n- Live map mode: true\r\n- Use unified map: true\r\n- OSM multi-threading: false / threads: 1\r\n- Map: Spain-Portugal (OAM) (Offline)\r\n- Id: cgeo.geocaching.maps.mapsforge.MapsforgeMapProvider$OfflineMapSource:primary:CGEO/maps/Spain-Portugal (OAM).map\r\n- Atts: #VectorMaps:(c)Christian Kernbeis, GeneralMaps:(c)Michael Bechtold, Themes:(c)Tobias Kuehn, www.openandromaps.org 2012-2024 #Hoehendaten: sonny.4lima.de, viewfinderpanoamas.org, NASA #Kartendaten: openstreetmap.org\r\n- Theme: Elevate.zip:Elevate.xml\r\n\r\nFilters:\r\n-------\r\n- Hide waypoints: original\r\n- LIVE: Estado: Tem Registo Offline de Encontrada=No ({\"advanced\":false,\"inconclusive\":false,\"tree\":{\"type\":\"AND\",\"children\":[{\"type\":\"type\",\"config\":{}},{\"type\":\"difficulty_terrain\",\"config\":{\"d\":{},\"t\":{}}},{\"type\":\"status\",\"config\":{\"values\":[\"has_offline_found_log_no\"]}}]}})\r\n- OFFLINE: Nenhum ({\"advanced\":true,\"inconclusive\":false,\"tree\":{\"type\":\"AND\",\"children\":[{\"type\":\"type\",\"config\":{}},{\"type\":\"status\",\"config\":{}}]}})\r\n\r\nServices:\r\n-------\r\n- Geocaching sites enabled:\r\n- geocaching.com: Logged in (Sesso iniciada) / PREMIUM\r\n- Geocaching.com Adventure Lab\r\n- Geocaching.com date format: yyyy-MM-dd\r\n- Geocaching.com website language: pt-PT\r\n- Last login error on geocaching.com: communication error // (2024-10-05 09-52)\r\n- Last successful login on geocaching.com: 2024-10-18 21-52\r\n- Routing: internal / BRouter installed: false\r\n\r\nPermissions\r\n-------\r\n- ACCESS_COARSE_LOCATION: granted\r\n- ACCESS_FINE_LOCATION: granted\r\n- READ_CONTACTS: granted\r\n- WRITE_EXTERNAL_STORAGE: DENIED\r\n- POST_NOTIFICATIONS: granted\r\n\r\nPaths\r\n-------\r\n- System internal c:geo dir: /data/user/0/cgeo.geocaching (147,9 GB free) v3 internal isDir(10 entries)\r\n- Legacy User storage c:geo dir: /data/user/0/cgeo.geocaching (147,9 GB free) v3 internal isDir(10 entries)\r\n- Geocache data: /storage/emulated/0/Android/data/cgeo.geocaching/files/GeocacheData (147,9 GB free) v3 external non-removable isDir(7104 entries)\r\n- Internal theme sync (is turned ON): /data/user/0/cgeo.geocaching/MapThemeData (147,9 GB free) v3 internal isDir(9 entries)\r\n- Map render theme path: Elevate.zip:Elevate.xml\r\n- Public Folders: #13\r\n- BASE: content://com.android.externalstorage.documents/tree/primary:CGEO/document/primary:CGEO (av:true, files:>=27, size:>=1,9 GB, free:>=147,9 GB)\r\n- OFFLINE_MAPS: content://com.android.externalstorage.documents/tree/primary:CGEO/maps/document/primary:CGEO/maps (av:true, files:>=11, size:>=1,9 GB, free:>=147,9 GB)\r\n- OFFLINE_MAP_THEMES: content://com.android.externalstorage.documents/tree/primary:CGEO/maps/_themes/document/primary:CGEO/maps/_themes (av:true, files:>=8, size:>=1,9 MB, free:>=147,9 GB)\r\n- OFFLINE_MAP_SHADING: content://com.android.externalstorage.documents/tree/primary:CGEO/maps/_hgt/document/primary:CGEO/maps/_hgt (av:true, files:>=1, size:>=2,8 MB, free:>=147,9 GB)\r\n- LOGFILES: content://com.android.externalstorage.documents/tree/primary:CGEO/document/primary:CGEO/logfiles (av:true, files:>=15, size:>=19,2 MB, free:>=147,9 GB)\r\n- GPX: content://com.android.externalstorage.documents/tree/primary:CGEO/document/primary:CGEO/gpx (av:true, files:>=1, size:>=226,1 KB, free:>=147,9 GB)\r\n- BACKUP: content://com.android.externalstorage.documents/tree/primary:CGEO/document/primary:CGEO/backup (av:true, files:>=14, size:>=603,1 MB, free:>=147,9 GB)\r\n- FIELD_NOTES: content://com.android.externalstorage.documents/tree/primary:CGEO/document/primary:CGEO/field-notes (av:true, files:>=0, size:>=0 B, free:>=147,9 GB)\r\n- SPOILER_IMAGES: content://com.android.externalstorage.documents/tree/primary:CGEO/document/primary:CGEO/GeocachePhotos (av:true, files:>=0, size:>=0 B, free:>=147,9 GB)\r\n- ROUTING_BASE: content://com.android.externalstorage.documents/tree/primary:CGEO/document/primary:CGEO/routing (av:true, files:>=11, size:>=184,8 MB, free:>=147,9 GB)\r\n- ROUTING_TILES: content://com.android.externalstorage.documents/tree/primary:CGEO/document/primary:CGEO/routing/segments4 (av:true, files:>=3, size:>=184,7 MB, free:>=147,9 GB)\r\n- WHERIGO: content://com.android.externalstorage.documents/tree/primary:CGEO/document/primary:CGEO/wherigo (av:true, files:>=5, size:>=3,7 MB, free:>=147,9 GB)\r\n- TEST_FOLDER: file:///data/user/0/cgeo.geocaching/files/unittest (av:true, files:>=0, size:>=0 B, free:>=147,9 GB)\r\n- PersistedDocumentUris: #2\r\n- PROXIMITY_NOTIFICATION_FAR: null\r\n- PROXIMITY_NOTIFICATION_CLOSE: null\r\n- Persisted Uri Permissions: #4\r\n- content://com.android.externalstorage.documents/tree/primary:CGEO/maps/_hgt (30/01/2023, 21:22):RW\r\n- content://com.android.externalstorage.documents/tree/primary:CGEO/maps (30/01/2023, 21:22):RW\r\n- content://com.android.externalstorage.documents/tree/primary:CGEO/maps/_themes (30/01/2023, 21:22):RW\r\n- content://com.android.externalstorage.documents/tree/primary:CGEO (12/01/2023, 21:47):RW\r\n\r\nDatabase\r\n-------\r\n- File: /data/user/0/cgeo.geocaching/databases/data (v103, Size:284,1 MB) on system internal storage\r\n- Data: {cg_attributes=52974, cg_caches=7547, cg_caches_lists=8113, cg_categories=0, cg_extension=74, cg_filters=0, cg_lists=11, cg_logCount=41677, cg_logImages=146841, cg_logs=285456, cg_logs_offline=23, cg_logs_offline_images=4, cg_logs_offline_trackables=32, cg_route=0, cg_search_destination_history=0, cg_spoilers=10615, cg_trackables=404, cg_trail_history=700, cg_variables=161, cg_waypoints=5532}\r\n- Extension Data: {DBEXTENSION_DOWNGRADEABLE_DBVERSION=1, DBEXTENSION_EMOJILRU=4, DBEXTENSION_FOUNDNUM=2, DBEXTENSION_LAST_TRACKABLE_ACTION=52, DBEXTENSION_ONE_TIME_DIALOGS=9, DBEXTENSION_POCKETQUERY_HISTORY=1, DBEXTENSION_TRACKFILES=5}\r\n\r\n--- End of system information ---\n```\n\n\n### Additional Information\n\n[logcat-2024-10-18-21-52-13-2.txt](https://github.com/user-attachments/files/17440616/logcat-2024-10-18-21-52-13-2.txt)\r\n", "logs": [{"name": "logcat-2024-10-18-21-52-13-2.txt", "url": "https://github.com/user-attachments/files/17440616/logcat-2024-10-18-21-52-13-2.txt"}]}, "pull_request": [{"number": 16236, "url": "https://github.com/cgeo/cgeo/pull/16236", "diff_url": "https://github.com/cgeo/cgeo/pull/16236.diff", "patch_url": "https://github.com/cgeo/cgeo/pull/16236.patch", "title": "fix #16234: avoid NPE on Wherigo cartridge delete", "content": "fix #16234: avoid NPE on Wherigo cartridge delete", "diff": "diff --git a/main/src/main/java/cgeo/geocaching/wherigo/WherigoCartridgeDialogProvider.java b/main/src/main/java/cgeo/geocaching/wherigo/WherigoCartridgeDialogProvider.java\nindex 7d2c0bfbe78..d38e171f3c3 100644\n--- a/main/src/main/java/cgeo/geocaching/wherigo/WherigoCartridgeDialogProvider.java\n+++ b/main/src/main/java/cgeo/geocaching/wherigo/WherigoCartridgeDialogProvider.java\n@@ -108,9 +108,13 @@ private void performActionAfterGameEnded(final CartridgeAction action, final Act\n                     .setMessage(TextParam.id(R.string.wherigo_confirm_delete_cartridge_message, WherigoGame.get().getCartridgeName(), \"\" + saveGames.size()))\n                     .setButtons(SimpleDialog.ButtonTextSet.YES_NO)\n                     .confirm(() -> {\n-                        ContentStorage.get().delete(cartridgeInfo.getFileInfo().uri);\n+                        if (cartridgeInfo.getFileInfo() != null && cartridgeInfo.getFileInfo().uri != null) {\n+                            ContentStorage.get().delete(cartridgeInfo.getFileInfo().uri);\n+                        }\n                         for (WherigoSavegameInfo savegame : saveGames) {\n-                            ContentStorage.get().delete(savegame.fileInfo.uri);\n+                            if (savegame.fileInfo != null && savegame.fileInfo.uri != null) {\n+                                ContentStorage.get().delete(savegame.fileInfo.uri);\n+                            }\n                         }\n                     });\n         } else {\n", "changes": [{"file": "main/src/main/java/cgeo/geocaching/wherigo/WherigoCartridgeDialogProvider.java", "module": "cgeo.geocaching.wherigo.WherigoCartridgeDialogProvider", "range": [{"start": 111, "end": 112}, {"start": 113, "end": 114}]}]}]}
{"url": "https://github.com/cgeo/cgeo/issues/15726", "repo": {"url": "https://github.com/cgeo/cgeo", "name": "cgeo", "owner": "cgeo", "modules": ["app.organicmaps.api", "cgeo.geocaching", "cgeo.geocaching.about", "cgeo.geocaching.activity", "cgeo.geocaching.address", "cgeo.geocaching.apps", "cgeo.geocaching.backup", "cgeo.geocaching.brouter", "cgeo.geocaching.calendar", "cgeo.geocaching.command", "cgeo.geocaching.connector", "cgeo.geocaching.contacts", "cgeo.geocaching.downloader", "cgeo.geocaching.enumerations", "cgeo.geocaching.export", "cgeo.geocaching.files", "cgeo.geocaching.filters", "cgeo.geocaching.helper", "cgeo.geocaching.list", "cgeo.geocaching.loaders", "cgeo.geocaching.location", "cgeo.geocaching.log", "cgeo.geocaching.maps", "cgeo.geocaching.models", "cgeo.geocaching.network", "cgeo.geocaching.permission", "cgeo.geocaching.playservices", "cgeo.geocaching.search", "cgeo.geocaching.sensors", "cgeo.geocaching.service", "cgeo.geocaching.settings", "cgeo.geocaching.sorting", "cgeo.geocaching.speech", "cgeo.geocaching.storage", "cgeo.geocaching.test", "cgeo.geocaching.ui", "cgeo.geocaching.unifiedmap", "cgeo.geocaching.utils", "cgeo.geocaching.wherigo", "cgeo.test", "cgeo.watchdog"]}, "issue": {"number": 15726, "url": "https://github.com/cgeo/cgeo/issues/15726", "state": "closed", "title": "[UnifiedMap] [nightly] crash on panning / zooming / loading caches on map", "body": "### Describe your problem!\r\n\r\nOn panning / zooming the map (UnifiedMap), the map crashes.\r\nSometimes it needs 2 or 3 steps - probably related to the visible cash count?\r\n\r\neven crashes on just opening the map...\r\n\r\ndoes not crash, if only a few cashes are visible\r\n\r\n### How to reproduce?\r\n\r\nOpen UnifiedMap around Stuttgart\r\nPan / zoom out\r\n\r\n\r\n### Actual result after these steps?\r\n\r\nc:geo crashes\r\n\r\n### Expected result after these steps?\r\n\r\nno crahs\r\n\r\n### Reproducible\r\n\r\nYes\r\n\r\n### c:geo Version\r\n\r\n2024.05.12-NB-a1dd1ef\r\n\r\n### System information\r\n\r\n_No response_\r\n\r\n### Additional Information\r\n\r\n![logcat-2024-05-12-21-28-34-2.txt](https://github.com/cgeo/cgeo/files/15287562/logcat-2024-05-12-21-28-34-2.txt)\r\n\r\n", "logs": [{"name": "logcat-2024-05-12-21-28-34-2.txt", "url": "https://github.com/cgeo/cgeo/files/15287562/logcat-2024-05-12-21-28-34-2.txt"}]}, "pull_request": [{"number": 15752, "url": "https://github.com/cgeo/cgeo/pull/15752", "diff_url": "https://github.com/cgeo/cgeo/pull/15752.diff", "patch_url": "https://github.com/cgeo/cgeo/pull/15752.patch", "title": "rel to #15726: VTM, make atlas usage optional", "content": "rel to #15726: VTM, make atlas usage optional", "diff": "diff --git a/main/src/main/java/cgeo/geocaching/settings/Settings.java b/main/src/main/java/cgeo/geocaching/settings/Settings.java\nindex a77d66910d7..09a0fcfb491 100644\n--- a/main/src/main/java/cgeo/geocaching/settings/Settings.java\n+++ b/main/src/main/java/cgeo/geocaching/settings/Settings.java\n@@ -707,6 +707,10 @@ public static boolean enableVtmSingleMarkerSymbol() {\n         return getBoolean(R.string.pref_vtm_single_marker_symbol, false);\n     }\n \n+    public static boolean enableVtmMarkerAtlasUsage() {\n+        return getBoolean(R.string.pref_vtm_marker_atlas_usage, false);\n+    }\n+\n     public static boolean enableFeatureUnifiedGeoItemLayer() {\n         return getBoolean(R.string.pref_feature_unified_geoitem_layer, false);\n     }\ndiff --git a/main/src/main/java/cgeo/geocaching/unifiedmap/geoitemlayer/MapsforgeVtmGeoItemLayer.java b/main/src/main/java/cgeo/geocaching/unifiedmap/geoitemlayer/MapsforgeVtmGeoItemLayer.java\nindex 8cad9c84a1f..00db5eec7da 100644\n--- a/main/src/main/java/cgeo/geocaching/unifiedmap/geoitemlayer/MapsforgeVtmGeoItemLayer.java\n+++ b/main/src/main/java/cgeo/geocaching/unifiedmap/geoitemlayer/MapsforgeVtmGeoItemLayer.java\n@@ -318,16 +318,22 @@ private MarkerSymbol getMarkerSymbol(final android.graphics.Bitmap bitmap, final\n                 }\n \n                 //Create a new Marker Symbol\n-                //For efficiency we use an image atlas (which is provided by VTM library)\n-                //General info about image atlas can be found e.g. here: https://en.wikipedia.org/wiki/Texture_atlas\n-\n-                //1. Place the bitmap on an atlas of our bitmap packer. Use an arbitrarily id to reference it afterwards\n-                final int id = markerCounter.addAndGet(1);\n-                markerPacker.add(id, new AndroidBitmap(bitmap));\n-                //2. Get the TextureRegion for the just added bitmap. Naturally it has to be in the last atlas of the bitmappacker\n-                final TextureRegion region = markerPacker.getAtlasItem(markerPacker.getAtlasCount() - 1).getAtlas().getTextureRegion(id);\n-                //3. Use the TextureRegion to create the symbol\n-                symbol = new MarkerSymbol(region, xAnchor, yAnchor, !isFlat);\n+                if (Settings.enableVtmMarkerAtlasUsage()) {\n+                    //For efficiency we use an image atlas (which is provided by VTM library)\n+                    //General info about image atlas can be found e.g. here: https://en.wikipedia.org/wiki/Texture_atlas\n+\n+                    //1. Place the bitmap on an atlas of our bitmap packer. Use an arbitrarily id to reference it afterwards\n+                    final int id = markerCounter.addAndGet(1);\n+                    markerPacker.add(id, new AndroidBitmap(bitmap));\n+                    //2. Get the TextureRegion for the just added bitmap. Naturally it has to be in the last atlas of the bitmappacker\n+                    final TextureRegion region = markerPacker.getAtlasItem(markerPacker.getAtlasCount() - 1).getAtlas().getTextureRegion(id);\n+                    //3. Use the TextureRegion to create the symbol\n+                    symbol = new MarkerSymbol(region, xAnchor, yAnchor, !isFlat);\n+                } else {\n+                    //create marker symbol w/o usage of atlas\n+                    symbol = new MarkerSymbol(new AndroidBitmap(bitmap), xAnchor, yAnchor, !isFlat);\n+                }\n+                //cache the marker symbol and return it\n                 markerSymbolCache.put(key, symbol);\n                 return symbol;\n             }\ndiff --git a/main/src/main/res/values/preference_keys.xml b/main/src/main/res/values/preference_keys.xml\nindex 01c936255a6..e65fd0cc20e 100644\n--- a/main/src/main/res/values/preference_keys.xml\n+++ b/main/src/main/res/values/preference_keys.xml\n@@ -521,6 +521,7 @@\n     <string translatable=\"false\" name=\"pref_webDeviceCode\">webDeviceCode</string>\n     <string translatable=\"false\" name=\"pref_feature_unified_geoitem_layer\">feature_unified_geoitem_layer</string>\n     <string translatable=\"false\" name=\"pref_vtm_single_marker_symbol\">vtmSingleMarkerSymbol</string>\n+    <string translatable=\"false\" name=\"pref_vtm_marker_atlas_usage\">vtmMarkerAtlasUsage</string>\n \n \n \n", "changes": [{"file": "main/src/main/java/cgeo/geocaching/settings/Settings.java", "module": "cgeo.geocaching.settings.Settings", "range": [{"start": 710, "end": 710}]}, {"file": "main/src/main/java/cgeo/geocaching/unifiedmap/geoitemlayer/MapsforgeVtmGeoItemLayer.java", "module": "cgeo.geocaching.unifiedmap.geoitemlayer.MapsforgeVtmGeoItemLayer", "range": [{"start": 321, "end": 331}]}]}, {"number": 15742, "url": "https://github.com/cgeo/cgeo/pull/15742", "diff_url": "https://github.com/cgeo/cgeo/pull/15742.diff", "patch_url": "https://github.com/cgeo/cgeo/pull/15742.patch", "title": "rel to #15726: vtm markersymbol: catch exception and add logging", "content": "rel to #15726: vtm markersymbol: catch exception and add logging", "diff": "diff --git a/main/src/main/java/cgeo/geocaching/unifiedmap/geoitemlayer/MapsforgeVtmGeoItemLayer.java b/main/src/main/java/cgeo/geocaching/unifiedmap/geoitemlayer/MapsforgeVtmGeoItemLayer.java\nindex 4d4e088374a..8cad9c84a1f 100644\n--- a/main/src/main/java/cgeo/geocaching/unifiedmap/geoitemlayer/MapsforgeVtmGeoItemLayer.java\n+++ b/main/src/main/java/cgeo/geocaching/unifiedmap/geoitemlayer/MapsforgeVtmGeoItemLayer.java\n@@ -10,7 +10,9 @@\n import cgeo.geocaching.models.geoitem.ToScreenProjector;\n import cgeo.geocaching.settings.Settings;\n import cgeo.geocaching.ui.ViewUtils;\n+import cgeo.geocaching.utils.ContextLogger;\n import cgeo.geocaching.utils.GroupedList;\n+import cgeo.geocaching.utils.Log;\n \n import android.graphics.BitmapFactory;\n import android.util.Pair;\n@@ -305,27 +307,37 @@ private MarkerSymbol getMarkerSymbol(final android.graphics.Bitmap bitmap, final\n             return defaultMarkerSymbol;\n         }\n \n-        final MarkerSymbolCacheKey key = new MarkerSymbolCacheKey(bitmap, xAnchor, yAnchor, isFlat);\n-        synchronized (markerSymbolCache) {\n-            MarkerSymbol symbol = markerSymbolCache.get(key);\n-            if (symbol != null) {\n+        final ContextLogger ctx = new ContextLogger(Log.LogLevel.DEBUG, \"VTM:getMarkerSymbol\");\n+        try {\n+\n+            final MarkerSymbolCacheKey key = new MarkerSymbolCacheKey(bitmap, xAnchor, yAnchor, isFlat);\n+            synchronized (markerSymbolCache) {\n+                MarkerSymbol symbol = markerSymbolCache.get(key);\n+                if (symbol != null) {\n+                    return symbol;\n+                }\n+\n+                //Create a new Marker Symbol\n+                //For efficiency we use an image atlas (which is provided by VTM library)\n+                //General info about image atlas can be found e.g. here: https://en.wikipedia.org/wiki/Texture_atlas\n+\n+                //1. Place the bitmap on an atlas of our bitmap packer. Use an arbitrarily id to reference it afterwards\n+                final int id = markerCounter.addAndGet(1);\n+                markerPacker.add(id, new AndroidBitmap(bitmap));\n+                //2. Get the TextureRegion for the just added bitmap. Naturally it has to be in the last atlas of the bitmappacker\n+                final TextureRegion region = markerPacker.getAtlasItem(markerPacker.getAtlasCount() - 1).getAtlas().getTextureRegion(id);\n+                //3. Use the TextureRegion to create the symbol\n+                symbol = new MarkerSymbol(region, xAnchor, yAnchor, !isFlat);\n+                markerSymbolCache.put(key, symbol);\n                 return symbol;\n             }\n-\n-            //Create a new Marker Symbol\n-            //For efficiency we use an image atlas (which is provided by VTM library)\n-            //General info about image atlas can be found e.g. here: https://en.wikipedia.org/wiki/Texture_atlas\n-\n-            //1. Place the bitmap on an atlas of our bitmap packer. Use an arbitrarily id to reference it afterwards\n-            final int id = markerCounter.addAndGet(1);\n-            markerPacker.add(id, new AndroidBitmap(bitmap));\n-            //2. Get the TextureRegion for the just added bitmap. Naturally it has to be in the last atlas of the bitmappacker\n-            final TextureRegion region = markerPacker.getAtlasItem(markerPacker.getAtlasCount() - 1).getAtlas().getTextureRegion(id);\n-            //3. Use the TextureRegion to create the symbol\n-            symbol = new MarkerSymbol(region, xAnchor, yAnchor, !isFlat);\n-            markerSymbolCache.put(key, symbol);\n-            return symbol;\n+        } catch (RuntimeException re) {\n+            ctx.setException(re, true);\n+            return defaultMarkerSymbol;\n+        } finally {\n+            ctx.close();\n         }\n+\n     }\n \n \ndiff --git a/main/src/main/java/cgeo/geocaching/utils/ContextLogger.java b/main/src/main/java/cgeo/geocaching/utils/ContextLogger.java\nindex f545c96cb1c..943e8eabbd4 100644\n--- a/main/src/main/java/cgeo/geocaching/utils/ContextLogger.java\n+++ b/main/src/main/java/cgeo/geocaching/utils/ContextLogger.java\n@@ -14,7 +14,7 @@\n /**\n  * Helper class to construct log messages. Optimized to log what is happening in a method,\n  * but can be used in other situations as well.\n- *\n+ * <br>\n  * All logging is done on level given in constructor, default is VERBOSE level.\n  */\n public class ContextLogger implements Closeable {\n@@ -32,7 +32,7 @@ public class ContextLogger implements Closeable {\n     private final String contextString;\n \n     private final boolean doLog;\n-    private final boolean forceLog;\n+    private boolean forceLog;\n     private final Log.LogLevel logLevel;\n     private boolean hasLogged = false;\n \n@@ -53,16 +53,14 @@ private ContextLogger(final Log.LogLevel logLevel, final boolean forceInfo, fina\n         this.startTime = System.currentTimeMillis();\n         this.logLevel = logLevel;\n         this.forceLog = forceInfo;\n+        this.contextString = \"[CtxLog]\" + String.format(context, params) + \":\";\n         this.doLog = Log.isEnabled(logLevel) || forceLog;\n         if (this.doLog) {\n-            this.contextString = \"[CtxLog]\" + String.format(context, params) + \":\";\n             if (this.forceLog) {\n                 Log.iForce(contextString + \"START\");\n             } else {\n                 Log.log(logLevel, contextString + \"START\");\n             }\n-        } else {\n-            this.contextString = null;\n         }\n     }\n \n@@ -95,17 +93,21 @@ public ContextLogger add(final String msg, final Object... params) {\n     }\n \n     public ContextLogger setException(final Throwable t) {\n+        return setException(t, false);\n+    }\n+\n+    public ContextLogger setException(final Throwable t, final boolean forceEndLog) {\n+        this.forceLog = this.forceLog || forceEndLog;\n         this.exception = t;\n         return this;\n     }\n \n     public ContextLogger addReturnValue(final Object returnValue) {\n-        add(\"RET:\" + returnValue);\n-        return this;\n+        return add(\"RET:\" + returnValue);\n     }\n \n     public void endLog() {\n-        if (doLog) {\n+        if (doLog || forceLog) {\n             hasLogged = true;\n             final String logMsg = this.contextString + \"END (\" + (System.currentTimeMillis() - startTime) + \"ms)\" + message +\n                     (this.exception == null ? \"\" : \"EXC:\" + exception.getClass().getName() + \"[\" + exception.getMessage() + \"]\");\n", "changes": [{"file": "main/src/main/java/cgeo/geocaching/unifiedmap/geoitemlayer/MapsforgeVtmGeoItemLayer.java", "module": "cgeo.geocaching.unifiedmap.geoitemlayer.MapsforgeVtmGeoItemLayer", "range": [{"start": 13, "end": 13}, {"start": 14, "end": 14}, {"start": 308, "end": 312}, {"start": 314, "end": 328}, {"start": 329, "end": 329}]}, {"file": "main/src/main/java/cgeo/geocaching/utils/ContextLogger.java", "module": "cgeo.geocaching.utils.ContextLogger", "range": [{"start": 17, "end": 18}, {"start": 35, "end": 36}, {"start": 56, "end": 56}, {"start": 58, "end": 58}, {"start": 64, "end": 65}, {"start": 98, "end": 98}, {"start": 103, "end": 105}, {"start": 108, "end": 109}]}]}]}
{"url": "https://github.com/cgeo/cgeo/issues/13682", "repo": {"url": "https://github.com/cgeo/cgeo", "name": "cgeo", "owner": "cgeo", "modules": ["app.organicmaps.api", "cgeo.geocaching", "cgeo.geocaching.about", "cgeo.geocaching.activity", "cgeo.geocaching.address", "cgeo.geocaching.apps", "cgeo.geocaching.backup", "cgeo.geocaching.brouter", "cgeo.geocaching.calendar", "cgeo.geocaching.command", "cgeo.geocaching.connector", "cgeo.geocaching.contacts", "cgeo.geocaching.downloader", "cgeo.geocaching.enumerations", "cgeo.geocaching.export", "cgeo.geocaching.files", "cgeo.geocaching.filters", "cgeo.geocaching.helper", "cgeo.geocaching.list", "cgeo.geocaching.loaders", "cgeo.geocaching.location", "cgeo.geocaching.log", "cgeo.geocaching.maps", "cgeo.geocaching.models", "cgeo.geocaching.network", "cgeo.geocaching.permission", "cgeo.geocaching.playservices", "cgeo.geocaching.search", "cgeo.geocaching.sensors", "cgeo.geocaching.service", "cgeo.geocaching.settings", "cgeo.geocaching.sorting", "cgeo.geocaching.speech", "cgeo.geocaching.storage", "cgeo.geocaching.test", "cgeo.geocaching.ui", "cgeo.geocaching.unifiedmap", "cgeo.geocaching.utils", "cgeo.geocaching.wherigo", "cgeo.test", "cgeo.watchdog"]}, "issue": {"number": 13682, "url": "https://github.com/cgeo/cgeo/issues/13682", "state": "closed", "title": "[Nightly] Crash on adding photo via camera to a cache", "body": "### Describe your problem!\n\nCrash, when I want to add a photo to a cache via camera in image-gallery \n\n### How to reproduce?\n\nOpen a cache\r\nGo to images\r\nAdd photo via camera-symbol\n\n### Actual result after these steps?\n\nThe cgeo crash and no photo is saved \n\n### Expected result after these steps?\n\nPhoto is added to own images\n\n### Reproducible\n\nYes\n\n### c:geo Version\n\n2022.11.16-NB-c66e387\n\n### System information\n\n```text\n## System information\r\n\r\nc:geo version: 2022.11.16-NB-c66e387\r\n\r\nDevice:\r\n-------\r\n- Device type: SM-G980F (x1sxx, samsung)\r\n- Available processors: 8\r\n- Android version: 11\r\n- Android build: RP1A.200720.012.G980FXXSCDUJ5\r\n- Screen resolution: 1080x2178px (360x726dp)\r\n- Pixel density: 3.3000002\r\n- System font scale: 1.1 / used scale: 1.1\r\n- Sailfish OS detected: false\r\n- Google Play services: enabled - 22.44.17 (150408-488410709)\r\n\r\nSensor and location:\r\n-------\r\n- Low power mode: active\r\n- Compass capabilities: yes\r\n- Rotation vector sensor: present\r\n- Orientation sensor: present\r\n- Magnetometer & Accelerometer sensor: present\r\n- Direction sensor used: rotation vector\r\n\r\nProgram settings:\r\n-------\r\n- Settings: v9, Count:180\r\n- Set language: de\r\n- System date format: dd.MM.yy\r\n- Time zone: GMT+01:00\r\n- Debug mode active: no\r\n- Last backup: 26. Apr., 22:11\r\n- Routing mode: Walk\r\n- Live map mode: true\r\n- OSM multi-threading: false / threads: 1\r\n- Map: Germany (Offline)\r\n  - Id: cgeo.geocaching.maps.mapsforge.MapsforgeMapProvider$OfflineMapSource:3438-3261:CGeo/maps/germany.map\r\n  - Atts: Map data (c) OpenStreetMap contributors\r\n  - Theme: Elevate.zip:Elevate.xml\r\n\r\nFilters:\r\n-------\r\n- Hide waypoints: original visited\r\n- LIVE: _Tour* ([_Tour:inconclusive=false:advanced=true]AND(status:exclude_disabled:exclude_archived))\r\n- OFFLINE: Keine ([:inconclusive=false:advanced=false]AND(type;difficulty_terrain:d=-:d=-:t=-:t=-;status))\r\n\r\nStored Filters (#15):\r\n- _Standard: [_Standard:inconclusive=false:advanced=false]AND(status:found_no:exclude_archived))\r\n- _Test: [_Test:inconclusive=false:advanced=true]AND(difficulty_terrain:d=1.5:d=4.0:t=-:t=3.0))\r\n- _toSolve: [_toSolve:inconclusive=false:advanced=true]AND(type:MYSTERY;status:solved_mystery_no))\r\n- _Tour: [_Tour:inconclusive=false:advanced=false]AND(status:found_no:has_offline_found_log_no:solved_mystery_yes:exclude_disabled:exclude_archived))\r\n- _unsaved: [_unsaved:inconclusive=false:advanced=false]AND(status:found_no:exclude_archived;stored_since:-10:-10))\r\n- Events: [Events:inconclusive=false:advanced=false]AND(hidden:2021-09-21:-:false:-1:-1;type:EVENT))\r\n- hasTrackable: [hasTrackable:inconclusive=false:advanced=true]AND(status:has_trackable_yes))\r\n- LabStation: [LabStation:inconclusive=false:advanced=false]AND(note::is_present;type:USER_DEFINED:ADVLAB;status))\r\n- Offlinelog: [Offlinelog:inconclusive=false:advanced=true]AND(status:has_offline_found_log_yes))\r\n- Steffen: [Steffen:inconclusive=false:advanced=true]AND(status:found_no:has_offline_found_log_no;stored_list:122:31))\r\n- toLog_Bianca: [toLog_Bianca:inconclusive=false:advanced=false]AND(stored_list:86;status:found_yes;log_entry:biansch :contains:inverse=true:logtext=:logtext=contains))\r\n- toLog_Carolin: [toLog_Carolin:inconclusive=false:advanced=false]AND(stored_list:86;status:found_yes;log_entry:carosch:contains:inverse=true:logtext=:logtext=contains))\r\n- Umlaute: [Umlaute:inconclusive=false:advanced=true]OR(note:+29:contains;note:+28:contains;note:+27:contains))\r\n- winter: [winter:inconclusive=false:advanced=true]AND(attributes:winter_no:inverse=true:attributesources=3))\r\n- WithNotes: [WithNotes:inconclusive=false:advanced=true]AND(note::is_present))\r\n\r\nServices:\r\n-------\r\n- Geocaching sites enabled:\r\n   geocaching.com: Logged in (Anmeldung OK) / PREMIUM\r\n   Geocaching.com Adventure Lab\r\n   opencaching.de: Logged in (Anmeldung OK)\r\n- Geocaching.com date format: dd MMM yy\r\n- Geocaching.com website language: en-US\r\n- Last login error on geocaching.com: communication error (2022-11-15 15-58)\r\n- Last successful login on geocaching.com: 2022-11-18 13-15\r\n- Routing: internal / BRouter installed: false\r\n- Installed c:geo plugins:  none\r\n\r\nPermissions & paths:\r\n-------\r\n- Fine location permission: granted\r\n- Write external storage permission: granted\r\n- System internal c:geo dir: /data/user/0/cgeo.geocaching (68,0 GB free) v3 internal isDir(8 entries)\r\n- Legacy User storage c:geo dir: /data/user/0/cgeo.geocaching (68,0 GB free) v3 internal isDir(8 entries)\r\n- Geocache data: /storage/emulated/0/Android/data/cgeo.geocaching/files/GeocacheData (68,0 GB free) v3 external non-removable isDir(1748 entries)\r\n- Internal theme sync (is turned off): /data/user/0/cgeo.geocaching/MapThemeData (68,0 GB free) v3 internal isDir(0 entries)\r\n- Public Folders: #12\r\n  - BASE: SD-Karte/CGeo (User-Defined)[SD-Karte/CGeo[DOCUMENT#0:p-content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo::]] (Uri: content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo/document/3438-3261%3ACGeo, Av:true, files:>=21, dirs:>=9, totalFileSize:>=6,7 GB, free space: 100,1 GB, files on device: 0)\r\n  - OFFLINE_MAPS: SD-Karte/CGeo/maps (Default)[SD-Karte/CGeo/maps[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo::/maps]] (Uri: content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo/document/3438-3261%3ACGeo%2Fmaps, Av:true, files:10, dirs:2, totalFileSize:6,7 GB, free space: 100,1 GB, files on device: 0)\r\n  - OFFLINE_MAP_THEMES: SD-Karte/CGeo/maps/_themes (Default)[SD-Karte/CGeo/maps/_themes[PERSISTABLE_FOLDER(OFFLINE_MAPS)#1:p-content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo::/maps/_themes]] (Uri: content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo/document/3438-3261%3ACGeo%2Fmaps%2F_themes, Av:true, files:2, dirs:0, totalFileSize:468,1 KB, free space: 100,1 GB, files on device: 0)\r\n  - OFFLINE_MAP_SHADING: SD-Karte/CGeo/maps/_hgt (Default)[SD-Karte/CGeo/maps/_hgt[PERSISTABLE_FOLDER(OFFLINE_MAPS)#1:p-content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo::/maps/_hgt]] (Uri: content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo/document/3438-3261%3ACGeo%2Fmaps%2F_hgt, Av:true, files:0, dirs:0, totalFileSize:0 B, free space: 100,1 GB, files on device: 0)\r\n  - LOGFILES: SD-Karte/CGeo/logfiles (Default)[SD-Karte/CGeo/logfiles[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo::/logfiles]] (Uri: content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo/document/3438-3261%3ACGeo%2Flogfiles, Av:true, files:1, dirs:0, totalFileSize:72,7 KB, free space: 100,1 GB, files on device: 0)\r\n  - GPX: SD-Karte/CGeo/gpx (Default)[SD-Karte/CGeo/gpx[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo::/gpx]] (Uri: content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo/document/3438-3261%3ACGeo%2Fgpx, Av:true, files:10, dirs:0, totalFileSize:76,4 MB, free space: 100,1 GB, files on device: 0)\r\n  - BACKUP: SD-Karte/CGeo/backup (Default)[SD-Karte/CGeo/backup[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo::/backup]] (Uri: content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo/document/3438-3261%3ACGeo%2Fbackup, Av:true, files:>=10, dirs:>=10, totalFileSize:>=253,8 MB, free space: 100,1 GB, files on device: 0)\r\n  - FIELD_NOTES: SD-Karte/CGeo/field-notes (Default)[SD-Karte/CGeo/field-notes[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo::/field-notes]] (Uri: content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo/document/3438-3261%3ACGeo%2Ffield-notes, Av:true, files:4, dirs:0, totalFileSize:8,4 KB, free space: 100,1 GB, files on device: 0)\r\n  - SPOILER_IMAGES: SD-Karte/CGeo/GeocachePhotos (Default)[SD-Karte/CGeo/GeocachePhotos[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo::/GeocachePhotos]] (Uri: content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo/document/3438-3261%3ACGeo%2FGeocachePhotos, Av:true, files:>=2, dirs:>=37, totalFileSize:>=5,2 MB, free space: 100,1 GB, files on device: 0)\r\n  - ROUTING_BASE: SD-Karte/CGeo/routing (Default)[SD-Karte/CGeo/routing[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo::/routing]] (Uri: content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo/document/3438-3261%3ACGeo%2Frouting, Av:true, files:9, dirs:1, totalFileSize:340,3 MB, free space: 100,1 GB, files on device: 0)\r\n  - ROUTING_TILES: SD-Karte/CGeo/routing/segments4 (Default)[SD-Karte/CGeo/routing/segments4[PERSISTABLE_FOLDER(ROUTING_BASE)#1:p-content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo::/routing/segments4]] (Uri: content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo/document/3438-3261%3ACGeo%2Frouting%2Fsegments4, Av:true, files:2, dirs:0, totalFileSize:340,2 MB, free space: 100,1 GB, files on device: 0)\r\n  - TEST_FOLDER: [Legacy]/data/user/0/cgeo.geocaching/files/unittest (Default)[/data/user/0/cgeo.geocaching/files/unittest[FILE#1:p-file:///data/user/0/cgeo.geocaching/files::/unittest]] (Uri: file:///data/user/0/cgeo.geocaching/files/unittest, Av:true, files:0, dirs:0, totalFileSize:0 B, free space: 68,0 GB, files on device: -1)\r\n- Map render theme path: Elevate.zip:Elevate.xml\r\n- PersistedDocumentUris: #1\r\n- UNUSED_TRACK: null\r\n- Persisted Uri Permissions: #1\r\n  - content://com.android.externalstorage.documents/tree/3438-3261%3ACGeo (1. Apr., 19:00):RW\r\n- Database: /data/user/0/cgeo.geocaching/databases/data (v99, Size:99,2 MB) on system internal storage\r\n\r\n--- End of system information ---\n```\n\n\n### Additional Information\n\n[logcat-2022-11-18-13-15-21-2.txt](https://github.com/cgeo/cgeo/files/10041188/logcat-2022-11-18-13-15-21-2.txt)\r\n", "logs": [{"name": "logcat-2022-11-18-13-15-21-2.txt", "url": "https://github.com/cgeo/cgeo/files/10041188/logcat-2022-11-18-13-15-21-2.txt"}]}, "pull_request": [{"number": 13692, "url": "https://github.com/cgeo/cgeo/pull/13692", "diff_url": "https://github.com/cgeo/cgeo/pull/13692.diff", "patch_url": "https://github.com/cgeo/cgeo/pull/13692.patch", "title": "fix #13682: prevent npe on imagegallery camery select when intent is null", "content": "fix #13682: prevent npe on imagegallery camery select when intent is null", "diff": "diff --git a/main/src/cgeo/geocaching/ui/ImageGalleryView.java b/main/src/cgeo/geocaching/ui/ImageGalleryView.java\nindex 95dfd97bb71..3bd2317a0bf 100644\n--- a/main/src/cgeo/geocaching/ui/ImageGalleryView.java\n+++ b/main/src/cgeo/geocaching/ui/ImageGalleryView.java\n@@ -505,7 +505,7 @@ protected void onDetachedFromWindow() {\n     /** Important: include this in your activity's \"onActivityReenter\" method.\n      * Needed e.g. for correct back transition when returning from detail view (e.g. scrolling to image gallery position) */\n     public static int onActivityReenter(final Activity activity, final ImageGalleryView imageGallery, final Intent data) {\n-        final int pos = data.getExtras() == null ? -1 : data.getExtras().getInt(ImageViewActivity.EXTRA_IMAGEVIEW_POS, -1);\n+        final int pos = data == null || data.getExtras() == null ? -1 : data.getExtras().getInt(ImageViewActivity.EXTRA_IMAGEVIEW_POS, -1);\n         if (pos >= 0) {\n             activity.postponeEnterTransition();\n             if (imageGallery != null) {\n", "changes": [{"file": "main/src/cgeo/geocaching/ui/ImageGalleryView.java", "module": "cgeo.geocaching.ui.ImageGalleryView", "range": [{"start": 508, "end": 509}]}]}]}
{"url": "https://github.com/cgeo/cgeo/issues/13551", "repo": {"url": "https://github.com/cgeo/cgeo", "name": "cgeo", "owner": "cgeo", "modules": ["app.organicmaps.api", "cgeo.geocaching", "cgeo.geocaching.about", "cgeo.geocaching.activity", "cgeo.geocaching.address", "cgeo.geocaching.apps", "cgeo.geocaching.backup", "cgeo.geocaching.brouter", "cgeo.geocaching.calendar", "cgeo.geocaching.command", "cgeo.geocaching.connector", "cgeo.geocaching.contacts", "cgeo.geocaching.downloader", "cgeo.geocaching.enumerations", "cgeo.geocaching.export", "cgeo.geocaching.files", "cgeo.geocaching.filters", "cgeo.geocaching.helper", "cgeo.geocaching.list", "cgeo.geocaching.loaders", "cgeo.geocaching.location", "cgeo.geocaching.log", "cgeo.geocaching.maps", "cgeo.geocaching.models", "cgeo.geocaching.network", "cgeo.geocaching.permission", "cgeo.geocaching.playservices", "cgeo.geocaching.search", "cgeo.geocaching.sensors", "cgeo.geocaching.service", "cgeo.geocaching.settings", "cgeo.geocaching.sorting", "cgeo.geocaching.speech", "cgeo.geocaching.storage", "cgeo.geocaching.test", "cgeo.geocaching.ui", "cgeo.geocaching.unifiedmap", "cgeo.geocaching.utils", "cgeo.geocaching.wherigo", "cgeo.test", "cgeo.watchdog"]}, "issue": {"number": 13551, "url": "https://github.com/cgeo/cgeo/issues/13551", "state": "closed", "title": "Empty trackable page if GC-website is in english", "body": "### Describe your problem!\r\n\r\nWhen loading the trackable page (e.g. TB9XHDG) an empty page is shown - only the name in the header is shown.\r\n\r\n\r\n### How to reproduce?\r\n\r\nSwitch language at geocaching.com to english\r\n\r\nOpen the trackable page for a trackable in c:geo\r\n\r\n\r\n### Actual result after these steps?\r\n\r\nGC-Language is english:\r\n![grafik](https://user-images.githubusercontent.com/70113341/197299121-a0279d47-5105-4e78-bae4-e47f8cb22d66.png)\r\n\r\nGC-Language is german:\r\n![grafik](https://user-images.githubusercontent.com/70113341/197299538-f490bea5-778e-4495-bef6-76b011f4185a.png)\r\n\r\n### Expected result after these steps?\r\n\r\n_No response_\r\n\r\n### Reproducible\r\n\r\nYes\r\n\r\n### c:geo Version\r\n\r\n2022.10.22-nightly\r\n\r\n### System information\r\n\r\nc:geo version: 2022.10.22-b8e4962 developer build\r\n\r\nDevice:\r\n-------\r\n- Device type: sdk_gphone_x86 (sdk_gphone_x86, google)\r\n- Available processors: 2\r\n- Android version: 11\r\n- Android build: RSR1.201013.001\r\n- Screen resolution: 1080x2088px (392x735dp)\r\n- Pixel density: 2.75\r\n- System font scale: 1.0 / used scale: 1.0\r\n- Sailfish OS detected: false\r\n- Google Play services: enabled - 22.41.13 (150700-480714934)\r\n\r\nSensor and location:\r\n-------\r\n- Low power mode: inactive\r\n- Compass capabilities: yes\r\n- Rotation vector sensor: present\r\n- Orientation sensor: present\r\n- Magnetometer & Accelerometer sensor: present\r\n- Direction sensor used: rotation vector\r\n\r\nProgram settings:\r\n-------\r\n- Settings: v9, Count:94\r\n- Set language: en\r\n- System date format: M/d/yy\r\n- Time zone: GMT\r\n- Debug mode active: no\r\n- Last backup: Oct 17, 9:44 PM\r\n- Routing mode: Walk\r\n- Live map mode: true\r\n- OSM multi-threading: false / threads: 1\r\n- Map: Germany (Offline)\r\n  - Id: cgeo.geocaching.maps.mapsforge.MapsforgeMapProvider$OfflineMapSource:primary:Cgeo/maps/germany.map\r\n  - Atts: Map data (c) OpenStreetMap contributors\r\n  - Theme: none\r\n\r\nFilters:\r\n-------\r\n- Hide waypoints: -\r\n- LIVE: None ([:inconclusive=false:advanced=false])\r\n- OFFLINE: None ([:inconclusive=false:advanced=true])\r\n\r\nStored Filters (#0):\r\n\r\nServices:\r\n-------\r\n- Geocaching sites enabled:\r\n   geocaching.com: Logged in (Login OK) / BASIC\r\n- Geocaching.com date format: dd.MM.yyyy\r\n- Geocaching.com website language: de-DE\r\n- Last login error on geocaching.com: Failed to log in to geocaching.com as c:geo because of wrong username/password (2022-10-21 10-53)\r\n- Last successful login on geocaching.com: 2022-10-21 22-34\r\n- Routing: internal / BRouter installed: false\r\n- Installed c:geo plugins:  none\r\n\r\nPermissions & paths:\r\n-------\r\n- Fine location permission: granted\r\n- Write external storage permission: granted\r\n- System internal c:geo dir: /data/user/0/cgeo.geocaching (1.7 GB free) v3 internal isDir(8 entries)\r\n- Legacy User storage c:geo dir: /data/user/0/cgeo.geocaching (1.7 GB free) v3 internal isDir(8 entries)\r\n- Geocache data: /storage/emulated/0/Android/data/cgeo.geocaching/files/GeocacheData (1.7 GB free) v3 external non-removable isDir(5 entries)\r\n- Internal theme sync (is turned off): /data/user/0/cgeo.geocaching/MapThemeData (1.7 GB free) v3 internal isDir(0 entries)\r\n- Public Folders: #12\r\n  - BASE: /Cgeo (User-Defined)[/Cgeo[DOCUMENT#0:p-content://com.android.externalstorage.documents/tree/primary%3ACgeo::]] (Uri: content://com.android.externalstorage.documents/tree/primary%3ACgeo/document/primary%3ACgeo, Av:true, files:>=4, dirs:>=9, totalFileSize:>=2.5 GB, free space: 1.7 GB, files on device: 393216)\r\n  - OFFLINE_MAPS: /Cgeo/maps (Default)[/Cgeo/maps[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/primary%3ACgeo::/maps]] (Uri: content://com.android.externalstorage.documents/tree/primary%3ACgeo/document/primary%3ACgeo%2Fmaps, Av:true, files:2, dirs:2, totalFileSize:2.5 GB, free space: 1.7 GB, files on device: 393216)\r\n  - OFFLINE_MAP_THEMES: /Cgeo/maps/_themes (Default)[/Cgeo/maps/_themes[PERSISTABLE_FOLDER(OFFLINE_MAPS)#1:p-content://com.android.externalstorage.documents/tree/primary%3ACgeo::/maps/_themes]] (Uri: content://com.android.externalstorage.documents/tree/primary%3ACgeo/document/primary%3ACgeo%2Fmaps%2F_themes, Av:true, files:0, dirs:0, totalFileSize:0 B, free space: 1.7 GB, files on device: 393216)\r\n  - OFFLINE_MAP_SHADING: /Cgeo/maps/_hgt (Default)[/Cgeo/maps/_hgt[PERSISTABLE_FOLDER(OFFLINE_MAPS)#1:p-content://com.android.externalstorage.documents/tree/primary%3ACgeo::/maps/_hgt]] (Uri: content://com.android.externalstorage.documents/tree/primary%3ACgeo/document/primary%3ACgeo%2Fmaps%2F_hgt, Av:true, files:0, dirs:0, totalFileSize:0 B, free space: 1.7 GB, files on device: 393216)\r\n  - LOGFILES: /Cgeo/logfiles (Default)[/Cgeo/logfiles[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/primary%3ACgeo::/logfiles]] (Uri: content://com.android.externalstorage.documents/tree/primary%3ACgeo/document/primary%3ACgeo%2Flogfiles, Av:true, files:1, dirs:0, totalFileSize:522.1 KB, free space: 1.7 GB, files on device: 393216)\r\n  - GPX: /Cgeo/gpx (Default)[/Cgeo/gpx[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/primary%3ACgeo::/gpx]] (Uri: content://com.android.externalstorage.documents/tree/primary%3ACgeo/document/primary%3ACgeo%2Fgpx, Av:true, files:1, dirs:0, totalFileSize:40.4 KB, free space: 1.7 GB, files on device: 393216)\r\n  - BACKUP: /Cgeo/backup (Default)[/Cgeo/backup[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/primary%3ACgeo::/backup]] (Uri: content://com.android.externalstorage.documents/tree/primary%3ACgeo/document/primary%3ACgeo%2Fbackup, Av:true, files:6, dirs:4, totalFileSize:766.9 KB, free space: 1.7 GB, files on device: 393216)\r\n  - FIELD_NOTES: /Cgeo/field-notes (Default)[/Cgeo/field-notes[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/primary%3ACgeo::/field-notes]] (Uri: content://com.android.externalstorage.documents/tree/primary%3ACgeo/document/primary%3ACgeo%2Ffield-notes, Av:true, files:0, dirs:0, totalFileSize:0 B, free space: 1.7 GB, files on device: 393216)\r\n  - SPOILER_IMAGES: /Cgeo/GeocachePhotos (Default)[/Cgeo/GeocachePhotos[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/primary%3ACgeo::/GeocachePhotos]] (Uri: content://com.android.externalstorage.documents/tree/primary%3ACgeo/document/primary%3ACgeo%2FGeocachePhotos, Av:true, files:0, dirs:0, totalFileSize:0 B, free space: 1.7 GB, files on device: 393216)\r\n  - ROUTING_BASE: /Cgeo/routing (Default)[/Cgeo/routing[PERSISTABLE_FOLDER(BASE)#1:p-content://com.android.externalstorage.documents/tree/primary%3ACgeo::/routing]] (Uri: content://com.android.externalstorage.documents/tree/primary%3ACgeo/document/primary%3ACgeo%2Frouting, Av:true, files:7, dirs:1, totalFileSize:84.0 KB, free space: 1.7 GB, files on device: 393216)\r\n  - ROUTING_TILES: /Cgeo/routing/segments4 (Default)[/Cgeo/routing/segments4[PERSISTABLE_FOLDER(ROUTING_BASE)#1:p-content://com.android.externalstorage.documents/tree/primary%3ACgeo::/routing/segments4]] (Uri: content://com.android.externalstorage.documents/tree/primary%3ACgeo/document/primary%3ACgeo%2Frouting%2Fsegments4, Av:true, files:0, dirs:0, totalFileSize:0 B, free space: 1.7 GB, files on device: 393216)\r\n  - TEST_FOLDER: [Legacy]/data/user/0/cgeo.geocaching/files/unittest (Default)[/data/user/0/cgeo.geocaching/files/unittest[FILE#1:p-file:///data/user/0/cgeo.geocaching/files::/unittest]] (Uri: file:///data/user/0/cgeo.geocaching/files/unittest, Av:true, files:>=5, dirs:>=29, totalFileSize:>=0 B, free space: 1.7 GB, files on device: -1)\r\n- Map render theme path: \r\n- PersistedDocumentUris: #1\r\n- UNUSED_TRACK: null\r\n- Persisted Uri Permissions: #1\r\n  - content://com.android.externalstorage.documents/tree/primary%3ACgeo (Jul 1, 1:21 PM):RW\r\n- Database: /data/user/0/cgeo.geocaching/databases/data (v99, Size:700.0 KB) on system internal storage\r\n\r\n--- End of system information ---\r\n\r\n\r\n\r\n\r\n### Additional Information\r\n[logcat-2022-10-22-00-01-45-2.txt](https://github.com/cgeo/cgeo/files/9843865/logcat-2022-10-22-00-01-45-2.txt)\r\n", "logs": [{"name": "logcat-2022-10-22-00-01-45-2.txt", "url": "https://github.com/cgeo/cgeo/files/9843865/logcat-2022-10-22-00-01-45-2.txt"}]}, "pull_request": [{"number": 13554, "url": "https://github.com/cgeo/cgeo/pull/13554", "diff_url": "https://github.com/cgeo/cgeo/pull/13554.diff", "patch_url": "https://github.com/cgeo/cgeo/pull/13554.patch", "title": "rel to #13551: fix nullpointerexception in ImageUtils.forEachImageUrlInHtml", "content": "rel to #13551: fix nullpointerexception in ImageUtils.forEachImageUrlInHtml", "diff": "diff --git a/main/res/values/strings.xml b/main/res/values/strings.xml\nindex 3f45c397bad..f205d0ac8f0 100644\n--- a/main/res/values/strings.xml\n+++ b/main/res/values/strings.xml\n@@ -1363,7 +1363,7 @@\n     <string name=\"cache_description\">Description</string>\n     <string name=\"cache_description_table_note\">Description contains table formatting which may need to be viewed at %s to be seen correctly.</string>\n     <string name=\"cache_description_rendering\">Rendering description, please wait</string>\n-    <string name=\"cache_description_render_restricted_warning\">Warning: Description is very large (%1$d chars). Only first %2$d%% were rendered.</string>\n+    <string name=\"cache_description_render_restricted_warning\">Warning: Description is very large (%1$d chars). Only first %2$d%% are displayed.</string>\n     <string name=\"cache_description_render_fully\">Render complete description</string>\n     <string name=\"cache_area_description\">Area Description</string>\n     <string name=\"cache_cache_description\">Cache Description</string>\ndiff --git a/main/src/cgeo/geocaching/utils/ImageUtils.java b/main/src/cgeo/geocaching/utils/ImageUtils.java\nindex 46de76a8764..6f271e12342 100644\n--- a/main/src/cgeo/geocaching/utils/ImageUtils.java\n+++ b/main/src/cgeo/geocaching/utils/ImageUtils.java\n@@ -478,10 +478,18 @@ public static void addImagesFromHtml(final Collection<Image> images, final Strin\n             }, htmlText);\n     }\n \n-    public static void forEachImageUrlInHtml(final androidx.core.util.Consumer<String> callback, final String ... htmlText) {\n+    public static void forEachImageUrlInHtml(@Nullable final androidx.core.util.Consumer<String> callback, @Nullable final String ... htmlText) {\n+        //shortcut for nulls\n+        if (htmlText == null || callback == null) {\n+            return;\n+        }\n         try (ContextLogger cLog = new ContextLogger(Log.LogLevel.DEBUG, \"forEachImageUrlInHtml\")) {\n             final boolean debug = Log.isDebug();\n             for (final String text : htmlText) {\n+                //skip null or empty texts\n+                if (StringUtils.isBlank(text)) {\n+                    continue;\n+                }\n                 final AtomicInteger count = debug ? new AtomicInteger(0) : null;\n                 if (debug) {\n                     cLog.add(\"size:\" + text.length());\n", "changes": [{"file": "main/src/cgeo/geocaching/utils/ImageUtils.java", "module": "cgeo.geocaching.utils.ImageUtils", "range": [{"start": 481, "end": 482}, {"start": 485, "end": 485}]}]}]}
{"url": "https://github.com/cgeo/cgeo/issues/13027", "repo": {"url": "https://github.com/cgeo/cgeo", "name": "cgeo", "owner": "cgeo", "modules": ["app.organicmaps.api", "cgeo.geocaching", "cgeo.geocaching.about", "cgeo.geocaching.activity", "cgeo.geocaching.address", "cgeo.geocaching.apps", "cgeo.geocaching.backup", "cgeo.geocaching.brouter", "cgeo.geocaching.calendar", "cgeo.geocaching.command", "cgeo.geocaching.connector", "cgeo.geocaching.contacts", "cgeo.geocaching.downloader", "cgeo.geocaching.enumerations", "cgeo.geocaching.export", "cgeo.geocaching.files", "cgeo.geocaching.filters", "cgeo.geocaching.helper", "cgeo.geocaching.list", "cgeo.geocaching.loaders", "cgeo.geocaching.location", "cgeo.geocaching.log", "cgeo.geocaching.maps", "cgeo.geocaching.models", "cgeo.geocaching.network", "cgeo.geocaching.permission", "cgeo.geocaching.playservices", "cgeo.geocaching.search", "cgeo.geocaching.sensors", "cgeo.geocaching.service", "cgeo.geocaching.settings", "cgeo.geocaching.sorting", "cgeo.geocaching.speech", "cgeo.geocaching.storage", "cgeo.geocaching.test", "cgeo.geocaching.ui", "cgeo.geocaching.unifiedmap", "cgeo.geocaching.utils", "cgeo.geocaching.wherigo", "cgeo.test", "cgeo.watchdog"]}, "issue": {"number": 13027, "url": "https://github.com/cgeo/cgeo/issues/13027", "state": "closed", "title": "Crash on delete calculated waypoint which is saved in note", "body": "### Describe your problem!\n\nCrash on deleting a waypoint with calculated coordinates (new calculator), which was exported to the PN.\n\n### How to reproduce?\n\n- Create waypoint with calculated  coordinates (using variables)\r\n- enter values for the variables, so the coordinates are calculated (didn't checked, if it also crashs with not full calculated coordinates)\r\n- Export it to note\r\n- Goto variables tab\r\n- Delete all variables\r\n- Goto waypoint tab\r\n- Delete waypoint \r\n\r\n\n\n### Actual result after these steps?\n\ncrash in recyclerView - reinitializePage \n\n### Expected result after these steps?\n\nWaypoint should be recreated correctly from the PN\n\n### Reproducible\n\nYes\n\n### c:geo Version\n\n2022.05.15-NB\n\n### System information\n\n_No response_\n\n### Additional Information\n\n[logcat-2022-05-18-17-37-48-2.txt](https://github.com/cgeo/cgeo/files/8730308/logcat-2022-05-18-17-37-48-2.txt)\r\n", "logs": [{"name": "logcat-2022-05-18-17-37-48-2.txt", "url": "https://github.com/cgeo/cgeo/files/8730308/logcat-2022-05-18-17-37-48-2.txt"}]}, "pull_request": [{"number": 13028, "url": "https://github.com/cgeo/cgeo/pull/13028", "diff_url": "https://github.com/cgeo/cgeo/pull/13028.diff", "patch_url": "https://github.com/cgeo/cgeo/pull/13028.patch", "title": "fix #13027: prevent crash on note recreation of calc waypoints", "content": "fix #13027: prevent crash on note recreation of calc waypoints", "diff": "diff --git a/main/src/cgeo/geocaching/CacheDetailActivity.java b/main/src/cgeo/geocaching/CacheDetailActivity.java\nindex d58c414fa27..796529ff311 100644\n--- a/main/src/cgeo/geocaching/CacheDetailActivity.java\n+++ b/main/src/cgeo/geocaching/CacheDetailActivity.java\n@@ -2089,7 +2089,7 @@ public View getView(final int position, final View convertView, @NonNull final V\n             v.setOnScrollListener(new FastScrollListener(v));\n \n             //register for changes of variableslist -> calculated waypoints may have changed\n-            cache.getVariables().addChangeListener(this, s -> adapter.notifyDataSetChanged());\n+            cache.getVariables().addChangeListener(this, s -> activity.runOnUiThread(() -> adapter.notifyDataSetChanged()));\n \n             if (v.getHeaderViewsCount() < 1) {\n                 final CachedetailWaypointsHeaderBinding headerBinding = CachedetailWaypointsHeaderBinding.inflate(getLayoutInflater(), v, false);\ndiff --git a/main/src/cgeo/geocaching/VariablesViewPageFragment.java b/main/src/cgeo/geocaching/VariablesViewPageFragment.java\nindex eb69a208932..b3886330547 100644\n--- a/main/src/cgeo/geocaching/VariablesViewPageFragment.java\n+++ b/main/src/cgeo/geocaching/VariablesViewPageFragment.java\n@@ -114,7 +114,7 @@ public void setContent() {\n         }\n         adapter.setVariableList(cache.getVariables());\n         //register for changes of variableslist -> calculated waypoints may have changed\n-        cache.getVariables().addChangeListener(this, s -> adapter.setVariableList(cache.getVariables()));\n+        cache.getVariables().addChangeListener(this, s -> activity.runOnUiThread(() -> adapter.setVariableList(cache.getVariables())));\n         binding.getRoot().setVisibility(View.VISIBLE);\n     }\n \ndiff --git a/main/src/cgeo/geocaching/models/CacheVariableList.java b/main/src/cgeo/geocaching/models/CacheVariableList.java\nindex e202b886edc..1538ca3ec9b 100644\n--- a/main/src/cgeo/geocaching/models/CacheVariableList.java\n+++ b/main/src/cgeo/geocaching/models/CacheVariableList.java\n@@ -98,9 +98,13 @@ private void addAllWaypointNeededVars(final Set<String> neededVars) {\n     }\n \n     private boolean recalculateWaypoints() {\n+        final Geocache cache = DataStore.loadCache(this.geocode, LoadFlags.LOAD_CACHE_OR_DB);\n+        return recalculateWaypoints(cache);\n+    }\n+\n+    public boolean recalculateWaypoints(final Geocache cache) {\n \n         boolean hasCalculatedWp = false;\n-        final Geocache cache = DataStore.loadCache(this.geocode, LoadFlags.LOAD_CACHE_OR_DB);\n         if (cache != null) {\n             for (Waypoint wp : cache.getWaypoints()) {\n                 if (wp.isCalculated()) {\ndiff --git a/main/src/cgeo/geocaching/models/Geocache.java b/main/src/cgeo/geocaching/models/Geocache.java\nindex 9e30b7ef7ed..e439d9978c5 100644\n--- a/main/src/cgeo/geocaching/models/Geocache.java\n+++ b/main/src/cgeo/geocaching/models/Geocache.java\n@@ -1736,6 +1736,7 @@ public boolean addWaypointsFromText(@Nullable final String text, final boolean u\n                     getVariables().addVariable(var.getKey(), var.getValue());\n                 }\n                 getVariables().saveState();\n+                getVariables().recalculateWaypoints(this); //need to do this because new wps are not saved to DB yet\n             }\n         }\n         return changed;\n", "changes": [{"file": "main/src/cgeo/geocaching/CacheDetailActivity.java", "module": "cgeo.geocaching.CacheDetailActivity", "range": [{"start": 2092, "end": 2093}]}, {"file": "main/src/cgeo/geocaching/VariablesViewPageFragment.java", "module": "cgeo.geocaching.VariablesViewPageFragment", "range": [{"start": 117, "end": 118}]}, {"file": "main/src/cgeo/geocaching/models/CacheVariableList.java", "module": "cgeo.geocaching.models.CacheVariableList", "range": [{"start": 101, "end": 101}, {"start": 103, "end": 103}]}, {"file": "main/src/cgeo/geocaching/models/Geocache.java", "module": "cgeo.geocaching.models.Geocache", "range": [{"start": 1739, "end": 1739}]}]}]}
{"url": "https://github.com/chenxiaolong/BCR/issues/539", "repo": {"url": "https://github.com/chenxiaolong/BCR", "name": "BCR", "owner": "chenxiaolong", "modules": ["com.chiller3.bcr", "com.chiller3.bcr.dialog", "com.chiller3.bcr.extension", "com.chiller3.bcr.format", "com.chiller3.bcr.output", "com.chiller3.bcr.rule", "com.chiller3.bcr.settings", "com.chiller3.bcr.standalone", "com.chiller3.bcr.template", "com.chiller3.bcr.view"]}, "issue": {"number": 539, "url": "https://github.com/chenxiaolong/BCR/issues/539", "state": "closed", "title": "Crash on Lineage OS 21", "body": "App does not start at all. It crashes immediately. I have attached log.\r\n\r\n[crash.log.txt](https://github.com/chenxiaolong/BCR/files/15213199/crash.log.txt)\r\n\r\nBRC: v1.62\r\nLineage OS: 20\r\nInstallation type: System (via flashable zip)\r\n", "logs": [{"name": "crash.log.txt", "url": "https://github.com/chenxiaolong/BCR/files/15213199/crash.log.txt"}]}, "pull_request": [{"number": 541, "url": "https://github.com/chenxiaolong/BCR/pull/541", "diff_url": "https://github.com/chenxiaolong/BCR/pull/541.diff", "patch_url": "https://github.com/chenxiaolong/BCR/pull/541.patch", "title": "Fix missing sysconfig file in build.gradle.kts", "content": "Issue: #539", "diff": "diff --git a/app/build.gradle.kts b/app/build.gradle.kts\nindex 19cfafa5b..3cf576e73 100644\n--- a/app/build.gradle.kts\n+++ b/app/build.gradle.kts\n@@ -327,7 +327,8 @@ android.applicationVariants.all {\n         val backupFiles = variant.outputs.map {\n             \"priv-app/${variant.applicationId}/${it.outputFile.name}\"\n         } + listOf(\n-            \"etc/permissions/privapp-permissions-${variant.applicationId}.xml\"\n+            \"etc/permissions/privapp-permissions-${variant.applicationId}.xml\",\n+            \"etc/sysconfig/config-${variant.applicationId}.xml\",\n         )\n \n         doLast {\n", "changes": [{"file": "app/build.gradle.kts", "module": "app.build.gradle.kts", "range": [{"start": 330, "end": 331}]}]}, {"number": 549, "url": "https://github.com/chenxiaolong/BCR/pull/549", "diff_url": "https://github.com/chenxiaolong/BCR/pull/549.diff", "patch_url": "https://github.com/chenxiaolong/BCR/pull/549.patch", "title": "Use android:usesNonSdkApi to access hidden/system APIs", "content": "Some custom Android builds seem to have a bug where the sysconfig file is not respected for some boots.\r\n\r\nFixes: #539\r\nFixes: #546", "diff": "diff --git a/app/build.gradle.kts b/app/build.gradle.kts\nindex a7e1d3ec9..a93f4a4ed 100644\n--- a/app/build.gradle.kts\n+++ b/app/build.gradle.kts\n@@ -299,22 +299,6 @@ android.applicationVariants.all {\n         }\n     }\n \n-    val configXml = tasks.register(\"configXml${capitalized}\") {\n-        inputs.property(\"variant.applicationId\", variant.applicationId)\n-\n-        val outputFile = variantDir.map { it.file(\"config-${variant.applicationId}.xml\") }\n-        outputs.file(outputFile)\n-\n-        doLast {\n-            outputFile.get().asFile.writeText(\"\"\"\n-                <?xml version=\"1.0\" encoding=\"utf-8\"?>\n-                <config>\n-                    <hidden-api-whitelisted-app package=\"${variant.applicationId}\" />\n-                </config>\n-            \"\"\".trimIndent())\n-        }\n-    }\n-\n     val addonD = tasks.register(\"addonD${capitalized}\") {\n         inputs.property(\"variant.applicationId\", variant.applicationId)\n \n@@ -328,7 +312,6 @@ android.applicationVariants.all {\n             \"priv-app/${variant.applicationId}/${it.outputFile.name}\"\n         } + listOf(\n             \"etc/permissions/privapp-permissions-${variant.applicationId}.xml\",\n-            \"etc/sysconfig/config-${variant.applicationId}.xml\",\n         )\n \n         doLast {\n@@ -375,9 +358,6 @@ android.applicationVariants.all {\n         from(permissionsXml.map { it.outputs }) {\n             into(\"system/etc/permissions\")\n         }\n-        from(configXml.map { it.outputs }) {\n-            into(\"system/etc/sysconfig\")\n-        }\n         from(variant.outputs.map { it.outputFile }) {\n             into(\"system/priv-app/${variant.applicationId}\")\n         }\ndiff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml\nindex f4f1f26f3..84cb4dd60 100644\n--- a/app/src/main/AndroidManifest.xml\n+++ b/app/src/main/AndroidManifest.xml\n@@ -25,8 +25,16 @@\n     <uses-permission android:name=\"android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS\" />\n     <uses-permission android:name=\"android.permission.VIBRATE\" />\n \n+    <!--\n+        We use android:usesNonSdkApi to bypass Android's hidden API restrictions instead of creating\n+        a sysconfig file with <hidden-api-whitelisted-app>. This is necessary because some custom\n+        Android builds have a bug where the sysconfig file is only sometimes respected, leading to\n+        intermittent app crashes.\n+    -->\n+    <!--suppress AndroidUnknownAttribute -->\n     <application\n         android:name=\".RecorderApplication\"\n+        android:usesNonSdkApi=\"true\"\n         android:allowBackup=\"true\"\n         android:icon=\"@mipmap/ic_launcher\"\n         android:label=\"@string/app_name\"\ndiff --git a/app/src/main/java/com/chiller3/bcr/extension/AudioFormatExtensions.kt b/app/src/main/java/com/chiller3/bcr/extension/AudioFormatExtensions.kt\nindex d43fdc53c..9c3db686c 100644\n--- a/app/src/main/java/com/chiller3/bcr/extension/AudioFormatExtensions.kt\n+++ b/app/src/main/java/com/chiller3/bcr/extension/AudioFormatExtensions.kt\n@@ -13,8 +13,8 @@ val AudioFormat.frameSizeInBytesCompat: Int\n         2 * channelCount\n     }\n \n-// Static extension functions are currently not supported in Kotlin. Also, we install a sysconfig\n-// file to allow access to these hidden fields.\n+// Static extension functions are currently not supported in Kotlin. Also, we set usesNonSdkApi to\n+// allow access to these hidden fields.\n \n @SuppressLint(\"SoonBlockedPrivateApi\")\n val SAMPLE_RATE_HZ_MIN_COMPAT: Int =\n", "changes": [{"file": "app/build.gradle.kts", "module": "app.build.gradle.kts", "range": [{"start": 302, "end": 317}, {"start": 331, "end": 331}, {"start": 378, "end": 380}]}, {"file": "app/src/main/AndroidManifest.xml", "module": "com.chiller3.bcr.RecorderApplication", "range": [{"start": 28, "end": 28}, {"start": 30, "end": 30}]}]}]}
{"url": "https://github.com/chenxiaolong/BCR/issues/275", "repo": {"url": "https://github.com/chenxiaolong/BCR", "name": "BCR", "owner": "chenxiaolong", "modules": ["com.chiller3.bcr", "com.chiller3.bcr.dialog", "com.chiller3.bcr.extension", "com.chiller3.bcr.format", "com.chiller3.bcr.output", "com.chiller3.bcr.rule", "com.chiller3.bcr.settings", "com.chiller3.bcr.standalone", "com.chiller3.bcr.template", "com.chiller3.bcr.view"]}, "issue": {"number": 275, "url": "https://github.com/chenxiaolong/BCR/issues/275", "state": "closed", "title": "App dont open. ", "body": "[crash.log (3).txt](https://github.com/chenxiaolong/BCR/files/11071625/crash.log.3.txt)\r\n", "logs": [{"name": "crash.log (3).txt", "url": "https://github.com/chenxiaolong/BCR/files/11071625/crash.log.3.txt"}]}, "pull_request": [{"number": 323, "url": "https://github.com/chenxiaolong/BCR/pull/323", "diff_url": "https://github.com/chenxiaolong/BCR/pull/323.diff", "patch_url": "https://github.com/chenxiaolong/BCR/pull/323.patch", "title": "Clean package manager caches on boot", "content": "On some devices, the system time is set too late in the boot process. This, for some reason, causes the package manager service to not update the cache entry in /data/system/package_cache despite the mtime of the apk being newer than the mtime of the cache entry [1]. The outdated cache entry causes BCR to crash with an error about the app theme not being derived from Theme.AppCompat. This commit works around the issue in a brute force way by deleting BCR's package manager cache entry on every boot.\r\n\r\n[1] https://cs.android.com/android/platform/superproject/+/android-13.0.0_r42:frameworks/base/services/core/java/com/android/server/pm/parsing/PackageCacher.java;l=139\r\n\r\nFixes: #275, #303, #307", "diff": "diff --git a/app/build.gradle.kts b/app/build.gradle.kts\nindex ad6937558..d7ced0647 100644\n--- a/app/build.gradle.kts\n+++ b/app/build.gradle.kts\n@@ -350,6 +350,8 @@ android.applicationVariants.all {\n             }\n         }\n \n+        from(File(magiskDir, \"boot_common.sh\"))\n+        from(File(magiskDir, \"post-fs-data.sh\"))\n         from(File(magiskDir, \"service.sh\"))\n \n         from(File(rootDir, \"LICENSE\"))\ndiff --git a/app/magisk/boot_common.sh b/app/magisk/boot_common.sh\nnew file mode 100644\nindex 000000000..654986427\n--- /dev/null\n+++ b/app/magisk/boot_common.sh\n@@ -0,0 +1,34 @@\n+# source \"${0%/*}/boot_common.sh\" <log file>\n+\n+exec >\"${1}\" 2>&1\n+\n+mod_dir=${0%/*}\n+\n+header() {\n+    echo \"----- ${*} -----\"\n+}\n+\n+module_prop() {\n+    grep \"^${1}=\" \"${mod_dir}/module.prop\" | cut -d= -f2\n+}\n+\n+run_cli_apk() {\n+    CLASSPATH=\"${cli_apk}\" app_process / \"${@}\" &\n+    pid=${!}\n+    wait \"${pid}\"\n+    echo \"Exit status: ${?}\"\n+    echo \"Logcat:\"\n+    logcat -d --pid \"${pid}\"\n+}\n+\n+app_id=$(module_prop id)\n+app_version=$(module_prop version)\n+cli_apk=$(echo \"${mod_dir}\"/system/priv-app/\"${app_id}\"/app-*.apk)\n+\n+header Environment\n+echo \"Timestamp: $(date)\"\n+echo \"Script: ${0}\"\n+echo \"App ID: ${app_id}\"\n+echo \"App version: ${app_version}\"\n+echo \"CLI APK: ${cli_apk}\"\n+echo \"UID/GID/Context: $(id)\"\ndiff --git a/app/magisk/post-fs-data.sh b/app/magisk/post-fs-data.sh\nnew file mode 100644\nindex 000000000..a1e74ed4c\n--- /dev/null\n+++ b/app/magisk/post-fs-data.sh\n@@ -0,0 +1,18 @@\n+# On some devices, the system time is set too late in the boot process. This,\n+# for some reason, causes the package manager service to not update the cache\n+# entry for BCR despite the mtime of the apk being newer than the mtime of the\n+# cache entry [1]. This causes BCR to crash with an obscure error about the app\n+# theme not being derived from Theme.AppCompat. This script works around the\n+# issue by forcibly deleting BCR's package manager cache entry on every boot.\n+#\n+# [1] https://cs.android.com/android/platform/superproject/+/android-13.0.0_r42:frameworks/base/services/core/java/com/android/server/pm/parsing/PackageCacher.java;l=139\n+\n+source \"${0%/*}/boot_common.sh\" /data/local/tmp/bcr_clear_package_manager_caches.log\n+\n+header Timestamps\n+ls -lZ \"${cli_apk}\"\n+ls -lZ \"${cli_apk#\"${mod_dir}\"}\"\n+find /data/system/package_cache -name \"${app_id}-*\" -exec ls -lZ {} \\+\n+\n+header Clear package manager caches\n+run_cli_apk com.chiller3.bcr.standalone.ClearPackageManagerCachesKt\ndiff --git a/app/magisk/service.sh b/app/magisk/service.sh\nindex d30387870..b6ea49200 100644\n--- a/app/magisk/service.sh\n+++ b/app/magisk/service.sh\n@@ -5,38 +5,10 @@\n # to alter the flags. This command blocks for an arbitrary amount of time\n # because it needs to wait until the primary user unlocks the device.\n \n-exec >/data/local/tmp/bcr_remove_hard_restrictions.log 2>&1\n-\n-mod_dir=${0%/*}\n-\n-header() {\n-    echo \"----- ${*} -----\"\n-}\n-\n-module_prop() {\n-    grep \"^${1}=\" \"${mod_dir}/module.prop\" | cut -d= -f2\n-}\n-\n-app_id=$(module_prop id)\n-app_version=$(module_prop version)\n-\n-header Environment\n-echo \"Timestamp: $(date)\"\n-echo \"Args: ${0} ${*}\"\n-echo \"Version: ${app_version}\"\n-echo \"UID/GID/Context: $(id)\"\n+source \"${0%/*}/boot_common.sh\" /data/local/tmp/bcr_remove_hard_restrictions.log\n \n header Remove hard restrictions\n-CLASSPATH=$(find \"${mod_dir}\"/system/priv-app/\"${app_id}\" -name '*.apk') \\\n-    app_process \\\n-    / \\\n-    com.chiller3.bcr.standalone.RemoveHardRestrictionsKt &\n-pid=${!}\n-wait \"${pid}\"\n-echo \"Exit status: ${?}\"\n-\n-header Logcat\n-logcat -d --pid \"${pid}\"\n+run_cli_apk com.chiller3.bcr.standalone.RemoveHardRestrictionsKt\n \n header Package state\n dumpsys package \"${app_id}\"\ndiff --git a/app/src/main/java/com/chiller3/bcr/standalone/ClearPackageManagerCaches.kt b/app/src/main/java/com/chiller3/bcr/standalone/ClearPackageManagerCaches.kt\nnew file mode 100644\nindex 000000000..672d1a973\n--- /dev/null\n+++ b/app/src/main/java/com/chiller3/bcr/standalone/ClearPackageManagerCaches.kt\n@@ -0,0 +1,95 @@\n+@file:Suppress(\"SameParameterValue\")\n+\n+package com.chiller3.bcr.standalone\n+\n+import com.chiller3.bcr.BuildConfig\n+import java.nio.file.Path\n+import java.nio.file.Paths\n+import kotlin.io.path.ExperimentalPathApi\n+import kotlin.io.path.deleteIfExists\n+import kotlin.io.path.isRegularFile\n+import kotlin.io.path.readBytes\n+import kotlin.io.path.walk\n+import kotlin.system.exitProcess\n+\n+private val PACKAGE_CACHE_DIR = Paths.get(\"/data/system/package_cache\")\n+\n+private var dryRun = false\n+\n+private fun delete(path: Path) {\n+    if (dryRun) {\n+        println(\"Would have deleted: $path\")\n+    } else {\n+        println(\"Deleting: $path\")\n+        path.deleteIfExists()\n+    }\n+}\n+\n+private fun ByteArray.indexOfSubarray(needle: ByteArray, start: Int = 0): Int {\n+    require(start >= 0) { \"start must be non-negative\" }\n+\n+    if (needle.isEmpty()) {\n+        return 0\n+    }\n+\n+    outer@ for (i in 0 until size - needle.size + 1) {\n+        for (j in needle.indices) {\n+            if (this[i + j] != needle[j]) {\n+                continue@outer\n+            }\n+        }\n+        return i\n+    }\n+\n+    return -1\n+}\n+\n+@OptIn(ExperimentalPathApi::class)\n+private fun clearPackageManagerCache(appId: String): Boolean {\n+    // The current implementation of the package cache uses PackageImpl.writeToParcel(), which\n+    // serializes the cache entry to the file as a Parcel. The current Parcel implementation stores\n+    // string values as null-terminated little-endian UTF-16. One of the string values stored is\n+    // manifestPackageName, which we can match on.\n+    //\n+    // This is a unique enough search that there should never be a false positive, but even if there\n+    // is, the package manager will just repopulate the cache.\n+    val needle = \"\\u0000$appId\\u0000\".toByteArray(Charsets.UTF_16LE)\n+    var ret = true\n+\n+    for (path in PACKAGE_CACHE_DIR.walk()) {\n+        if (!path.isRegularFile()) {\n+            continue\n+        }\n+\n+        try {\n+            // Not the most efficient, but these are tiny files that Android is later going to read\n+            // entirely into memory anyway\n+            if (path.readBytes().indexOfSubarray(needle) >= 0) {\n+                delete(path)\n+            }\n+        } catch (e: Exception) {\n+            e.printStackTrace()\n+            ret = false\n+        }\n+    }\n+\n+    return ret\n+}\n+\n+private fun mainInternal() {\n+    clearPackageManagerCache(BuildConfig.APPLICATION_ID)\n+}\n+\n+fun main(args: Array<String>) {\n+    if (\"--dry-run\" in args) {\n+        dryRun = true\n+    }\n+\n+    try {\n+        mainInternal()\n+    } catch (e: Exception) {\n+        System.err.println(\"Failed to clear caches\")\n+        e.printStackTrace()\n+        exitProcess(1)\n+    }\n+}\n\\ No newline at end of file\ndiff --git a/app/src/main/java/com/chiller3/bcr/standalone/RemoveHardRestrictions.kt b/app/src/main/java/com/chiller3/bcr/standalone/RemoveHardRestrictions.kt\nindex 05102befc..c8caa4503 100644\n--- a/app/src/main/java/com/chiller3/bcr/standalone/RemoveHardRestrictions.kt\n+++ b/app/src/main/java/com/chiller3/bcr/standalone/RemoveHardRestrictions.kt\n@@ -272,7 +272,7 @@ private fun waitForLogin(userId: Int) {\n         \"User $userId did not unlock the device after $IS_USER_UNLOCKED_ATTEMPTS attempts\")\n }\n \n-fun mainInternal() {\n+private fun mainInternal() {\n     if (Build.VERSION.SDK_INT == Build.VERSION_CODES.P) {\n         println(\"Android 9 does not have hard-restricted permissions\")\n         return\n", "changes": [{"file": "app/build.gradle.kts", "module": "app.build.gradle.kts", "range": [{"start": 353, "end": 353}]}, {"file": "app/magisk/boot_common.sh", "module": "app.magisk.boot_common.sh", "range": [{"start": 0, "end": 0}]}, {"file": "app/magisk/post-fs-data.sh", "module": "app.magisk.post-fs-data.sh", "range": [{"start": 0, "end": 0}]}, {"file": "app/magisk/service.sh", "module": "app.magisk.service.sh", "range": [{"start": 8, "end": 28}, {"start": 30, "end": 40}]}, {"file": "app/src/main/java/com/chiller3/bcr/standalone/ClearPackageManagerCaches.kt", "module": "com.chiller3.bcr.standalone.ClearPackageManagerCachesKt", "range": [{"start": 0, "end": 0}]}, {"file": "app/src/main/java/com/chiller3/bcr/standalone/RemoveHardRestrictions.kt", "module": "com.chiller3.bcr.standalone.RemoveHardRestrictionsKt", "range": [{"start": 275, "end": 276}]}]}]}
{"url": "https://github.com/chenxiaolong/BCR/issues/260", "repo": {"url": "https://github.com/chenxiaolong/BCR", "name": "BCR", "owner": "chenxiaolong", "modules": ["com.chiller3.bcr", "com.chiller3.bcr.dialog", "com.chiller3.bcr.extension", "com.chiller3.bcr.format", "com.chiller3.bcr.output", "com.chiller3.bcr.rule", "com.chiller3.bcr.settings", "com.chiller3.bcr.standalone", "com.chiller3.bcr.template", "com.chiller3.bcr.view"]}, "issue": {"number": 260, "url": "https://github.com/chenxiaolong/BCR/issues/260", "state": "closed", "title": "Custom name template is failing to load ", "body": "@chenxiaolong \r\nHello sir, \r\nAll of a sudden after updating to new version the custom made template is failing to load and it gives files name as per default format\r\n\r\nHere by, i am attaching the log file please help me to fix it. \r\n\r\nThannks\r\n\r\nFiles \r\n@\r\n[20230301_160019.603+0530_out_121_customer care.log.txt](https://github.com/chenxiaolong/BCR/files/10860010/20230301_160019.603%2B0530_out_121_customer.care.log.txt)\r\n\r\nHere is custom template i used (it use to work previously)\r\nDownload : https://we.tl/t-7hPbqJPAF1\r\n\r\n\r\n\r\n\r\n", "logs": [{"name": "20230301_160019.603+0530_out_121_customer care.log.txt", "url": "https://github.com/chenxiaolong/BCR/files/10860010/20230301_160019.603%2B0530_out_121_customer.care.log.txt"}]}, "pull_request": [{"number": 261, "url": "https://github.com/chenxiaolong/BCR/pull/261", "diff_url": "https://github.com/chenxiaolong/BCR/pull/261.diff", "patch_url": "https://github.com/chenxiaolong/BCR/pull/261.patch", "title": "app/proguard-rules.pro: Keep TreeDocumentFile constructor", "content": "We call it via reflection in our faster DocumentFile extensions and the first parameter was being optimized out in release builds because it is always null in the usages that R8 is able to analyze.\r\n\r\nRelated-to: #257\r\nFixes: #260", "diff": "diff --git a/app/build.gradle.kts b/app/build.gradle.kts\nindex 65282893e..8b23114f3 100644\n--- a/app/build.gradle.kts\n+++ b/app/build.gradle.kts\n@@ -138,7 +138,23 @@ android {\n         }\n     }\n     buildTypes {\n+        getByName(\"debug\") {\n+            buildConfigField(\"boolean\", \"FORCE_DEBUG_MODE\", \"true\")\n+        }\n+\n+        create(\"debugOpt\") {\n+            buildConfigField(\"boolean\", \"FORCE_DEBUG_MODE\", \"true\")\n+\n+            isMinifyEnabled = true\n+            isShrinkResources = true\n+            proguardFiles(getDefaultProguardFile(\"proguard-android-optimize.txt\"), \"proguard-rules.pro\")\n+\n+            signingConfig = signingConfigs.getByName(\"debug\")\n+        }\n+\n         getByName(\"release\") {\n+            buildConfigField(\"boolean\", \"FORCE_DEBUG_MODE\", \"false\")\n+\n             isMinifyEnabled = true\n             isShrinkResources = true\n             proguardFiles(getDefaultProguardFile(\"proguard-android-optimize.txt\"), \"proguard-rules.pro\")\ndiff --git a/app/proguard-rules.pro b/app/proguard-rules.pro\nindex a53f59c5a..e396b8a1b 100644\n--- a/app/proguard-rules.pro\n+++ b/app/proguard-rules.pro\n@@ -23,3 +23,9 @@\n # Disable obfuscation completely for BCR. As an open source project,\n # shrinking is the only goal of minification.\n -dontobfuscate\n+\n+# We construct TreeDocumentFile via reflection in DocumentFileExtensions\n+# to speed up SAF performance when doing path lookups.\n+-keepclassmembers class androidx.documentfile.provider.TreeDocumentFile {\n+    <init>(androidx.documentfile.provider.DocumentFile, android.content.Context, android.net.Uri);\n+}\ndiff --git a/app/src/main/java/com/chiller3/bcr/Preferences.kt b/app/src/main/java/com/chiller3/bcr/Preferences.kt\nindex 01268978a..08953b05a 100644\n--- a/app/src/main/java/com/chiller3/bcr/Preferences.kt\n+++ b/app/src/main/java/com/chiller3/bcr/Preferences.kt\n@@ -70,7 +70,7 @@ class Preferences(private val context: Context) {\n     }\n \n     var isDebugMode: Boolean\n-        get() = prefs.getBoolean(PREF_DEBUG_MODE, false)\n+        get() = BuildConfig.FORCE_DEBUG_MODE || prefs.getBoolean(PREF_DEBUG_MODE, false)\n         set(enabled) = prefs.edit { putBoolean(PREF_DEBUG_MODE, enabled) }\n \n     /**\ndiff --git a/app/src/main/java/com/chiller3/bcr/RecorderThread.kt b/app/src/main/java/com/chiller3/bcr/RecorderThread.kt\nindex a57635f88..1a270446b 100644\n--- a/app/src/main/java/com/chiller3/bcr/RecorderThread.kt\n+++ b/app/src/main/java/com/chiller3/bcr/RecorderThread.kt\n@@ -52,7 +52,7 @@ class RecorderThread(\n ) : Thread(RecorderThread::class.java.simpleName) {\n     private val tag = \"${RecorderThread::class.java.simpleName}/${id}\"\n     private val prefs = Preferences(context)\n-    private val isDebug = BuildConfig.DEBUG || prefs.isDebugMode\n+    private val isDebug = prefs.isDebugMode\n \n     // Thread state\n     @Volatile private var isCancelled = false\ndiff --git a/app/src/main/java/com/chiller3/bcr/SettingsActivity.kt b/app/src/main/java/com/chiller3/bcr/SettingsActivity.kt\nindex 71c2194e6..f42756e8e 100644\n--- a/app/src/main/java/com/chiller3/bcr/SettingsActivity.kt\n+++ b/app/src/main/java/com/chiller3/bcr/SettingsActivity.kt\n@@ -125,7 +125,7 @@ class SettingsActivity : AppCompatActivity() {\n         }\n \n         private fun refreshVersion() {\n-            val suffix = if (!BuildConfig.DEBUG && prefs.isDebugMode) {\n+            val suffix = if (prefs.isDebugMode) {\n                 \"+debugmode\"\n             } else {\n                 \"\"\n", "changes": [{"file": "app/src/main/java/com/chiller3/bcr/Preferences.kt", "module": "com.chiller3.bcr.Preferences", "range": [{"start": 73, "end": 74}]}, {"file": "app/src/main/java/com/chiller3/bcr/RecorderThread.kt", "module": "com.chiller3.bcr.RecorderThread", "range": [{"start": 55, "end": 56}]}, {"file": "app/src/main/java/com/chiller3/bcr/SettingsActivity.kt", "module": "com.chiller3.bcr.SettingsActivity", "range": [{"start": 128, "end": 129}]}]}]}
{"url": "https://github.com/komikku-app/komikku/issues/120", "repo": {"url": "https://github.com/komikku-app/komikku", "name": "komikku", "owner": "komikku-app", "modules": ["com.murgupluoglu", "eu.kanade", "exh", "exh.assets", "exh.debug", "exh.eh", "exh.favorites", "exh.log", "exh.md", "exh.metadata", "exh.pagepreview", "exh.pref", "exh.recs", "exh.search", "exh.smartsearch", "exh.source", "exh.uconfig", "exh.ui", "exh.util", "mihon.buildlogic", "mihon.core", "mihon.data", "mihon.domain", "mihon.feature", "mihon.presentation", "mihon.telemetry", "tachiyomi.core", "tachiyomi.data", "tachiyomi.domain", "tachiyomi.macrobenchmark", "tachiyomi.presentation", "tachiyomi.source", "xyz.nulldev"]}, "issue": {"number": 120, "url": "https://github.com/komikku-app/komikku/issues/120", "state": "closed", "title": "App crashes when related titles contain duplicate entries", "body": "### Steps to reproduce\r\n\r\nSome time sources return duplicate entries which have same ID but their URL somehow is different, which causes crash.\r\nReason: it is filtering duplicate entries by url while LazyRow is keying by entries' ID\r\n\r\n### Expected behavior\r\n\r\nShould not crash\r\n\r\n### Actual behavior\r\n\r\nCrash in some cases\r\n\r\n### Crash logs\r\n\r\n[tachiyomi_crash_logs-related-key.log](https://github.com/user-attachments/files/15991910/tachiyomi_crash_logs-related-key.log)\r\n\r\n### Komikku version\r\n\r\nr9066\r\n\r\n### Android version\r\n\r\nall\r\n\r\n### Device\r\n\r\nall\r\n\r\n### Other details\r\n\r\n_No response_\r\n\r\n### Acknowledgements\r\n\r\n- [X] I have searched the existing issues and this is a new ticket, **NOT** a duplicate or related to another open or closed issue.\r\n- [X] I have written a short but informative title.\r\n- [X] If this is an issue with an official extension, I should be opening an issue in the [extensions repository](https://github.com/komikku-app/extensions/issues/new/choose).\r\n- [X] I have gone through the [FAQ](https://mihon.app/docs/faq/general) and [troubleshooting guide](https:/mihon.app/docs/guides/troubleshooting/).\r\n- [X] I have updated the app to version **[1.10.5](https://github.com/komikku-app/komikku/releases/latest)**.\r\n\r\n- [X] I have updated all installed extensions.\r\n- [X] I will fill out all of the requested information in this form.", "logs": [{"name": "tachiyomi_crash_logs-related-key.log", "url": "https://github.com/user-attachments/files/15991910/tachiyomi_crash_logs-related-key.log"}]}, "pull_request": [{"number": 124, "url": "https://github.com/komikku-app/komikku/pull/124", "diff_url": "https://github.com/komikku-app/komikku/pull/124.diff", "patch_url": "https://github.com/komikku-app/komikku/pull/124.patch", "title": "improvement", "content": "close #120 ", "diff": "diff --git a/app/src/main/java/eu/kanade/tachiyomi/data/sync/service/GoogleDriveSyncService.kt b/app/src/main/java/eu/kanade/tachiyomi/data/sync/service/GoogleDriveSyncService.kt\nindex 8756502f1c..4321cce8d8 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/data/sync/service/GoogleDriveSyncService.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/data/sync/service/GoogleDriveSyncService.kt\n@@ -154,11 +154,11 @@ class GoogleDriveSyncService(context: Context, json: Json, syncPreferences: Sync\n \n             if (retries >= maxRetries) {\n                 logcat(LogPriority.ERROR) { \"Max retries reached, exiting sync process\" }\n-                throw Exception(context.stringResource(SYMR.strings.error_before_sync_gdrive) + \": Max retries reached.\")\n+                throw Exception(context.stringResource(SYMR.strings.error_before_sync_gdrive, \"Max retries reached.\"))\n             }\n         } catch (e: Exception) {\n             logcat(LogPriority.ERROR, throwable = e) { \"Error in GoogleDrive beforeSync\" }\n-            throw Exception(context.stringResource(SYMR.strings.error_before_sync_gdrive) + \": ${e.message}\", e)\n+            throw Exception(context.stringResource(SYMR.strings.error_before_sync_gdrive, e.message ?: \"Exception\"), e)\n         }\n     }\n \ndiff --git a/app/src/main/java/eu/kanade/tachiyomi/ui/manga/MangaScreen.kt b/app/src/main/java/eu/kanade/tachiyomi/ui/manga/MangaScreen.kt\nindex b941e88053..005e01a186 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/ui/manga/MangaScreen.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/ui/manga/MangaScreen.kt\n@@ -5,7 +5,7 @@ import android.content.Intent\n import androidx.activity.compose.BackHandler\n import androidx.activity.compose.rememberLauncherForActivityResult\n import androidx.activity.result.contract.ActivityResultContracts\n-import androidx.compose.animation.AnimatedContent\n+import androidx.compose.animation.Crossfade\n import androidx.compose.foundation.layout.systemBarsPadding\n import androidx.compose.runtime.Composable\n import androidx.compose.runtime.LaunchedEffect\n@@ -25,7 +25,6 @@ import androidx.compose.ui.platform.LocalHapticFeedback\n import androidx.core.net.toUri\n import cafe.adriel.voyager.core.model.rememberScreenModel\n import cafe.adriel.voyager.core.model.screenModelScope\n-import cafe.adriel.voyager.core.stack.StackEvent\n import cafe.adriel.voyager.navigator.LocalNavigator\n import cafe.adriel.voyager.navigator.Navigator\n import cafe.adriel.voyager.navigator.currentOrThrow\n@@ -92,8 +91,6 @@ import kotlinx.coroutines.flow.onEach\n import kotlinx.coroutines.flow.take\n import kotlinx.coroutines.launch\n import logcat.LogPriority\n-import soup.compose.material.motion.animation.materialSharedAxisX\n-import soup.compose.material.motion.animation.rememberSlideDistance\n import tachiyomi.core.common.i18n.stringResource\n import tachiyomi.core.common.util.lang.launchIO\n import tachiyomi.core.common.util.lang.launchUI\n@@ -158,17 +155,9 @@ class MangaScreen(\n         }\n \n         val content = @Composable {\n-            val slideDistance = rememberSlideDistance()\n-            AnimatedContent(\n+            Crossfade(\n                 targetState = showingRelatedMangasScreen.value,\n-                transitionSpec = {\n-                    materialSharedAxisX(\n-                        forward = navigator.lastEvent != StackEvent.Pop,\n-                        slideDistance = slideDistance,\n-                    )\n-                },\n-                label = \"manga_related_transition\",\n-                contentKey = { \"showingRelatedMangasScreen#$it\" }\n+                label = \"manga_related_crossfade\",\n             ) { showRelatedMangasScreen ->\n                 when (showRelatedMangasScreen) {\n                     true -> RelatedMangasScreen(\ndiff --git a/app/src/main/java/eu/kanade/tachiyomi/ui/manga/MangaScreenModel.kt b/app/src/main/java/eu/kanade/tachiyomi/ui/manga/MangaScreenModel.kt\nindex b1e2ed4f84..daab6283e9 100644\n--- a/app/src/main/java/eu/kanade/tachiyomi/ui/manga/MangaScreenModel.kt\n+++ b/app/src/main/java/eu/kanade/tachiyomi/ui/manga/MangaScreenModel.kt\n@@ -2050,15 +2050,15 @@ sealed interface RelatedManga {\n         }\n \n         internal fun List<RelatedManga>.removeDuplicates(manga: Manga): List<RelatedManga> {\n-            val mangaUrls = HashSet<String>().apply { add(manga.url) }\n+            val mangaIds = HashSet<Long>().apply { add(manga.id) }\n \n             return map { relatedManga ->\n                 if (relatedManga is Success) {\n                     Success(\n                         relatedManga.keyword,\n                         relatedManga.mangaList\n-                            .filterNot { mangaUrls.contains(it.url) }\n-                            .onEach { mangaUrls.add(it.url) },\n+                            .filterNot { mangaIds.contains(it.id) }\n+                            .onEach { mangaIds.add(it.id) },\n                     )\n                 } else {\n                     relatedManga\ndiff --git a/config/detekt/baseline.xml b/config/detekt/baseline.xml\nindex 6252060383..1ff07b8cac 100644\n--- a/config/detekt/baseline.xml\n+++ b/config/detekt/baseline.xml\n@@ -1962,8 +1962,8 @@\n     <ID>TooGenericExceptionThrown:EHentai.kt$EHentai$throw Exception(it.text())</ID>\n     <ID>TooGenericExceptionThrown:ExtensionLoader.kt$ExtensionLoader$throw Exception(\"Unknown source class type: ${obj.javaClass}\")</ID>\n     <ID>TooGenericExceptionThrown:GoogleDriveSyncService.kt$GoogleDriveService$throw Exception(context.stringResource(MR.strings.google_drive_not_signed_in))</ID>\n-    <ID>TooGenericExceptionThrown:GoogleDriveSyncService.kt$GoogleDriveSyncService$throw Exception(context.stringResource(MR.strings.error_before_sync_gdrive) + \": ${e.message}\", e)</ID>\n-    <ID>TooGenericExceptionThrown:GoogleDriveSyncService.kt$GoogleDriveSyncService$throw Exception(context.stringResource(MR.strings.error_before_sync_gdrive) + \": Max retries reached.\")</ID>\n+    <ID>TooGenericExceptionThrown:GoogleDriveSyncService.kt$GoogleDriveSyncService$throw Exception(context.stringResource(MR.strings.error_before_sync_gdrive, e.message ?: \"Exception\"), e)</ID>\n+    <ID>TooGenericExceptionThrown:GoogleDriveSyncService.kt$GoogleDriveSyncService$throw Exception(context.stringResource(MR.strings.error_before_sync_gdrive, \"Max retries reached.\"))</ID>\n     <ID>TooGenericExceptionThrown:GoogleDriveSyncService.kt$GoogleDriveSyncService$throw Exception(context.stringResource(MR.strings.error_deleting_google_drive_lock_file), e)</ID>\n     <ID>TooGenericExceptionThrown:GoogleDriveSyncService.kt$GoogleDriveSyncService$throw Exception(context.stringResource(MR.strings.error_uploading_sync_data) + \": ${e.message}\", e)</ID>\n     <ID>TooGenericExceptionThrown:GoogleDriveSyncService.kt$GoogleDriveSyncService$throw Exception(context.stringResource(MR.strings.google_drive_not_signed_in))</ID>\n", "changes": [{"file": "app/src/main/java/eu/kanade/tachiyomi/data/sync/service/GoogleDriveSyncService.kt", "module": "eu.kanade.tachiyomi.data.sync.service.GoogleDriveSyncService", "range": [{"start": 157, "end": 158}, {"start": 161, "end": 162}]}, {"file": "app/src/main/java/eu/kanade/tachiyomi/ui/manga/MangaScreen.kt", "module": "eu.kanade.tachiyomi.ui.manga.MangaScreen", "range": [{"start": 8, "end": 9}, {"start": 28, "end": 28}, {"start": 95, "end": 96}, {"start": 161, "end": 163}, {"start": 164, "end": 172}]}, {"file": "app/src/main/java/eu/kanade/tachiyomi/ui/manga/MangaScreenModel.kt", "module": "eu.kanade.tachiyomi.ui.manga.MangaScreenModel", "range": [{"start": 2053, "end": 2054}, {"start": 2060, "end": 2062}]}]}]}
{"url": "https://github.com/xchacha20-poly1305/husi/issues/65", "repo": {"url": "https://github.com/xchacha20-poly1305/husi", "name": "husi", "owner": "xchacha20-poly1305", "modules": ["fr.husi.plugin.hysteria2", "fr.husi.plugin.juicity", "fr.husi.plugin.mieru", "fr.husi.plugin.naive", "fr.husi.plugin.shadowquic", "io.nekohasekai.sagernet", "io.nekohasekai.sagernet.aidl", "io.nekohasekai.sagernet.bg", "io.nekohasekai.sagernet.bg.proto", "io.nekohasekai.sagernet.compose", "io.nekohasekai.sagernet.compose.theme", "io.nekohasekai.sagernet.database", "io.nekohasekai.sagernet.database.preference", "io.nekohasekai.sagernet.fmt", "io.nekohasekai.sagernet.fmt.anytls", "io.nekohasekai.sagernet.fmt.config", "io.nekohasekai.sagernet.fmt.direct", "io.nekohasekai.sagernet.fmt.gson", "io.nekohasekai.sagernet.fmt.http", "io.nekohasekai.sagernet.fmt.hysteria", "io.nekohasekai.sagernet.fmt.internal", "io.nekohasekai.sagernet.fmt.juicity", "io.nekohasekai.sagernet.fmt.mieru", "io.nekohasekai.sagernet.fmt.naive", "io.nekohasekai.sagernet.fmt.shadowquic", "io.nekohasekai.sagernet.fmt.shadowsocks", "io.nekohasekai.sagernet.fmt.shadowtls", "io.nekohasekai.sagernet.fmt.socks", "io.nekohasekai.sagernet.fmt.ssh", "io.nekohasekai.sagernet.fmt.trojan", "io.nekohasekai.sagernet.fmt.tuic", "io.nekohasekai.sagernet.fmt.v2ray", "io.nekohasekai.sagernet.fmt.wireguard", "io.nekohasekai.sagernet.group", "io.nekohasekai.sagernet.ktx", "io.nekohasekai.sagernet.plugin", "io.nekohasekai.sagernet.repository", "io.nekohasekai.sagernet.tasker", "io.nekohasekai.sagernet.ui", "io.nekohasekai.sagernet.ui.configuration", "io.nekohasekai.sagernet.ui.dashboard", "io.nekohasekai.sagernet.ui.profile", "io.nekohasekai.sagernet.ui.tools", "io.nekohasekai.sagernet.utils", "io.nekohasekai.sagernet.widget", "io.nekohasekai.sfa.utils"]}, "issue": {"number": 65, "url": "https://github.com/xchacha20-poly1305/husi/issues/65", "state": "closed", "title": "Crash when I click on About  Telegram update channel", "body": "### Version\n\n```text\n0.6.6\n```\n\n\n### Description\n\nCrash when I click on About  Telegram update channel.\r\n\r\n[husi Crash 5535574892870247350.log](https://github.com/xchacha20-poly1305/husi/files/14631240/husi.Crash.5535574892870247350.log)\r\n\n\n### Reproduction\n\n1. Open the drawer.\r\n2. Tap on About.\r\n3. Tap on Telegram update channel.\n\n### Logs\n\n_No response_\n\n### Integrity requirements\n\n- [X] I confirm that my problem is the bug of husi, but not the problem of my own network environment or my server.\n- [X] I confirm that I have provided the simplest configuration that can be used to reproduce the error I reported.\n- [X] I confirm that I have provided the complete configuration files and logs, rather than just providing parts I think are useful out of confidence in my own intelligence.", "logs": [{"name": "husi Crash 5535574892870247350.log", "url": "https://github.com/xchacha20-poly1305/husi/files/14631240/husi.Crash.5535574892870247350.log"}]}, "pull_request": [{"number": 46, "url": "https://github.com/xchacha20-poly1305/husi/pull/46", "diff_url": "https://github.com/xchacha20-poly1305/husi/pull/46.diff", "patch_url": "https://github.com/xchacha20-poly1305/husi/pull/46.patch", "title": "chore: bump com.jakewharton:process-phoenix from 2.1.2 to 2.2.0", "content": "Bumps [com.jakewharton:process-phoenix](https://github.com/JakeWharton/ProcessPhoenix) from 2.1.2 to 2.2.0.\n<details>\n<summary>Changelog</summary>\n<p><em>Sourced from <a href=\"https://github.com/JakeWharton/ProcessPhoenix/blob/trunk/CHANGELOG.md\">com.jakewharton:process-phoenix's changelog</a>.</em></p>\n<blockquote>\n<h2>Version 2.2.0 <em>(2024-02-26)</em></h2>\n<ul>\n<li>New: Support for launching the default Leanback intent on Android TV.</li>\n<li>Strict mode's unsafe intent policy is now automatically disabled before launching back into the main application.</li>\n</ul>\n</blockquote>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/JakeWharton/ProcessPhoenix/commit/f773df9a83c4b797821792aa4801e9bdd958cc8d\"><code>f773df9</code></a> Add properties to enable Central release</li>\n<li><a href=\"https://github.com/JakeWharton/ProcessPhoenix/commit/46b02ecb74a50822db869c0d2c737fa5920db654\"><code>46b02ec</code></a> Prepare version 2.2.0</li>\n<li><a href=\"https://github.com/JakeWharton/ProcessPhoenix/commit/6f982eb4408e0dcc67dbd58faa7ac33b54dfd773\"><code>6f982eb</code></a> Disable strict mode complaints on API 31+ (<a href=\"https://redirect.github.com/JakeWharton/ProcessPhoenix/issues/66\">#66</a>)</li>\n<li><a href=\"https://github.com/JakeWharton/ProcessPhoenix/commit/208d45e8eb2940916903c170726ad89068513fdd\"><code>208d45e</code></a> Ensure the leanback intent is started on Android TV (<a href=\"https://redirect.github.com/JakeWharton/ProcessPhoenix/issues/59\">#59</a>)</li>\n<li><a href=\"https://github.com/JakeWharton/ProcessPhoenix/commit/d039d2ab3a8f8c4a5bd2e9e3438520f7f0ef718d\"><code>d039d2a</code></a> Bump gradle/wrapper-validation-action from 2.0.0 to 2.0.1 (<a href=\"https://redirect.github.com/JakeWharton/ProcessPhoenix/issues/65\">#65</a>)</li>\n<li><a href=\"https://github.com/JakeWharton/ProcessPhoenix/commit/8de36e4297b46074e3f4bebd2e9124fe67f6565b\"><code>8de36e4</code></a> Fix command for publishing in build.yaml (<a href=\"https://redirect.github.com/JakeWharton/ProcessPhoenix/issues/64\">#64</a>)</li>\n<li><a href=\"https://github.com/JakeWharton/ProcessPhoenix/commit/db2d70fd242996277df7f2d42e15b3a9051c5941\"><code>db2d70f</code></a> Update to the latest Gradle, AGP (<a href=\"https://redirect.github.com/JakeWharton/ProcessPhoenix/issues/63\">#63</a>)</li>\n<li><a href=\"https://github.com/JakeWharton/ProcessPhoenix/commit/4deb69b22b9a36993f815ade15e06415632b8055\"><code>4deb69b</code></a> Merge pull request <a href=\"https://redirect.github.com/JakeWharton/ProcessPhoenix/issues/62\">#62</a> from JakeWharton/dependabot/github_actions/gradle/wrap...</li>\n<li><a href=\"https://github.com/JakeWharton/ProcessPhoenix/commit/7fcb9aff21110196c71e3945cdfbe23a7797050e\"><code>7fcb9af</code></a> Bump gradle/wrapper-validation-action from 1.1.0 to 2.0.0</li>\n<li><a href=\"https://github.com/JakeWharton/ProcessPhoenix/commit/c490ee8b5cd727c30558decb0e5380fbcb085de5\"><code>c490ee8</code></a> Merge pull request <a href=\"https://redirect.github.com/JakeWharton/ProcessPhoenix/issues/61\">#61</a> from JakeWharton/dependabot/github_actions/actions/set...</li>\n<li>Additional commits viewable in <a href=\"https://github.com/JakeWharton/ProcessPhoenix/compare/2.1.2...2.2.0\">compare view</a></li>\n</ul>\n</details>\n<br />\n\n\n[![Dependabot compatibility score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=com.jakewharton:process-phoenix&package-manager=gradle&previous-version=2.1.2&new-version=2.2.0)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[//]: # (dependabot-automerge-start)\n[//]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options</summary>\n<br />\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot show <dependency name> ignore conditions` will show all of the ignore conditions of the specified dependency\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\n\n\n</details>", "diff": "diff --git a/app/build.gradle.kts b/app/build.gradle.kts\nindex 165a4268c..dcae47cbe 100644\n--- a/app/build.gradle.kts\n+++ b/app/build.gradle.kts\n@@ -74,7 +74,7 @@ dependencies {\n \n     implementation(\"com.squareup.okhttp3:okhttp:5.0.0-alpha.12\")\n     implementation(\"com.github.daniel-stoneuk:material-about-library:3.2.0-rc01\")\n-    implementation(\"com.jakewharton:process-phoenix:2.1.2\")\n+    implementation(\"com.jakewharton:process-phoenix:2.2.0\")\n     implementation(\"com.esotericsoftware:kryo:5.6.0\")\n     implementation(\"com.google.guava:guava:33.0.0-android\")\n     implementation(\"org.ini4j:ini4j:0.5.4\")\n", "changes": [{"file": "app/build.gradle.kts", "module": "com.jakewharton.processphoenix.ProcessPhoenix", "range": [{"start": 77, "end": 78}]}]}]}
{"url": "https://github.com/kiwix/kiwix-android/issues/4000", "repo": {"url": "https://github.com/kiwix/kiwix-android", "name": "kiwix-android", "owner": "kiwix", "modules": ["custom", "eu.mhutti1.utils.storage", "org.kiwix.kiwixmobile", "org.kiwix.kiwixmobile.core", "org.kiwix.kiwixmobile.custom", "org.kiwix.kiwixmobile.deeplinks", "org.kiwix.kiwixmobile.di", "org.kiwix.kiwixmobile.download", "org.kiwix.kiwixmobile.error", "org.kiwix.kiwixmobile.help", "org.kiwix.kiwixmobile.initial", "org.kiwix.kiwixmobile.intro", "org.kiwix.kiwixmobile.language", "org.kiwix.kiwixmobile.localFileTransfer", "org.kiwix.kiwixmobile.localLibrary", "org.kiwix.kiwixmobile.main", "org.kiwix.kiwixmobile.migration", "org.kiwix.kiwixmobile.mimetype", "org.kiwix.kiwixmobile.nav", "org.kiwix.kiwixmobile.note", "org.kiwix.kiwixmobile.page", "org.kiwix.kiwixmobile.reader", "org.kiwix.kiwixmobile.roomDao", "org.kiwix.kiwixmobile.search", "org.kiwix.kiwixmobile.settings", "org.kiwix.kiwixmobile.shortcuts", "org.kiwix.kiwixmobile.splash", "org.kiwix.kiwixmobile.storage", "org.kiwix.kiwixmobile.testutils", "org.kiwix.kiwixmobile.ui", "org.kiwix.kiwixmobile.utils", "org.kiwix.kiwixmobile.webserver", "org.kiwix.kiwixmobile.widgets", "org.kiwix.kiwixmobile.zimManager", "org.kiwix.sharedFunctions", "org.kiwix.videowebview", "plugin"]}, "issue": {"number": 4000, "url": "https://github.com/kiwix/kiwix-android/issues/4000", "state": "closed", "title": "Medical wikimedia (mini) keeps crashing", "body": "At least this time the user provided a log. Should I ask for more info?\r\n\r\n[logs1726851491827.txt](https://github.com/user-attachments/files/17079847/logs1726851491827.txt)\r\n", "logs": [{"name": "logs1726851491827.txt", "url": "https://github.com/user-attachments/files/17079847/logs1726851491827.txt"}]}, "pull_request": [{"number": 4007, "url": "https://github.com/kiwix/kiwix-android/pull/4007", "diff_url": "https://github.com/kiwix/kiwix-android/pull/4007.diff", "patch_url": "https://github.com/kiwix/kiwix-android/pull/4007.patch", "title": "Fixed: Medical wikimedia (mini) keeps crashing.", "content": "Fixes #4000\r\n\r\n* This issue occurred when we tried to access ZIM files from the applications folder in the `zimFiles()` method. In this method, we add directories to a non-null list of files. However, when attempting to retrieve the list of files from the application directory, the SD card path was null due to the SD card being unmounted, which caused the application to crash.\r\n* To fix this, we have improved our `zimFiles()` and `obbFiles()` methods to return only existing, non-null directories. This ensures proper handling of file system detection, so if a directory is unavailable or returns null, these methods handle it appropriately.\r\n\r\n", "diff": "diff --git a/custom/src/main/java/org/kiwix/kiwixmobile/custom/main/CustomFileValidator.kt b/custom/src/main/java/org/kiwix/kiwixmobile/custom/main/CustomFileValidator.kt\nindex 288b616439..1785e98309 100644\n--- a/custom/src/main/java/org/kiwix/kiwixmobile/custom/main/CustomFileValidator.kt\n+++ b/custom/src/main/java/org/kiwix/kiwixmobile/custom/main/CustomFileValidator.kt\n@@ -23,6 +23,7 @@ import android.content.pm.PackageManager\n import android.content.res.AssetFileDescriptor\n import android.content.res.AssetManager\n import androidx.core.content.ContextCompat\n+import org.kiwix.kiwixmobile.core.extensions.isFileExist\n import org.kiwix.kiwixmobile.core.utils.files.Log\n import org.kiwix.kiwixmobile.custom.main.ValidationState.HasBothFiles\n import org.kiwix.kiwixmobile.custom.main.ValidationState.HasFile\n@@ -57,7 +58,7 @@ class CustomFileValidator @Inject constructor(private val context: Context) {\n   }\n \n   @Suppress(\"MagicNumber\")\n-  private fun getAssetFileDescriptorListFromPlayAssetDelivery(): List<AssetFileDescriptor> {\n+  fun getAssetFileDescriptorListFromPlayAssetDelivery(): List<AssetFileDescriptor> {\n     try {\n       val assetManager = context.createPackageContext(context.packageName, 0).assets\n       val assetFileDescriptorList: ArrayList<AssetFileDescriptor> = arrayListOf()\n@@ -94,28 +95,34 @@ class CustomFileValidator @Inject constructor(private val context: Context) {\n     return chunkFiles\n   }\n \n-  private fun obbFiles() = scanDirs(ContextCompat.getObbDirs(context), \"obb\")\n+  private fun obbFiles() =\n+    scanDirs(\n+      ContextCompat.getObbDirs(context).filterNotNull().filter(File::isFileExist).toTypedArray(),\n+      \"obb\"\n+    )\n \n   private fun zimFiles(): List<File> {\n     // Create a list to store the parent directories\n     val directoryList = mutableListOf<File>()\n \n     // Get the external files directories for the app\n-    ContextCompat.getExternalFilesDirs(context, null).forEach { dir ->\n-      // Check if the directory's parent is not null\n-      dir?.parent?.let { parentPath ->\n-        // Add the parent directory to the list, so we can scan all the files contained in the folder.\n-        // We are doing this because ContextCompat.getExternalFilesDirs(context, null) method returns the path to the\n-        // \"files\" folder, which is specific to the app's package name, both for internal and SD card storage.\n-        // By obtaining the parent directory, we can scan files from the app-specific directory itself.\n-        directoryList.add(File(parentPath))\n-      } ?: kotlin.run {\n-        // If the parent directory is null, it means the current directory is the target folder itself.\n-        // Add the current directory to the list, as it represents the app-specific directory for both internal\n-        // and SD card storage. This allows us to scan files directly from this directory.\n-        directoryList.add(dir)\n+    ContextCompat.getExternalFilesDirs(context, null).filterNotNull()\n+      .filter(File::isFileExist)\n+      .forEach { dir ->\n+        // Check if the directory's parent is not null\n+        dir.parent?.let { parentPath ->\n+          // Add the parent directory to the list, so we can scan all the files contained in the folder.\n+          // We are doing this because ContextCompat.getExternalFilesDirs(context, null) method returns the path to the\n+          // \"files\" folder, which is specific to the app's package name, both for internal and SD card storage.\n+          // By obtaining the parent directory, we can scan files from the app-specific directory itself.\n+          directoryList.add(File(parentPath))\n+        } ?: kotlin.run {\n+          // If the parent directory is null, it means the current directory is the target folder itself.\n+          // Add the current directory to the list, as it represents the app-specific directory for both internal\n+          // and SD card storage. This allows us to scan files directly from this directory.\n+          directoryList.add(dir)\n+        }\n       }\n-    }\n     return scanDirs(directoryList.toTypedArray(), \"zim\")\n   }\n \ndiff --git a/custom/src/test/java/org/kiwix/kiwixmobile/custom/download/main/CustomFileValidatorTest.kt b/custom/src/test/java/org/kiwix/kiwixmobile/custom/download/main/CustomFileValidatorTest.kt\nnew file mode 100644\nindex 0000000000..7f0cb6ffae\n--- /dev/null\n+++ b/custom/src/test/java/org/kiwix/kiwixmobile/custom/download/main/CustomFileValidatorTest.kt\n@@ -0,0 +1,198 @@\n+/*\n+ * Kiwix Android\n+ * Copyright (c) 2024 Kiwix <android.kiwix.org>\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with this program. If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ */\n+\n+package org.kiwix.kiwixmobile.custom.download.main\n+\n+import android.content.Context\n+import android.content.pm.PackageManager\n+import android.content.res.AssetFileDescriptor\n+import android.content.res.AssetManager\n+import androidx.core.content.ContextCompat\n+import io.mockk.every\n+import io.mockk.mockk\n+import org.junit.jupiter.api.Assertions.assertEquals\n+import org.junit.jupiter.api.Assertions.assertTrue\n+import org.junit.jupiter.api.Assertions.fail\n+import org.junit.jupiter.api.BeforeEach\n+import org.junit.jupiter.api.Test\n+import org.kiwix.kiwixmobile.custom.main.CustomFileValidator\n+import org.kiwix.kiwixmobile.custom.main.ValidationState\n+import java.io.File\n+\n+class CustomFileValidatorTest {\n+\n+  private lateinit var context: Context\n+  private lateinit var customFileValidator: CustomFileValidator\n+  private lateinit var assetManager: AssetManager\n+\n+  @BeforeEach\n+  fun setUp() {\n+    context = mockk(relaxed = true)\n+    assetManager = mockk(relaxed = true)\n+    customFileValidator = CustomFileValidator(context)\n+  }\n+\n+  @Test\n+  fun `validate should call onFilesFound when both OBB and ZIM files are found`() {\n+    val obbFile = mockk<File>()\n+    val zimFile = mockk<File>()\n+    mockZimFiles(arrayOf(obbFile), \"obb\")\n+    mockZimFiles(arrayOf(zimFile), \"zim\")\n+\n+    customFileValidator.validate(\n+      onFilesFound = {\n+        assertTrue(it is ValidationState.HasBothFiles)\n+        assertEquals(obbFile, (it as ValidationState.HasBothFiles).obbFile)\n+        assertEquals(zimFile, it.zimFile)\n+      },\n+      onNoFilesFound = { fail(\"Should not call onNoFilesFound\") }\n+    )\n+  }\n+\n+  @Test\n+  fun `validate should call onFilesFound when only OBB file is found`() {\n+    val obbFile = mockk<File>()\n+    mockZimFiles(arrayOf(obbFile), \"obb\")\n+    mockZimFiles(arrayOf(), \"zim\")\n+\n+    customFileValidator.validate(\n+      onFilesFound = {\n+        assertTrue(it is ValidationState.HasFile)\n+        assertEquals(obbFile, (it as ValidationState.HasFile).file)\n+      },\n+      onNoFilesFound = { fail(\"Should not call onNoFilesFound\") }\n+    )\n+  }\n+\n+  @Test\n+  fun `validate should call onFilesFound when only ZIM file is found`() {\n+    val zimFile = mockk<File>()\n+    mockZimFiles(arrayOf(), \"obb\")\n+    mockZimFiles(arrayOf(zimFile), \"zim\")\n+\n+    customFileValidator.validate(\n+      onFilesFound = {\n+        assertTrue(it is ValidationState.HasFile)\n+        assertEquals(zimFile, (it as ValidationState.HasFile).file)\n+      },\n+      onNoFilesFound = { fail(\"Should not call onNoFilesFound\") }\n+    )\n+  }\n+\n+  @Test\n+  fun `validate should call onNoFilesFound when no OBB or ZIM files are found`() {\n+    mockZimFiles(arrayOf(), extension = \"zim\")\n+    mockZimFiles(arrayOf(), extension = \"obb\")\n+\n+    customFileValidator.validate(\n+      onFilesFound = { fail(\"Should not call onFilesFound\") },\n+      onNoFilesFound = { }\n+    )\n+  }\n+\n+  @Test\n+  fun `validate should call onNoFilesFound when directories are null`() {\n+    mockZimFiles(null, \"zim\")\n+    mockZimFiles(null, \"obb\")\n+\n+    customFileValidator.validate(\n+      onFilesFound = { fail(\"Should not call onFilesFound\") },\n+      onNoFilesFound = { }\n+    )\n+  }\n+\n+  @Test\n+  fun `validate should call onNoFilesFound when no matching files are found`() {\n+    val textFile = mockk<File>()\n+    mockZimFiles(arrayOf(textFile), \"txt\")\n+\n+    customFileValidator.validate(\n+      onFilesFound = { fail(\"Should not call onFilesFound\") },\n+      onNoFilesFound = { }\n+    )\n+  }\n+\n+  @Test\n+  fun `validate should call onFilesFound for case insensitive file extensions`() {\n+    val zimFile = mockk<File>()\n+    mockZimFiles(arrayOf(zimFile), \"ZIM\")\n+\n+    customFileValidator.validate(\n+      onFilesFound = {\n+        fail(\"Should not call onFilesFound\")\n+      },\n+      onNoFilesFound = {}\n+    )\n+  }\n+\n+  @Test\n+  fun `getAssetFileDescriptorListFromPlayAssetDelivery returns empty list when exception occurs`() {\n+    every {\n+      context.createPackageContext(\n+        any(),\n+        any()\n+      ).assets\n+    } throws PackageManager.NameNotFoundException()\n+\n+    val assetList = customFileValidator.getAssetFileDescriptorListFromPlayAssetDelivery()\n+\n+    assertTrue(assetList.isEmpty())\n+  }\n+\n+  @Test\n+  fun `getAssetFileDescriptorListFromPlayAssetDelivery returns list of asset descriptors`() {\n+    val descriptor = mockk<AssetFileDescriptor>()\n+    every { context.createPackageContext(any(), any()).assets } returns assetManager\n+    every { assetManager.openFd(any()) } returns descriptor\n+    every { assetManager.list(\"\") } returns arrayOf(\"chunk1.zim\", \"chunk2.zim\")\n+\n+    val assetList = customFileValidator.getAssetFileDescriptorListFromPlayAssetDelivery()\n+\n+    assertEquals(2, assetList.size)\n+    assertEquals(descriptor, assetList[0])\n+  }\n+\n+  private fun mockZimFiles(\n+    zimFilesArray: Array<File?>?,\n+    extension: String\n+  ) {\n+    zimFilesArray?.forEach {\n+      it?.let {\n+        every { it.exists() } returns true\n+        every { it.isFile } returns true\n+        every { it.extension } returns extension\n+        every { it.isDirectory } returns false\n+        every { it.name } returns \"sample.$extension\"\n+      }\n+    }\n+    val storageDirectory = mockk<File>()\n+    every { storageDirectory.exists() } returns true\n+    every { storageDirectory.isDirectory } returns true\n+    every { storageDirectory.extension } returns \"\"\n+    every { storageDirectory.parent } returns null\n+    every { storageDirectory.listFiles() } returns zimFilesArray\n+\n+    if (extension == \"zim\") {\n+      every {\n+        ContextCompat.getExternalFilesDirs(context, null)\n+      } returns arrayOf(storageDirectory)\n+    } else {\n+      every { ContextCompat.getObbDirs(context) } returns arrayOf(storageDirectory)\n+    }\n+  }\n+}\n", "changes": [{"file": "custom/src/main/java/org/kiwix/kiwixmobile/custom/main/CustomFileValidator.kt", "module": "org.kiwix.kiwixmobile.custom.main.CustomFileValidator", "range": [{"start": 26, "end": 26}, {"start": 60, "end": 61}, {"start": 97, "end": 98}, {"start": 104, "end": 117}, {"start": 118, "end": 118}]}]}]}
{"url": "https://github.com/kiwix/kiwix-android/issues/3605", "repo": {"url": "https://github.com/kiwix/kiwix-android", "name": "kiwix-android", "owner": "kiwix", "modules": ["custom", "eu.mhutti1.utils.storage", "org.kiwix.kiwixmobile", "org.kiwix.kiwixmobile.core", "org.kiwix.kiwixmobile.custom", "org.kiwix.kiwixmobile.deeplinks", "org.kiwix.kiwixmobile.di", "org.kiwix.kiwixmobile.download", "org.kiwix.kiwixmobile.error", "org.kiwix.kiwixmobile.help", "org.kiwix.kiwixmobile.initial", "org.kiwix.kiwixmobile.intro", "org.kiwix.kiwixmobile.language", "org.kiwix.kiwixmobile.localFileTransfer", "org.kiwix.kiwixmobile.localLibrary", "org.kiwix.kiwixmobile.main", "org.kiwix.kiwixmobile.migration", "org.kiwix.kiwixmobile.mimetype", "org.kiwix.kiwixmobile.nav", "org.kiwix.kiwixmobile.note", "org.kiwix.kiwixmobile.page", "org.kiwix.kiwixmobile.reader", "org.kiwix.kiwixmobile.roomDao", "org.kiwix.kiwixmobile.search", "org.kiwix.kiwixmobile.settings", "org.kiwix.kiwixmobile.shortcuts", "org.kiwix.kiwixmobile.splash", "org.kiwix.kiwixmobile.storage", "org.kiwix.kiwixmobile.testutils", "org.kiwix.kiwixmobile.ui", "org.kiwix.kiwixmobile.utils", "org.kiwix.kiwixmobile.webserver", "org.kiwix.kiwixmobile.widgets", "org.kiwix.kiwixmobile.zimManager", "org.kiwix.sharedFunctions", "org.kiwix.videowebview", "plugin"]}, "issue": {"number": 3605, "url": "https://github.com/kiwix/kiwix-android/issues/3605", "state": "closed", "title": "v. 3.8.1+3.9.0: Error on opening a split zim file on external storage", "body": "I'm running Kiwix v. 3.8.1 build 7230801 on a BLU G90 phone running Android 10.\r\n\r\nI have a Wikivoyage zim file, in the Android/data/org.kiwix.kiwixmobile/files/Kiwix folder of the phone's internal storage, and a split Wikipedia zim file (.zimaa to .zimai) in the top level of the SD card external storage. Both are shown in the app's Library, and both used to work fine.\r\n\r\nToday I noticed that opening the Wikipedia file results in the error \r\n\"The selected file is not a valid zim file\". I get the same error if I try to add the .zimaa file manually to the library.\r\nThe (unsplit) Wikivoyage zim file continues to work fine.\r\n\r\nLog file is attached.\r\n[kiwixlogs.txt](https://github.com/kiwix/kiwix-android/files/13689784/kiwixlogs.txt)\r\n", "logs": [{"name": "kiwixlogs.txt", "url": "https://github.com/kiwix/kiwix-android/files/13689784/kiwixlogs.txt"}]}, "pull_request": [{"number": 3803, "url": "https://github.com/kiwix/kiwix-android/pull/3803", "diff_url": "https://github.com/kiwix/kiwix-android/pull/3803.diff", "patch_url": "https://github.com/kiwix/kiwix-android/pull/3803.patch", "title": "Fixed: Error on opening a split zim file on external storage.", "content": "Fixes #3605 \r\n\r\n * Added test cases for testing whether the ZimFileReader can open the splitted zim file or not.\r\n * Capturing the better exception when getting the mediaCount and `articleCount` because it was throwing `java.lang.Exception` with splitted zim file when the zim file is corrupted. If there is any zim file is corrupted and libzim throws this exception then our UI will not show the other zim file on `LocalLibraryScreen` due to the getting zim files process being crashed.", "diff": "diff --git a/app/src/androidTest/java/org/kiwix/kiwixmobile/page/history/NavigationHistoryRobot.kt b/app/src/androidTest/java/org/kiwix/kiwixmobile/page/history/NavigationHistoryRobot.kt\nindex 3880a150e4..8ea8ac86b4 100644\n--- a/app/src/androidTest/java/org/kiwix/kiwixmobile/page/history/NavigationHistoryRobot.kt\n+++ b/app/src/androidTest/java/org/kiwix/kiwixmobile/page/history/NavigationHistoryRobot.kt\n@@ -70,6 +70,17 @@ class NavigationHistoryRobot : BaseRobot() {\n       .perform(webClick())\n   }\n \n+  fun assertZimFileLoaded() {\n+    pauseForBetterTestPerformance()\n+    onWebView()\n+      .withElement(\n+        findElement(\n+          Locator.XPATH,\n+          \"//*[contains(text(), 'Android_(operating_system)')]\"\n+        )\n+      )\n+  }\n+\n   fun longClickOnBackwardButton() {\n     pauseForBetterTestPerformance()\n     longClickOn(ViewId(R.id.bottom_toolbar_arrow_back))\ndiff --git a/app/src/androidTest/java/org/kiwix/kiwixmobile/reader/ZimFileReaderWithSplittedZimFileTest.kt b/app/src/androidTest/java/org/kiwix/kiwixmobile/reader/ZimFileReaderWithSplittedZimFileTest.kt\nnew file mode 100644\nindex 0000000000..e7dab4544a\n--- /dev/null\n+++ b/app/src/androidTest/java/org/kiwix/kiwixmobile/reader/ZimFileReaderWithSplittedZimFileTest.kt\n@@ -0,0 +1,173 @@\n+/*\n+ * Kiwix Android\n+ * Copyright (c) 2024 Kiwix <android.kiwix.org>\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with this program. If not, see <http://www.gnu.org/licenses/>.\n+ *\n+ */\n+\n+package org.kiwix.kiwixmobile.reader\n+\n+import androidx.core.content.ContextCompat\n+import androidx.core.content.edit\n+import androidx.core.net.toUri\n+import androidx.lifecycle.Lifecycle\n+import androidx.preference.PreferenceManager\n+import androidx.test.core.app.ActivityScenario\n+import androidx.test.internal.runner.junit4.statement.UiThreadStatement\n+import androidx.test.platform.app.InstrumentationRegistry\n+import androidx.test.uiautomator.UiDevice\n+import org.junit.Assert\n+import org.junit.Before\n+import org.junit.Rule\n+import org.junit.Test\n+import org.junit.jupiter.api.fail\n+import org.kiwix.kiwixmobile.BaseActivityTest\n+import org.kiwix.kiwixmobile.R\n+import org.kiwix.kiwixmobile.core.NightModeConfig\n+import org.kiwix.kiwixmobile.core.reader.ZimFileReader\n+import org.kiwix.kiwixmobile.core.utils.SharedPreferenceUtil\n+import org.kiwix.kiwixmobile.main.KiwixMainActivity\n+import org.kiwix.kiwixmobile.nav.destination.library.LocalLibraryFragmentDirections\n+import org.kiwix.kiwixmobile.page.history.navigationHistory\n+import org.kiwix.kiwixmobile.testutils.RetryRule\n+import org.kiwix.kiwixmobile.testutils.TestUtils\n+import org.kiwix.libzim.Archive\n+import org.kiwix.libzim.SuggestionSearcher\n+import java.io.File\n+import java.io.FileOutputStream\n+import java.io.OutputStream\n+\n+class ZimFileReaderWithSplittedZimFileTest : BaseActivityTest() {\n+\n+  @Rule\n+  @JvmField\n+  var retryRule = RetryRule()\n+\n+  private lateinit var kiwixMainActivity: KiwixMainActivity\n+\n+  @Before\n+  override fun waitForIdle() {\n+    UiDevice.getInstance(InstrumentationRegistry.getInstrumentation()).apply {\n+      if (TestUtils.isSystemUINotRespondingDialogVisible(this)) {\n+        TestUtils.closeSystemDialogs(context, this)\n+      }\n+      waitForIdle()\n+    }\n+    PreferenceManager.getDefaultSharedPreferences(context).edit {\n+      putBoolean(SharedPreferenceUtil.PREF_SHOW_INTRO, false)\n+      putBoolean(SharedPreferenceUtil.PREF_WIFI_ONLY, false)\n+      putBoolean(SharedPreferenceUtil.PREF_PLAY_STORE_RESTRICTION, false)\n+    }\n+    activityScenario = ActivityScenario.launch(KiwixMainActivity::class.java).apply {\n+      moveToState(Lifecycle.State.RESUMED)\n+    }\n+  }\n+\n+  @Test\n+  fun testZimFileReaderWithSplittedZimFile() {\n+    activityScenario.onActivity {\n+      kiwixMainActivity = it\n+      kiwixMainActivity.navigate(R.id.libraryFragment)\n+    }\n+    createAndGetSplitedZimFile()?.let {\n+      UiThreadStatement.runOnUiThread {\n+        kiwixMainActivity.navigate(\n+          LocalLibraryFragmentDirections.actionNavigationLibraryToNavigationReader()\n+            .apply { zimFileUri = it.toUri().toString() }\n+        )\n+      }\n+\n+      navigationHistory {\n+        checkZimFileLoadedSuccessful(R.id.readerFragment)\n+        assertZimFileLoaded() // check if the zim file successfully loaded\n+        clickOnAndroidArticle()\n+      }\n+    } ?: kotlin.run {\n+      // error in creating the zim file chunk\n+      fail(\"Couldn't create the zim file chunk\")\n+    }\n+  }\n+\n+  @Test\n+  fun testWithExtraZeroSizeFile() {\n+    createAndGetSplitedZimFile(true)?.let { zimFile ->\n+      // test the articleCount and mediaCount of this zim file.\n+      val archive = Archive(zimFile.canonicalPath)\n+      val zimFileReader = ZimFileReader(\n+        zimFile,\n+        null,\n+        null,\n+        archive,\n+        NightModeConfig(SharedPreferenceUtil(context), context),\n+        SuggestionSearcher(archive)\n+      )\n+      Assert.assertEquals(zimFileReader.mediaCount, 16)\n+      Assert.assertEquals(zimFileReader.articleCount, 4)\n+    } ?: kotlin.run {\n+      // error in creating the zim file chunk\n+      fail(\"Couldn't create the zim file chunk\")\n+    }\n+  }\n+\n+  private fun createAndGetSplitedZimFile(shouldCreateExtraZeroSizeFile: Boolean = false): File? {\n+    val loadFileStream =\n+      EncodedUrlTest::class.java.classLoader.getResourceAsStream(\"testzim.zim\")\n+    val storageDir = ContextCompat.getExternalFilesDirs(context, null)[0]\n+\n+    // Delete existing parts if they exist\n+    (1..3)\n+      .asSequence()\n+      .map { File(storageDir, \"testzim.zima${('a' + it - 1).toChar()}\") }\n+      .filter(File::exists)\n+      .forEach(File::delete)\n+\n+    // Calculate the size of each part\n+    val totalFileSize = loadFileStream.available().toLong()\n+    val partSize = totalFileSize / 3 // convert into 3 parts\n+    var partNumber = 1\n+\n+    // Read the input stream in chunks and write to smaller files\n+    loadFileStream.use { inputStream ->\n+      var bytesRead: Long = 0\n+      var currentPartSize: Long = 0\n+      val buffer = ByteArray(1024)\n+      var length: Int\n+      var outputStream: OutputStream? = null\n+\n+      while (inputStream.read(buffer).also { length = it } > 0) {\n+        if (currentPartSize >= partSize || bytesRead == 0L) {\n+          outputStream?.close() // Close the previous outputStream if any open.\n+          val partFile = File(storageDir, \"testzim.zima${('a' + partNumber - 1).toChar()}\")\n+          outputStream = FileOutputStream(partFile)\n+          partNumber++\n+          currentPartSize = 0\n+        }\n+\n+        outputStream?.write(buffer, 0, length)\n+\n+        bytesRead += length\n+        currentPartSize += length\n+      }\n+      outputStream?.close()\n+    }\n+    if (shouldCreateExtraZeroSizeFile) {\n+      File(storageDir, \"testzim.zimad\").apply {\n+        if (exists()) delete() // delete if already exist.\n+        createNewFile() // create new zero size file.\n+      }\n+    }\n+    val splittedZimFile = File(storageDir, \"testzim.zimaa\")\n+    return if (splittedZimFile.exists()) splittedZimFile else null\n+  }\n+}\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/reader/ZimFileReader.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/reader/ZimFileReader.kt\nindex c4b6ae3c59..509e0607c5 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/reader/ZimFileReader.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/reader/ZimFileReader.kt\n@@ -157,18 +157,26 @@ class ZimFileReader constructor(\n \n   val tags: String\n     get() = getSafeMetaData(\"Tags\", \"\")\n-  private val mediaCount: Int?\n+  val mediaCount: Int?\n     get() = try {\n       jniKiwixReader.mediaCount\n-    } catch (unsatisfiedLinkError: UnsatisfiedLinkError) {\n-      Log.e(TAG, \"Unable to find the media count $unsatisfiedLinkError\")\n+    }\n+    // Catch all exceptions to prevent the rendering process of other zim files from aborting.\n+    // If the zim file is split with zim-tool,\n+    // refer to https://github.com/kiwix/kiwix-android/issues/3827.\n+    catch (ignore: Exception) {\n+      Log.e(TAG, \"Unable to find the media count $ignore\")\n       null\n     }\n-  private val articleCount: Int?\n+  val articleCount: Int?\n     get() = try {\n       jniKiwixReader.articleCount\n-    } catch (unsatisfiedLinkError: UnsatisfiedLinkError) {\n-      Log.e(TAG, \"Unable to find the article count $unsatisfiedLinkError\")\n+    }\n+    // Catch all exceptions to prevent the rendering process of other zim files from aborting.\n+    // If the zim file is split with zim-tool,\n+    // refer to https://github.com/kiwix/kiwix-android/issues/3827.\n+    catch (ignore: Exception) {\n+      Log.e(TAG, \"Unable to find the article count $ignore\")\n       null\n     }\n \n", "changes": [{"file": "core/src/main/java/org/kiwix/kiwixmobile/core/reader/ZimFileReader.kt", "module": "org.kiwix.kiwixmobile.core.reader.ZimFileReader", "range": [{"start": 160, "end": 161}, {"start": 163, "end": 165}, {"start": 167, "end": 168}, {"start": 170, "end": 172}]}]}]}
{"url": "https://github.com/kiwix/kiwix-android/issues/3515", "repo": {"url": "https://github.com/kiwix/kiwix-android", "name": "kiwix-android", "owner": "kiwix", "modules": ["custom", "eu.mhutti1.utils.storage", "org.kiwix.kiwixmobile", "org.kiwix.kiwixmobile.core", "org.kiwix.kiwixmobile.custom", "org.kiwix.kiwixmobile.deeplinks", "org.kiwix.kiwixmobile.di", "org.kiwix.kiwixmobile.download", "org.kiwix.kiwixmobile.error", "org.kiwix.kiwixmobile.help", "org.kiwix.kiwixmobile.initial", "org.kiwix.kiwixmobile.intro", "org.kiwix.kiwixmobile.language", "org.kiwix.kiwixmobile.localFileTransfer", "org.kiwix.kiwixmobile.localLibrary", "org.kiwix.kiwixmobile.main", "org.kiwix.kiwixmobile.migration", "org.kiwix.kiwixmobile.mimetype", "org.kiwix.kiwixmobile.nav", "org.kiwix.kiwixmobile.note", "org.kiwix.kiwixmobile.page", "org.kiwix.kiwixmobile.reader", "org.kiwix.kiwixmobile.roomDao", "org.kiwix.kiwixmobile.search", "org.kiwix.kiwixmobile.settings", "org.kiwix.kiwixmobile.shortcuts", "org.kiwix.kiwixmobile.splash", "org.kiwix.kiwixmobile.storage", "org.kiwix.kiwixmobile.testutils", "org.kiwix.kiwixmobile.ui", "org.kiwix.kiwixmobile.utils", "org.kiwix.kiwixmobile.webserver", "org.kiwix.kiwixmobile.widgets", "org.kiwix.kiwixmobile.zimManager", "org.kiwix.sharedFunctions", "org.kiwix.videowebview", "plugin"]}, "issue": {"number": 3515, "url": "https://github.com/kiwix/kiwix-android/issues/3515", "state": "closed", "title": "Cannot open ZIM files from phone storage", "body": "I cannot open ZIMs which have not been downloaded from the Kiwix app.\r\n\r\nKiwix Android 3.7.1 Build 7230701 (2023-10-26 nightly)\r\n\r\nZIMs downloaded by the app (and hence placed in the app data folder where app obviously has proper permissions) are opening well.\r\n\r\nZIMs downloaded by something else (Firefox in current test, but I'm sure it does not matters) and not placed in this folder (placed in Download folder in my test) do not open with the error \"Impossible de lire ce fichier ZIM\" (in French which is expected on my phone).\r\n\r\nMaybe a permission issue to access storage?\r\n\r\nProbably a close duplicate of #1447 (not exactly the same, there is probably no file handler issue, but still a permission problem).\r\n\r\nLogs:\r\n[logs1697787018926.txt](https://github.com/kiwix/libkiwix/files/13175333/logs1697787018926.txt)\r\n\r\n\r\nSteps to reproduce:\r\n- download a ZIM from the internet from your browser (e.g. https://library.kiwix.org/ or https://dev.library.kiwix.org/)\r\n- open Kiwix app\r\n- go to the Catalog\r\n- click the \"+\" sign in the bottom right corner to add a local ZIM\r\n- select the ZIM you just downloaded\r\n- et voil", "logs": [{"name": "logs1697787018926.txt", "url": "https://github.com/kiwix/libkiwix/files/13175333/logs1697787018926.txt"}]}, "pull_request": [{"number": 3518, "url": "https://github.com/kiwix/kiwix-android/pull/3518", "diff_url": "https://github.com/kiwix/kiwix-android/pull/3518.diff", "patch_url": "https://github.com/kiwix/kiwix-android/pull/3518.patch", "title": "Fixed, can not open ZIM files from phone storage via the file picker in Android 13.", "content": "Fixes #3515\r\n* Fixed, can not open ZIM files from phone storage via the file picker in Android 13.\r\n* Improved the permission request scenario for 'MANAGE_EXTERNAL_STORAGE' in Android 13. In the non-play store variant, we were not prompting users to grant this permission, and they were unaware that it was necessary to access the ZIM files in their storage. To resolve this issue, we now request this permission.\r\n\r\n**Issue**\r\n\r\nhttps://github.com/kiwix/kiwix-android/assets/34593983/2b428621-859e-41b5-b58b-31dec81c89ae\r\n\r\n**Fix**\r\n\r\nhttps://github.com/kiwix/kiwix-android/assets/34593983/dea7750d-1181-4bae-ae42-cc9fbcb932bf\r\n\r\n", "diff": "diff --git a/app/detekt_baseline.xml b/app/detekt_baseline.xml\nindex 22d856fb2d..db84623e8a 100644\n--- a/app/detekt_baseline.xml\n+++ b/app/detekt_baseline.xml\n@@ -12,7 +12,7 @@\n     <ID>MagicNumber:ZimManageViewModel.kt$ZimManageViewModel$5</ID>\n     <ID>MagicNumber:ZimManageViewModel.kt$ZimManageViewModel$500</ID>\n     <ID>MagicNumber:LocalFileTransferFragment.kt$LocalFileTransferFragment$500</ID>\n-    <ID>NestedBlockDepth:LocalLibraryFragment.kt$LocalLibraryFragment$private fun checkPermissions()</ID>\n+    <ID>NestedBlockDepth:LocalLibraryFragment.kt$LocalLibraryFragment$private fun checkManageExternalStoragePermission()</ID>\n     <ID>NestedBlockDepth:PeerGroupHandshake.kt$PeerGroupHandshake$private fun readHandshakeAndExchangeMetaData(): InetAddress?</ID>\n     <ID>NestedBlockDepth:ReceiverHandShake.kt$ReceiverHandShake$override fun exchangeFileTransferMetadata(inputStream: InputStream, outputStream: OutputStream)</ID>\n     <ID>PackageNaming:AvailableSpaceCalculator.kt$package\ndiff --git a/app/src/main/java/org/kiwix/kiwixmobile/nav/destination/library/LocalLibraryFragment.kt b/app/src/main/java/org/kiwix/kiwixmobile/nav/destination/library/LocalLibraryFragment.kt\nindex d0ca9e4162..3782bc6ae3 100644\n--- a/app/src/main/java/org/kiwix/kiwixmobile/nav/destination/library/LocalLibraryFragment.kt\n+++ b/app/src/main/java/org/kiwix/kiwixmobile/nav/destination/library/LocalLibraryFragment.kt\n@@ -430,33 +430,37 @@ class LocalLibraryFragment : BaseFragment() {\n           )\n         )\n       } else {\n-        requestFileSystemCheck()\n+        checkManageExternalStoragePermission()\n       }\n     } else {\n-      if (sharedPreferenceUtil.isPlayStoreBuild) {\n-        requestFileSystemCheck()\n-      } else {\n-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.R) {\n-          if (Environment.isExternalStorageManager()) {\n-            // We already have permission!!\n-            requestFileSystemCheck()\n-          } else {\n-            if (sharedPreferenceUtil.manageExternalFilesPermissionDialog) {\n-              // We should only ask for first time, If the users wants to revoke settings\n-              // then they can directly toggle this feature from settings screen\n-              sharedPreferenceUtil.manageExternalFilesPermissionDialog = false\n-              // Show Dialog and  Go to settings to give permission\n-              dialogShower.show(\n-                KiwixDialog.ManageExternalFilesPermissionDialog,\n-                {\n-                  this.activity?.let(FragmentActivity::navigateToSettings)\n-                }\n-              )\n-            }\n-          }\n-        } else {\n+      checkManageExternalStoragePermission()\n+    }\n+  }\n+\n+  private fun checkManageExternalStoragePermission() {\n+    if (sharedPreferenceUtil.isPlayStoreBuild) {\n+      requestFileSystemCheck()\n+    } else {\n+      if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.R) {\n+        if (Environment.isExternalStorageManager()) {\n+          // We already have permission!!\n           requestFileSystemCheck()\n+        } else {\n+          if (sharedPreferenceUtil.manageExternalFilesPermissionDialog) {\n+            // We should only ask for first time, If the users wants to revoke settings\n+            // then they can directly toggle this feature from settings screen\n+            sharedPreferenceUtil.manageExternalFilesPermissionDialog = false\n+            // Show Dialog and  Go to settings to give permission\n+            dialogShower.show(\n+              KiwixDialog.ManageExternalFilesPermissionDialog,\n+              {\n+                this.activity?.let(FragmentActivity::navigateToSettings)\n+              }\n+            )\n+          }\n         }\n+      } else {\n+        requestFileSystemCheck()\n       }\n     }\n   }\n", "changes": [{"file": "app/src/main/java/org/kiwix/kiwixmobile/nav/destination/library/LocalLibraryFragment.kt", "module": "org.kiwix.kiwixmobile.nav.destination.library.LocalLibraryFragment", "range": [{"start": 433, "end": 434}, {"start": 436, "end": 458}, {"start": 459, "end": 459}, {"start": 460, "end": 460}]}]}]}
{"url": "https://github.com/kiwix/kiwix-android/issues/3508", "repo": {"url": "https://github.com/kiwix/kiwix-android", "name": "kiwix-android", "owner": "kiwix", "modules": ["custom", "eu.mhutti1.utils.storage", "org.kiwix.kiwixmobile", "org.kiwix.kiwixmobile.core", "org.kiwix.kiwixmobile.custom", "org.kiwix.kiwixmobile.deeplinks", "org.kiwix.kiwixmobile.di", "org.kiwix.kiwixmobile.download", "org.kiwix.kiwixmobile.error", "org.kiwix.kiwixmobile.help", "org.kiwix.kiwixmobile.initial", "org.kiwix.kiwixmobile.intro", "org.kiwix.kiwixmobile.language", "org.kiwix.kiwixmobile.localFileTransfer", "org.kiwix.kiwixmobile.localLibrary", "org.kiwix.kiwixmobile.main", "org.kiwix.kiwixmobile.migration", "org.kiwix.kiwixmobile.mimetype", "org.kiwix.kiwixmobile.nav", "org.kiwix.kiwixmobile.note", "org.kiwix.kiwixmobile.page", "org.kiwix.kiwixmobile.reader", "org.kiwix.kiwixmobile.roomDao", "org.kiwix.kiwixmobile.search", "org.kiwix.kiwixmobile.settings", "org.kiwix.kiwixmobile.shortcuts", "org.kiwix.kiwixmobile.splash", "org.kiwix.kiwixmobile.storage", "org.kiwix.kiwixmobile.testutils", "org.kiwix.kiwixmobile.ui", "org.kiwix.kiwixmobile.utils", "org.kiwix.kiwixmobile.webserver", "org.kiwix.kiwixmobile.widgets", "org.kiwix.kiwixmobile.zimManager", "org.kiwix.sharedFunctions", "org.kiwix.videowebview", "plugin"]}, "issue": {"number": 3508, "url": "https://github.com/kiwix/kiwix-android/issues/3508", "state": "closed", "title": "DWDS app is very slow when opening a search result", "body": "When I search a term in DWDS app, search is very fast to provide results live.\r\n\r\nBut when I click on a result to open the corresponding page, it takes about 2 secs for the app to close the search results and open the page.\r\n\r\nI do not experience the same latency when navigating from one page to another one inside the ZIM via links present in the pages.\r\n\r\nLogs:\r\n[logs1697785830332.txt](https://github.com/kiwix/kiwix-android-custom/files/13051033/logs1697785830332.txt)\r\n\r\n", "logs": [{"name": "logs1697785830332.txt", "url": "https://github.com/kiwix/kiwix-android-custom/files/13051033/logs1697785830332.txt"}]}, "pull_request": [{"number": 3514, "url": "https://github.com/kiwix/kiwix-android/pull/3514", "diff_url": "https://github.com/kiwix/kiwix-android/pull/3514.diff", "patch_url": "https://github.com/kiwix/kiwix-android/pull/3514.patch", "title": "Fixed, the DWDS app is very slow when opening a search result.", "content": "Fixes #3508 \r\n\r\n* Now, `libkiwix` provides the `pageUrl` along with the `pageTitle` (searchTitle). Previously, we were not using this `pageUrl` provided by `libkiwix`. Instead, we were making another request for the `pageUrl` based on the `pageTitle`, which was slowing down the process. We have now started directly using the `pageUrl` provided by `libkiwix` during the search. This change has made the process much more efficient and faster.\r\n* To ensure the previously saved searches still work as expected, we have implemented a condition.\r\n* We have added a new column in RecentSearchEntity for saving the `pageUrl` that we will use when the user clicks on the recentSearchHistory.\r\n* Previously, we were saving the 'recentSearches' in ObjectBox, and then we were opening the 'searchedPage,' which slowed down the displaying of the results for the user. To address this issue, we are now saving 'recentSearches' in the background, ensuring that it will not impact the end user.\r\n* While testing I discovered an issue since we are now directly using the URLs provided by the 'searchSuggestion,' and those URLs are already decoded, our 'URLDecoder.decode()' method will fail to decode URLs containing '%' symbols, as they are already decoded, for example, 'https://kiwix.app/A/FT%.' To resolve this issue, we have modified our 'decodeUrl' extension function to return the same URL if it is already decoded.\r\n\r\n```\r\nCould not get Item for url = https://kiwix.app/A/FT% \r\noriginal exception = java.lang.IllegalArgumentException: URLDecoder: Incomplete trailing escape (%) pattern\r\nCould not get Item for url = https://kiwix.app/A/FT% \r\noriginal exception = java.lang.IllegalArgumentException: URLDecoder: Incomplete trailing escape (%) pattern\r\n```\r\n\r\n\r\n\r\nhttps://github.com/kiwix/kiwix-android/assets/34593983/0bd59ff6-504d-442b-a4a7-5f71cb5e2150\r\n\r\n", "diff": "diff --git a/app/src/main/java/org/kiwix/kiwixmobile/nav/destination/reader/KiwixReaderFragment.kt b/app/src/main/java/org/kiwix/kiwixmobile/nav/destination/reader/KiwixReaderFragment.kt\nindex a0cb43c7e2..259f1257ed 100644\n--- a/app/src/main/java/org/kiwix/kiwixmobile/nav/destination/reader/KiwixReaderFragment.kt\n+++ b/app/src/main/java/org/kiwix/kiwixmobile/nav/destination/reader/KiwixReaderFragment.kt\n@@ -102,11 +102,14 @@ class KiwixReaderFragment : CoreReaderFragment() {\n   }\n \n   private fun openSearchItem(item: SearchItemToOpen) {\n-    zimReaderContainer?.titleToUrl(item.pageTitle)?.let {\n-      if (item.shouldOpenInNewTab) {\n-        createNewTab()\n+    item.pageUrl?.let(::loadUrlWithCurrentWebview) ?: kotlin.run {\n+      // For handling the previously saved recent searches\n+      zimReaderContainer?.titleToUrl(item.pageTitle)?.let {\n+        if (item.shouldOpenInNewTab) {\n+          createNewTab()\n+        }\n+        loadUrlWithCurrentWebview(zimReaderContainer?.urlSuffixToParsableUrl(it))\n       }\n-      loadUrlWithCurrentWebview(zimReaderContainer?.urlSuffixToParsableUrl(it))\n     }\n     requireActivity().consumeObservable<SearchItemToOpen>(TAG_FILE_SEARCHED)\n   }\ndiff --git a/core/objectbox-models/default.json b/core/objectbox-models/default.json\nindex d4ba5033d0..9f15e6f8cc 100644\n--- a/core/objectbox-models/default.json\n+++ b/core/objectbox-models/default.json\n@@ -221,7 +221,7 @@\n     },\n     {\n       \"id\": \"7:7635075139296819361\",\n-      \"lastPropertyId\": \"3:3320858395373055542\",\n+      \"lastPropertyId\": \"4:6431198268026321201\",\n       \"name\": \"RecentSearchEntity\",\n       \"properties\": [\n         {\n@@ -239,6 +239,11 @@\n           \"id\": \"3:3320858395373055542\",\n           \"name\": \"zimId\",\n           \"type\": 9\n+        },\n+        {\n+          \"id\": \"4:6431198268026321201\",\n+          \"name\": \"url\",\n+          \"type\": 9\n         }\n       ],\n       \"relations\": []\ndiff --git a/core/objectbox-models/default.json.bak b/core/objectbox-models/default.json.bak\nindex d86bb4d441..d4ba5033d0 100644\n--- a/core/objectbox-models/default.json.bak\n+++ b/core/objectbox-models/default.json.bak\n@@ -391,9 +391,7 @@\n         {\n           \"id\": \"5:7998345745727500384\",\n           \"name\": \"noteTitle\",\n-          \"indexId\": \"5:7599267150617990347\",\n-          \"type\": 9,\n-          \"flags\": 2080\n+          \"type\": 9\n         },\n         {\n           \"id\": \"7:2160052450778801841\",\n@@ -429,7 +427,8 @@\n     1293695782925933448,\n     3655049272366703856,\n     7576716732364166705,\n-    4868787482832538530\n+    4868787482832538530,\n+    7599267150617990347\n   ],\n   \"retiredPropertyUids\": [\n     4712434661554562781,\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/dao/NewRecentSearchDao.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/dao/NewRecentSearchDao.kt\nindex 7010f12b6d..f5a4788858 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/dao/NewRecentSearchDao.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/dao/NewRecentSearchDao.kt\n@@ -42,11 +42,11 @@ class NewRecentSearchDao @Inject constructor(\n   ).map { searchEntities ->\n     searchEntities.distinctBy(RecentSearchEntity::searchTerm)\n       .take(NUM_RECENT_RESULTS)\n-      .map { searchEntity -> RecentSearchListItem(searchEntity.searchTerm) }\n+      .map { searchEntity -> RecentSearchListItem(searchEntity.searchTerm, searchEntity.url) }\n   }\n \n-  fun saveSearch(title: String, id: String) {\n-    box.put(RecentSearchEntity(searchTerm = title, zimId = id))\n+  fun saveSearch(title: String, id: String, url: String?) {\n+    box.put(RecentSearchEntity(searchTerm = title, zimId = id, url = url))\n   }\n \n   fun deleteSearchString(searchTerm: String) {\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/dao/entities/RecentSearchEntity.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/dao/entities/RecentSearchEntity.kt\nindex f27e8d12b2..c767ed0a7d 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/dao/entities/RecentSearchEntity.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/dao/entities/RecentSearchEntity.kt\n@@ -24,5 +24,6 @@ import io.objectbox.annotation.Id\n data class RecentSearchEntity(\n   @Id var id: Long = 0L,\n   val searchTerm: String,\n-  val zimId: String\n+  val zimId: String,\n+  val url: String?\n )\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/reader/ZimFileReader.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/reader/ZimFileReader.kt\nindex 2defa03798..b8553d56e4 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/reader/ZimFileReader.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/reader/ZimFileReader.kt\n@@ -336,7 +336,18 @@ private val String.filePath: String\n \n // Decode the URL if it is encoded because libkiwix does not return the path for encoded paths.\n val String.decodeUrl: String\n-  get() = URLDecoder.decode(this, \"UTF-8\")\n+  get() = try {\n+    URLDecoder.decode(this, \"UTF-8\")\n+  } catch (illegalArgumentException: IllegalArgumentException) {\n+    // Searched item already has the decoded URL,\n+    // and if any URL contains % in it, then it will fail to decode that URL and will not load the page.\n+    // e.g. https://kiwix.app/A/FT%, More info https://github.com/kiwix/kiwix-android/pull/3514\n+    Log.e(\n+      \"ZimFileReader\",\n+      \"Could not decode url $this \\n original exception = $illegalArgumentException\"\n+    )\n+    this\n+  }\n \n // Truncate mime-type (everything after the first space and semi-colon(if exists)\n val String.truncateMimeType: String\n@@ -352,3 +363,7 @@ private val DirectAccessInfo.parcelFileDescriptor: ParcelFileDescriptor?\n \n // Default illustration size for ZIM file favicons\n const val ILLUSTRATION_SIZE = 48\n+\n+// add content prefix to url since searched items return the url inside of zim without content prefix.\n+val String.addContentPrefix: String\n+  get() = if (startsWith(CONTENT_PREFIX)) this else CONTENT_PREFIX + this\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/search/adapter/SearchListItem.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/search/adapter/SearchListItem.kt\nindex 4b2e807456..84777e9416 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/search/adapter/SearchListItem.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/search/adapter/SearchListItem.kt\n@@ -20,7 +20,13 @@ package org.kiwix.kiwixmobile.core.search.adapter\n \n sealed class SearchListItem {\n   abstract val value: String\n+  abstract val url: String?\n \n-  data class RecentSearchListItem(override val value: String) : SearchListItem()\n-  data class ZimSearchResultListItem constructor(override val value: String) : SearchListItem()\n+  data class RecentSearchListItem(override val value: String, override val url: String?) :\n+    SearchListItem()\n+\n+  data class ZimSearchResultListItem constructor(\n+    override val value: String,\n+    override val url: String?\n+  ) : SearchListItem()\n }\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchState.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchState.kt\nindex ef745ae6dd..89c3cfbea3 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchState.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchState.kt\n@@ -39,7 +39,7 @@ data class SearchState(\n         val searchResults = mutableListOf<SearchListItem.RecentSearchListItem>()\n         while (searchIterator.hasNext()) {\n           val entry = searchIterator.next()\n-          searchResults.add(SearchListItem.RecentSearchListItem(entry.title))\n+          searchResults.add(SearchListItem.RecentSearchListItem(entry.title, entry.path))\n         }\n         /**\n          * Returns null if there are no suggestions left in the iterator.\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchViewModel.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchViewModel.kt\nindex 5a2490ef9d..f284a0422f 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchViewModel.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchViewModel.kt\n@@ -170,7 +170,8 @@ class SearchViewModel @Inject constructor(\n       SaveSearchToRecents(\n         recentSearchDao,\n         searchListItem,\n-        zimReaderContainer.id\n+        zimReaderContainer.id,\n+        viewModelScope\n       )\n     ).isSuccess\n     _effects.trySendBlocking(OpenSearchItem(searchListItem, openInNewTab))\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/OpenSearchItem.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/OpenSearchItem.kt\nindex 4d079dc56d..b765368dca 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/OpenSearchItem.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/OpenSearchItem.kt\n@@ -24,6 +24,7 @@ import kotlinx.parcelize.Parcelize\n import org.kiwix.kiwixmobile.core.base.SideEffect\n import org.kiwix.kiwixmobile.core.extensions.ActivityExtensions.setNavigationResultOnCurrent\n import org.kiwix.kiwixmobile.core.main.CoreMainActivity\n+import org.kiwix.kiwixmobile.core.reader.addContentPrefix\n import org.kiwix.kiwixmobile.core.search.adapter.SearchListItem\n import org.kiwix.kiwixmobile.core.utils.TAG_FILE_SEARCHED\n \n@@ -35,7 +36,11 @@ data class OpenSearchItem(\n     val readerFragmentResId = (activity as CoreMainActivity).readerFragmentResId\n     activity.navigate(readerFragmentResId)\n     activity.setNavigationResultOnCurrent(\n-      SearchItemToOpen(searchListItem.value, openInNewTab),\n+      SearchItemToOpen(\n+        searchListItem.value,\n+        openInNewTab,\n+        searchListItem.url?.addContentPrefix\n+      ),\n       TAG_FILE_SEARCHED\n     )\n   }\n@@ -44,5 +49,6 @@ data class OpenSearchItem(\n @Parcelize\n data class SearchItemToOpen(\n   val pageTitle: String,\n-  val shouldOpenInNewTab: Boolean\n+  val shouldOpenInNewTab: Boolean,\n+  val pageUrl: String?\n ) : Parcelable\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/SaveSearchToRecents.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/SaveSearchToRecents.kt\nindex 178ae4c4fd..724f114ba0 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/SaveSearchToRecents.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/SaveSearchToRecents.kt\n@@ -19,16 +19,29 @@\n package org.kiwix.kiwixmobile.core.search.viewmodel.effects\n \n import androidx.appcompat.app.AppCompatActivity\n+import kotlinx.coroutines.CoroutineScope\n+import kotlinx.coroutines.Dispatchers\n+import kotlinx.coroutines.launch\n import org.kiwix.kiwixmobile.core.base.SideEffect\n import org.kiwix.kiwixmobile.core.dao.NewRecentSearchDao\n+import org.kiwix.kiwixmobile.core.reader.addContentPrefix\n import org.kiwix.kiwixmobile.core.search.adapter.SearchListItem\n \n data class SaveSearchToRecents(\n   private val recentSearchDao: NewRecentSearchDao,\n   private val searchListItem: SearchListItem,\n-  private val id: String?\n+  private val id: String?,\n+  private val viewModelScope: CoroutineScope\n ) : SideEffect<Unit> {\n   override fun invokeWith(activity: AppCompatActivity) {\n-    id?.let { recentSearchDao.saveSearch(searchListItem.value, it) }\n+    id?.let {\n+      viewModelScope.launch(Dispatchers.IO) {\n+        recentSearchDao.saveSearch(\n+          searchListItem.value,\n+          it,\n+          searchListItem.url?.addContentPrefix\n+        )\n+      }\n+    }\n   }\n }\ndiff --git a/core/src/sharedTestFunctions/java/org/kiwix/sharedFunctions/TestModelFunctions.kt b/core/src/sharedTestFunctions/java/org/kiwix/sharedFunctions/TestModelFunctions.kt\nindex 26febfcb5d..7c2e827c58 100644\n--- a/core/src/sharedTestFunctions/java/org/kiwix/sharedFunctions/TestModelFunctions.kt\n+++ b/core/src/sharedTestFunctions/java/org/kiwix/sharedFunctions/TestModelFunctions.kt\n@@ -165,8 +165,13 @@ fun libraryNetworkEntity(books: List<Book> = emptyList()) = LibraryNetworkEntity\n   book = LinkedList(books)\n }\n \n-fun recentSearchEntity(id: Long = 0L, searchTerm: String = \"\", zimId: String = \"\") =\n-  RecentSearchEntity(id, searchTerm, zimId)\n+fun recentSearchEntity(\n+  id: Long = 0L,\n+  searchTerm: String = \"\",\n+  zimId: String = \"\",\n+  url: String = \"\"\n+) =\n+  RecentSearchEntity(id, searchTerm, zimId, url)\n \n fun bookOnDiskEntity(\n   id: Long = 0,\ndiff --git a/core/src/test/java/org/kiwix/kiwixmobile/core/dao/NewRecentSearchDaoTest.kt b/core/src/test/java/org/kiwix/kiwixmobile/core/dao/NewRecentSearchDaoTest.kt\nindex 70e78806e0..3463ba8372 100644\n--- a/core/src/test/java/org/kiwix/kiwixmobile/core/dao/NewRecentSearchDaoTest.kt\n+++ b/core/src/test/java/org/kiwix/kiwixmobile/core/dao/NewRecentSearchDaoTest.kt\n@@ -50,7 +50,7 @@ internal class NewRecentSearchDaoTest {\n       newRecentSearchDao.recentSearches(zimId)\n         .test(this)\n         .assertValues(\n-          queryResult.map { RecentSearchListItem(it.searchTerm) }\n+          queryResult.map { RecentSearchListItem(it.searchTerm, it.url) }\n         )\n         .finish()\n     }\n@@ -62,7 +62,7 @@ internal class NewRecentSearchDaoTest {\n       newRecentSearchDao.recentSearches(null)\n         .test(this)\n         .assertValues(\n-          queryResult.map { RecentSearchListItem(it.searchTerm) }\n+          queryResult.map { RecentSearchListItem(it.searchTerm, it.url) }\n         )\n         .finish()\n     }\n@@ -74,7 +74,7 @@ internal class NewRecentSearchDaoTest {\n       newRecentSearchDao.recentSearches(\"\")\n         .test(this)\n         .assertValues(\n-          queryResult.take(1).map { RecentSearchListItem(it.searchTerm) }\n+          queryResult.take(1).map { RecentSearchListItem(it.searchTerm, it.url) }\n         )\n         .finish()\n     }\n@@ -109,8 +109,16 @@ internal class NewRecentSearchDaoTest {\n \n   @Test\n   fun `saveSearch puts RecentSearchEntity into box`() {\n-    newRecentSearchDao.saveSearch(\"title\", \"id\")\n-    verify { box.put(recentSearchEntity(searchTerm = \"title\", zimId = \"id\")) }\n+    newRecentSearchDao.saveSearch(\"title\", \"id\", \"https://kiwix.app/mainPage\")\n+    verify {\n+      box.put(\n+        recentSearchEntity(\n+          searchTerm = \"title\",\n+          zimId = \"id\",\n+          url = \"https://kiwix.app/mainPage\"\n+        )\n+      )\n+    }\n   }\n \n   @Test\ndiff --git a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchStateTest.kt b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchStateTest.kt\nindex c71655d091..8f39f5cb5d 100644\n--- a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchStateTest.kt\n+++ b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchStateTest.kt\n@@ -31,6 +31,7 @@ internal class SearchStateTest {\n   @Test\n   internal fun `visibleResults use searchResults when searchTerm is not empty`() = runTest {\n     val searchTerm = \"notEmpty\"\n+    val pageUrl = \"\"\n     val suggestionSearchWrapper: SuggestionSearchWrapper = mockk()\n     val searchIteratorWrapper: SuggestionIteratorWrapper = mockk()\n     val entryWrapper: SuggestionItemWrapper = mockk()\n@@ -42,6 +43,7 @@ internal class SearchStateTest {\n     every { searchIteratorWrapper.hasNext() } returnsMany listOf(true, false)\n     every { searchIteratorWrapper.next() } returns entryWrapper\n     every { entryWrapper.title } returns searchTerm\n+    every { entryWrapper.path } returns pageUrl\n     every {\n       suggestionSearchWrapper.getResults(\n         0,\n@@ -55,12 +57,12 @@ internal class SearchStateTest {\n         emptyList(),\n         FromWebView\n       ).getVisibleResults(0)\n-    ).isEqualTo(listOf(RecentSearchListItem(searchTerm)))\n+    ).isEqualTo(listOf(RecentSearchListItem(searchTerm, \"\")))\n   }\n \n   @Test\n   internal fun `visibleResults use recentResults when searchTerm is empty`() = runTest {\n-    val results = listOf(RecentSearchListItem(\"\"))\n+    val results = listOf(RecentSearchListItem(\"\", \"\"))\n     assertThat(\n       SearchState(\n         \"\",\ndiff --git a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchViewModelTest.kt b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchViewModelTest.kt\nindex f847b62f85..7fbf391906 100644\n--- a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchViewModelTest.kt\n+++ b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchViewModelTest.kt\n@@ -19,6 +19,7 @@\n package org.kiwix.kiwixmobile.core.search.viewmodel\n \n import android.os.Bundle\n+import androidx.lifecycle.viewModelScope\n import io.mockk.clearAllMocks\n import io.mockk.coEvery\n import io.mockk.every\n@@ -119,7 +120,7 @@ internal class SearchViewModelTest {\n \n     @Test\n     fun `SearchState combines sources from inputs`() = runTest {\n-      val item = ZimSearchResultListItem(\"\")\n+      val item = ZimSearchResultListItem(\"\", \"\")\n       val searchTerm = \"searchTerm\"\n       val searchOrigin = FromWebView\n       val suggestionSearch: SuggestionSearch = mockk()\n@@ -128,7 +129,7 @@ internal class SearchViewModelTest {\n           emissionOf(\n             searchTerm = searchTerm,\n             suggestionSearch = suggestionSearch,\n-            databaseResults = listOf(RecentSearchListItem(\"\")),\n+            databaseResults = listOf(RecentSearchListItem(\"\", \"\")),\n             searchOrigin = searchOrigin\n           )\n         }\n@@ -136,7 +137,7 @@ internal class SearchViewModelTest {\n           SearchState(\n             searchTerm,\n             SearchResultsWithTerm(searchTerm, suggestionSearch),\n-            listOf(RecentSearchListItem(\"\")),\n+            listOf(RecentSearchListItem(\"\", \"\")),\n             searchOrigin\n           )\n         )\n@@ -154,27 +155,27 @@ internal class SearchViewModelTest {\n \n     @Test\n     fun `OnItemClick offers Saves and Opens`() = runBlockingTest {\n-      val searchListItem = RecentSearchListItem(\"\")\n+      val searchListItem = RecentSearchListItem(\"\", \"\")\n       actionResultsInEffects(\n         OnItemClick(searchListItem),\n-        SaveSearchToRecents(recentSearchDao, searchListItem, \"id\"),\n+        SaveSearchToRecents(recentSearchDao, searchListItem, \"id\", viewModel.viewModelScope),\n         OpenSearchItem(searchListItem, false)\n       )\n     }\n \n     @Test\n     fun `OnOpenInNewTabClick offers Saves and Opens in new tab`() = runBlockingTest {\n-      val searchListItem = RecentSearchListItem(\"\")\n+      val searchListItem = RecentSearchListItem(\"\", \"\")\n       actionResultsInEffects(\n         OnOpenInNewTabClick(searchListItem),\n-        SaveSearchToRecents(recentSearchDao, searchListItem, \"id\"),\n+        SaveSearchToRecents(recentSearchDao, searchListItem, \"id\", viewModel.viewModelScope),\n         OpenSearchItem(searchListItem, true)\n       )\n     }\n \n     @Test\n     fun `OnItemLongClick offers Saves and Opens`() = runBlockingTest {\n-      val searchListItem = RecentSearchListItem(\"\")\n+      val searchListItem = RecentSearchListItem(\"\", \"\")\n       actionResultsInEffects(\n         OnItemLongClick(searchListItem),\n         ShowDeleteSearchDialog(searchListItem, viewModel.actions)\n@@ -188,7 +189,7 @@ internal class SearchViewModelTest {\n \n     @Test\n     fun `ConfirmedDelete offers Delete and Toast`() = runBlockingTest {\n-      val searchListItem = RecentSearchListItem(\"\")\n+      val searchListItem = RecentSearchListItem(\"\", \"\")\n       actionResultsInEffects(\n         ConfirmedDelete(searchListItem),\n         DeleteRecentSearch(searchListItem, recentSearchDao),\ndiff --git a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/SuggestionItemWrapper.kt b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/SuggestionItemWrapper.kt\nindex bc5942e661..54f2aa00d7 100644\n--- a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/SuggestionItemWrapper.kt\n+++ b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/SuggestionItemWrapper.kt\n@@ -22,4 +22,5 @@ import org.kiwix.libzim.SuggestionItem\n \n class SuggestionItemWrapper : SuggestionItem() {\n   override fun getTitle(): String = super.getTitle()\n+  override fun getPath(): String = super.getPath()\n }\ndiff --git a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/DeleteRecentSearchTest.kt b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/DeleteRecentSearchTest.kt\nindex f2e9dafa15..6fba7ea566 100644\n--- a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/DeleteRecentSearchTest.kt\n+++ b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/DeleteRecentSearchTest.kt\n@@ -30,7 +30,7 @@ internal class DeleteRecentSearchTest {\n \n   @Test\n   fun `invoke with deletes a search`() {\n-    val searchListItem: SearchListItem = RecentSearchListItem(\"\")\n+    val searchListItem: SearchListItem = RecentSearchListItem(\"\", \"\")\n     val recentSearchDao: NewRecentSearchDao = mockk()\n     val activity: AppCompatActivity = mockk()\n     DeleteRecentSearch(searchListItem, recentSearchDao).invokeWith(activity)\ndiff --git a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/OpenSearchItemTest.kt b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/OpenSearchItemTest.kt\nindex 49e7409a2c..1f5fe3f91b 100644\n--- a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/OpenSearchItemTest.kt\n+++ b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/OpenSearchItemTest.kt\n@@ -26,6 +26,7 @@ import io.mockk.verify\n import org.junit.jupiter.api.Test\n import org.kiwix.kiwixmobile.core.extensions.ActivityExtensions.setNavigationResultOnCurrent\n import org.kiwix.kiwixmobile.core.main.CoreMainActivity\n+import org.kiwix.kiwixmobile.core.reader.ZimFileReader\n import org.kiwix.kiwixmobile.core.search.adapter.SearchListItem.RecentSearchListItem\n import org.kiwix.kiwixmobile.core.utils.TAG_FILE_SEARCHED\n import org.kiwix.kiwixmobile.core.utils.TAG_FILE_SEARCHED_NEW_TAB\n@@ -34,7 +35,7 @@ internal class OpenSearchItemTest {\n \n   @Test\n   fun `invoke with returns an Ok Result with list item value`() {\n-    val searchListItem = RecentSearchListItem(\"\")\n+    val searchListItem = RecentSearchListItem(\"\", ZimFileReader.CONTENT_PREFIX)\n     val activity: CoreMainActivity = mockk(relaxed = true)\n     mockkConstructor(Intent::class)\n     val intent = mockk<Intent>()\n@@ -46,7 +47,7 @@ internal class OpenSearchItemTest {\n     verify {\n       activity.navigate(activity.readerFragmentResId)\n       activity.setNavigationResultOnCurrent(\n-        SearchItemToOpen(searchListItem.value, false),\n+        SearchItemToOpen(searchListItem.value, false, ZimFileReader.CONTENT_PREFIX),\n         TAG_FILE_SEARCHED\n       )\n     }\n@@ -54,7 +55,7 @@ internal class OpenSearchItemTest {\n \n   @Test\n   fun `invoke with returns an Ok Result with list item value for new tab`() {\n-    val searchListItem = RecentSearchListItem(\"\")\n+    val searchListItem = RecentSearchListItem(\"\", ZimFileReader.CONTENT_PREFIX)\n     val activity: CoreMainActivity = mockk(relaxed = true)\n     mockkConstructor(Intent::class)\n     val intent = mockk<Intent>()\n@@ -66,7 +67,7 @@ internal class OpenSearchItemTest {\n     verify {\n       activity.navigate(activity.readerFragmentResId)\n       activity.setNavigationResultOnCurrent(\n-        SearchItemToOpen(searchListItem.value, true),\n+        SearchItemToOpen(searchListItem.value, true, ZimFileReader.CONTENT_PREFIX),\n         TAG_FILE_SEARCHED\n       )\n     }\ndiff --git a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/SaveSearchToRecentsTest.kt b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/SaveSearchToRecentsTest.kt\nindex a6e8d62a8e..7a7ba92f87 100644\n--- a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/SaveSearchToRecentsTest.kt\n+++ b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/SaveSearchToRecentsTest.kt\n@@ -22,27 +22,43 @@ import androidx.appcompat.app.AppCompatActivity\n import io.mockk.Called\n import io.mockk.mockk\n import io.mockk.verify\n+import kotlinx.coroutines.CoroutineScope\n+import kotlinx.coroutines.Dispatchers\n import org.junit.jupiter.api.Test\n import org.kiwix.kiwixmobile.core.dao.NewRecentSearchDao\n+import org.kiwix.kiwixmobile.core.reader.ZimFileReader\n import org.kiwix.kiwixmobile.core.search.adapter.SearchListItem.RecentSearchListItem\n \n internal class SaveSearchToRecentsTest {\n \n   private val newRecentSearchDao: NewRecentSearchDao = mockk()\n-  private val searchListItem = RecentSearchListItem(\"\")\n+  private val searchListItem = RecentSearchListItem(\"\", ZimFileReader.CONTENT_PREFIX)\n \n   private val activity: AppCompatActivity = mockk()\n+  private val viewModelScope = CoroutineScope(Dispatchers.IO)\n \n   @Test\n   fun `invoke with null Id does nothing`() {\n-    SaveSearchToRecents(newRecentSearchDao, searchListItem, null).invokeWith(activity)\n+    SaveSearchToRecents(\n+      newRecentSearchDao,\n+      searchListItem,\n+      null,\n+      viewModelScope\n+    ).invokeWith(\n+      activity\n+    )\n     verify { newRecentSearchDao wasNot Called }\n   }\n \n   @Test\n   fun `invoke with non null Id saves search`() {\n     val id = \"id\"\n-    SaveSearchToRecents(newRecentSearchDao, searchListItem, id).invokeWith(activity)\n-    verify { newRecentSearchDao.saveSearch(searchListItem.value, id) }\n+    SaveSearchToRecents(\n+      newRecentSearchDao,\n+      searchListItem,\n+      id,\n+      viewModelScope\n+    ).invokeWith(activity)\n+    verify { newRecentSearchDao.saveSearch(searchListItem.value, id, ZimFileReader.CONTENT_PREFIX) }\n   }\n }\ndiff --git a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/ShowDeleteSearchDialogTest.kt b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/ShowDeleteSearchDialogTest.kt\nindex 8fef6980b3..63c7f09b54 100644\n--- a/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/ShowDeleteSearchDialogTest.kt\n+++ b/core/src/test/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/ShowDeleteSearchDialogTest.kt\n@@ -36,7 +36,7 @@ internal class ShowDeleteSearchDialogTest {\n   @Test\n   fun `invoke with shows dialog that offers ConfirmedDelete action`() {\n     val actions = mockk<Channel<Action>>(relaxed = true)\n-    val searchListItem = RecentSearchListItem(\"\")\n+    val searchListItem = RecentSearchListItem(\"\", \"\")\n     val activity = mockk<CoreMainActivity>()\n     val showDeleteSearchDialog = ShowDeleteSearchDialog(searchListItem, actions)\n     val dialogShower = mockk<DialogShower>()\ndiff --git a/custom/src/main/java/org/kiwix/kiwixmobile/custom/main/CustomReaderFragment.kt b/custom/src/main/java/org/kiwix/kiwixmobile/custom/main/CustomReaderFragment.kt\nindex 8b4317c3a6..090bac52d5 100644\n--- a/custom/src/main/java/org/kiwix/kiwixmobile/custom/main/CustomReaderFragment.kt\n+++ b/custom/src/main/java/org/kiwix/kiwixmobile/custom/main/CustomReaderFragment.kt\n@@ -98,11 +98,14 @@ class CustomReaderFragment : CoreReaderFragment() {\n   }\n \n   private fun openSearchItem(item: SearchItemToOpen) {\n-    zimReaderContainer?.titleToUrl(item.pageTitle)?.apply {\n-      if (item.shouldOpenInNewTab) {\n-        createNewTab()\n+    item.pageUrl?.let(::loadUrlWithCurrentWebview) ?: kotlin.run {\n+      // For handling the previously saved recent searches\n+      zimReaderContainer?.titleToUrl(item.pageTitle)?.apply {\n+        if (item.shouldOpenInNewTab) {\n+          createNewTab()\n+        }\n+        loadUrlWithCurrentWebview(zimReaderContainer?.urlSuffixToParsableUrl(this))\n       }\n-      loadUrlWithCurrentWebview(zimReaderContainer?.urlSuffixToParsableUrl(this))\n     }\n   }\n \n", "changes": [{"file": "app/src/main/java/org/kiwix/kiwixmobile/nav/destination/reader/KiwixReaderFragment.kt", "module": "org.kiwix.kiwixmobile.nav.destination.reader.KiwixReaderFragment", "range": [{"start": 105, "end": 108}, {"start": 109, "end": 109}]}, {"file": "custom/src/main/java/org/kiwix/kiwixmobile/custom/main/CustomReaderFragment.kt", "module": "org.kiwix.kiwixmobile.custom.main.CustomReaderFragment", "range": [{"start": 101, "end": 104}, {"start": 105, "end": 105}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/reader/ZimFileReader.kt", "module": "org.kiwix.kiwixmobile.core.reader.ZimFileReader", "range": [{"start": 339, "end": 340}, {"start": 355, "end": 355}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/dao/NewRecentSearchDao.kt", "module": "org.kiwix.kiwixmobile.core.dao.NewRecentSearchDao", "range": [{"start": 45, "end": 46}, {"start": 48, "end": 50}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/dao/entities/RecentSearchEntity.kt", "module": "org.kiwix.kiwixmobile.core.dao.entities.RecentSearchEntity", "range": [{"start": 27, "end": 28}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/search/adapter/SearchListItem.kt", "module": "org.kiwix.kiwixmobile.core.search.adapter.SearchListItem", "range": [{"start": 23, "end": 23}, {"start": 24, "end": 26}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/SaveSearchToRecents.kt", "module": "org.kiwix.kiwixmobile.core.search.viewmodel.effects.SaveSearchToRecents", "range": [{"start": 22, "end": 22}, {"start": 24, "end": 24}, {"start": 29, "end": 30}, {"start": 32, "end": 33}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/effects/OpenSearchItem.kt", "module": "org.kiwix.kiwixmobile.core.search.viewmodel.effects.OpenSearchItem", "range": [{"start": 27, "end": 27}, {"start": 38, "end": 39}, {"start": 47, "end": 48}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchState.kt", "module": "org.kiwix.kiwixmobile.core.search.viewmodel.SearchState", "range": [{"start": 42, "end": 43}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/search/viewmodel/SearchViewModel.kt", "module": "org.kiwix.kiwixmobile.core.search.viewmodel.SearchViewModel", "range": [{"start": 173, "end": 174}]}]}]}
{"url": "https://github.com/kiwix/kiwix-android/issues/2849", "repo": {"url": "https://github.com/kiwix/kiwix-android", "name": "kiwix-android", "owner": "kiwix", "modules": ["custom", "eu.mhutti1.utils.storage", "org.kiwix.kiwixmobile", "org.kiwix.kiwixmobile.core", "org.kiwix.kiwixmobile.custom", "org.kiwix.kiwixmobile.deeplinks", "org.kiwix.kiwixmobile.di", "org.kiwix.kiwixmobile.download", "org.kiwix.kiwixmobile.error", "org.kiwix.kiwixmobile.help", "org.kiwix.kiwixmobile.initial", "org.kiwix.kiwixmobile.intro", "org.kiwix.kiwixmobile.language", "org.kiwix.kiwixmobile.localFileTransfer", "org.kiwix.kiwixmobile.localLibrary", "org.kiwix.kiwixmobile.main", "org.kiwix.kiwixmobile.migration", "org.kiwix.kiwixmobile.mimetype", "org.kiwix.kiwixmobile.nav", "org.kiwix.kiwixmobile.note", "org.kiwix.kiwixmobile.page", "org.kiwix.kiwixmobile.reader", "org.kiwix.kiwixmobile.roomDao", "org.kiwix.kiwixmobile.search", "org.kiwix.kiwixmobile.settings", "org.kiwix.kiwixmobile.shortcuts", "org.kiwix.kiwixmobile.splash", "org.kiwix.kiwixmobile.storage", "org.kiwix.kiwixmobile.testutils", "org.kiwix.kiwixmobile.ui", "org.kiwix.kiwixmobile.utils", "org.kiwix.kiwixmobile.webserver", "org.kiwix.kiwixmobile.widgets", "org.kiwix.kiwixmobile.zimManager", "org.kiwix.sharedFunctions", "org.kiwix.videowebview", "plugin"]}, "issue": {"number": 2849, "url": "https://github.com/kiwix/kiwix-android/issues/2849", "state": "closed", "title": "Not possible to jump to sections in Table of Contents containing single quote", "body": "- Kiwix 3.4.5\r\n- Article: List of creepypastas\r\n- [wikipedia_en_all_maxi_2022-05.zim](https://de.wikipedia.org/wiki/Der_Patriot_(Tageszeitung))\r\n- Log: \r\n[logs1653416153136.txt](https://github.com/kiwix/kiwix-android/files/8765420/logs1653416153136.txt)\r\n\r\nSelecting `Hi I'm Mary Mary` does nothing, as it contains a single quote.\r\n\r\n![20220524_203942](https://user-images.githubusercontent.com/71934042/170108677-197b0af7-d0ff-4c7b-b641-1134c488bddb.gif)\r\n", "logs": [{"name": "logs1653416153136.txt", "url": "https://github.com/kiwix/kiwix-android/files/8765420/logs1653416153136.txt"}]}, "pull_request": [{"number": 3145, "url": "https://github.com/kiwix/kiwix-android/pull/3145", "diff_url": "https://github.com/kiwix/kiwix-android/pull/3145.diff", "patch_url": "https://github.com/kiwix/kiwix-android/pull/3145.patch", "title": "Fixed not possible to jump to sections in table of contents containing single quote", "content": "Fixes #2849 ", "diff": "diff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/main/CoreReaderFragment.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/main/CoreReaderFragment.kt\nindex b942d82296..7d0502fb40 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/main/CoreReaderFragment.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/main/CoreReaderFragment.kt\n@@ -574,7 +574,7 @@ abstract class CoreReaderFragment :\n       override fun onSectionClick(view: View?, position: Int) {\n         loadUrlWithCurrentWebview(\n           \"javascript:document.getElementById('\" +\n-            documentSections!![position].id +\n+            documentSections!![position].id.replace(\"'\", \"\\\\'\") +\n             \"').scrollIntoView();\"\n         )\n         drawerLayout?.closeDrawers()\n", "changes": [{"file": "core/src/main/java/org/kiwix/kiwixmobile/core/main/CoreReaderFragment.kt", "module": "org.kiwix.kiwixmobile.core.main.CoreReaderFragment", "range": [{"start": 577, "end": 578}]}]}]}
{"url": "https://github.com/kiwix/kiwix-android/issues/2845", "repo": {"url": "https://github.com/kiwix/kiwix-android", "name": "kiwix-android", "owner": "kiwix", "modules": ["custom", "eu.mhutti1.utils.storage", "org.kiwix.kiwixmobile", "org.kiwix.kiwixmobile.core", "org.kiwix.kiwixmobile.custom", "org.kiwix.kiwixmobile.deeplinks", "org.kiwix.kiwixmobile.di", "org.kiwix.kiwixmobile.download", "org.kiwix.kiwixmobile.error", "org.kiwix.kiwixmobile.help", "org.kiwix.kiwixmobile.initial", "org.kiwix.kiwixmobile.intro", "org.kiwix.kiwixmobile.language", "org.kiwix.kiwixmobile.localFileTransfer", "org.kiwix.kiwixmobile.localLibrary", "org.kiwix.kiwixmobile.main", "org.kiwix.kiwixmobile.migration", "org.kiwix.kiwixmobile.mimetype", "org.kiwix.kiwixmobile.nav", "org.kiwix.kiwixmobile.note", "org.kiwix.kiwixmobile.page", "org.kiwix.kiwixmobile.reader", "org.kiwix.kiwixmobile.roomDao", "org.kiwix.kiwixmobile.search", "org.kiwix.kiwixmobile.settings", "org.kiwix.kiwixmobile.shortcuts", "org.kiwix.kiwixmobile.splash", "org.kiwix.kiwixmobile.storage", "org.kiwix.kiwixmobile.testutils", "org.kiwix.kiwixmobile.ui", "org.kiwix.kiwixmobile.utils", "org.kiwix.kiwixmobile.webserver", "org.kiwix.kiwixmobile.widgets", "org.kiwix.kiwixmobile.zimManager", "org.kiwix.sharedFunctions", "org.kiwix.videowebview", "plugin"]}, "issue": {"number": 2845, "url": "https://github.com/kiwix/kiwix-android/issues/2845", "state": "closed", "title": "Large Downloads Are Halted 3.4.5 (7230405)", "body": "<!-- Checklist for reporting a bug\r\n- Check the issue tracker. The issue you have may have already been reported.\r\n- Ensure you have tested the latest developers version.\r\n-->\r\n\r\n**Describe the bug**\r\n<!-- A clear and concise description of what the bug is. -->\r\nDownloading large files like the 88.7 GB wikipedia_en_all_maxi_2022-05.zim has repeatedly failed/halted due to \"UNKNOWN_HOST\".\r\n\r\n**Expected behavior**\r\n<!-- A clear and concise description of what you expected to happen. -->\r\nThe download should continue as normal.\r\n\r\n**Steps to reproduce the behavior:**\r\n1. Start a fresh session of Kiwix.\r\n2. Go to the Download tab.\r\n3. Use the search function and enter \"wikipedia\".\r\n4. Tap on the the 88.7 GB file to begin the download.\r\n5. Press the power button to allow the screen to sleep.\r\n6. Check in periodically until the download has failed due to UNKNOWN_HOST.\r\n\r\n**Environment**\r\n- Version of Kiwix Android : 3.4.5 Build 7230405\r\n- Device : Samsung A50\r\n- OS version : Android 11\r\n\r\n**Logs**\r\n<!-- If applicable, add logs to help the developers in identifying your problem otherwise delete this heading. -->\r\n[logs1653249667183.txt](https://github.com/kiwix/kiwix-android/files/8750183/logs1653249667183.txt)\r\n\r\n\r\nAdditional notes:\r\n\r\nI am able to download smaller .zim files, and the SD card has hundreds of GBs in available space.\r\n\r\nI did not test the latest developer's version, as I'm not sure where I would find that. I tried http://download.kiwix.org/nightly/2022-05-22/, but the only .apk listed is a debug tool. \r\n\r\nI used developer options to force the screen to stay awake, but still ran into the same problems. \r\n\r\nMy internet is mostly reliable, and the phone automatically switches to data during any downtime.\r\n\r\nI'm only having this problem because the .zim file I downloaded on my PC and placed into my micro SD card isn't being detected by the app, so I'm forced to download it via the app.\r\n\r\n", "logs": [{"name": "logs1653249667183.txt", "url": "https://github.com/kiwix/kiwix-android/files/8750183/logs1653249667183.txt"}]}, "pull_request": [{"number": 2881, "url": "https://github.com/kiwix/kiwix-android/pull/2881", "diff_url": "https://github.com/kiwix/kiwix-android/pull/2881.diff", "patch_url": "https://github.com/kiwix/kiwix-android/pull/2881.patch", "title": "Increase read, connect and auto retry attempts", "content": "Fixes #2845 \r\n\r\nWe were facing the issue if network was unavailable due to sudden changes in network then downloading halt. so we have improve the scenario by adding following parameter.\r\na) Increase connection timeout and auto retry attempt.\r\nb) Downloading will resume by itself and notify user about the network. ", "diff": "diff --git a/app/src/main/java/org/kiwix/kiwixmobile/nav/destination/library/OnlineLibraryFragment.kt b/app/src/main/java/org/kiwix/kiwixmobile/nav/destination/library/OnlineLibraryFragment.kt\nindex b6ad10b20e..c2ddc6e6f3 100644\n--- a/app/src/main/java/org/kiwix/kiwixmobile/nav/destination/library/OnlineLibraryFragment.kt\n+++ b/app/src/main/java/org/kiwix/kiwixmobile/nav/destination/library/OnlineLibraryFragment.kt\n@@ -46,6 +46,7 @@ import androidx.lifecycle.ViewModelProvider\n import androidx.lifecycle.observe\n import androidx.recyclerview.widget.LinearLayoutManager\n import androidx.recyclerview.widget.RecyclerView\n+import com.tonyodev.fetch2.Status\n import eu.mhutti1.utils.storage.StorageDevice\n import eu.mhutti1.utils.storage.StorageSelectDialog\n import kotlinx.android.synthetic.main.fragment_destination_download.allowInternetPermissionButton\n@@ -106,10 +107,18 @@ class OnlineLibraryFragment : BaseFragment(), FragmentActivityExtensions {\n     LibraryAdapter(\n       LibraryDelegate.BookDelegate(bookUtils, ::onBookItemClick),\n       LibraryDelegate.DownloadDelegate {\n-        dialogShower.show(\n-          KiwixDialog.YesNoDialog.StopDownload,\n-          { downloader.cancelDownload(it.downloadId) }\n-        )\n+        if (it.currentDownloadState == Status.FAILED) {\n+          if (isNotConnected) {\n+            noInternetSnackbar()\n+          } else {\n+            downloader.retryDownload(it.downloadId)\n+          }\n+        } else {\n+          dialogShower.show(\n+            KiwixDialog.YesNoDialog.StopDownload,\n+            { downloader.cancelDownload(it.downloadId) }\n+          )\n+        }\n       },\n       LibraryDelegate.DividerDelegate\n     )\ndiff --git a/app/src/main/java/org/kiwix/kiwixmobile/zim_manager/library_view/adapter/LibraryListItem.kt b/app/src/main/java/org/kiwix/kiwixmobile/zim_manager/library_view/adapter/LibraryListItem.kt\nindex 1881179b0c..03c19b5917 100644\n--- a/app/src/main/java/org/kiwix/kiwixmobile/zim_manager/library_view/adapter/LibraryListItem.kt\n+++ b/app/src/main/java/org/kiwix/kiwixmobile/zim_manager/library_view/adapter/LibraryListItem.kt\n@@ -19,6 +19,7 @@\n package org.kiwix.kiwixmobile.zim_manager.library_view.adapter\n \n import androidx.annotation.StringRes\n+import com.tonyodev.fetch2.Status\n import org.kiwix.kiwixmobile.core.downloader.model.Base64String\n import org.kiwix.kiwixmobile.core.downloader.model.DownloadModel\n import org.kiwix.kiwixmobile.core.downloader.model.DownloadState\n@@ -69,7 +70,8 @@ sealed class LibraryListItem {\n     val progress: Int,\n     val eta: Seconds,\n     val downloadState: DownloadState,\n-    override val id: Long\n+    override val id: Long,\n+    val currentDownloadState: Status\n   ) : LibraryListItem() {\n \n     val readableEta: CharSequence = eta.takeIf { it.seconds > 0L }?.toHumanReadableTime() ?: \"\"\n@@ -84,7 +86,8 @@ sealed class LibraryListItem {\n       downloadModel.progress,\n       Seconds(downloadModel.etaInMilliSeconds / 1000L),\n       DownloadState.from(downloadModel.state, downloadModel.error),\n-      downloadModel.book.id.hashCode().toLong()\n+      downloadModel.book.id.hashCode().toLong(),\n+      downloadModel.state\n     )\n   }\n }\ndiff --git a/app/src/main/java/org/kiwix/kiwixmobile/zim_manager/library_view/adapter/LibraryViewHolder.kt b/app/src/main/java/org/kiwix/kiwixmobile/zim_manager/library_view/adapter/LibraryViewHolder.kt\nindex 6613d32e76..db2bf8aad7 100644\n--- a/app/src/main/java/org/kiwix/kiwixmobile/zim_manager/library_view/adapter/LibraryViewHolder.kt\n+++ b/app/src/main/java/org/kiwix/kiwixmobile/zim_manager/library_view/adapter/LibraryViewHolder.kt\n@@ -23,6 +23,7 @@ import android.view.View\n import android.view.View.MeasureSpec\n import android.widget.Toast\n import androidx.annotation.StringRes\n+import com.tonyodev.fetch2.Status\n import kotlinx.android.synthetic.main.item_download.downloadProgress\n import kotlinx.android.synthetic.main.item_download.downloadState\n import kotlinx.android.synthetic.main.item_download.eta\n@@ -99,6 +100,9 @@ sealed class LibraryViewHolder<in T : LibraryListItem>(containerView: View) :\n       downloadProgress.progress = item.progress\n       stop.setOnClickListener { clickAction.invoke(item) }\n       downloadState.text = item.downloadState.toReadableState(containerView.context)\n+      if (item.currentDownloadState == Status.FAILED) {\n+        clickAction.invoke(item)\n+      }\n       eta.text = item.readableEta\n     }\n   }\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/di/modules/DownloaderModule.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/di/modules/DownloaderModule.kt\nindex ad6ce5ba10..29b26fc562 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/di/modules/DownloaderModule.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/di/modules/DownloaderModule.kt\n@@ -34,7 +34,10 @@ import org.kiwix.kiwixmobile.core.downloader.Downloader\n import org.kiwix.kiwixmobile.core.downloader.DownloaderImpl\n import org.kiwix.kiwixmobile.core.downloader.fetch.FetchDownloadNotificationManager\n import org.kiwix.kiwixmobile.core.downloader.fetch.FetchDownloadRequester\n+import org.kiwix.kiwixmobile.core.utils.CONNECT_TIME_OUT\n+import org.kiwix.kiwixmobile.core.utils.READ_TIME_OUT\n import org.kiwix.kiwixmobile.core.utils.SharedPreferenceUtil\n+import java.util.concurrent.TimeUnit\n import javax.inject.Singleton\n \n @Module\n@@ -77,6 +80,8 @@ object DownloaderModule {\n   @Singleton\n   fun provideOkHttpDownloader() = OkHttpDownloader(\n     OkHttpClient.Builder()\n+      .connectTimeout(CONNECT_TIME_OUT, TimeUnit.MINUTES)\n+      .readTimeout(READ_TIME_OUT, TimeUnit.MINUTES)\n       .followRedirects(true)\n       .followSslRedirects(true)\n       .build()\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/DownloadRequester.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/DownloadRequester.kt\nindex cf41124ab3..33c73c508f 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/DownloadRequester.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/DownloadRequester.kt\n@@ -22,4 +22,5 @@ import org.kiwix.kiwixmobile.core.downloader.model.DownloadRequest\n interface DownloadRequester {\n   fun enqueue(downloadRequest: DownloadRequest): Long\n   fun cancel(downloadId: Long)\n+  fun retryDownload(downloadId: Long)\n }\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/Downloader.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/Downloader.kt\nindex 53f5c4d5a6..4f9d09b50f 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/Downloader.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/Downloader.kt\n@@ -22,4 +22,5 @@ import org.kiwix.kiwixmobile.core.entity.LibraryNetworkEntity\n interface Downloader {\n   fun download(book: LibraryNetworkEntity.Book)\n   fun cancelDownload(downloadId: Long)\n+  fun retryDownload(downloadId: Long)\n }\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/DownloaderImpl.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/DownloaderImpl.kt\nindex 7483d0be05..291ebf74d2 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/DownloaderImpl.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/DownloaderImpl.kt\n@@ -49,4 +49,8 @@ class DownloaderImpl @Inject constructor(\n   override fun cancelDownload(downloadId: Long) {\n     downloadRequester.cancel(downloadId)\n   }\n+\n+  override fun retryDownload(downloadId: Long) {\n+    downloadRequester.retryDownload(downloadId)\n+  }\n }\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/fetch/FetchDownloadRequester.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/fetch/FetchDownloadRequester.kt\nindex b53d77e520..cb312342b1 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/fetch/FetchDownloadRequester.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/downloader/fetch/FetchDownloadRequester.kt\n@@ -23,6 +23,7 @@ import com.tonyodev.fetch2.NetworkType.WIFI_ONLY\n import com.tonyodev.fetch2.Request\n import org.kiwix.kiwixmobile.core.downloader.DownloadRequester\n import org.kiwix.kiwixmobile.core.downloader.model.DownloadRequest\n+import org.kiwix.kiwixmobile.core.utils.AUTO_RETRY_MAX_ATTEMPTS\n import org.kiwix.kiwixmobile.core.utils.SharedPreferenceUtil\n import javax.inject.Inject\n \n@@ -40,10 +41,14 @@ class FetchDownloadRequester @Inject constructor(\n   override fun cancel(downloadId: Long) {\n     fetch.delete(downloadId.toInt())\n   }\n+\n+  override fun retryDownload(downloadId: Long) {\n+    fetch.retry(downloadId.toInt())\n+  }\n }\n \n private fun DownloadRequest.toFetchRequest(sharedPreferenceUtil: SharedPreferenceUtil) =\n   Request(\"$uri\", getDestination(sharedPreferenceUtil)).apply {\n     networkType = if (sharedPreferenceUtil.prefWifiOnly) WIFI_ONLY else ALL\n-    autoRetryMaxAttempts = 10\n+    autoRetryMaxAttempts = AUTO_RETRY_MAX_ATTEMPTS\n   }\ndiff --git a/core/src/main/java/org/kiwix/kiwixmobile/core/utils/Constants.kt b/core/src/main/java/org/kiwix/kiwixmobile/core/utils/Constants.kt\nindex 927d6f54fb..a1ad44a29d 100644\n--- a/core/src/main/java/org/kiwix/kiwixmobile/core/utils/Constants.kt\n+++ b/core/src/main/java/org/kiwix/kiwixmobile/core/utils/Constants.kt\n@@ -44,3 +44,10 @@ const val INTERNAL_SELECT_POSITION = 0\n const val EXTERNAL_SELECT_POSITION = 1\n \n const val FILE_SELECT_CODE = 5\n+\n+// For Read and Connect timeout on download OkHttpClient both are in minutes\n+const val READ_TIME_OUT = 1L\n+const val CONNECT_TIME_OUT = 1L\n+\n+// For autoRetryMaxAttempts in download zim file\n+const val AUTO_RETRY_MAX_ATTEMPTS = 20\n", "changes": [{"file": "app/src/main/java/org/kiwix/kiwixmobile/nav/destination/library/OnlineLibraryFragment.kt", "module": "org.kiwix.kiwixmobile.nav.destination.library.OnlineLibraryFragment", "range": [{"start": 49, "end": 49}, {"start": 109, "end": 113}]}, {"file": "app/src/main/java/org/kiwix/kiwixmobile/zim_manager/library_view/adapter/LibraryListItem.kt", "module": "org.kiwix.kiwixmobile.zim_manager.library_view.adapter.LibraryListItem", "range": [{"start": 22, "end": 22}, {"start": 72, "end": 73}, {"start": 87, "end": 88}]}, {"file": "app/src/main/java/org/kiwix/kiwixmobile/zim_manager/library_view/adapter/LibraryViewHolder.kt", "module": "org.kiwix.kiwixmobile.zim_manager.library_view.adapter.LibraryViewHolder", "range": [{"start": 26, "end": 26}, {"start": 102, "end": 102}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/di/modules/DownloaderModule.kt", "module": "org.kiwix.kiwixmobile.core.di.modules.DownloaderModule", "range": [{"start": 37, "end": 37}, {"start": 38, "end": 38}, {"start": 80, "end": 80}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/downloader/DownloadRequester.kt", "module": "org.kiwix.kiwixmobile.core.downloader.DownloadRequester", "range": [{"start": 25, "end": 25}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/downloader/Downloader.kt", "module": "org.kiwix.kiwixmobile.core.downloader.Downloader", "range": [{"start": 25, "end": 25}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/downloader/DownloaderImpl.kt", "module": "org.kiwix.kiwixmobile.core.downloader.DownloaderImpl", "range": [{"start": 52, "end": 52}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/downloader/fetch/FetchDownloadRequester.kt", "module": "org.kiwix.kiwixmobile.core.downloader.fetch.FetchDownloadRequester", "range": [{"start": 26, "end": 26}, {"start": 43, "end": 43}, {"start": 48, "end": 49}]}, {"file": "core/src/main/java/org/kiwix/kiwixmobile/core/utils/Constants.kt", "module": "org.kiwix.kiwixmobile.core.utils.Constants", "range": [{"start": 47, "end": 47}]}]}]}
{"url": "https://github.com/kiwix/kiwix-android/issues/825", "repo": {"url": "https://github.com/kiwix/kiwix-android", "name": "kiwix-android", "owner": "kiwix", "modules": ["custom", "eu.mhutti1.utils.storage", "org.kiwix.kiwixmobile", "org.kiwix.kiwixmobile.core", "org.kiwix.kiwixmobile.custom", "org.kiwix.kiwixmobile.deeplinks", "org.kiwix.kiwixmobile.di", "org.kiwix.kiwixmobile.download", "org.kiwix.kiwixmobile.error", "org.kiwix.kiwixmobile.help", "org.kiwix.kiwixmobile.initial", "org.kiwix.kiwixmobile.intro", "org.kiwix.kiwixmobile.language", "org.kiwix.kiwixmobile.localFileTransfer", "org.kiwix.kiwixmobile.localLibrary", "org.kiwix.kiwixmobile.main", "org.kiwix.kiwixmobile.migration", "org.kiwix.kiwixmobile.mimetype", "org.kiwix.kiwixmobile.nav", "org.kiwix.kiwixmobile.note", "org.kiwix.kiwixmobile.page", "org.kiwix.kiwixmobile.reader", "org.kiwix.kiwixmobile.roomDao", "org.kiwix.kiwixmobile.search", "org.kiwix.kiwixmobile.settings", "org.kiwix.kiwixmobile.shortcuts", "org.kiwix.kiwixmobile.splash", "org.kiwix.kiwixmobile.storage", "org.kiwix.kiwixmobile.testutils", "org.kiwix.kiwixmobile.ui", "org.kiwix.kiwixmobile.utils", "org.kiwix.kiwixmobile.webserver", "org.kiwix.kiwixmobile.widgets", "org.kiwix.kiwixmobile.zimManager", "org.kiwix.sharedFunctions", "org.kiwix.videowebview", "plugin"]}, "issue": {"number": 825, "url": "https://github.com/kiwix/kiwix-android/issues/825", "state": "closed", "title": "Not able to open any ZIM file with last nightly", "body": "ZIM files are correctly listed in the library, but if I click on one of them, the app crash\r\n\r\n**Environment**\r\n- Version of Kiwix Android : 2.4\r\n- Device : old Samsung Galaxy tab\r\n- OS version : 4.2.2\r\n\r\n[android.log](https://github.com/kiwix/kiwix-android/files/2238543/android.log)\r\n", "logs": [{"name": "android.log", "url": "https://github.com/kiwix/kiwix-android/files/2238543/android.log"}]}, "pull_request": [{"number": 829, "url": "https://github.com/kiwix/kiwix-android/pull/829", "diff_url": "https://github.com/kiwix/kiwix-android/pull/829.diff", "patch_url": "https://github.com/kiwix/kiwix-android/pull/829.patch", "title": "Mhutti1/strip html", "content": "Fixes #825 \r\n\r\nhttps://drive.google.com/file/d/1GeG9Vdh8jPPriJn4KWbo9TAbrU81uF37/view?usp=sharing", "diff": "diff --git a/app/build.gradle b/app/build.gradle\nindex 6fc2b8a854..f35ff9850a 100644\n--- a/app/build.gradle\n+++ b/app/build.gradle\n@@ -33,7 +33,7 @@ dependencies {\n \n   // Get kiwixlib online if it is not populated locally\n   if (file(\"../kiwixlib/src/main\").list().length == 1) {\n-    implementation 'org.kiwix.kiwixlib:kiwixlib:1.0.9'\n+    implementation 'org.kiwix.kiwixlib:kiwixlib:1.0.11'\n   } else {\n     implementation project(':kiwixlib')\n     archs = file(\"../kiwixlib/src/main/jniLibs\").list()\ndiff --git a/app/src/main/java/org/kiwix/kiwixmobile/TabDrawerAdapter.java b/app/src/main/java/org/kiwix/kiwixmobile/TabDrawerAdapter.java\nindex 4395583187..a32089e937 100644\n--- a/app/src/main/java/org/kiwix/kiwixmobile/TabDrawerAdapter.java\n+++ b/app/src/main/java/org/kiwix/kiwixmobile/TabDrawerAdapter.java\n@@ -58,11 +58,13 @@ public TabDrawerAdapter.ViewHolder onCreateViewHolder(ViewGroup parent, int view\n   @Override\n   public void onBindViewHolder(ViewHolder holder, int position) {\n     KiwixWebView webView = webViews.get(position);\n-    String webViewTitle = stripHtml(webView.getTitle());\n-    if(webViewTitle.contains(\"REPLACE_\")) {\n-      webViewTitle = getResourceString(appContext, webViewTitle);\n+    if (webView.getTitle() != null) {\n+      String webViewTitle = stripHtml(webView.getTitle());\n+      if (webViewTitle.contains(\"REPLACE_\")) {\n+        webViewTitle = getResourceString(appContext, webViewTitle);\n+      }\n+      holder.title.setText(webViewTitle);\n     }\n-    holder.title.setText(webViewTitle);\n     holder.exit.setOnClickListener(v -> listener.onCloseTab(v, position));\n     holder.itemView.setOnClickListener(v -> {\n       listener.onSelectTab(v, position);\n", "changes": [{"file": "app/src/main/java/org/kiwix/kiwixmobile/TabDrawerAdapter.java", "module": "org.kiwix.kiwixmobile.TabDrawerAdapter", "range": [{"start": 61, "end": 64}, {"start": 65, "end": 65}]}]}]}
{"url": "https://github.com/termux/termux-api/issues/276", "repo": {"url": "https://github.com/termux/termux-api", "name": "termux-api", "owner": "termux", "modules": ["com.termux.api", "com.termux.api.activities", "com.termux.api.apis", "com.termux.api.settings.activities", "com.termux.api.settings.fragments.termux_api_app", "com.termux.api.settings.fragments.termux_api_app.debugging", "com.termux.api.util"]}, "issue": {"number": 276, "url": "https://github.com/termux/termux-api/issues/276", "state": "closed", "title": "termux-job-scheduler hangs indefinitely when scheduling a new job", "body": "**Problem description**\r\n`termux-job-scheduler` is unable to schedule a job, and hangs when I try to.\r\n\r\n**Steps to reproduce**\r\n```\r\ncat > ~/script <<EOF\r\n#!/data/data/com.termux/files/usr/bin/bash\r\ntermux-notification --content \"$(date)\"\r\nEOF\r\nchmod +x ~/script\r\ntermux-job-scheduler --script ~/script --period-ms 1800000\r\n```\r\n\r\n**Expected behavior**\r\n`script` is scheduled to run every 30m  5m and `termux-job-scheduler` exits.\r\n\r\n**Actual behavior**\r\nthe script runs once, but `termux-job-scheduler` hangs. `termux-job-scheduler --pending` run in another session doesn't output anything.\r\n\r\n**Additional information**\r\ntermux-info:\r\n```\r\nUpdatable packages:\r\nAll packages up to date\r\nSubscribed repositories:\r\nhttps://dl.bintray.com/grimler/science-packages-24 science/stable\r\nhttps://dl.bintray.com/grimler/game-packages-24 games/stable\r\nhttps://dl.bintray.com/termux/termux-packages-24 stable/main\r\nSystem information:\r\nLinux localhost 4.4.23+ #1 SMP PREEMPT Tue Jun 12 17:03:20 CST 2018 aarch64 Android\r\nTermux-packages arch:\r\naarch64\r\nAndroid version:\r\n9\r\nDevice manufacturer:\r\nHUAWEI\r\nDevice model:\r\nPRA-LX1\r\n```\r\nLog: [log-adb.txt](https://github.com/termux/termux-api/files/3464771/log-adb.txt)\r\n", "logs": [{"name": "log-adb.txt", "url": "https://github.com/termux/termux-api/files/3464771/log-adb.txt"}]}, "pull_request": [{"number": 277, "url": "https://github.com/termux/termux-api/pull/277", "diff_url": "https://github.com/termux/termux-api/pull/277.diff", "patch_url": "https://github.com/termux/termux-api/pull/277.patch", "title": "Provide a default for --network (= \"any\") to fix #276", "content": "fixes #276\r\n\r\nUnfortunately I'm on vacation with only a laptop which doesn't have the Android SDK, so this commit is untested.", "diff": "diff --git a/app/src/main/java/com/termux/api/JobSchedulerAPI.java b/app/src/main/java/com/termux/api/JobSchedulerAPI.java\nindex 3aa9c42e5..4fd52a4ed 100644\n--- a/app/src/main/java/com/termux/api/JobSchedulerAPI.java\n+++ b/app/src/main/java/com/termux/api/JobSchedulerAPI.java\n@@ -92,6 +92,8 @@ static void onReceive(TermuxApiReceiver apiReceiver, Context context, Intent int\n                     networkTypeCode = JobInfo.NETWORK_TYPE_NONE;\n                     break;\n             }\n+        } else { // networkType == null\n+            networkTypeCode = JobInfo.NETWORK_TYPE_ANY;\n         }\n \n \n", "changes": [{"file": "app/src/main/java/com/termux/api/JobSchedulerAPI.java", "module": "com.termux.api.JobSchedulerAPI", "range": [{"start": 95, "end": 95}]}]}]}
{"url": "https://github.com/Tornaco/Thanox/issues/480", "repo": {"url": "https://github.com/Tornaco/Thanox", "name": "Thanox", "owner": "Tornaco", "modules": ["com.android.dex", "com.android.dx", "com.android.multidex", "com.android.systemui", "com.elvishew.xlog", "com.godaddy.android", "com.google.android", "com.miguelcatalan.materialsearchview", "com.nononsenseapps.filepicker", "com.simplecityapps.recyclerview_fastscroll", "com.stardust.autojs", "github.tornaco.android", "github.tornaco.permission", "github.tornaco.practice", "github.tornaco.thanos", "github.tornaco.thanox", "github.tornaco.xposed", "io.github.libxposed", "lang3", "lang3.builder", "lang3.exception", "lang3.mutable", "lang3.reflect", "lang3.tuple", "mobi.upod.timedurationpicker", "now.fortuitous.thanos", "org.burnoutcrew.reorderable", "pxb.android", "pxb.android.arsc", "pxb.android.axml", "rx2.android", "rx2.android.plugins", "rx2.android.schedulers", "si.virag.fuzzydateformatter", "tornaco.project.android", "util", "util.os", "util.q", "zhao.arsceditor", "zhao.arsceditor.ResDecoder"]}, "issue": {"number": 480, "url": "https://github.com/Tornaco/Thanox/issues/480", "state": "closed", "title": "12L", "body": "1.  \r\nAndroid 12\r\n2. Thanoxxposedmagisk\r\nLsposed\r\n3. \r\n\r\n4. thanox\r\n\r\n5. Thanox\r\n\r\n6.  appissue\r\n[log.txt](https://github.com/Tornaco/Thanox/files/8589513/log.txt)\r\n", "logs": [{"name": "log.txt", "url": "https://github.com/Tornaco/Thanox/files/8589513/log.txt"}]}, "pull_request": [{"number": 955, "url": "https://github.com/Tornaco/Thanox/pull/955", "diff_url": "https://github.com/Tornaco/Thanox/pull/955.diff", "patch_url": "https://github.com/Tornaco/Thanox/pull/955.patch", "title": "Bump com.github.skydoves:landscapist-glide from 2.3.2 to 2.3.4 in /android", "content": "Bumps [com.github.skydoves:landscapist-glide](https://github.com/skydoves/landscapist) from 2.3.2 to 2.3.4.\n<details>\n<summary>Release notes</summary>\n<p><em>Sourced from <a href=\"https://github.com/skydoves/landscapist/releases\">com.github.skydoves:landscapist-glide's releases</a>.</em></p>\n<blockquote>\n<h2>2.3.4</h2>\n<h2>What's Changed</h2>\n<ul>\n<li>Update androidxMacroBenchmark to v1.2.4 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/469\">skydoves/landscapist#469</a></li>\n<li>Update dependency androidx.compose:compose-bom to v2024.04.01 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/470\">skydoves/landscapist#470</a></li>\n<li>Update dependency androidx.activity:activity-compose to v1.9.0 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/471\">skydoves/landscapist#471</a></li>\n<li>Update dependency androidx.core:core-ktx to v1.13.0 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/472\">skydoves/landscapist#472</a></li>\n<li>Update gradle/gradle-build-action action to v3.3.1 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/473\">skydoves/landscapist#473</a></li>\n<li>Fix typo docs/sponsor.md by <a href=\"https://github.com/danielpassos\"><code>@danielpassos</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/474\">skydoves/landscapist#474</a></li>\n<li>Update actions/checkout action to v4.1.3 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/475\">skydoves/landscapist#475</a></li>\n<li>Update actions/checkout action to v4.1.4 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/476\">skydoves/landscapist#476</a></li>\n<li>Update gradle/gradle-build-action action to v3.3.2 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/477\">skydoves/landscapist#477</a></li>\n<li>Update androidGradlePlugin to v8.4.0 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/478\">skydoves/landscapist#478</a></li>\n<li>Update dependency androidx.core:core-ktx to v1.13.1 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/479\">skydoves/landscapist#479</a></li>\n<li>Update dependency androidx.compose:compose-bom to v2024.05.00 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/480\">skydoves/landscapist#480</a></li>\n<li>Update dependency com.google.android.material:material to v1.12.0 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/481\">skydoves/landscapist#481</a></li>\n<li>Update ktor to v2.3.11 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/483\">skydoves/landscapist#483</a></li>\n<li>Update actions/checkout action to v4.1.5 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/484\">skydoves/landscapist#484</a></li>\n<li>Update actions/checkout action to v4.1.6 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/485\">skydoves/landscapist#485</a></li>\n<li>Update dependency org.jetbrains.compose to v1.6.10 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/486\">skydoves/landscapist#486</a></li>\n<li>Update androidGradlePlugin to v8.4.1 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/487\">skydoves/landscapist#487</a></li>\n<li>Update dependency gradle to v8.8 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/489\">skydoves/landscapist#489</a></li>\n<li>Update dependency org.jetbrains.compose to v1.6.11 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/490\">skydoves/landscapist#490</a></li>\n<li>Update fresco to v3.2.0 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/491\">skydoves/landscapist#491</a></li>\n<li>Migrate Kotlin to 2.0.0 and Compose compiler plugin by <a href=\"https://github.com/skydoves\"><code>@skydoves</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/492\">skydoves/landscapist#492</a></li>\n<li>Update baseline profiles by <a href=\"https://github.com/skydoves\"><code>@skydoves</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/493\">skydoves/landscapist#493</a></li>\n</ul>\n<h2>New Contributors</h2>\n<ul>\n<li><a href=\"https://github.com/danielpassos\"><code>@danielpassos</code></a> made their first contribution in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/474\">skydoves/landscapist#474</a></li>\n</ul>\n<p><strong>Full Changelog</strong>: <a href=\"https://github.com/skydoves/landscapist/compare/2.3.3...2.3.4\">https://github.com/skydoves/landscapist/compare/2.3.3...2.3.4</a></p>\n<h2>2.3.3</h2>\n<h2>What's Changed</h2>\n<ul>\n<li>Generate baseline profiles by <a href=\"https://github.com/github-actions\"><code>@github-actions</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/444\">skydoves/landscapist#444</a></li>\n<li>Update ktor to v2.3.9 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/446\">skydoves/landscapist#446</a></li>\n<li>Update dependency org.jetbrains.dokka to v1.9.20 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/447\">skydoves/landscapist#447</a></li>\n<li>Update dependency androidx.compose:compose-bom to v2024.02.02 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/448\">skydoves/landscapist#448</a></li>\n<li>Update dependency com.vanniktech.maven.publish to v0.28.0 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/400\">skydoves/landscapist#400</a></li>\n<li>Update actions/setup-java action to v4.2.0 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/449\">skydoves/landscapist#449</a></li>\n<li>Update dependency org.jetbrains.compose to v1.6.1 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/450\">skydoves/landscapist#450</a></li>\n<li>Update actions/setup-java action to v4.2.1 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/451\">skydoves/landscapist#451</a></li>\n<li>Update androidGradlePlugin to v8.3.1 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/454\">skydoves/landscapist#454</a></li>\n<li>Update README.md by <a href=\"https://github.com/KwonDae\"><code>@KwonDae</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/455\">skydoves/landscapist#455</a></li>\n<li>Update dependency androidx.compose:compose-bom to v2024.03.00 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/456\">skydoves/landscapist#456</a></li>\n<li>Update dependency gradle to v8.7 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/457\">skydoves/landscapist#457</a></li>\n<li>Update hilt to v2.51.1 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/458\">skydoves/landscapist#458</a></li>\n<li>Bump Kotlin to 1.9.23, jetbrains compose to 1.6.1 by <a href=\"https://github.com/skydoves\"><code>@skydoves</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/459\">skydoves/landscapist#459</a></li>\n<li>Update dependency androidx.compose:compose-bom to v2024.04.00 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/460\">skydoves/landscapist#460</a></li>\n<li>Update gradle/gradle-build-action action to v3.2.0 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/461\">skydoves/landscapist#461</a></li>\n<li>Update ktor to v2.3.10 by <a href=\"https://github.com/renovate\"><code>@renovate</code></a> in <a href=\"https://redirect.github.com/skydoves/landscapist/pull/462\">skydoves/landscapist#462</a></li>\n</ul>\n<!-- raw HTML omitted -->\n</blockquote>\n<p>... (truncated)</p>\n</details>\n<details>\n<summary>Commits</summary>\n<ul>\n<li><a href=\"https://github.com/skydoves/landscapist/commit/3c213c91cd83bdc7b9146995ebd911e8c3f2d8fe\"><code>3c213c9</code></a> Prepare for release 2.3.4</li>\n<li><a href=\"https://github.com/skydoves/landscapist/commit/04c242307d5c7bb6b43649ecda678868a2394e5d\"><code>04c2423</code></a> Merge pull request <a href=\"https://redirect.github.com/skydoves/landscapist/issues/493\">#493</a> from skydoves/baseline-prof/0607</li>\n<li><a href=\"https://github.com/skydoves/landscapist/commit/51a547534ea9cecad0cd121e2c7bf76afac74782\"><code>51a5475</code></a> Update baseline profiles</li>\n<li><a href=\"https://github.com/skydoves/landscapist/commit/5d9cdf5987ef2fcd681695fbd3315d4663c0afb2\"><code>5d9cdf5</code></a> Merge pull request <a href=\"https://redirect.github.com/skydoves/landscapist/issues/492\">#492</a> from skydoves/kotlin/2.0</li>\n<li><a href=\"https://github.com/skydoves/landscapist/commit/3af23384bf0202237878d737302b307496150f0f\"><code>3af2338</code></a> Override missing abstract methods</li>\n<li><a href=\"https://github.com/skydoves/landscapist/commit/6d4de00b387d797ce455a2232f5354e49fd84d55\"><code>6d4de00</code></a> Fix Compose compiler plugin migration issues</li>\n<li><a href=\"https://github.com/skydoves/landscapist/commit/0f97da04ae18cb0b65fab8165046a0cf4f366e1a\"><code>0f97da0</code></a> Merge branch 'kotlin/2.0' of <a href=\"https://github.com/skydoves/landscapist\">https://github.com/skydoves/landscapist</a> into kot...</li>\n<li><a href=\"https://github.com/skydoves/landscapist/commit/3392c9410b2fd45bfdb190b7ef9353edbc9f6552\"><code>3392c94</code></a> Use Stable annotation for sealed classes and data objects</li>\n<li><a href=\"https://github.com/skydoves/landscapist/commit/c476db114315c6c7c15b77e5264f546fff696f27\"><code>c476db1</code></a> Merge branch 'main' into kotlin/2.0</li>\n<li><a href=\"https://github.com/skydoves/landscapist/commit/ee947ee1111239878aa221927b42b9d1482a3a6f\"><code>ee947ee</code></a> Migrate Kotlin to 2.0.0 and Compose compiler plugin</li>\n<li>Additional commits viewable in <a href=\"https://github.com/skydoves/landscapist/compare/2.3.2...2.3.4\">compare view</a></li>\n</ul>\n</details>\n<br />\n\n\n[![Dependabot compatibility score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=com.github.skydoves:landscapist-glide&package-manager=gradle&previous-version=2.3.2&new-version=2.3.4)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)\n\nYou can trigger a rebase of this PR by commenting `@dependabot rebase`.\n\n[//]: # (dependabot-automerge-start)\n[//]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options</summary>\n<br />\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot show <dependency name> ignore conditions` will show all of the ignore conditions of the specified dependency\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\n\n\n</details>\n\n> **Note**\n> Automatic rebases have been disabled on this pull request as it has been open for over 30 days.\n", "diff": "diff --git a/android/gradle/libs.versions.toml b/android/gradle/libs.versions.toml\nindex 198eb9a0a..e97d9b5bf 100644\n--- a/android/gradle/libs.versions.toml\n+++ b/android/gradle/libs.versions.toml\n@@ -204,7 +204,7 @@ compose-ui-viewbinding = { module = \"androidx.compose.ui:ui-viewbinding\", versio\n datastore-preferences = { module = \"androidx.datastore:datastore-preferences\", version.ref = \"datastore-preferences\" }\n glide = { group = \"com.github.bumptech.glide\", name = \"glide\", version.ref = \"glide\" }\n glide-compiler = { group = \"com.github.bumptech.glide\", name = \"compiler\", version.ref = \"glide\" }\n-glide-landscapist = { module = \"com.github.skydoves:landscapist-glide\", version = \"2.3.2\" }\n+glide-landscapist = { module = \"com.github.skydoves:landscapist-glide\", version = \"2.3.4\" }\n \n junit = { module = \"junit:junit\", version.ref = \"junit\" }\n kotlin-reflect = { module = \"org.jetbrains.kotlin:kotlin-reflect\", version.ref = \"kotlin-reflect\" }\n", "changes": [{"file": "android/gradle/libs.versions.toml", "module": "android.gradle.libs.versions.toml", "range": [{"start": 207, "end": 208}]}]}]}
{"url": "https://github.com/cgeo/cgeo/issues/9509", "repo": {"url": "https://github.com/cgeo/cgeo", "name": "cgeo", "owner": "cgeo", "modules": ["app.organicmaps.api", "cgeo.geocaching", "cgeo.geocaching.about", "cgeo.geocaching.activity", "cgeo.geocaching.address", "cgeo.geocaching.apps", "cgeo.geocaching.backup", "cgeo.geocaching.brouter", "cgeo.geocaching.calendar", "cgeo.geocaching.command", "cgeo.geocaching.connector", "cgeo.geocaching.contacts", "cgeo.geocaching.downloader", "cgeo.geocaching.enumerations", "cgeo.geocaching.export", "cgeo.geocaching.files", "cgeo.geocaching.filters", "cgeo.geocaching.helper", "cgeo.geocaching.list", "cgeo.geocaching.loaders", "cgeo.geocaching.location", "cgeo.geocaching.log", "cgeo.geocaching.maps", "cgeo.geocaching.models", "cgeo.geocaching.network", "cgeo.geocaching.permission", "cgeo.geocaching.playservices", "cgeo.geocaching.search", "cgeo.geocaching.sensors", "cgeo.geocaching.service", "cgeo.geocaching.settings", "cgeo.geocaching.sorting", "cgeo.geocaching.speech", "cgeo.geocaching.storage", "cgeo.geocaching.test", "cgeo.geocaching.ui", "cgeo.geocaching.unifiedmap", "cgeo.geocaching.utils", "cgeo.geocaching.wherigo", "cgeo.test", "cgeo.watchdog"]}, "issue": {"number": 9509, "url": "https://github.com/cgeo/cgeo/issues/9509", "state": "closed", "title": "[Nightly] Crash when adding WP from clipboard", "body": "**Describe the bug:**\r\nCreated a parking WP in a cache yesterday. Tried to copy it via clipboard to another cache today => crash.\r\nCross-checked afterwards with a reference point => same result.\r\n\r\n**To Reproduce:**\r\n1. Create a WP in any cache\r\n2. Copy WP to clipboard\r\n3. Go to another cache and insert WP from clipboard\r\n\r\n**Actual behavior/state after performing these steps:**\r\nc:geo crashes and re-starts in main screen.\r\n\r\n**Expected behavior/state after performing these steps:**\r\nGuess what ...  ;)\r\n\r\n**Version of c:geo used:**\r\n2020,12.06-NB-b5f906d\r\n\r\n**Is the problem reproducible:**\r\nYes - at least most of the times. ;)\r\nBefore filing the BR, I first checked the scenario described above with latest Nightly - and most surprisingly it worked.\r\nOk, I thought, has been corrected. Fine. So I did the same with the WP, I *really* wanted to copy ... => crash.  :/\r\nSo it may possibly take some attempts to reproduce ... see [logcat.txt](https://github.com/cgeo/cgeo/files/5649729/logcat_2020-12-06_23-50.txt) for details.\r\n\r\n**System information:**\r\n```\r\n--- System information ---\r\nDevice: VOG-L29 (VOG-L29EEA, HUAWEI)\r\nAndroid version: 10\r\nAndroid build: VOG-L29 10.1.0.150(C431E19R2P5)\r\nc:geo version: 2020.12.06-NB-b5f906d\r\nGoogle Play services: disabled - 20.45.16 (120400-344294571)\r\nLow power mode: inactive\r\nCompass capabilities: yes\r\nRotation vector sensor: present\r\nOrientation sensor: present\r\nMagnetometer & Accelerometer sensor: present\r\nDirection sensor used: rotation vector\r\nHide caches: own/found archived\r\nHide waypoints: -\r\nHW acceleration: enabled (default state)\r\nSystem language: en_DE\r\nSystem date format: dd/MM/y\r\nDebug mode active: no\r\nSystem internal c:geo dir: /data/user/0/cgeo.geocaching (71,2 GB free) internal\r\nUser storage c:geo dir: /storage/emulated/0/cgeo (71,1 GB free) external non-removable\r\nGeocache data: /storage/emulated/0/Android/data/cgeo.geocaching/files/GeocacheData (71,1 GB free) external non-removable\r\nDatabase: /data/user/0/cgeo.geocaching/databases/data (315,6 MB) on system internal storage\r\nLast backup: 5 Dec, 02:42\r\nGPX import path: /storage/emulated/0/Download\r\nGPX export path: /storage/emulated/0/Download\r\nOffline maps path: /storage/0123-4567/Locus/mapsVector\r\nMap render theme path: /storage/0123-4567/Locus/mapsVector/_themes/Elevate4/Elements.xml\r\nLive map mode: true\r\nGlobal filter: display all caches\r\nFine location permission: granted\r\nWrite external storage permission: granted\r\nGeocaching sites enabled:\r\n   geocaching.com: Logged in (Login OK) / PREMIUM\r\n   extremcaching.com: Logged in (Login OK)\r\nGeocaching.com date format: dd MMM yy\r\nInstalled c:geo plugins: contacts\r\nBRouter connection available: true\r\n--- End of system information ---\r\n```", "logs": [{"name": "logcat.txt", "url": "https://github.com/cgeo/cgeo/files/5649729/logcat_2020-12-06_23-50.txt"}]}, "pull_request": [{"number": 9527, "url": "https://github.com/cgeo/cgeo/pull/9527", "diff_url": "https://github.com/cgeo/cgeo/pull/9527.diff", "patch_url": "https://github.com/cgeo/cgeo/pull/9527.patch", "title": "avoid crash on adding waypoint via clipboard (fix #9509)", "content": "Attempts to fix #9509 - do not create the new waypoint in a background thread, as that cannot upgrade the UI elements.", "diff": "diff --git a/main/src/cgeo/geocaching/CacheDetailActivity.java b/main/src/cgeo/geocaching/CacheDetailActivity.java\nindex fd3e430f1f5..4c639715ab8 100644\n--- a/main/src/cgeo/geocaching/CacheDetailActivity.java\n+++ b/main/src/cgeo/geocaching/CacheDetailActivity.java\n@@ -1944,34 +1944,22 @@ protected void onPostExecute(final Boolean result) {\n             setClipboardButtonVisibility(addWaypointFromClipboard);\n             addWaypointFromClipboard.setOnClickListener(v2 -> {\n                 final Waypoint oldWaypoint = DataStore.loadWaypoint(Waypoint.hasClipboardWaypoint());\n-                new AsyncTask<Void, Void, Boolean>() {\n-                    @Override\n-                    protected Boolean doInBackground(final Void... params) {\n-                        if (null != oldWaypoint) {\n-                            ensureSaved();\n-                            final Waypoint newWaypoint = cache.duplicateWaypoint(oldWaypoint);\n-                            if (null != newWaypoint) {\n-                                DataStore.saveCache(cache, EnumSet.of(SaveFlag.DB));\n-                                addWaypointAndSort(sortedWaypoints, newWaypoint);\n-                                return true;\n-                            }\n-                        }\n-                        return false;\n-                    }\n-\n-                    @Override\n-                    protected void onPostExecute(final Boolean result) {\n-                        if (result) {\n-                            adapter.notifyDataSetChanged();\n-                            if (oldWaypoint.isUserDefined()) {\n-                                Dialogs.confirmYesNo((Activity) view.getContext(), R.string.cache_waypoints_add_fromclipboard, R.string.cache_waypoints_remove_original_waypoint, (dialog, which) -> {\n-                                    DataStore.deleteWaypoint(oldWaypoint.getId());\n-                                    ClipboardUtils.clearClipboard();\n-                                });\n-                            }\n+                if (null != oldWaypoint) {\n+                    ensureSaved();\n+                    final Waypoint newWaypoint = cache.duplicateWaypoint(oldWaypoint);\n+                    if (null != newWaypoint) {\n+                        DataStore.saveCache(cache, EnumSet.of(SaveFlag.DB));\n+                        addWaypointAndSort(sortedWaypoints, newWaypoint);\n+                        adapter.notifyDataSetChanged();\n+                        reinitializePage(Page.WAYPOINTS);\n+                        if (oldWaypoint.isUserDefined()) {\n+                            Dialogs.confirmYesNo((Activity) view.getContext(), R.string.cache_waypoints_add_fromclipboard, R.string.cache_waypoints_remove_original_waypoint, (dialog, which) -> {\n+                                DataStore.deleteWaypoint(oldWaypoint.getId());\n+                                ClipboardUtils.clearClipboard();\n+                            });\n                         }\n                     }\n-                }.execute();\n+                }\n             });\n             final ClipboardManager cliboardManager = (ClipboardManager) getSystemService(CLIPBOARD_SERVICE);\n             cliboardManager.addPrimaryClipChangedListener(() -> setClipboardButtonVisibility(addWaypointFromClipboard));\n", "changes": [{"file": "main/src/cgeo/geocaching/CacheDetailActivity.java", "module": "cgeo.geocaching.CacheDetailActivity", "range": [{"start": 1947, "end": 1972}, {"start": 1974, "end": 1975}]}]}]}
{"url": "https://github.com/deltachat/deltachat-android/issues/2871", "repo": {"url": "https://github.com/deltachat/deltachat-android", "name": "deltachat-android", "owner": "deltachat", "modules": ["chat.delta.rpc", "chat.delta.rpc.types", "chat.delta.util", "com.b44t.messenger", "com.b44t.messenger.uibenchmarks", "com.b44t.messenger.uitests", "com.codewaves.stickyheadergrid", "org.thoughtcrime.securesms", "org.thoughtcrime.securesms.accounts", "org.thoughtcrime.securesms.animation", "org.thoughtcrime.securesms.attachments", "org.thoughtcrime.securesms.audio", "org.thoughtcrime.securesms.calls", "org.thoughtcrime.securesms.components", "org.thoughtcrime.securesms.connect", "org.thoughtcrime.securesms.contacts", "org.thoughtcrime.securesms.crypto", "org.thoughtcrime.securesms.database", "org.thoughtcrime.securesms.geolocation", "org.thoughtcrime.securesms.glide", "org.thoughtcrime.securesms.imageeditor", "org.thoughtcrime.securesms.jobmanager", "org.thoughtcrime.securesms.messagerequests", "org.thoughtcrime.securesms.mms", "org.thoughtcrime.securesms.notifications", "org.thoughtcrime.securesms.permissions", "org.thoughtcrime.securesms.preferences", "org.thoughtcrime.securesms.profiles", "org.thoughtcrime.securesms.providers", "org.thoughtcrime.securesms.proxy", "org.thoughtcrime.securesms.qr", "org.thoughtcrime.securesms.reactions", "org.thoughtcrime.securesms.recipients", "org.thoughtcrime.securesms.scribbles", "org.thoughtcrime.securesms.search", "org.thoughtcrime.securesms.service", "org.thoughtcrime.securesms.util", "org.thoughtcrime.securesms.video"]}, "issue": {"number": 2871, "url": "https://github.com/deltachat/deltachat-android/issues/2871", "state": "closed", "title": "After backup restore, 1:1 chat name overridden manually (by user) before changes to name of corresponding email contact in Android address book when message from respective contact is received", "body": "- Android version:\r\nAndroid 12.\r\n\r\n- Device:\r\nGoogle Pixel 3a (sargo).\r\n\r\n- Delta Chat version:\r\n1.42.1.\r\n\r\n- Expected behavior:\r\nA manually (by the user) applied name for a 1:1 chat does not change after a backup is restored, and after a message from a contact who is assigned to that chat is received.\r\n\r\n- Actual behavior:\r\nA manually (by the user) applied name for a 1:1 chat changes after a backup is restored, and after a message from a contact who is assigned to that chat is received.\r\n\r\n- Steps to reproduce the problem:\r\n-- Run a previous version (e.g. 1.40.1) of Delta Chat.\r\n-- Ensure that your Android address book includes a contact (e.g. `Alice C.`) with an email address that corresponds to a 1:1 chat in Delta Chat.\r\n-- Rename the corresponding 1:1 chat in Delta Chat (e.g. from `Alice C.` to `Alice Cooper`).\r\n-- Create a complete backup of your account, chats, and media.\r\n-- Go to Android settings and clear the cache and storage that are applied to Delta Chat.\r\n-- Uninstall Delta Chat.\r\n-- Install Delta Chat version 1.42.1.\r\n-- Restore the backup which you created before.\r\n-- Receive a message from the contact whose 1:1 chat name you changed before. (Result: The name of the corresponding 1:1 chat has changed from `Alice Cooper` to `Alice C.`.)\r\n\r\n- Screenshots:\r\nN/A.\r\n\r\n- Logs:\r\n[deltachat-log-20231117-084832_2.txt](https://github.com/deltachat/deltachat-android/files/13390958/deltachat-log-20231117-084832_2.txt)", "logs": [{"name": "deltachat-log-20231117-084832_2.txt", "url": "https://github.com/deltachat/deltachat-android/files/13390958/deltachat-log-20231117-084832_2.txt"}]}, "pull_request": [{"number": 2873, "url": "https://github.com/deltachat/deltachat-android/pull/2873", "diff_url": "https://github.com/deltachat/deltachat-android/pull/2873.diff", "patch_url": "https://github.com/deltachat/deltachat-android/pull/2873.patch", "title": "fix contact creation", "content": "this pr fixes my findings at https://github.com/deltachat/deltachat-android/issues/2871#issuecomment-1816239147 by looking up the contact-id before creating it with an empty name.\r\n\r\nin general, it seems undefined if you call createContact() with an empty name on an existing address with a name set. as createContact() is really only for \"user input\", it is probably okay to reset the name (and it was wrong to use this function here, maybe a relict from the old UI; the code is also overcomplex as it passes addresses though where IDs should be good enough, but yes ...)\r\n\r\nit need to be tested if this pr also fixes the issue @gerryfrancis reported at #2871 EDIT: closes #2871", "diff": "diff --git a/src/org/thoughtcrime/securesms/NewConversationActivity.java b/src/org/thoughtcrime/securesms/NewConversationActivity.java\nindex a33e4a61bb..c61838e649 100644\n--- a/src/org/thoughtcrime/securesms/NewConversationActivity.java\n+++ b/src/org/thoughtcrime/securesms/NewConversationActivity.java\n@@ -99,7 +99,7 @@ public void onContactSelected(int specialId, String addr) {\n     else {\n       int contactId = dcContext.lookupContactIdByAddr(addr);\n       if (contactId!=0 && dcContext.getChatIdByContactId(contactId)!=0) {\n-        openConversation(dcContext.createChatByContactId(contactId));\n+        openConversation(dcContext.getChatIdByContactId(contactId));\n       } else {\n         String nameNAddr = contactId == 0 ? addr : dcContext.getContact(contactId).getNameNAddr();\n         new AlertDialog.Builder(this)\n@@ -107,10 +107,13 @@ public void onContactSelected(int specialId, String addr) {\n                 .setCancelable(true)\n                 .setNegativeButton(android.R.string.cancel, null)\n                 .setPositiveButton(android.R.string.ok, (dialog, which) -> {\n-                  int contactId1 = dcContext.createContact(null, addr);\n+                  int contactId1 = dcContext.lookupContactIdByAddr(addr);\n                   if (contactId1 == 0) {\n-                    Toast.makeText(NewConversationActivity.this, R.string.bad_email_address, Toast.LENGTH_LONG).show();\n-                    return;\n+                    contactId1 = dcContext.createContact(null, addr);\n+                    if (contactId1 == 0) {\n+                      Toast.makeText(NewConversationActivity.this, R.string.bad_email_address, Toast.LENGTH_LONG).show();\n+                      return;\n+                    }\n                   }\n                   openConversation(dcContext.createChatByContactId(contactId1));\n                 }).show();\n", "changes": [{"file": "src/org/thoughtcrime/securesms/NewConversationActivity.java", "module": "org.thoughtcrime.securesms.NewConversationActivity", "range": [{"start": 102, "end": 103}, {"start": 110, "end": 111}, {"start": 112, "end": 114}]}]}]}
{"url": "https://github.com/deltachat/deltachat-android/issues/2400", "repo": {"url": "https://github.com/deltachat/deltachat-android", "name": "deltachat-android", "owner": "deltachat", "modules": ["chat.delta.rpc", "chat.delta.rpc.types", "chat.delta.util", "com.b44t.messenger", "com.b44t.messenger.uibenchmarks", "com.b44t.messenger.uitests", "com.codewaves.stickyheadergrid", "org.thoughtcrime.securesms", "org.thoughtcrime.securesms.accounts", "org.thoughtcrime.securesms.animation", "org.thoughtcrime.securesms.attachments", "org.thoughtcrime.securesms.audio", "org.thoughtcrime.securesms.calls", "org.thoughtcrime.securesms.components", "org.thoughtcrime.securesms.connect", "org.thoughtcrime.securesms.contacts", "org.thoughtcrime.securesms.crypto", "org.thoughtcrime.securesms.database", "org.thoughtcrime.securesms.geolocation", "org.thoughtcrime.securesms.glide", "org.thoughtcrime.securesms.imageeditor", "org.thoughtcrime.securesms.jobmanager", "org.thoughtcrime.securesms.messagerequests", "org.thoughtcrime.securesms.mms", "org.thoughtcrime.securesms.notifications", "org.thoughtcrime.securesms.permissions", "org.thoughtcrime.securesms.preferences", "org.thoughtcrime.securesms.profiles", "org.thoughtcrime.securesms.providers", "org.thoughtcrime.securesms.proxy", "org.thoughtcrime.securesms.qr", "org.thoughtcrime.securesms.reactions", "org.thoughtcrime.securesms.recipients", "org.thoughtcrime.securesms.scribbles", "org.thoughtcrime.securesms.search", "org.thoughtcrime.securesms.service", "org.thoughtcrime.securesms.util", "org.thoughtcrime.securesms.video"]}, "issue": {"number": 2400, "url": "https://github.com/deltachat/deltachat-android/issues/2400", "state": "closed", "title": "Messages not coming in anymore (probably due to dead idle tasks caused by network change)", "body": "- Operating System (Linux/Mac/Windows/iOS/Android):\r\nAndroid 11.\r\n\r\n- Delta Chat Version:\r\n1.33.0-1.34.5.\r\n\r\n- Expected behavior:\r\nMessages are coming in when the app is not focused and WLAN is the active network gateway.\r\n\r\n- Actual behavior:\r\nMessages are not coming in when the app is not focused and WLAN is the active network gateway.\r\n\r\n- Steps to reproduce the problem:\r\n-- Wait for the issue to occur, but use some other apps in the meantime. (WLAN and mobile data must be enabled on the device.)\r\n\r\n- Screenshots:\r\nN/A.\r\n\r\n- Logs:\r\n[deltachat-log-20220921-131932_2.txt](https://github.com/deltachat/deltachat-core-rust/files/9675549/deltachat-log-20220921-131932_2.txt)\r\n\r\n- Remarks:\r\nI doubt that the change from async-std to tokio has something to do with it. I think the culprit lies in how Delta Chat core recognizes old and new network tasks after a different network gateway is activated by the OS.\r\n![2022-09-26-19-51_2](https://user-images.githubusercontent.com/51095533/193065254-62b9c59d-2f1e-4983-888d-5b2c5f202fac.png)\r\nThis switch in Android developer options seems to drive two networks, e.g. LTE and WLAN, in parallel to improve delays for switching between the two networks. When enabled (default setting), the tasks bound to the LTE connection might remain in the back when WLAN is active. Delta Chat might try to hold on to the LTE connection tasks at some time, probably the app cannot distinguish between the \"old\" and \"new\" idle tasks properly, and various requests might run into a timeout. I cannot reproduce the issue after I disabled this developer function.\r\nAn [Android technote](https://developer.android.com/training/basics/network-ops/reading-network-state) says this:\r\n`All Android apps have a default network. The system decides which should be the default network. The system typically prefers unmetered networks to metered ones and faster networks to slower ones. When an app issues a network request, such as with [HttpsURLConnection](https://developer.android.com/reference/javax/net/ssl/HttpsURLConnection), the system satisfies this request using the default network. Apps can send traffic on other networks, too.`\r\nAnd further:\r\n`When a new network becomes the default, any new connection the app opens uses this network. At some point later, all remaining connections on the previous default network are forcefully terminated.`\r\nSo, the old connections seem to exist for a while, but they do not carry any data as soon as a different network has been set as default. The core might see the old tasks in memory, and therefore does not create any new ones. At a later time, the old tasks are getting killed by the OS, and new network tasks are never created when the app is never focused. This is just speculation, of course, but I guess that is what occurs in the connectivity background.\r\nFolks, this is a serious issue that has been torturing a few Delta Chat users (including myself), and messages can be delayed for hours. Some users are losing their temper, and things are derailing a little bit. These users have no idea about Android developer options, some cannot even get to them (and I am quite glad about it, otherwise they might mess up their device). Please have a look at this stuff as soon as possible, thank you very much! :)", "logs": [{"name": "deltachat-log-20220921-131932_2.txt", "url": "https://github.com/deltachat/deltachat-core-rust/files/9675549/deltachat-log-20220921-131932_2.txt"}]}, "pull_request": [{"number": 2403, "url": "https://github.com/deltachat/deltachat-android/pull/2403", "diff_url": "https://github.com/deltachat/deltachat-android/pull/2403.diff", "patch_url": "https://github.com/deltachat/deltachat-android/pull/2403.patch", "title": "use more modern methods to track connectivity changes", "content": "use [`registerDefaultNetworkCallback()`](https://developer.android.com/reference/android/net/ConnectivityManager#registerDefaultNetworkCallback(android.net.ConnectivityManager.NetworkCallback)) instead of [deprecated CONNECTIVITY_ACTION](https://developer.android.com/reference/android/net/ConnectivityManager#CONNECTIVITY_ACTION).\r\n\r\n- there is also a [`registerNetworkCallback()`](https://developer.android.com/reference/android/net/ConnectivityManager#registerNetworkCallback(android.net.NetworkRequest,%20android.app.PendingIntent)) but according to [SO](https://stackoverflow.com/questions/53863034/difference-between-registerdefaultnetworkcallback-and-registernetworkcallback) , that is for less broader usage and won't catch \"more\".\r\n\r\n- it is a bit unclear to me, if the other callbacks are needed, for now, we just log a line. just calling maybe_network everywhere would be too much, as eg. [`onCapabilitiesChanged()`](https://developer.android.com/reference/android/net/ConnectivityManager.NetworkCallback#onCapabilitiesChanged(android.net.Network,%20android.net.NetworkCapabilities)) is called after [`onAvailable()`](https://developer.android.com/reference/android/net/ConnectivityManager.NetworkCallback#onAvailable(android.net.Network)) ... but only since API 26.\r\n\r\nthere should be a review APK build by this pr - maybe this is sufficient for testing? cc @gerryfrancis @Gh0stz0x @link2xt - if not i can also build a \"regular\" APK tomorrow.\r\n\r\nall in all, i am not sure if that fixes the issue. CONNECTIVITY_ACTION is deprecated - but it is still available. and it seems to be still in use by Signal as well. we'll see :)\r\n\r\ntargets #2400", "diff": "diff --git a/src/org/thoughtcrime/securesms/ApplicationContext.java b/src/org/thoughtcrime/securesms/ApplicationContext.java\nindex 11d4bbf46f..fa190cba6a 100644\n--- a/src/org/thoughtcrime/securesms/ApplicationContext.java\n+++ b/src/org/thoughtcrime/securesms/ApplicationContext.java\n@@ -4,6 +4,10 @@\n import android.content.Context;\n import android.content.Intent;\n import android.content.IntentFilter;\n+import android.net.ConnectivityManager;\n+import android.net.LinkProperties;\n+import android.net.NetworkCapabilities;\n+import android.os.Build;\n import android.util.Log;\n \n import androidx.annotation.NonNull;\n@@ -16,9 +20,9 @@\n import androidx.work.WorkManager;\n \n import com.b44t.messenger.DcAccounts;\n-import com.b44t.messenger.DcEventEmitter;\n import com.b44t.messenger.DcContext;\n import com.b44t.messenger.DcEvent;\n+import com.b44t.messenger.DcEventEmitter;\n \n import org.thoughtcrime.securesms.components.emoji.EmojiProvider;\n import org.thoughtcrime.securesms.connect.AccountManager;\n@@ -54,6 +58,11 @@ public class ApplicationContext extends MultiDexApplication {\n   public NotificationCenter     notificationCenter;\n   private JobManager            jobManager;\n \n+  private int                   debugOnAvailableCount;\n+  private int                   debugOnBlockedStatusChangedCount;\n+  private int                   debugOnCapabilitiesChangedCount;\n+  private int                   debugOnLinkPropertiesChangedCount;\n+\n   public static ApplicationContext getInstance(@NonNull Context context) {\n     return (ApplicationContext)context.getApplicationContext();\n   }\n@@ -120,6 +129,33 @@ public void onCreate() {\n \n     new ForegroundDetector(ApplicationContext.getInstance(this));\n \n+    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n+      ConnectivityManager connectivityManager =\n+        (ConnectivityManager) this.getSystemService(Context.CONNECTIVITY_SERVICE);\n+      connectivityManager.registerDefaultNetworkCallback(new ConnectivityManager.NetworkCallback() {\n+        @Override\n+        public void onAvailable(@NonNull android.net.Network network) {\n+          Log.i(\"DeltaChat\", \"++++++++++++++++++ NetworkCallback.onAvailable() #\" + debugOnAvailableCount++);\n+          dcAccounts.maybeNetwork();\n+        }\n+\n+        @Override\n+        public void onBlockedStatusChanged(@NonNull android.net.Network network, boolean blocked) {\n+          Log.i(\"DeltaChat\", \"++++++++++++++++++ NetworkCallback.onBlockedStatusChanged() #\" + debugOnBlockedStatusChangedCount++);\n+        }\n+\n+        @Override\n+        public void onCapabilitiesChanged(@NonNull android.net.Network network, NetworkCapabilities networkCapabilities) {\n+          // usually called after onAvailable(), so a maybeNetwork seems contraproductive\n+          Log.i(\"DeltaChat\", \"++++++++++++++++++ NetworkCallback.onCapabilitiesChanged() #\" + debugOnCapabilitiesChangedCount++);\n+        }\n+\n+        @Override\n+        public void onLinkPropertiesChanged(@NonNull android.net.Network network, LinkProperties linkProperties) {\n+          Log.i(\"DeltaChat\", \"++++++++++++++++++ NetworkCallback.onLinkPropertiesChanged() #\" + debugOnLinkPropertiesChangedCount++);\n+        }\n+      });\n+    } // no else: use old method for debugging\n     BroadcastReceiver networkStateReceiver = new NetworkStateReceiver();\n     registerReceiver(networkStateReceiver, new IntentFilter(android.net.ConnectivityManager.CONNECTIVITY_ACTION));\n \ndiff --git a/src/org/thoughtcrime/securesms/connect/NetworkStateReceiver.java b/src/org/thoughtcrime/securesms/connect/NetworkStateReceiver.java\nindex 03c592a5f4..9b0fb03d85 100644\n--- a/src/org/thoughtcrime/securesms/connect/NetworkStateReceiver.java\n+++ b/src/org/thoughtcrime/securesms/connect/NetworkStateReceiver.java\n@@ -5,12 +5,15 @@\n import android.content.Intent;\n import android.net.ConnectivityManager;\n import android.net.NetworkInfo;\n+import android.os.Build;\n import android.util.Log;\n \n import com.b44t.messenger.DcContext;\n \n public class NetworkStateReceiver extends BroadcastReceiver {\n \n+    private int debugConnectedCount;\n+\n     @Override\n     public void onReceive(Context context, Intent intent) {\n \n@@ -19,8 +22,9 @@ public void onReceive(Context context, Intent intent) {\n             NetworkInfo ni = manager.getActiveNetworkInfo();\n \n             if (ni != null && ni.getState() == NetworkInfo.State.CONNECTED) {\n-                Log.i(\"DeltaChat\", \"++++++++++++++++++ Connected ++++++++++++++++++\");\n-                new Thread(() -> {\n+                Log.i(\"DeltaChat\", \"++++++++++++++++++ Connected #\" + debugConnectedCount++);\n+                if (Build.VERSION.SDK_INT < Build.VERSION_CODES.N) {\n+                  new Thread(() -> {\n                     // call dc_maybe_network() from a worker thread.\n                     // theoretically, dc_maybe_network() can be called from the main thread and returns at once,\n                     // however, in reality, it does currently halt things for some seconds.\n@@ -28,7 +32,8 @@ public void onReceive(Context context, Intent intent) {\n                     Log.i(\"DeltaChat\", \"calling maybeNetwork()\");\n                     DcHelper.getAccounts(context).maybeNetwork();\n                     Log.i(\"DeltaChat\", \"maybeNetwork() returned\");\n-                }).start();\n+                  }).start();\n+                }\n             }\n         }\n         catch (Exception e) {\n", "changes": [{"file": "src/org/thoughtcrime/securesms/ApplicationContext.java", "module": "org.thoughtcrime.securesms.ApplicationContext", "range": [{"start": 7, "end": 7}, {"start": 19, "end": 19}, {"start": 22, "end": 22}, {"start": 57, "end": 57}, {"start": 123, "end": 123}]}, {"file": "src/org/thoughtcrime/securesms/connect/NetworkStateReceiver.java", "module": "org.thoughtcrime.securesms.connect.NetworkStateReceiver", "range": [{"start": 8, "end": 8}, {"start": 14, "end": 14}, {"start": 22, "end": 24}, {"start": 31, "end": 32}]}]}]}
{"url": "https://github.com/deltachat/deltachat-android/issues/1726", "repo": {"url": "https://github.com/deltachat/deltachat-android", "name": "deltachat-android", "owner": "deltachat", "modules": ["chat.delta.rpc", "chat.delta.rpc.types", "chat.delta.util", "com.b44t.messenger", "com.b44t.messenger.uibenchmarks", "com.b44t.messenger.uitests", "com.codewaves.stickyheadergrid", "org.thoughtcrime.securesms", "org.thoughtcrime.securesms.accounts", "org.thoughtcrime.securesms.animation", "org.thoughtcrime.securesms.attachments", "org.thoughtcrime.securesms.audio", "org.thoughtcrime.securesms.calls", "org.thoughtcrime.securesms.components", "org.thoughtcrime.securesms.connect", "org.thoughtcrime.securesms.contacts", "org.thoughtcrime.securesms.crypto", "org.thoughtcrime.securesms.database", "org.thoughtcrime.securesms.geolocation", "org.thoughtcrime.securesms.glide", "org.thoughtcrime.securesms.imageeditor", "org.thoughtcrime.securesms.jobmanager", "org.thoughtcrime.securesms.messagerequests", "org.thoughtcrime.securesms.mms", "org.thoughtcrime.securesms.notifications", "org.thoughtcrime.securesms.permissions", "org.thoughtcrime.securesms.preferences", "org.thoughtcrime.securesms.profiles", "org.thoughtcrime.securesms.providers", "org.thoughtcrime.securesms.proxy", "org.thoughtcrime.securesms.qr", "org.thoughtcrime.securesms.reactions", "org.thoughtcrime.securesms.recipients", "org.thoughtcrime.securesms.scribbles", "org.thoughtcrime.securesms.search", "org.thoughtcrime.securesms.service", "org.thoughtcrime.securesms.util", "org.thoughtcrime.securesms.video"]}, "issue": {"number": 1726, "url": "https://github.com/deltachat/deltachat-android/issues/1726", "state": "closed", "title": "delta stops with some messages", "body": "<!--\r\nThis is a bug report tracker. New features are discussed in the forum: https://support.delta.chat\r\nPlease fill out as much of this form as you can (leaving out stuff that is not applicable is ok).\r\n-->\r\n\r\n- Operating System (Linux/Mac/Windows/iOS/Android): Android\r\n- Delta Chat Version: 1.14.3\r\n- Expected behavior: \r\n- Actual behavior:\r\nI received multiple messages in a group, when I enter the group delta stops, then I go back to antrar and when I scroll to a certain message, delta stops again\r\n- Steps to reproduce the problem:\r\n- Screenshots:\r\n- Logs:\r\n[deltachat-log-20201110-153929.txt](https://github.com/deltachat/deltachat-android/files/5524742/deltachat-log-20201110-153929.txt)\r\n\r\n", "logs": [{"name": "deltachat-log-20201110-153929.txt", "url": "https://github.com/deltachat/deltachat-android/files/5524742/deltachat-log-20201110-153929.txt"}]}, "pull_request": [{"number": 1729, "url": "https://github.com/deltachat/deltachat-android/pull/1729", "diff_url": "https://github.com/deltachat/deltachat-android/pull/1729.diff", "patch_url": "https://github.com/deltachat/deltachat-android/pull/1729.patch", "title": "Fix #1726", "content": "@agutierrez25249 this should prevent the crash but maybe the concerning message is not displayed correctly, please check this when you get my fix.\r\n\r\nMaybe it quotes a sticker and this does not work correctly?", "diff": "diff --git a/src/org/thoughtcrime/securesms/ConversationItem.java b/src/org/thoughtcrime/securesms/ConversationItem.java\nindex 3d5ea4d954..553060c72c 100644\n--- a/src/org/thoughtcrime/securesms/ConversationItem.java\n+++ b/src/org/thoughtcrime/securesms/ConversationItem.java\n@@ -21,11 +21,6 @@\n import android.content.res.TypedArray;\n import android.graphics.Color;\n import android.graphics.PorterDuff;\n-import androidx.annotation.DimenRes;\n-import androidx.annotation.NonNull;\n-import androidx.annotation.Nullable;\n-import androidx.appcompat.app.AlertDialog;\n-\n import android.graphics.Rect;\n import android.text.SpannableString;\n import android.text.Spanned;\n@@ -40,6 +35,11 @@\n import android.widget.LinearLayout;\n import android.widget.TextView;\n \n+import androidx.annotation.DimenRes;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.appcompat.app.AlertDialog;\n+\n import com.b44t.messenger.DcChat;\n import com.b44t.messenger.DcContact;\n import com.b44t.messenger.DcMsg;\n@@ -571,7 +571,10 @@ private void setQuote(@NonNull DcMsg current) {\n     if (msg != null) {\n       author = dcContext.getRecipient(dcContext.getContact(msg.getFromId()));\n       if (msg.getType() != DcMsg.DC_MSG_TEXT) {\n-        slideDeck.addSlide(MediaUtil.getSlideForMsg(context, msg));\n+        Slide slide = MediaUtil.getSlideForMsg(context, msg);\n+        if (slide != null) {\n+          slideDeck.addSlide(slide);\n+        }\n       }\n     }\n \n", "changes": [{"file": "src/org/thoughtcrime/securesms/ConversationItem.java", "module": "org.thoughtcrime.securesms.ConversationItem", "range": [{"start": 24, "end": 28}, {"start": 43, "end": 43}, {"start": 574, "end": 575}]}]}]}
{"url": "https://github.com/deltachat/deltachat-android/issues/1549", "repo": {"url": "https://github.com/deltachat/deltachat-android", "name": "deltachat-android", "owner": "deltachat", "modules": ["chat.delta.rpc", "chat.delta.rpc.types", "chat.delta.util", "com.b44t.messenger", "com.b44t.messenger.uibenchmarks", "com.b44t.messenger.uitests", "com.codewaves.stickyheadergrid", "org.thoughtcrime.securesms", "org.thoughtcrime.securesms.accounts", "org.thoughtcrime.securesms.animation", "org.thoughtcrime.securesms.attachments", "org.thoughtcrime.securesms.audio", "org.thoughtcrime.securesms.calls", "org.thoughtcrime.securesms.components", "org.thoughtcrime.securesms.connect", "org.thoughtcrime.securesms.contacts", "org.thoughtcrime.securesms.crypto", "org.thoughtcrime.securesms.database", "org.thoughtcrime.securesms.geolocation", "org.thoughtcrime.securesms.glide", "org.thoughtcrime.securesms.imageeditor", "org.thoughtcrime.securesms.jobmanager", "org.thoughtcrime.securesms.messagerequests", "org.thoughtcrime.securesms.mms", "org.thoughtcrime.securesms.notifications", "org.thoughtcrime.securesms.permissions", "org.thoughtcrime.securesms.preferences", "org.thoughtcrime.securesms.profiles", "org.thoughtcrime.securesms.providers", "org.thoughtcrime.securesms.proxy", "org.thoughtcrime.securesms.qr", "org.thoughtcrime.securesms.reactions", "org.thoughtcrime.securesms.recipients", "org.thoughtcrime.securesms.scribbles", "org.thoughtcrime.securesms.search", "org.thoughtcrime.securesms.service", "org.thoughtcrime.securesms.util", "org.thoughtcrime.securesms.video"]}, "issue": {"number": 1549, "url": "https://github.com/deltachat/deltachat-android/issues/1549", "state": "closed", "title": "Camera (live view) turned off (black screen) after rotating device", "body": "- Operating System (Linux/Mac/Windows/iOS/Android):\r\nAndroid 10 on Fairphone FP2 (Lineage OS 17.1 build QQ3A.200705.002 from 2020-08-07).\r\n\r\n- Delta Chat Version:\r\n1.12.2.\r\n\r\n- Expected behavior:\r\nWhen live view of the camera is turned on (to take a photo), rotating the device adapts the view (from portrait to landscape or vice-versa).\r\n\r\n- Actual behavior:\r\nWhen live view of the camera is turned on (to take a photo), rotating the device turns the camera off and the screen is black. (However, the navigation bar on the right is visible works.)\r\n\r\n- Steps to reproduce the problem:\r\n-- Start a chat.\r\n-- Tap the camera icon to activate the camera.\r\n-- Rotate the device. (Result: The camera turns black.)\r\n\r\n- Screenshots:\r\nN/A.\r\n\r\n- Logs:\r\n[deltachat.txt](https://github.com/deltachat/deltachat-android/files/5068659/deltachat.txt)\r\n\r\n\r\n- Remarks:\r\n-- Rotation of screen is configured and works.\r\n-- Changing the camera (from front to back or vice-versa) brings the view back. For now, a possible workaround is to change the camera twice.", "logs": [{"name": "deltachat.txt", "url": "https://github.com/deltachat/deltachat-android/files/5068659/deltachat.txt"}]}, "pull_request": [{"number": 1575, "url": "https://github.com/deltachat/deltachat-android/pull/1575", "diff_url": "https://github.com/deltachat/deltachat-android/pull/1575.diff", "patch_url": "https://github.com/deltachat/deltachat-android/pull/1575.patch", "title": "reinitialize camera on orientation change", "content": "fixes #1549 \r\n\r\nit is 'inspired' by the way the Flip button works: https://github.com/deltachat/deltachat-android/blob/master/src/org/thoughtcrime/securesms/components/camera/CameraView.java#L264\r\n\r\nhowever the aspect ratio is still awful (at least on my device), but that's an unrelated issue. ", "diff": "diff --git a/src/org/thoughtcrime/securesms/components/camera/QuickAttachmentDrawer.java b/src/org/thoughtcrime/securesms/components/camera/QuickAttachmentDrawer.java\nindex 1cdeef1e05..249daaedc7 100644\n--- a/src/org/thoughtcrime/securesms/components/camera/QuickAttachmentDrawer.java\n+++ b/src/org/thoughtcrime/securesms/components/camera/QuickAttachmentDrawer.java\n@@ -108,11 +108,12 @@ public void onConfigurationChanged() {\n     final boolean rotationChanged = this.rotation != rotation;\n     this.rotation = rotation;\n     if (rotationChanged) {\n+      updateControlsView();\n+      setDrawerStateAndUpdate(drawerState, true);\n       if (isShowing()) {\n         cameraView.onPause();\n+        cameraView.onResume();\n       }\n-      updateControlsView();\n-      setDrawerStateAndUpdate(drawerState, true);\n     }\n   }\n \n", "changes": [{"file": "src/org/thoughtcrime/securesms/components/camera/QuickAttachmentDrawer.java", "module": "org.thoughtcrime.securesms.components.camera.QuickAttachmentDrawer", "range": [{"start": 111, "end": 111}, {"start": 113, "end": 113}, {"start": 114, "end": 115}]}]}]}
{"url": "https://github.com/deltachat/deltachat-android/issues/1544", "repo": {"url": "https://github.com/deltachat/deltachat-android", "name": "deltachat-android", "owner": "deltachat", "modules": ["chat.delta.rpc", "chat.delta.rpc.types", "chat.delta.util", "com.b44t.messenger", "com.b44t.messenger.uibenchmarks", "com.b44t.messenger.uitests", "com.codewaves.stickyheadergrid", "org.thoughtcrime.securesms", "org.thoughtcrime.securesms.accounts", "org.thoughtcrime.securesms.animation", "org.thoughtcrime.securesms.attachments", "org.thoughtcrime.securesms.audio", "org.thoughtcrime.securesms.calls", "org.thoughtcrime.securesms.components", "org.thoughtcrime.securesms.connect", "org.thoughtcrime.securesms.contacts", "org.thoughtcrime.securesms.crypto", "org.thoughtcrime.securesms.database", "org.thoughtcrime.securesms.geolocation", "org.thoughtcrime.securesms.glide", "org.thoughtcrime.securesms.imageeditor", "org.thoughtcrime.securesms.jobmanager", "org.thoughtcrime.securesms.messagerequests", "org.thoughtcrime.securesms.mms", "org.thoughtcrime.securesms.notifications", "org.thoughtcrime.securesms.permissions", "org.thoughtcrime.securesms.preferences", "org.thoughtcrime.securesms.profiles", "org.thoughtcrime.securesms.providers", "org.thoughtcrime.securesms.proxy", "org.thoughtcrime.securesms.qr", "org.thoughtcrime.securesms.reactions", "org.thoughtcrime.securesms.recipients", "org.thoughtcrime.securesms.scribbles", "org.thoughtcrime.securesms.search", "org.thoughtcrime.securesms.service", "org.thoughtcrime.securesms.util", "org.thoughtcrime.securesms.video"]}, "issue": {"number": 1544, "url": "https://github.com/deltachat/deltachat-android/issues/1544", "state": "closed", "title": "image rotation not working sometimes", "body": "\r\n[deltachat-log-20200812-091030.txt](https://github.com/deltachat/deltachat-android/files/5062858/deltachat-log-20200812-091030.txt)\r\n[deltachat-log-20200812-091030.txt]\r\n\r\nSeen in Android 9 phone with the Google keyboard and Delta Chat 1.12.1 on redmi note 8 in MIUI 11 on the last patch, maybe it are the Android 9  \r\n\r\n\r\n**How do the bug:** \r\n- open Delta Chat on landscape mode\r\n- go to chat with a Image(in my case .png)\r\n- put the keyboard in fullscreen likewise you are trying to do a message\r\n- rotate to portrait again", "logs": [{"name": "deltachat-log-20200812-091030.txt", "url": "https://github.com/deltachat/deltachat-android/files/5062858/deltachat-log-20200812-091030.txt"}]}, "pull_request": [{"number": 1562, "url": "https://github.com/deltachat/deltachat-android/pull/1562", "diff_url": "https://github.com/deltachat/deltachat-android/pull/1562.diff", "patch_url": "https://github.com/deltachat/deltachat-android/pull/1562.patch", "title": "Almost fix #1544 image rotation not working sometimes", "content": "Almost fix #1544 image rotation not working sometimes.\r\n\r\nI did not find any better way to do this. Now it is not crashing anymore but it jumps again.", "diff": "diff --git a/src/org/thoughtcrime/securesms/components/ScaleStableImageView.java b/src/org/thoughtcrime/securesms/components/ScaleStableImageView.java\nindex b817fae1a8..7655d41306 100644\n--- a/src/org/thoughtcrime/securesms/components/ScaleStableImageView.java\n+++ b/src/org/thoughtcrime/securesms/components/ScaleStableImageView.java\n@@ -112,9 +112,11 @@ protected void onSizeChanged(int width, int height, int oldWidth, int oldHeight)\n                 large = storedSizes.get(landscapeWidth + \"x\" + landscapeHeight);\n             if (large == null) return; // no baseline. can't work.\n             Bitmap original = ((BitmapDrawable) large).getBitmap();\n-            Bitmap cropped = Bitmap.createBitmap(original, 0, 0, width, height);\n-            Drawable croppedDrawable = new BitmapDrawable(getResources(), cropped);\n-            overrideDrawable(croppedDrawable);\n+            if (height <= original.getHeight() || width <= original.getWidth()) {\n+                Bitmap cropped = Bitmap.createBitmap(original, 0, 0, width, height);\n+                Drawable croppedDrawable = new BitmapDrawable(getResources(), cropped);\n+                overrideDrawable(croppedDrawable);\n+            }\n         } else {\n             Util.runOnBackground(() -> {\n                 Bitmap bitmap = ((BitmapDrawable) defaultDrawable).getBitmap();\n", "changes": [{"file": "src/org/thoughtcrime/securesms/components/ScaleStableImageView.java", "module": "org.thoughtcrime.securesms.components.ScaleStableImageView", "range": [{"start": 115, "end": 118}]}]}]}
{"url": "https://github.com/project-travel-mate/Travel-Mate/issues/623", "repo": {"url": "https://github.com/project-travel-mate/Travel-Mate", "name": "Travel-Mate", "owner": "project-travel-mate", "modules": ["adapters", "dao", "database", "flipviewpager.adapter", "flipviewpager.utils", "flipviewpager.view", "io.github.project_travel_mate", "io.github.project_travel_mate.destinations", "io.github.project_travel_mate.destinations.description", "io.github.project_travel_mate.destinations.funfacts", "io.github.project_travel_mate.favourite", "io.github.project_travel_mate.friend", "io.github.project_travel_mate.login", "io.github.project_travel_mate.mytrips", "io.github.project_travel_mate.notifications", "io.github.project_travel_mate.roompersistence", "io.github.project_travel_mate.searchcitydialog", "io.github.project_travel_mate.travel", "io.github.project_travel_mate.travel.swipefragmentrealtime", "io.github.project_travel_mate.travel.swipefragmentrealtime.modefragments", "io.github.project_travel_mate.utilities", "io.github.project_travel_mate.utilities.helper", "objects", "utils", "views", "widget"]}, "issue": {"number": 623, "url": "https://github.com/project-travel-mate/Travel-Mate/issues/623", "state": "closed", "title": "[ Travel Mate version 5.4.0 ]  In landscape mode Rename option is not working properly ", "body": "#### Project Information\r\n* Repository    :  https://github.com/project-travel-mate/Travel-Mate\r\n* Project Name  :  Travel Mate\r\n* Publisher     :  Swati Garg\r\n\r\n#### Expected behavior\r\n\r\nI expected that when I change the profile name   in landscape mode the profile name should be changed\r\n\r\n#### Actual behavior\r\n\r\nafter opening the application when I try to change profile name in landscape mode   Profile name would not have been changed. you can see in bug video properly \r\n\r\n#### How to reproduce\r\n* [Download ](https://play.google.com/store/apps/details?id=io.github.project_travel_mate)and open the application\r\n*  click on your profile\r\n*  rotate your phone screen portrait to landscape \r\n* click on  rename icon\r\n* enter the new name \r\n* rotate your phone screen landscape to portrait  \r\n* Note the Bug\r\n* Browser/App version:    5.4.0\r\n* Operating system:  8.0.0 \r\n\r\n#### Recording Of The Bug\r\nhttps://youtu.be/eSTs5xwlutY\r\n#### GitHub Account\r\nhttps://github.com/XAMIR555\r\n\r\n# Logcat\r\n\r\n[logcat.txt](https://github.com/project-travel-mate/Travel-Mate/files/3109410/logcat.txt)\r\n", "logs": [{"name": "logcat.txt", "url": "https://github.com/project-travel-mate/Travel-Mate/files/3109410/logcat.txt"}]}, "pull_request": [{"number": 624, "url": "https://github.com/project-travel-mate/Travel-Mate/pull/624", "diff_url": "https://github.com/project-travel-mate/Travel-Mate/pull/624.diff", "patch_url": "https://github.com/project-travel-mate/Travel-Mate/pull/624.patch", "title": "Fixed behavior of display Name in Profile Activity", "content": "## Description\r\nFixed behavior of display Name in Profile Activity\r\n\r\nFixes #623 \r\n\r\n## Type of change\r\nJust put an x in the [] which are valid.\r\n- [x] Bug fix (non-breaking change which fixes an issue)\r\n- [ ] New feature (non-breaking change which adds functionality)\r\n- [ ] Breaking change (fix or feature that would cause existing functionality to not work as expected)\r\n\r\n# How Has This Been Tested?\r\n\r\nPlease describe the tests that you ran to verify your changes.\r\n- [x] `./gradlew assembleDebug assembleRelease`\r\n- [x] `./gradlew checkstyle`\r\n\r\n# Checklist:\r\n- [x] My code follows the style guidelines of this project\r\n- [x] I have performed a self-review of my own code\r\n- [ ] I have commented my code, particularly in hard-to-understand areas\r\n- [x] I have made corresponding changes to the documentation\r\n- [x] My changes generate no new warnings\r\n", "diff": "diff --git a/Android/app/src/main/AndroidManifest.xml b/Android/app/src/main/AndroidManifest.xml\nindex c46f91294d..4d78a8b8e8 100644\n--- a/Android/app/src/main/AndroidManifest.xml\n+++ b/Android/app/src/main/AndroidManifest.xml\n@@ -125,7 +125,8 @@\n                 android:resource=\"@xml/provider_paths\" />\n         </provider>\n \n-        <activity android:name=\".ProfileActivity\" />\n+        <activity android:name=\".ProfileActivity\"\n+                  android:configChanges=\"orientation|screenSize\" />\n         <activity android:name=\".friend.FriendsProfileActivity\" />\n         <activity android:name=\".notifications.NotificationsActivity\" />\n         <activity\n", "changes": [{"file": "Android/app/src/main/AndroidManifest.xml", "module": "ProfileActivity", "range": [{"start": 128, "end": 129}]}]}]}
{"url": "https://github.com/PhilKes/NotallyX/issues/323", "repo": {"url": "https://github.com/PhilKes/NotallyX", "name": "NotallyX", "owner": "PhilKes", "modules": ["android.print", "androidx.recyclerview.widget", "com.philkes.notallyx", "com.philkes.notallyx.changehistory", "com.philkes.notallyx.data", "com.philkes.notallyx.data.dao", "com.philkes.notallyx.data.imports", "com.philkes.notallyx.data.imports.evernote", "com.philkes.notallyx.data.imports.google", "com.philkes.notallyx.data.imports.json", "com.philkes.notallyx.data.imports.txt", "com.philkes.notallyx.data.model", "com.philkes.notallyx.presentation", "com.philkes.notallyx.presentation.activity", "com.philkes.notallyx.presentation.activity.main", "com.philkes.notallyx.presentation.activity.main.fragment", "com.philkes.notallyx.presentation.activity.main.fragment.settings", "com.philkes.notallyx.presentation.activity.note", "com.philkes.notallyx.presentation.activity.note.reminders", "com.philkes.notallyx.presentation.view.main", "com.philkes.notallyx.presentation.view.main.label", "com.philkes.notallyx.presentation.view.main.reminder", "com.philkes.notallyx.presentation.view.main.sorting", "com.philkes.notallyx.presentation.view.misc", "com.philkes.notallyx.presentation.view.misc.tristatecheckbox", "com.philkes.notallyx.presentation.view.note", "com.philkes.notallyx.presentation.view.note.action", "com.philkes.notallyx.presentation.view.note.audio", "com.philkes.notallyx.presentation.view.note.image", "com.philkes.notallyx.presentation.view.note.listitem", "com.philkes.notallyx.presentation.view.note.listitem.adapter", "com.philkes.notallyx.presentation.view.note.listitem.sorting", "com.philkes.notallyx.presentation.view.note.preview", "com.philkes.notallyx.presentation.viewmodel", "com.philkes.notallyx.presentation.viewmodel.preference", "com.philkes.notallyx.presentation.widget", "com.philkes.notallyx.recyclerview.listmanager", "com.philkes.notallyx.sorting", "com.philkes.notallyx.test", "com.philkes.notallyx.utils", "com.philkes.notallyx.utils.audio", "com.philkes.notallyx.utils.backup", "com.philkes.notallyx.utils.changehistory", "com.philkes.notallyx.utils.security"]}, "issue": {"number": 323, "url": "https://github.com/PhilKes/NotallyX/issues/323", "state": "closed", "title": "Background crashes", "body": "### What happened?\n\nThe app crushes if left running on background for a while.\n\n### Screenshots\n\n![Image](https://github.com/user-attachments/assets/61b982f1-46f1-4051-b2e6-468d76e85139)\n\n### App Version\n\n7.0.0\n\n### Android Version\n\n15 (GrapheneOS)\n\n### Logs\n\nCollected with the native tool in GOS: [NotallyX log dab9a0a9227f.txt](https://github.com/user-attachments/files/18586354/NotallyX.log.dab9a0a9227f.txt)", "logs": [{"name": "NotallyX log dab9a0a9227f.txt", "url": "https://github.com/user-attachments/files/18586354/NotallyX.log.dab9a0a9227f.txt"}]}, "pull_request": [{"number": 417, "url": "https://github.com/PhilKes/NotallyX/pull/417", "diff_url": "https://github.com/PhilKes/NotallyX/pull/417.diff", "patch_url": "https://github.com/PhilKes/NotallyX/pull/417.patch", "title": "Correctly reload state if EditActivity was destroyed by system", "content": "Fixes #408 \r\nFixes #323", "diff": "diff --git a/app/src/main/java/com/philkes/notallyx/presentation/activity/note/EditActivity.kt b/app/src/main/java/com/philkes/notallyx/presentation/activity/note/EditActivity.kt\nindex 3baf8b37..2711645e 100644\n--- a/app/src/main/java/com/philkes/notallyx/presentation/activity/note/EditActivity.kt\n+++ b/app/src/main/java/com/philkes/notallyx/presentation/activity/note/EditActivity.kt\n@@ -156,7 +156,7 @@ abstract class EditActivity(private val type: Type) :\n             val persistedId = savedInstanceState?.getLong(\"id\")\n             val selectedId = intent.getLongExtra(EXTRA_SELECTED_BASE_NOTE, 0L)\n             val id = persistedId ?: selectedId\n-            if (persistedId == null) {\n+            if (persistedId == null || notallyModel.originalNote == null) {\n                 notallyModel.setState(id)\n             }\n             if (notallyModel.isNewNote && intent.action == Intent.ACTION_SEND) {\ndiff --git a/app/src/main/java/com/philkes/notallyx/presentation/viewmodel/NotallyModel.kt b/app/src/main/java/com/philkes/notallyx/presentation/viewmodel/NotallyModel.kt\nindex a82e3ab6..45ad195c 100644\n--- a/app/src/main/java/com/philkes/notallyx/presentation/viewmodel/NotallyModel.kt\n+++ b/app/src/main/java/com/philkes/notallyx/presentation/viewmodel/NotallyModel.kt\n@@ -96,7 +96,7 @@ class NotallyModel(private val app: Application) : AndroidViewModel(app) {\n     var audioRoot = app.getExternalAudioDirectory()\n     var filesRoot = app.getExternalFilesDirectory()\n \n-    private lateinit var originalNote: BaseNote\n+    var originalNote: BaseNote? = null\n \n     init {\n         database.observeForever { baseNoteDao = it.getBaseNoteDao() }\n@@ -284,7 +284,7 @@ class NotallyModel(private val app: Application) : AndroidViewModel(app) {\n             app.checkAutoSave(\n                 preferences,\n                 note = note,\n-                forceFullBackup = originalNote.attachmentsDifferFrom(note),\n+                forceFullBackup = originalNote?.attachmentsDifferFrom(note) == true,\n             )\n             return@withContext id\n         }\n", "changes": [{"file": "app/src/main/java/com/philkes/notallyx/presentation/activity/note/EditActivity.kt", "module": "com.philkes.notallyx.presentation.activity.note.EditActivity", "range": [{"start": 159, "end": 160}]}, {"file": "app/src/main/java/com/philkes/notallyx/presentation/viewmodel/NotallyModel.kt", "module": "com.philkes.notallyx.presentation.viewmodel.NotallyModel", "range": [{"start": 99, "end": 100}, {"start": 287, "end": 288}]}]}]}
{"url": "https://github.com/SORMAS-Foundation/SORMAS-Project/issues/12332", "repo": {"url": "https://github.com/SORMAS-Foundation/SORMAS-Project", "name": "SORMAS-Project", "owner": "SORMAS-Foundation", "modules": ["customreport.chartbuilder", "customreport.data", "customreport.reportbuilder", "de.symeda.junit.cdi", "de.symeda.sormas.api", "de.symeda.sormas.app", "de.symeda.sormas.backend", "de.symeda.sormas.providers", "de.symeda.sormas.rest", "de.symeda.sormas.ui", "gatling.constants", "gatling.envconfig.configprovider", "gatling.envconfig.constants", "gatling.envconfig.dto", "gatling.envconfig.dto.demis", "gatling.envconfig.manager", "gatling.environmentdata.constants", "gatling.environmentdata.dto", "gatling.environmentdata.manager", "gatling.restassured", "gatling.restassured.constants", "gatling.restassured.dtos", "gatling.simulator", "gatling.tests.GET.allUUIDS", "gatling.tests.GET.entity", "gatling.utils", "org.junit.rules", "org.junit.runners.model", "org.sormas.e2etests.common", "org.sormas.e2etests.constants", "org.sormas.e2etests.entities", "org.sormas.e2etests.enums", "org.sormas.e2etests.envconfig", "org.sormas.e2etests.helpers", "org.sormas.e2etests.pages", "org.sormas.e2etests.runner", "org.sormas.e2etests.state", "org.sormas.e2etests.steps", "org.sormas.e2etests.webdriver", "recorders"]}, "issue": {"number": 12332, "url": "https://github.com/SORMAS-Foundation/SORMAS-Project/issues/12332", "state": "closed", "title": "Synchronization fails on newer versions with a long-running system", "body": "### Bug Description\n\nSynchronization failed after mobile app upgraded to the version on the server\n\n### Reproduction Steps\n\n1. Connect the mobile app to https://release-international.sormas.netzlink.com/sormas-ui/ using surveillance officer + contact officer role\r\n2. Synchronize the app \r\n...\r\n\n\n### Expected Behavior\n\nApp should synchronize successfully, there should be no red arrow message \"\"Synchronizaton failed, please try later\"\n\n### Affected Area(s)\n\nAndroid app\n\n### SORMAS Version\n\n1.86.0\n\n### Android version/Browser\n\nA 11\n\n### User Role(s)\n\nSurveillance officer + contact officer\n\n### Server URL\n\nhttps://release-international.sormas.netzlink.com/sormas-ui/\n\n### Additional Information\n\ntablet log\r\n[android-debug.log](https://github.com/SORMAS-Foundation/SORMAS-Project/files/12130060/android-debug.log)\r\n", "logs": [{"name": "android-debug.log", "url": "https://github.com/SORMAS-Foundation/SORMAS-Project/files/12130060/android-debug.log"}]}, "pull_request": [{"number": 12382, "url": "https://github.com/SORMAS-Foundation/SORMAS-Project/pull/12382", "diff_url": "https://github.com/SORMAS-Foundation/SORMAS-Project/pull/12382.diff", "patch_url": "https://github.com/SORMAS-Foundation/SORMAS-Project/pull/12382.patch", "title": "#12332 - Remove unsupported feature config", "content": "<!--\r\nIf you've never submitted a pull request to the SORMAS repository before or this is your first time using this template, please read the Contributing guidelines (https://github.com/sormas-foundation/SORMAS-Project/blob/development/docs/CONTRIBUTING.md) for an explanation of our guidelines regarding pull requests. You don't have to remove this comment or from your pull request as it will automatically be hidden.\r\n\r\nPlease specify the number of the issue this pull request is related to after the #.\r\n-->\r\nFixes #12332", "diff": "diff --git a/sormas-app/app/src/main/java/de/symeda/sormas/app/backend/common/DatabaseHelper.java b/sormas-app/app/src/main/java/de/symeda/sormas/app/backend/common/DatabaseHelper.java\nindex 704cde9b961..1991f48b4a9 100644\n--- a/sormas-app/app/src/main/java/de/symeda/sormas/app/backend/common/DatabaseHelper.java\n+++ b/sormas-app/app/src/main/java/de/symeda/sormas/app/backend/common/DatabaseHelper.java\n@@ -188,7 +188,7 @@ public class DatabaseHelper extends OrmLiteSqliteOpenHelper {\n \tpublic static final String DATABASE_NAME = \"sormas.db\";\n \t// any time you make changes to your database objects, you may have to increase the database version\n \n-\tpublic static final int DATABASE_VERSION = 346;\n+\tpublic static final int DATABASE_VERSION = 347;\n \n \tprivate static DatabaseHelper instance = null;\n \n@@ -3081,6 +3081,10 @@ public void onUpgrade(SQLiteDatabase db, ConnectionSource connectionSource, int\n \t\t\t\t\t\t+ \"waterType, otherWaterType, infrastructureDetails, otherInfrastructureDetails, waterUse, otherWaterUse, location_id, id FROM tmp_environments\");\n \t\t\t\tgetDao(Environment.class).executeRaw(\"DROP TABLE tmp_environments\");\n \n+\t\t\tcase 346:\n+\t\t\t\tcurrentVersion = 346;\n+\t\t\t\tgetDao(FeatureConfiguration.class).executeRaw(\"DELETE FROM featureConfiguration WHERE featureType = 'DASHBOARD';\");\n+\n \t\t\t\t// ATTENTION: break should only be done after last version\n \t\t\t\tbreak;\n \n", "changes": [{"file": "sormas-app/app/src/main/java/de/symeda/sormas/app/backend/common/DatabaseHelper.java", "module": "de.symeda.sormas.app.backend.common.DatabaseHelper", "range": [{"start": 191, "end": 192}, {"start": 3084, "end": 3084}]}]}]}
{"url": "https://github.com/albu-razvan/Stario/issues/64", "repo": {"url": "https://github.com/albu-razvan/Stario", "name": "Stario", "owner": "albu-razvan", "modules": ["androidx.core.widget", "com.stario.launcher", "com.stario.launcher.activities.launcher", "com.stario.launcher.activities.pages", "com.stario.launcher.activities.settings", "com.stario.launcher.apps", "com.stario.launcher.apps.interfaces", "com.stario.launcher.apps.popup", "com.stario.launcher.exceptions", "com.stario.launcher.hidden", "com.stario.launcher.preferences", "com.stario.launcher.services", "com.stario.launcher.sheet", "com.stario.launcher.sheet.behavior", "com.stario.launcher.sheet.briefing", "com.stario.launcher.sheet.drawer", "com.stario.launcher.sheet.widgets", "com.stario.launcher.themes", "com.stario.launcher.ui", "com.stario.launcher.ui.common", "com.stario.launcher.ui.dialogs", "com.stario.launcher.ui.icons", "com.stario.launcher.ui.keyboard", "com.stario.launcher.ui.popup", "com.stario.launcher.ui.recyclers", "com.stario.launcher.ui.utils", "com.stario.launcher.ui.widgets", "com.stario.launcher.utils", "com.stario.launcher.utils.media", "com.stario.launcher.utils.objects"]}, "issue": {"number": 64, "url": "https://github.com/albu-razvan/Stario/issues/64", "state": "closed", "title": "Scrolling in App Drawer Causes Crashes", "body": "Logcat:\r\n[app_logcat.txt](https://github.com/user-attachments/files/18054372/app_logcat.txt)\r\n\r\n\r\n", "logs": [{"name": "app_logcat.txt", "url": "https://github.com/user-attachments/files/18054372/app_logcat.txt"}]}, "pull_request": [{"number": 72, "url": "https://github.com/albu-razvan/Stario/pull/72", "diff_url": "https://github.com/albu-razvan/Stario/pull/72.diff", "patch_url": "https://github.com/albu-razvan/Stario/pull/72.patch", "title": "#64 Fix AdaptiveIconView drawing null pointer", "content": null, "diff": "diff --git a/.idea/modules.xml b/.idea/modules.xml\ndeleted file mode 100644\nindex 30da47f..0000000\n--- a/.idea/modules.xml\n+++ /dev/null\n@@ -1,8 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<project version=\"4\">\n-  <component name=\"ProjectModuleManager\">\n-    <modules>\n-      <module fileurl=\"file://$PROJECT_DIR$/.idea/modules/app/stario.app.main.iml\" filepath=\"$PROJECT_DIR$/.idea/modules/app/stario.app.main.iml\" />\n-    </modules>\n-  </component>\n-</project>\n\\ No newline at end of file\ndiff --git a/.idea/modules/app/stario.app.main.iml b/.idea/modules/app/stario.app.main.iml\ndeleted file mode 100644\nindex 7a596dc..0000000\n--- a/.idea/modules/app/stario.app.main.iml\n+++ /dev/null\n@@ -1,8 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<module version=\"4\">\n-  <component name=\"AdditionalModuleElements\">\n-    <content url=\"file://$MODULE_DIR$/../../../app/src/debug\" dumb=\"true\">\n-      <sourceFolder url=\"file://$MODULE_DIR$/../../../app/src/debug/res\" type=\"java-resource\" />\n-    </content>\n-  </component>\n-</module>\n\\ No newline at end of file\ndiff --git a/app/.gitignore b/app/.gitignore\nindex 956c004..67aaf57 100644\n--- a/app/.gitignore\n+++ b/app/.gitignore\n@@ -1,2 +1,3 @@\n /build\n-/release\n\\ No newline at end of file\n+/release\n+/debug\n\\ No newline at end of file\ndiff --git a/app/proguard-rules.txt b/app/proguard-rules.txt\nindex 1564ab3..b6b266d 100644\n--- a/app/proguard-rules.txt\n+++ b/app/proguard-rules.txt\n@@ -1,4 +1,5 @@\n -keep class android.app.WallpaperManager { *; }\n+-keep class android.animation.LayoutTransition { *; }\n -keep class org.chickenhook.restrictionbypass.** { *; }\n -keep class com.ctc.wstx.stax.** { *; }\n -dontwarn aQute.bnd.annotation.spi.ServiceProvider\ndiff --git a/app/src/main/java/com/stario/launcher/ui/icons/AdaptiveIconView.java b/app/src/main/java/com/stario/launcher/ui/icons/AdaptiveIconView.java\nindex f39f495..6deb5e4 100644\n--- a/app/src/main/java/com/stario/launcher/ui/icons/AdaptiveIconView.java\n+++ b/app/src/main/java/com/stario/launcher/ui/icons/AdaptiveIconView.java\n@@ -37,8 +37,8 @@\n \n import com.stario.launcher.R;\n import com.stario.launcher.activities.settings.dialogs.icons.IconsDialog;\n-import com.stario.launcher.preferences.Entry;\n import com.stario.launcher.apps.IconPackManager;\n+import com.stario.launcher.preferences.Entry;\n import com.stario.launcher.ui.measurements.Measurements;\n import com.stario.launcher.utils.objects.ObjectInvalidateDelegate;\n import com.stario.launcher.utils.objects.ObjectRemeasureDelegate;\n@@ -264,16 +264,22 @@ public void draw(@NonNull Canvas canvas) {\n \n     @Override\n     public void onDraw(@NonNull Canvas canvas) {\n-        super.onDraw(canvas);\n-\n         if (icon.getValue() != null) {\n             Drawable icon = this.icon.getValue();\n \n             if (icon instanceof AdaptiveIconDrawable) {\n                 AdaptiveIconDrawable adaptiveIconDrawable = (AdaptiveIconDrawable) icon;\n \n-                adaptiveIconDrawable.getBackground().draw(canvas);\n-                adaptiveIconDrawable.getForeground().draw(canvas);\n+                Drawable background = adaptiveIconDrawable.getBackground();\n+                Drawable foreground = adaptiveIconDrawable.getForeground();\n+\n+                if (background != null) {\n+                    background.draw(canvas);\n+                }\n+\n+                if (foreground != null) {\n+                    foreground.draw(canvas);\n+                }\n             } else {\n                 icon.draw(canvas);\n             }\n", "changes": [{"file": "app/src/main/java/com/stario/launcher/ui/icons/AdaptiveIconView.java", "module": "com.stario.launcher.ui.icons.AdaptiveIconView", "range": [{"start": 40, "end": 40}, {"start": 42, "end": 42}, {"start": 267, "end": 268}, {"start": 275, "end": 277}]}]}]}
